/*!CK:984240345!*//*1421879853,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["KBJgq"]); }

__d("PerfXClientMetricsConfig",[],function(a,b,c,d,e,f){e.exports={LOGGER_CONFIG:"PerfXClientMetricsLoggerConfig"};},null);
__d("PerfXLogger",["Arbiter","BanzaiLogger","PerfXClientMetricsConfig","Run","performance"],function(a,b,c,d,e,f,g,h,i,j,k){var l={},m='BigPipe/init',n='tti_bigpipe',o='pagelet_event',p='ajaxpipe/onload_callback',q=i.LOGGER_CONFIG,r={},s={listenersSetUp:false,setupListeners:function(){if(this.listenersSetUp)return;g.subscribe(m,function(event,t){var u=t.arbiter;this.subscribeToTTI(u);this.subscribeToPageletEvents(u);this.subscribeToAjaxPipeOnload(u);}.bind(this));this.listenersSetUp=true;},init:function(t,u,v){l[t]={perfx_page:u,perfx_page_type:v};this.setupListeners();},initForPageLoad:function(t,u,v){this.init(t,u,v);j.onAfterLoad(this.finishPageload.bind(this,t));},initForQuickling:function(t,u,v,w){this.init(t,u,v);r[t]=w;},subscribeToTTI:function(t){t.subscribe(n,function(event,u){var v=u.lid;if(!(v in l))return;l[v].tti=u.ts;});},subscribeToPageletEvents:function(t){t.subscribe(o,function(event,u){var v=u.lid;if(!(v in l))return;var w=l[v].e2e;if(!w||w<u.ts)l[v].e2e=u.ts;});},subscribeToAjaxPipeOnload:function(t){t.subscribe(p,function(event,u){this.finishQuickling(u.lid);}.bind(this));},generatePayload:function(t,u){var v=l[t],w=Object.assign({},v);if(!this.adjustAndValidateValues(w,u))return;return w;},getPageloadPayload:function(t){if(!(t in l))return;if(!k.timing){delete l[t];return;}var u=k.timing.navigationStart;return this.generatePayload(t,u);},getQuicklingPayload:function(t){if(!(t in r)||!(t in l))return;if(!k.timing||!k.getEntriesByName){delete r[t];delete l[t];return;}var u=r[t],v=k.getEntriesByName(u);if(v.length===0)return;var w=v[0],x=k.timing.navigationStart+w.startTime;return this.generatePayload(t,x);},finishPageload:function(t){var u=this.getPageloadPayload(t);if(u){this.log(t,u);delete l[t];}},finishQuickling:function(t){var u=this.getQuicklingPayload(t);if(u){this.log(t,u);delete l[t];}},log:function(t,u){u.lid=t;h.log(q,u);},adjustAndValidateValues:function(t,u){var v=['e2e','tti'],w=true;for(var x=0;x<v.length;x++){var y=v[x],z=t[y];if(!z){w=false;break;}t[y]=z-u;}return w;},getPayload:function(t){if(!(t in l))return;var u=l[t].perfx_page_type;if(u==="normal"){return this.getPageloadPayload(t);}else if(u==="quickling")return this.getQuicklingPayload(t);}};e.exports=s;},null);