/*!CK:1571314332!*//*1420660866,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["TUehQ"]); }

__d("dummy-large-js",[],function(a,b,c,d,e,f){(function(){var g=74,h=75,i=70,j=76,k=315,l='Arbiter',m='AsyncRequest',n='Bootloader',o='CSS',p='Dialog',q='DOM',r='DOMQuery',s='DOMControl',t='Event',u='EventListener',v='fbt',w='FullScreen',x='ImageUtils',y='Input',z='Keys',aa='Layer',ba='LayerHideOnEscape',ca='LikeConfirmer',da='LinkController',ea='LitestandStoryInsertionStatus',fa='Locale',ga='PageTransitions',ha='Parent',ia='PhotoLogger',ja='PhotoPermalinkURI',ka='PhotosConst',la='PhotoSessionLog',ma='PhotosetPivotSlide.react',na='PhotosetSearchPivot.react',oa='PhotosetSearchPivotData',pa='PhotoSnowliftAds',qa='PhotoStreamCache',ra='PhotosUtils',sa='PhotoTagSearchPivotLogger',ta='PhotoViewer',ua='React',va='Rect',wa='ScriptPath',xa='ScrollableArea',ya='Style',za='Toggler',ab='Tooltip',bb='UFIFeedbackTargets',cb='UIPagelet',db='URI',eb='UserAgent_DEPRECATED',fb='Vector',gb='VideoPlayerReason',hb='$',ib='computeRelativeURI',jb='copyProperties',kb='createArrayFromMixed',lb='csx',mb='cx',nb='emptyFunction',ob='ge',pb='getActiveElement',qb='goURI',rb='invariant',sb='userAction';for(var tb in ta)if(ta.hasOwnProperty(tb))vb[tb]=ta[tb];var ub=ta===null?null:ta.prototype;vb.prototype=Object.create(ub);vb.prototype.constructor=vb;vb.__superConstructor__=ta;function vb(){"use strict";ta.call(this);this.$PhotoSnowlift0={};this.$PhotoSnowlift1=0;this.$PhotoSnowlift2=false;this.clearAlbumBoundaries();}vb.prototype.preload=function(wb,xb){"use strict";n.loadModules(["PhotoTagger","Live","PhotoTagApproval","PhotoTags","TagTokenizer","css:fb-photos-snowlift-fullscreen-css"],function(zb){this.PhotoTagger=zb;}.bind(this));var yb=this.getImageSrc(db(wb).getQueryData());if(yb)if(!this.$PhotoSnowlift3(yb))(new Image()).src=yb;};vb.prototype.bootstrap=function(wb,xb){"use strict";this.preload(wb,xb);if(this.closeDirty){setTimeout(this.bootstrap.bind(this,wb,xb),0);return;}pa.reset();this.resetUriStack=true;if(this.isOpen)if(this.openExplicitly){this.closeCleanup();this.resetUriStack=false;}else return;this.$PhotoSnowlift4=null;var yb=ha.byAttribute(xb,'data-cursor');if(yb){try{var ac=JSON.parse(yb.getAttribute('data-ft'));this.$PhotoSnowlift4={qid:ac.qid,mf_story_key:ac.mf_story_key};}catch(zb){}}else try{yb=ha.byAttribute(xb,'data-ad');var bc=JSON.parse(yb.getAttribute('data-ad'));this.$PhotoSnowlift4={ad_id:bc.adid};}catch(zb){}this.ua=sb('snowlift',xb).uai('open');wa.openOverlayView('snowlift');this.returningToStart=false;this.loading&&o.removeClass(this.loading,'loading');if(xb){o.addClass((this.loading=xb),'loading');var cc=ha.byClass(xb,'uiStreamStory')||ha.byClass(xb,"_5jmm");if(cc){this.storyID=cc.id;}else{var dc=ha.byClass(xb,"_5b9c");if(dc)this.storyID=dc.getAttribute('data-ownerid');}this.$PhotoSnowlift5();this.getThumbAndSize(xb);}else this.loading=null;l.inform('PhotoSnowlift.GO',wb,l.BEHAVIOR_STATE);this.loadFrameIfUninitialized();};vb.prototype.$PhotoSnowlift5=function(){"use strict";if(this.container)if(this.storyID){this.container.setAttribute('data-ownerid',this.storyID);}else this.container.removeAttribute('data-ownerid');};vb.prototype.setupFromSnowflake=function(wb,xb){"use strict";this.extraClasses=wb;this.snowflake=true;this.firstInSet=xb;if(this.root){o.addClass(this.root,"snowflake");this.extraClasses.forEach(function(yb){o.addClass(this.root,yb);},this);}};vb.prototype.getCurrentImageServerSizeDimensions=function(){"use strict";var wb=this.stream.getCurrentImageData();return wb.originalDimensions||wb.dimensions;};vb.prototype.getEventPrefix=function(){"use strict";return 'PhotoSnowlift';};vb.prototype.getRoot=function(){"use strict";return this.root;};vb.prototype.getSourceString=function(){"use strict";return 'snowlift';};vb.prototype.getViewerSource=function(){"use strict";return this.source;};vb.prototype.getViewerSet=function(){"use strict";return this.stream.getPhotoSet();};vb.prototype.getVersionConst=function(){"use strict";return ka.VIEWER_SNOWLIFT;};vb.prototype.getImage=function(){"use strict";return this.image;};vb.prototype.getImageId=function(){"use strict";return this.stream.getCursor();};vb.prototype.getRHCHeader=function(){"use strict";return this.rhcHeader;};vb.prototype.getRHCBody=function(){"use strict";return this.ufiForm;};vb.prototype.getRHCFooter=function(){"use strict";return this.rhcFooter;};vb.prototype.getLoadQuery=function(){"use strict";return this.loadQuery;};vb.prototype.getCurrentPhotoInfo=function(){"use strict";var wb=this.stream.getCurrentImageData();if(wb)return wb.info;return null;};vb.prototype.getOwnerId=function(){"use strict";var wb=this.stream.getCurrentImageData();if(wb)return wb.info.owner;return null;};vb.prototype.getThumbAndSize=function(wb){"use strict";this.currentImageSize=null;this.thumbSrc=null;var xb=db(wb.getAttribute('ajaxify')).getQueryData();if(!xb.size)return;var yb=fb.deserialize(xb.size);if(!yb.x||!yb.y)return;this.currentImageSize=yb;if(wb.getAttribute('data-cropped'))return;var zb=q.scry(wb,'img')[0],ac=q.scry(wb,'i')[0],bc=ha.byAttribute(wb,'data-size');this.shouldStretch=bc&&this.currentImageSize&&zb&&bc.getAttribute('data-size')==="2"&&this.currentImageSize.x>this.currentImageSize.y&&this.currentImageSize.x<=vb.TIMELINE_STRETCH_WIDTH&&zb.offsetWidth===vb.TIMELINE_STRETCH_WIDTH;var cc;if(zb){cc=zb.src;}else if(ac){cc=ya.get(ac,'backgroundImage').replace(/.*url\("?([^"]*)"?\).*/,'$1');}else return;this.thumbSrc=cc;};vb.prototype.loadFrameIfUninitialized=function(){"use strict";if(this.root)return;new m('/ajax/photos/snowlift/init.php').setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();};vb.prototype.init=function(wb,xb){"use strict";this.init=nb;this.$PhotoSnowlift6=xb.photos_client_loading;this.$PhotoSnowlift7=null;if(this.$PhotoSnowlift6)this.$PhotoSnowlift7=new ia(ka.VIEWER_SNOWLIFT_STRING);this.$PhotoSnowlift8=xb.pivot_hover;this.$PhotoSnowlift9=xb.show_more_photos;this.$PhotoSnowlifta=xb.extra_slide_pivot;la.setEndMetrics(xb.pivot_end_metric);this.startingMousePos=null;this.haveLeftBufferRegion=false;this.showingTypeaheadSuggestions=false;this.fullscreen=w.isSupported();this.showOGVideos=xb.og_videos;this.resizeCommentsForAds=xb.resize_comments_for_ads;this.spotlight=wb;this.spotlight.subscribe('blur',function(){this.closingAction=la.OUTSIDE;}.bind(this));this.spotlight.subscribe('hide',this.closeHandler.bind(this));this.spotlight.subscribe('key',this.keyHandler.bind(this));this.initializeNodes(this.spotlight.getRoot());pa.init(this.sideAdUnit,this,xb,this.adsDisplayedCallback.bind(this));this.inAdsDisplayedCallback=false;this.lastAdsHeight=0;if(!this.subscription){da.registerHandler(this.handleNavigateAway.bind(this));this.subscription=l.subscribe('PhotoSnowlift.GO',function(yb,zb){this.openExplicitly=true;this.loading&&o.removeClass(this.loading,'loading');this.open(zb);}.bind(this));}this.transitionHandlerRegistered=false;this.returningToStart=false;ga.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;l.subscribe('PhotoTagApproval.HILITE_TAG',this.onHiliteTag.bind(this));l.subscribe('PhotoTagApproval.UPDATE_TAG_BOX',this.onUpdateTagBox.bind(this));if(this.fullscreen)w.subscribe('changed',this.onFullScreenChange.bind(this));this.slideshowGk=xb.snowlift_slideshow;this.buttonTruncateGk=xb.snowlift_button_truncate;this.$PhotoSnowliftb=this.$PhotoSnowliftb&&xb.www_panorama_viewer;this.allowIrrelevantRequests=!!xb.snowlift_allow_irrelevant_requests;if(this.snowflake){o.addClass(this.root,"snowflake");this.extraClasses.forEach(function(yb){o.addClass(this.root,yb);},this);}};vb.prototype.onFullScreenChange=function(){"use strict";if(!this.isOpen)return;var wb=w.isFullScreen();o.conditionClass(document.body,'fbPhotoSnowliftFullScreenMode',wb);if(wb){if(!o.hasClass(this.root,'fbPhotoSnowliftEditMode'))this.collapseRHC();var xb=this.stream.getCurrentImageData();if(xb&&xb.url&&this.image.src!==xb.url&&this.shouldShowHiRes(xb))this.switchImage(xb.url);this.adjustForResize();if(!this.$PhotoSnowlift2)this.$PhotoSnowliftc();}else{if(!this.$PhotoSnowlift2)this.uncollapseRHC();if(eb.chrome()&&!o.hasClass(this.root,'fbPhotoSnowliftEditMode'))this.page(0,false);l.inform('reflow');}za.hide();};vb.prototype.initializeNodes=function(wb){"use strict";this.root=wb;this.container=q.find(wb,'div.fbPhotoSnowliftContainer');this.$PhotoSnowlift5();this.snowliftPopup=q.find(this.container,'div.fbPhotoSnowliftPopup');this.rhc=q.find(this.snowliftPopup,'div.rhc');this.rhcHeader=q.find(this.rhc,'div.rhcHeader');this.rhcFooter=q.find(this.rhc,'div.rhcFooter');this.ufiForm=q.find(this.rhc,'form.fbPhotosSnowliftFeedbackForm');this.ufiInputContainer=q.find(this.rhc,'div.fbPhotosSnowboxFeedbackInput');this.scroller=q.find(this.ufiForm,'div.rhcScroller');this.scrollerBody=q.find(this.scroller,'div.uiScrollableAreaBody');this.stageWrapper=q.find(this.snowliftPopup,'div.stageWrapper');this.overlay=q.find(this.snowliftPopup,'div.snowliftOverlay');this.errorBox=q.find(this.stageWrapper,'div.stageError');this.image=q.find(this.stageWrapper,'img.spotlight');this.stage=q.find(this.stageWrapper,'div.stage');this.showZoomInButton=q.scry(this.stageWrapper,"._5qmg").pop();this.showZoomOutButton=q.scry(this.stageWrapper,"._5qmh").pop();this.zoomedImage=q.scry(this.stage,"._10zw").pop();this.outerImageSlider=q.scry(this.stage,"._10zx").pop();this.innerImageSlider=q.scry(this.stage,"._10zv").pop();this.$PhotoSnowliftb=this.showZoomInButton&&this.showZoomOutButton&&this.zoomedImage&&this.outerImageSlider&&this.innerImageSlider;if(this.$PhotoSnowliftb){o.hide(this.showZoomInButton);o.hide(this.showZoomOutButton);o.hide(this.zoomedImage);o.hide(this.outerImageSlider);}this.videoStage=q.find(this.stageWrapper,'div.videoStage');this.prevPager=q.find(this.snowliftPopup,'a.snowliftPager.prev');this.nextPager=q.find(this.snowliftPopup,'a.snowliftPager.next');this.stageActions=q.find(wb,'div.stageActions');this.buttonActions=q.find(this.stageActions,'div.fbPhotosPhotoButtons');this.placeInfo=q.find(this.rhc,'div.fbPhotosSnowliftPlaceInfo');this.sideAdUnit=q.find(wb,"._5ciw");o.conditionClass(this.root,'fullScreenAvailable',this.fullscreen);};vb.prototype.initializeScroller=function(){"use strict";this.initializeScroller=nb;this.scrollableArea=xa.fromNative(this.scroller,{fade:true,persistent:true});var wb=function(event){var xb=t.$E(event).getTarget();if(q.contains(this.ufiInputContainer,xb)){var yb=s.getInstance(xb);if(yb){this.scrollableArea.scrollToBottom();var zb=yb.subscribe('resize',function(){var bc=this.scrollableArea.isScrolledToBottom();this.adjustScroller();bc&&this.scrollableArea.scrollToBottom();}.bind(this)),ac=t.listen(xb,'blur',function(){yb.unsubscribe(zb);ac.remove();});}}}.bind(this);l.subscribe('ufi/inputHeightChanged',function(xb,yb){if(q.contains(this.ufiInputContainer,yb.node))this.adjustScroller();}.bind(this));l.subscribe('ufi/addCommentFacepileRendered',function(){this.adjustScroller();}.bind(this));l.subscribe('ufi/changed',function(xb,yb){if(this.ufiForm===yb.form)this.adjustScrollerIfNecessary();}.bind(this));l.subscribe('ufi/comment',function(xb,yb){if(this.ufiForm===yb.form){this.adjustScrollerIfNecessary();if(yb.isranked){this.scrollableArea.scrollToTop();}else this.scrollableArea.scrollToBottom();}}.bind(this));t.listen(this.rhc,'click',function(event){var xb=event.getTarget();if(ha.byTag(xb,'a')||ha.byTag(xb,'button')||q.isNodeOfType(xb,'input'))this.adjustScrollerIfNecessary();}.bind(this));l.subscribe(['reflow','CommentUFI.Pager'],function(){if(this.isOpen)this.adjustScrollerIfNecessary();}.bind(this));t.listen(this.ufiForm,'focusin',wb);};vb.prototype.openHandler=function(wb){"use strict";if(this.isOpen||!ja.isValid(wb)||this.returningToStart||wb.getQueryData().closeTheater||wb.getQueryData().permPage){this.openHandlerRegistered=false;return false;}this.open(wb);this.$PhotoSnowlifte.push(db(wb).getQualifiedURI().toString());ga.transitionComplete(true);return true;};vb.prototype.getImageSrc=function(wb){"use strict";if(wb.smallsrc){if(!wb.size)return wb.smallsrc;var xb=fb.deserialize(wb.size),yb=this.getStageSize(xb);yb=this.$PhotoSnowliftf(yb);if(yb.x<=vb.STAGE_NORMAL_MAX.x&&yb.y<=vb.STAGE_NORMAL_MAX.y)return wb.smallsrc;}return wb.src;};vb.prototype.open=function(wb){"use strict";var xb=db(wb),yb=xb.getQueryData(),zb=ja.parse(xb);if(zb!==null){yb.fbid=zb.photo_id;yb.set=zb.set_token;}var ac=this.getImageSrc(yb);if(ac){delete yb.src;delete yb.smallsrc;}if(this.resetUriStack)this.$PhotoSnowlifte=[];if(!this.initialLoad){yb.firstLoad=true;this.initialLoad=true;ea.registerBlocker(function(){return this.isOpen;}.bind(this));}this.sessionID=Date.now();this.loadQuery=jb(yb,{ssid:this.sessionID});if(this.$PhotoSnowlift4)this.loadQuery.data_ft=this.$PhotoSnowlift4;this.isOpen=true;this.pagersShown=false;this.refreshOnClose=false;this.hilitedTag=null;this.loadingStates={image:false,html:false};this.replaceUrl=false;this.movementDelta=0;this.pivotsCarouselElement=null;this.videoPivotsGK=false;o.show(this.nextPager);o.show(this.prevPager);this.source=null;this.saveTagSubscription=l.subscribe('PhotoTagger.SAVE_TAG',this.onTagSaved.bind(this));this.taggedPhotoIds=[];this.stream=new qa();this.stream.init(ka.VIEWER_SNOWLIFT,'PhotoViewerPagelet','pagelet_photo_viewer',this.$PhotoSnowlift6?this.$PhotoSnowlift7:null,yb.tagSuggestionMode||'everyone');if(!!db.getMostRecentURI().getQueryData().viewas)this.stream.setViewAs(db.getMostRecentURI().getQueryData().viewas+'');this.fetchInitialData();this.setLoadingState(vb.STATE_HTML,true);this.rhcCollapsed=false;this.$PhotoSnowliftg(wb,ac);n.loadModules(["PhotosButtonTooltips"],function(bc){bc.init();});};vb.prototype.$PhotoSnowliftg=function(wb,xb){"use strict";this.createLoader(xb);this.spotlight.show();this.ua&&this.ua.add_event('frame');l.inform('layer_shown',{type:'PhotoSnowlift'});l.inform('PhotoSnowlift.OPEN');this.stageHandlers=[t.listen(window,'resize',this.adjustForResize.bind(this)),t.listen(this.stageWrapper,'click',this.buttonListener.bind(this)),t.listen(this.stageWrapper,'mouseleave',function(event){var ac=event.getTarget();if(!(ha.byClass(ac,'snowliftOverlay')||ha.byClass(ac,'fbPhotoSnowliftTagApproval')||ha.byClass(ac,'tagPointer')||ha.byClass(ac,'arrow')||ha.byClass(ac,'faceboxSuggestion')||ha.byClass(ac,'typeaheadWrapper')||ha.byClass(ac,'photoTagTypeahead')||ha.byClass(ac,'fbPhotoTagger')))this.unhiliteAllTags();this.hidePagers();}.bind(this)),t.listen(this.stageWrapper,'mousemove',this.hilitePager.bind(this)),t.listen(this.stageWrapper,'mousemove',this.hiliteTagsOnMouseMove.bind(this)),t.listen(this.overlay,'mouseenter',this.unhiliteAllTags.bind(this)),t.listen(this.container,'mousemove',this.$PhotoSnowlifth.bind(this)),t.listen(this.container,'mouseover',this.$PhotoSnowlifti.bind(this)),t.listen(this.stageWrapper,'focusin',this.hilitePager.bind(this)),t.listen(this.rhc,'focusin',this.hidePagers.bind(this))];if(this.$PhotoSnowliftb){this.stageHandlers.push(t.listen(this.stage,'mousedown',this.$PhotoSnowliftj.bind(this)));this.stageHandlers.push(t.listen(this.root,'mouseup',this.$PhotoSnowliftk.bind(this)));}this.stageHandlers.push(t.listen(this.container,'click',function(event){var ac=event.getTarget();if(ha.byClass(ac,'rotateRight')){this.rotate('right');}else if(ha.byClass(ac,'rotateLeft')){this.rotate('left');}else if(ha.byClass(ac,'closeTheater')){if(w.isFullScreen()){w.toggleFullScreen();return;}this.closingAction=la.X;this.spotlight.hide();return false;}else if(this.fullscreen)if(ha.byClass(ac,'fbPhotoSnowliftFullScreen')){this.toggleFullScreen();}else if(ha.byClass(ac,'fbPhotoSnowliftCollapse'))this.toggleCollapse();}.bind(this)));var yb=ob('fbPhotoSnowliftFeedback');if(yb)this.stageHandlers.push(t.listen(yb,'click',function(event){var ac=event.getTarget();if(ha.byClass(ac,'like_link')||(ha.byClass(ac,'UFILikeLink')&&ha.byClass(ac,'UIActionLinks')))this.toggleLikeButton();var bc=ha.byClass(event.getTarget(),'uiUfiCollapsedComment');if(bc)o.addClass(bc,'uiUfiCollapsedCommentToggle');}.bind(this)));var zb=ob('fbPhotoSnowliftOnProfile');if(zb)this.stageHandlers.push(t.listen(zb,'click',function(event){if(ha.byClass(event.getTarget(),'fbPhotoRemoveFromProfileLink'))this.refreshOnClose=true;}.bind(this)));if(this.resetUriStack)this.startingURI=db.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI();if(!xb)this.setLoadingState(vb.STATE_IMAGE_DATA,true);if(!this.transitionHandlerRegistered){ga.registerHandler(this.transitionHandler.bind(this));this.transitionHandlerRegistered=true;}la.initLogging(la.SNOWLIFT);if(this.pivots)la.setRelevantCount(this.pivots.relevantCount);};vb.prototype.toggleFullScreen=function(){"use strict";var wb=w.toggleFullScreen(document.documentElement);if(wb){var xb=this.stream.getCurrentImageData();if(xb&&xb.url&&this.image.src!==xb.url&&this.shouldShowHiRes(xb))if(!this.$PhotoSnowlift3(xb.url))(new Image()).src=xb.url;la.logEnterFullScreen(this.stream.getCursor());}};vb.prototype.getStream=function(){"use strict";return this.stream;};vb.prototype.fetchInitialData=function(){"use strict";this.ua&&this.ua.add_event('init_data');this.stream.waitForInitData();cb.loadFromEndpoint('PhotoViewerInitPagelet',ob('pagelet_photo_viewer_init',this.root),this.loadQuery,{actorID:bb.getActorIDForFeedbackTargetIfExists(this.loadQuery.fbid),usePipe:true,jsNonblock:true,crossPage:true,allowIrrelevantRequests:this.allowIrrelevantRequests});};vb.prototype.toggleCollapse=function(){"use strict";if(this.rhcCollapsed){this.uncollapseRHC();}else this.collapseRHC();};vb.prototype.collapseRHC=function(){"use strict";this.rhcCollapsed=true;o.addClass(this.root,'collapseRHC');this.adjustForResize();};vb.prototype.uncollapseRHC=function(){"use strict";this.rhcCollapsed=false;o.removeClass(this.root,'collapseRHC');this.adjustForResize();};vb.prototype.closeHandler=function(){"use strict";if(!this.isOpen)return;this.closingAction=this.closingAction||la.ESC;if(db.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI().toString()==this.startingURI.toString()){this.close();return;}this.returnToStartingURI(this.refreshOnClose);this.close();};vb.prototype.returnToStartingURI=function(wb,xb){"use strict";if(!wb)if(xb){this.squashNextTransition(qb.bind(null,xb));}else this.squashNextTransition();this.returningToStart=true;var yb=l.subscribe('page_transition',(function(){this.returningToStart=false;yb.unsubscribe();}).bind(this)),zb=wb||isNaN(eb.opera()),ac=this.$PhotoSnowlifte.length;if(zb&&ac<window.history.length){window.history.go(-ac);}else{var bc=this.startingURI,cc=new db(bc).removeQueryData('closeTheater');if(bc.getQueryData().sk=='approve'&&bc.getPath()=='/profile.php'){cc.removeQueryData('highlight');cc.removeQueryData('notif_t');}qb(cc);}};vb.prototype.squashNextTransition=function(wb){"use strict";this.squashNext=true;ga.registerHandler(function xb(){if(this.squashNext){this.squashNext=false;if(wb)setTimeout(wb,0);ga.transitionComplete(true);return true;}return false;}.bind(this),7);};vb.prototype.handleNavigateAway=function(wb){"use strict";var xb=ib(ga.$PhotoSnowliftl.getQualifiedURI(),wb.getAttribute('href'));if(this.isOpen&&(xb instanceof db)&&xb.getUnqualifiedURI().toString()!=this.startingURI.toString()&&xb.getPath()!='/photo.php'){if(!this.closingAction)this.closingAction=la.NAVIGATE;this.returnToStartingURI(false,xb);this.close();return false;}return true;};vb.prototype.postProcessTaggedPhotos=function(){"use strict";if(this.taggedPhotoIds&&this.taggedPhotoIds.length>0){var wb=null;if(this.source===vb.COLLECTIONS_UNTAGGED_PHOTOS){wb='/ajax/photos/photo/edit/skiptag/';}else if(this.source===vb.PHOTOS_OF_YOU_SUGGESTIONS||this.source===vb.FRIENDS_IN_PHOTOS_SUGGESTIONS)wb='/ajax/photos/photo/add_to_star_grid/';if(wb)new m().setURI(wb).setAllowCrossPageTransition(true).setData({media_id:this.taggedPhotoIds,source:this.source}).send();}};vb.prototype.onTagSaved=function(wb,xb){"use strict";if(this.taggedPhotoIds){if(this.source===vb.PHOTOS_OF_YOU_SUGGESTIONS&&!xb.self_tag)return;this.taggedPhotoIds.push(xb.photo_fbid);}};vb.prototype.clearAlbumBoundaries=function(){"use strict";this.$PhotoSnowliftn={start:0,end:0};};vb.prototype.close=function(){"use strict";if(!this.isOpen)return;this.$PhotoSnowlifto=null;this.hideMorePhotos();this.hidePivotSlide();this.$PhotoSnowliftp();this.isOpen=false;this.$PhotoSnowlift1=0;this.clearAlbumBoundaries();if(this.fullscreen)w.disableFullScreen();sb('snowlift').uai('close');wa.closeOverlayView('snowlift');this.spotlight.hide();this.openExplicitly=false;this.postProcessTaggedPhotos();l.unsubscribe(this.saveTagSubscription);this.taggedPhotoIds=[];this.closeDirty=true;setTimeout(this.closeCleanup.bind(this),0);if(this.snowflake){o.removeClass(this.root,"snowflake");this.extraClasses.forEach(function(wb){o.removeClass(this.root,wb);},this);}this.extraClasses=[];this.snowflake=false;this.firstInSet=null;this.movementDelta=0;};vb.prototype.closeCleanup=function(){"use strict";this.closeDirty=false;o.removeClass(this.root,'dataLoading');la.logPhotoViews(this.closingAction);this.destroy();o.hide(this.errorBox);o.hide(this.image);this.currentImageSize=null;this.thumbSrc=null;this.shouldStretch=false;this.resetUriStack=true;var wb=this.stream.getCursor();o.removeClass(this.stageWrapper,'showVideo');q.empty(this.videoStage);this.uncollapseRHC();this.currentMinSize=null;this.setStagePagersState('reset');this.recacheData();q.empty(this.sideAdUnit);this.stream.destroy();this.root.setAttribute('aria-busy','true');var xb=this.closingAction===la.NAVIGATE;this.closingAction=null;if(!this.openHandlerRegistered){ga.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;}l.inform('layer_hidden',{type:'PhotoSnowlift'});l.inform('PhotoSnowlift.CLOSE',{is_navigating:xb,fbid:wb});this.$PhotoSnowliftq();this.$PhotoSnowliftr=null;};vb.prototype.createLoader=function(wb){"use strict";if(this.currentImageSize===null){this.adjustStageSize(vb.STAGE_MIN);}else{var xb=this.getStageSize(this.currentImageSize);xb=new fb(Math.max(xb.x,vb.STAGE_MIN.x),Math.max(xb.y,vb.STAGE_MIN.y));var yb=this.getImageSizeInStage(this.currentImageSize,xb);if(this.thumbSrc===null){this.adjustStageSize(yb);}else this.useImage(q.create('img',{className:'spotlight',alt:'',src:this.thumbSrc,style:{width:yb.x+'px',height:yb.y+'px'}}),yb,false);}this.setLoadingState(this.STATE_IMAGE_PIXELS,true);if(wb)setTimeout((function(){var zb=new Image(),ac=function(){if(!this.isOpen)return;if(!this.stream||!this.stream.errorInCurrent()){this.switchImage(wb,this.currentImageSize);this.ua&&this.ua.add_event('image');this.setLoadingState(vb.STATE_IMAGE_DATA,false);}}.bind(this),bc=t.listen(zb,'load',ac),cc=function(){if(bc){bc.remove();bc=null;}};l.subscribeOnce('PhotoSnowlift.SWITCH_IMAGE',cc);l.subscribeOnce('PhotoSnowlift.CLOSE',cc);this.$PhotoSnowlift3(wb);zb.src=wb;}).bind(this),0);o.hide(this.stageActions);this.setStagePagersState('disabled');};vb.prototype.initDataFetched=function(wb){"use strict";la.setPhotoSet(this.stream.getPhotoSet());la.setLogFbids(wb.logids);this.$PhotoSnowliftn.start=this.stream.getCursor();var xb=this.stream.getCurrentImageData();la.addPhotoView(xb.info,this.shouldShowHiRes(xb),this.fullscreen&&w.isFullScreen());var yb=this.stream.getCurrentExtraData();if(this.$PhotoSnowlift8&&yb)sa.logImageImpression('snowlift',String(this.stream.getCursor()),Object.keys(yb.tagRects));if(yb&&yb.source!==(void 0)){this.source=parseInt(yb.source,10);la.setSource(this.source);}if(!this.pageHandlers)this.pageHandlers=[t.listen(this.root,'click',this.pageListener.bind(this)),t.listen(this.root,'mouseleave',this.mouseLeaveListener.bind(this))];o.show(this.stageActions);this.root.setAttribute('aria-busy','false');this.isLoggedInViewer=wb.loggedin;this.disableAds=!this.isLoggedInViewer||wb.fromad||this.stream.isInViewAsMode();this.loadAds();if(this.$PhotoSnowlifts(xb)){la.addPanoramaImpression();this.switchIntoZoomedImage();}else if(this.$PhotoSnowliftb)o.hide(this.showZoomInButton);};vb.prototype.adjustScrollerIfNecessary=function(){"use strict";clearTimeout(this.scrollerTimeout);this.scrollerTimeout=setTimeout(this.adjustScroller.bind(this),0);};vb.prototype.adjustScroller=function(wb){"use strict";clearTimeout(this.scrollerTimeout);this.initializeScroller();this.scrollableArea.resize();var xb=fb.getElementDimensions(this.rhc),yb=xb.y;yb-=fb.getElementDimensions(this.rhcHeader).y;yb-=fb.getElementDimensions(this.ufiInputContainer).y;if(this.placeInfo){var zb=fb.getElementDimensions(this.placeInfo);yb-=zb.y;ya.set(this.sideAdUnit,'bottom',zb.y+'px');}if(wb==null)wb=this.resizeCommentsForAds?this.lastAdsHeight:0;this.lastAdsHeight=wb;yb=Math.max(0,yb);var ac=fb.getElementDimensions(this.scrollerBody).y,bc=Math.max(vb.MIN_UFI_HEIGHT,yb-wb);if(ac>=bc){if(yb>bc){o.removeClass(this.rhc,'pinnedUfi');yb-=bc;}else{o.addClass(this.rhc,'pinnedUfi');yb=0;}ya.set(this.scroller,'height',bc+'px');}else{ya.set(this.scroller,'height','auto');o.removeClass(this.rhc,'pinnedUfi');yb-=ac;}var cc=fb.getElementDimensions(this.ufiInputContainer).y;ya.set(this.ufiForm,'padding-bottom',cc+'px');pa.resize(new fb(xb.x,yb));this.scrollableArea.adjustGripper();};vb.prototype.adjustForResize=function(){"use strict";this.currentMinSize=null;this.adjustStageSize();this.adjustForNewData();if(this.$PhotoSnowliftb){if(!this.$PhotoSnowlift2)this.$PhotoSnowliftc();this.$PhotoSnowliftt(this.$PhotoSnowliftr);}};vb.prototype.shouldShowHiRes=function(wb){"use strict";if(!wb||!wb.smallurl)return false;var xb=this.getStageSize(wb.dimensions);xb=this.$PhotoSnowliftf(xb);var yb=this.getImageSizeInStage(wb.dimensions,xb);return (yb.x>vb.STAGE_NORMAL_MAX.x||yb.y>vb.STAGE_NORMAL_MAX.y);};vb.prototype.$PhotoSnowliftf=function(wb){"use strict";if(window.devicePixelRatio&&window.devicePixelRatio>1)wb=new fb(wb.x*window.devicePixelRatio,wb.y*window.devicePixelRatio);return wb;};vb.prototype.getImageURL=function(wb){"use strict";if(wb.video){return null;}else if(wb.smallurl&&!this.shouldShowHiRes(wb))return wb.smallurl;return wb.url;};vb.prototype.getImageOrVideoDimensions=function(wb){"use strict";if(wb.video){var xb=this.getVideoElement(wb.video);if(xb)return this.getVideoSize(xb);}return this.getImageDimensions(wb);};vb.prototype.getImageDimensions=function(wb){"use strict";if(this.$PhotoSnowlift2)return wb.originalDimensions;if(wb.smalldims&&(!this.shouldShowHiRes(wb)||this.image.src===wb.smallurl))return wb.smalldims;return wb.dimensions;};vb.prototype.getStageSize=function(wb,xb){"use strict";var yb=fb.getViewportDimensions(),zb=new fb(wb.x,wb.y+this.getExtraVerticalSpace());if(xb)zb=new fb(Math.max(wb.x,xb.x),Math.max(wb.y,xb.y));var ac,bc;if(this.fullscreen&&w.isFullScreen()){return new fb((this.rhcCollapsed?screen.width:screen.width-vb.SIDEBAR_SIZE_MAX),screen.height-vb.FULL_SCREEN_PADDING*2);}else{ac=Math.min(zb.x,(yb.x-vb.SIDEBAR_SIZE_MAX-vb.STAGE_CHROME.x));bc=Math.min(zb.y,yb.y-vb.STAGE_CHROME.y);}if(ac===0&&bc===0)return new fb(0,0);var cc=ac/bc,dc=zb.x/zb.y;if(cc<dc)return new fb(ac,Math.round(ac/dc));return new fb(Math.round(bc*dc),bc);};vb.prototype.getExtraVerticalSpace=function(){"use strict";if(this.getVideoOnStage())return vb.VIDEO_BOTTOM_BAR_SPACE*2;return 0;};vb.prototype.getComponentsHeight=function(){"use strict";var wb=this.getVideoOnStage();if(wb)return this.getVideoComponentsHeight(ob(wb));return 0;};vb.prototype.getImageSizeInStage=function(wb,xb){"use strict";var yb=wb.x,zb=wb.y,ac=this.getComponentsHeight(),bc=this.getExtraVerticalSpace();zb-=ac;xb=new fb(xb.x,xb.y-ac-bc);if(yb>=xb.x||zb>=xb.y){var cc=xb.x/xb.y,dc=yb/zb;if(cc<dc){yb=xb.x;zb=Math.round(yb/dc);}else if(cc>dc){zb=xb.y;yb=Math.round(zb*dc);}else{yb=xb.x;zb=xb.y;}}return new fb(yb,zb+ac);};vb.prototype.getStageSizeForZoomedImage=function(wb,xb){"use strict";if(this.fullscreen&&w.isFullScreen()){var yb=this.rhcCollapsed?screen.width:screen.width-vb.SIDEBAR_SIZE_MAX,zb=screen.height-vb.FULL_SCREEN_PADDING*2;return new fb(yb,zb);}var ac=fb.getViewportDimensions();if(xb===null)xb=new fb(0,0);var bc=new fb(Math.max(wb.x,vb.STAGE_MIN.x,xb.x),Math.max(wb.y,vb.STAGE_MIN.y,xb.y)),cc=ac.x-vb.STAGE_CHROME.x;if(!this.rhcCollapsed)cc-=vb.SIDEBAR_SIZE_MAX;yb=Math.min(bc.x,cc);zb=Math.min(bc.y,ac.y-vb.STAGE_CHROME.y);return new fb(yb,zb);};vb.prototype.adjustStageSize=function(wb){"use strict";var xb=this.currentImageSize;if(wb){xb=wb;}else{var yb=this.stream&&this.stream.getCurrentImageData();if(yb)xb=this.getImageOrVideoDimensions(yb);}if(!xb)return;this.currentImageSize=xb;var zb=this.getExtraVerticalSpace();if(this.shouldStretch&&!this.getVideoOnStage()&&xb.x>xb.y&&xb.x<=vb.TIMELINE_STRETCH_WIDTH&&xb.x>=vb.TIMELINE_STRETCH_MIN){xb.y=Math.round(xb.y*vb.TIMELINE_STRETCH_WIDTH/xb.x);xb.x=vb.TIMELINE_STRETCH_WIDTH;}var ac;if(this.$PhotoSnowlift2){ac=this.getStageSizeForZoomedImage(xb,this.currentMinSize);}else ac=this.getStageSize(xb,this.currentMinSize);if(!this.currentMinSize)this.currentMinSize=new fb(0,0);this.currentMinSize=new fb(Math.max(ac.x,vb.STAGE_MIN.x,this.currentMinSize.x),Math.max(ac.y,vb.STAGE_MIN.y,this.currentMinSize.y));var bc=this.getImageSizeInStage(xb,this.currentMinSize),cc=this.currentMinSize.x-bc.x,dc=this.currentMinSize.y-bc.y;if(cc>0&&cc<vb.PADDING_MIN){this.currentMinSize.x-=cc;}else if(dc>0&&dc<vb.PADDING_MIN)this.currentMinSize.y-=dc;var ec=this.currentMinSize.x+vb.SIDEBAR_SIZE_MAX;if(this.rhcCollapsed)ec=this.currentMinSize.x;var fc=this.getVideoOnStage()&&this.pivotsCarouselElement,gc=0,hc=this.currentMinSize.y;if(fc){var ic=this.pivotsCarouselElement.clientHeight;gc=Math.ceil(ic/100)*100;hc=hc+gc;}this.snowliftPopup.style.cssText='width:'+ec+'px;'+'height:'+hc+'px;';var jc=this.currentMinSize.y-zb,kc=jc+gc;if(eb.firefox()){var lc=ya.get(this.stageWrapper,'font-size');jc=(jc/parseFloat(lc))+'em';kc=(kc/parseFloat(lc))+'em';}else{jc=jc+'px';kc=kc+'px';}this.stageWrapper.style.cssText='width:'+this.currentMinSize.x+'px;'+'line-height:'+jc+';';if(this.getVideoOnStage())this.videoStage.style.cssText='width:'+this.currentMinSize.x+'px;'+'height:'+kc+';';if(this.$PhotoSnowlift2){var mc=this.currentMinSize.y-zb;if(xb.y>mc){var nc=(xb.x/xb.y)*mc;ya.apply(this.zoomedImage,{width:nc+"px",height:mc+"px"});}else ya.apply(this.zoomedImage,{width:xb.x+"px",height:xb.y+"px"});}else{bc.y-=this.getComponentsHeight();this.setMediaElementSize(bc);}if(fc)this.setPivotCarouselElementWidth(lc);var oc=this.getTagger();if(oc)oc.repositionTagger();this.adjustScrollerIfNecessary();};vb.prototype.setMediaElementSize=function(wb){"use strict";var xb=this.image;if(this.getVideoOnStage())xb=q.scry(this.videoStage,"._53j5")[0]||xb;xb.style.cssText='width:'+wb.x+'px;'+'height:'+wb.y+'px;';};vb.prototype.setPivotCarouselElementWidth=function(wb){"use strict";var xb=this.videoStage.clientWidth;if(eb.firefox()){xb=(xb/parseFloat(wb))+'em';}else xb=xb+'px';this.pivotsCarouselElement.style.width=xb;};vb.prototype.adjustForNewData=function(){"use strict";if(!this.image)return;var wb=q.scry(this.stage,'div.tagsWrapper')[0],xb=fb.getElementDimensions(this.image);if(wb){ya.set(wb,'width',xb.x+'px');ya.set(wb,'height',xb.y+'px');}};vb.prototype.adsDisplayedCallback=function(wb,xb){"use strict";var yb=this.resizeCommentsForAds&&!this.inAdsDisplayedCallback&&!this.disableAds&&wb<vb.MIN_ADS_VISIBLE&&xb.length>=vb.MIN_ADS_VISIBLE;if(yb){this.inAdsDisplayedCallback=true;var zb=xb[vb.MIN_ADS_VISIBLE-1];this.adjustScroller(zb);this.inAdsDisplayedCallback=false;}};vb.prototype.setLoadingState=function(wb,xb){"use strict";switch(wb){case vb.STATE_IMAGE_PIXELS:o.conditionClass(this.root,'imagePixelsLoading',xb);break;case vb.STATE_IMAGE_DATA:this.loadingStates[wb]=xb;o.conditionClass(this.root,'imageLoading',xb);break;case vb.STATE_HTML:this.loadingStates[wb]=xb;o.conditionClass(this.root,'dataLoading',xb);this.rhc.setAttribute('aria-busy',xb?'true':'false');break;}};vb.prototype.destroy=function(){"use strict";this.stageHandlers.forEach(function(wb){wb.remove();});if(this.pageHandlers){this.pageHandlers.forEach(function(wb){wb.remove();});this.pageHandlers=null;}this.$PhotoSnowliftu&&clearInterval(this.$PhotoSnowliftu);this.$PhotoSnowliftu=null;this.$PhotoSnowliftv=null;};vb.prototype.checkState=function(wb){"use strict";if(wb!=vb.STATE_ERROR&&!this.loadingStates[wb])return;switch(wb){case vb.STATE_IMAGE_DATA:var xb=this.stream.getCurrentImageData();if(xb){var yb=this.getImageURL(xb);if(yb){if(!this.$PhotoSnowlift2&&this.$PhotoSnowlifts())this.$PhotoSnowliftw();this.switchImage(yb,null,true);}else if(xb.video)this.switchVideo(xb.video,true);this.setLoadingState(wb,false);}break;case vb.STATE_HTML:if(this.stream.getCurrentHtml()){this.swapData();this.setLoadingState(wb,false);}break;default:if(this.stream.errorInCurrent()){o.hide(this.image);o.show(this.errorBox);}break;}};vb.prototype.buttonListener=function(event){"use strict";var wb=event.getTarget(),xb=Date.now();if(ha.byClass(wb,"_5qmg")){la.addPanoramaClick();this.switchIntoZoomedImage();return;}if(ha.byClass(wb,"_5qmh")){this.$PhotoSnowliftq();this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));return false;}if(ha.byClass(wb,'fbPhotoTagApprovalBox'))return;if(xb-this.lastPage<350)return;if(ha.byClass(wb,'fbPhotosPhotoLike')){this.likePhoto();}else if(ha.byClass(wb,'tagApproveIgnore')){this.updateTagBox(event,wb);}else if(ha.byClass(wb,"_5ge9")){this.hideMorePhotos();this.toggleSlideshow();return false;}else if(ha.byClass(wb,"_5ymu")){if(!this.$PhotoSnowliftx){sa.logShowMorePhotos();var yb=this.stream.getCursor();if(yb)this.showMorePhotos(String(yb));if(this.$PhotoSnowliftb)o.hide(this.showZoomInButton);}else{sa.logHideMorePhotos();this.$PhotoSnowliftc();this.hideMorePhotos();}return;}else if(ha.byClass(wb,"_27n"))this.$PhotoSnowliftc();this.hideMorePhotos();};vb.prototype.toggleSlideshow=function(){"use strict";if(!this.slideshowGk)return;if(this.$PhotoSnowliftu){this.stopSlideshow();}else this.startSlideshow();};vb.prototype.startSlideshow=function(){"use strict";this.$PhotoSnowliftu=window.setInterval(this.page.bind(this,1,eb.chrome()&&w.isFullScreen()),vb.SLIDESHOW_TIME);o.addClass(this.root,'slideshowStarted');o.removeClass(this.root,'slideshowAvailable');};vb.prototype.stopSlideshow=function(){"use strict";this.$PhotoSnowliftu&&clearInterval(this.$PhotoSnowliftu);this.$PhotoSnowliftu=null;o.addClass(this.root,'slideshowAvailable');o.removeClass(this.root,'slideshowStarted');};vb.prototype.likePhoto=function(){"use strict";la.addButtonLike();var wb=hb('fbPhotoSnowliftFeedback'),xb=q.scry(wb,'button.like_link')[0];if(!xb)xb=q.scry(wb,'a.UFILikeLink')[0];var yb=xb.getAttribute('href');if(w.isFullScreen())if(eb.chrome())xb.setAttribute('href','javascript:;');xb.click();xb.setAttribute('href',yb);};vb.prototype.toggleLikeButton=function(){"use strict";var wb=q.scry(this.buttonActions,'a.fbPhotosPhotoLike')[0];if(wb){var xb=q.find(this.root,'.likeCount'),yb=q.find(xb,'.likeCountNum');if(xb)if(o.hasClass(wb,'viewerLikesThis')){q.setContent(yb,parseInt(yb.textContent,10)-1);}else q.setContent(yb,parseInt(yb.textContent,10)+1);o.toggleClass(wb,'viewerLikesThis');o.removeClass(wb,'viewerAlreadyLikedThis');}};vb.prototype.likePhotoWithKey=function(){"use strict";return ca.like(this.likePhoto.bind(this),pb());};vb.prototype.updateTagBox=function(wb,xb){"use strict";this.unhiliteAllTags();var yb=ob(wb);if(!yb)return;o.addClass(yb,'tagBox');o.addClass(yb,'tagBoxPendingResponse');o.removeClass(yb,'tagBoxPending');o.hide(q.find(yb,'span.tagForm'));if(xb){o.show(q.find(yb,'span.tagApproved'));}else o.show(q.find(yb,'span.tagIgnored'));};vb.prototype.rotate=function(wb){"use strict";var xb=this.stream.getCursor();if(this.getVideoOnStage()){var yb=(wb=='left')?270:90;rb(!!this.videoRotateURI);n.loadModules(["VideoRotate"],function(ac){new ac(xb,this.videoRotateURI).motionRotate(yb);}.bind(this));return;}var zb=jb({fbid:xb,opaquecursor:this.stream.getOpaqueCursor(xb),cs_ver:ka.VIEWER_SNOWLIFT},this.stream.getPhotoSetQuery());zb[wb]=1;this.setLoadingState(vb.STATE_IMAGE_DATA,true);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);o.hide(this.image);new m('/ajax/photos/photo/rotate/').setAllowCrossPageTransition(true).setData(zb).setErrorHandler(this.rotationError.bind(this,xb)).setFinallyHandler(this.rotationComplete.bind(this,xb)).setMethod('POST').setReadOnly(false).send();};vb.prototype.rotationComplete=function(wb,xb){"use strict";if(wb==this.stream.getCursor()){this.setLoadingState(vb.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));this.swapData();}};vb.prototype.rotationError=function(wb,xb){"use strict";if(wb==this.stream.getCursor()){this.setLoadingState(vb.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));n.loadModules(["AsyncResponse"],function(yb){yb.defaultErrorHandler(xb);});}};vb.prototype.saveTagsFromPayload=function(wb){"use strict";this.storeFromData(wb);if('data' in wb&&this.stream.getCursor() in wb.data)this.swapData();};vb.prototype.saveEdit=function(){"use strict";if(!o.hasClass(this.root,'fbPhotoSnowliftEditMode'))return;n.loadModules(["PhotoInlineEditor","Form"],function(wb,xb){var yb=wb.getInstance(this.getViewerConst());yb&&xb.bootstrap(yb.getForm().controller);}.bind(this));};vb.prototype.mouseLeaveListener=function(event){"use strict";this.unhiliteAllTags();this.reHilitePendingTag();};vb.prototype.hilitePager=function(event){"use strict";var wb=fb.getEventPosition(event),xb=fb.getElementPosition(this.stage);if(fa.isRTL()){var yb=fb.getElementDimensions(this.stage);this.stagePagerPrev=yb.x-(wb.x-xb.x)<vb.GOPREV_AREA;}else this.stagePagerPrev=wb.x-xb.x<vb.GOPREV_AREA;o.conditionClass(this.prevPager,'hilightPager',this.stagePagerPrev);o.conditionClass(this.nextPager,'hilightPager',!this.stagePagerPrev);var zb,ac=event.getTarget();if(!ha.byClass(ac,'snowliftOverlay')&&!ha.byClass(ac,'bottomBarActions')&&!ha.byClass(ac,'snowliftPager'))zb=vb.PAGER_FADE;this.showPagers(zb);};vb.prototype.showPagers=function(wb){"use strict";clearTimeout(this.fadePagerTimer);this.setStagePagersState('active');if(wb===(void 0))this.fadePagerTimer=setTimeout(this.hidePagers.bind(this),wb);};vb.prototype.hidePagers=function(){"use strict";var wb=q.scry(this.getRoot(),'.fbPhotosPhotoActionsMenu')[0];if(wb)return;clearTimeout(this.fadePagerTimer);this.setStagePagersState('inactive');};vb.prototype.getTagger=function(){"use strict";return (this.PhotoTagger&&this.PhotoTagger.getInstance(ka.VIEWER_SNOWLIFT));};vb.prototype.unhiliteAllTags=function(){"use strict";clearTimeout(this.unhiliteTimer);q.scry(this.stage,'div.tagsWrapper div.hover').forEach(function(xb){o.removeClass(xb,'hover');});q.scry(this.stage,'div.tagsWrapper div.otherActive').forEach(function(xb){o.removeClass(xb,'otherActive');});this.hilitedTag=null;this.showingTypeaheadSuggestions=false;if(!o.hasClass(this.root,'taggingMode')){var wb=this.getTagger();if(wb){wb.hideTagger();wb.setCurrentFacebox(null);}}};vb.prototype.switchHilitedTags=function(wb,xb){"use strict";if(this.switchTimer!==null){clearTimeout(this.switchTimer);this.switchTimer=null;}this.unhiliteAllTags();this.hiliteAllBoxes();var yb=ob(wb);if(yb){this.hilitedTag=wb;if(!o.hasClass(this.root,'taggingMode')&&ra.isFacebox(this.hilitedTag)){var zb=this.getTagger();if(zb){o.addClass(yb,'hover');var ac=zb.getFacebox(wb);zb.setCurrentFacebox(ac);if(ac)zb.addTagFromFacebox(ac);}}else o.addClass(yb,'hover');if(o.hasClass(yb,'tagBoxPending')&&!o.hasClass(yb,'showPendingTagName')&&xb===true){q.scry(this.stage,'div.tagsWrapper div.showPendingTagName').forEach(function(bc){o.removeClass(bc,'showPendingTagName');});o.addClass(yb,'showPendingTagName');}}};vb.prototype.reHilitePendingTag=function(){"use strict";var wb=ob(this.hilitedTag);if(wb&&o.hasClass(wb,'showPendingTagName'))return;var xb=q.scry(this.stage,'div.tagsWrapper div.showPendingTagName')[0];if(xb)this.switchHilitedTags(xb.id);};vb.prototype.hiliteTagsOnMouseMove=function(event){"use strict";if(!this.stream.getCurrentExtraData()||this.getVideoOnStage())return;if(this.switchTimer!==null)return;var wb=event.getTarget();if(ha.byClass(wb,'snowliftOverlay')||ha.byClass(wb,'fbPhotoSnowliftTagApproval')||ha.byClass(wb,'tagPointer')||ha.byClass(wb,'arrow')||ha.byClass(wb,'faceboxSuggestion')||ha.byClass(wb,'typeaheadWrapper')||ha.byClass(wb,'photoTagTypeahead'))return;var xb=ha.byClass(wb,'tagBoxPending'),yb=false;if(this.hilitedTag){var zb=ob(this.hilitedTag);yb=zb&&o.hasClass(zb,'tagBoxPending');}var ac=((!this.hilitedTag&&xb)||(!yb&&xb));if(ac){this.switchHilitedTags(xb.id);return;}if(xb&&(xb.id==this.hilitedTag))return;var bc=250,cc=15,dc=fb.getEventPosition(event);if(!this.startingMousePos)this.startingMousePos=dc;var ec=ra.absoluteToNormalizedPosition(this.image,dc);if(!this.haveLeftBufferRegion&&this.startingMousePos.distanceTo(dc)<cc){return;}else this.haveLeftBufferRegion=true;if(this.currentTagHasPrecedence(ec))return;var fc=ra.getNearestBox(this.stream.getCurrentExtraData().tagRects,ec);if(!fc){if(!yb){this.unhiliteAllTags();this.reHilitePendingTag();}return;}var gc=null;if(yb){var hc={};hc[this.hilitedTag]=this.stream.getCurrentExtraData().tagRects[this.hilitedTag];gc=ra.getNearestBox(hc,ec);}if(gc!==null&&yb)return;if(this.hilitedTag!=fc)if(yb){this.switchTimer=setTimeout(this.switchHilitedTags.bind(this,fc),bc);}else{if(this.$PhotoSnowlift8&&!this.$PhotoSnowlift0[fc]){this.$PhotoSnowlift0[fc]=true;sa.logPivotImpression('snowlift',fc);}this.switchHilitedTags(fc);}};vb.prototype.currentTagHasPrecedence=function(wb){"use strict";if(!this.hilitedTag)return false;if(this.stream.getCurrentExtraData().tagRects[this.hilitedTag]===(void 0)){this.hilitedTag=null;return false;}var xb=this.stream.getCurrentExtraData().tagRects[this.hilitedTag],yb=new va(xb.t+(xb.h()/2),xb.r,xb.b+(ra.isFacebox(this.hilitedTag)?10:0),xb.l,xb.domain);return yb.contains(wb);};vb.prototype.getVideoOnStage=function(){"use strict";var wb=this.stream&&this.stream.getCurrentImageData();return wb&&wb.video;};vb.prototype.shouldPageOnAction=function(wb,xb){"use strict";if(!this.isOpen||ca.isShowingConfirmation())return false;var yb=q.isNode(xb)&&(ha.byClass(xb,'snowliftPager')||ha.byClass(xb,'stagePagers')||ha.byClass(xb,'pivotPageColumn')),zb=q.isNode(xb)&&ha.byClass(xb,'stage'),ac=o.hasClass(xb,'faceBox'),bc=(!o.hasClass(this.root,'taggingMode')&&ac&&!yb);if(bc){if(!this.showingTypeaheadSuggestions){this.getTagger().updateWithSuggestions();setTimeout((function(){q.find(this.getTagger().tagger,'input.textInput').focus();}).bind(this),0);}this.showingTypeaheadSuggestions=!this.showingTypeaheadSuggestions;return false;}var cc=((zb&&o.hasClass(this.root,'taggingMode'))||ha.byClass(xb,'tagBoxPending')||ha.byClass(xb,'tagBoxPendingResponse')||ha.byClass(xb,'fbPhotoTagApprovalBox')||ha.byClass(xb,'tag'));if(cc)return false;if(zb&&this.$PhotoSnowlift2)zb=false;return wb==z.LEFT||wb==z.RIGHT||wb==g||wb==h||yb||bc||zb;};vb.prototype.keyHandler=function(wb,event){"use strict";if(event.getModifiers().any||aa.getTopmostLayer()!==this.spotlight)return true;switch(t.getKeyCode(event)){case z.LEFT:case z.RIGHT:case g:case h:this.pageListener(event);return false;case i:return this.toggleFullScreen();case j:return this.likePhotoWithKey();case z.SPACE:this.toggleSlideshow();this.showPagers(vb.PAGER_FADE);return false;case z.ESC:if(this.$PhotoSnowlift2){this.$PhotoSnowliftq();this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));return false;}break;}};vb.prototype.shouldHandlePendingTag=function(event){"use strict";var wb=this.getTagger();if(!wb||!wb.tags.length)return false;var xb=ra.absoluteToNormalizedPosition(this.getImage(),fb.getEventPosition(event)),yb=wb.findNearestTag(xb);if(!yb||!o.hasClass(yb.node,'tagBoxPending'))return false;l.inform('PhotoTagApproval.PENDING_TAG_PHOTO_CLICK',{id:yb.id,version:this.getVersionConst()});return true;};vb.prototype.pageListener=function(event){"use strict";var wb=t.getKeyCode(event),xb=event.getTarget();if(this.$PhotoSnowliftu){this.stopSlideshow();return;}if(!this.shouldPageOnAction(wb,xb))return;if(this.shouldHandlePendingTag(event))return;var yb=0;if(wb==z.RIGHT||wb==h){yb=1;la.setPagingAction('key_right');this.$PhotoSnowlifty=true;}else if(wb==z.LEFT||wb==g){yb=-1;la.setPagingAction('key_left');this.$PhotoSnowlifty=true;}else if(ha.byClass(xb,'next')){yb=1;la.setPagingAction('click_next');}else if(ha.byClass(xb,'prev')){yb=-1;la.setPagingAction('click_prev');}else if(!this.stagePagerPrev){yb=1;la.setPagingAction('click_stage');}else{yb=-1;la.setPagingAction('click_stage_back');}var zb=q.scry(this.ufiForm,'input.mentionsHidden'),ac=false;for(var bc=0;bc<zb.length;bc++)if(!y.isEmpty(zb[bc])){ac=true;break;}if(ac||o.hasClass(this.root,'fbPhotoSnowliftEditMode')){this.warnLeavePage(this.page.bind(this,yb));}else{this.page(yb,eb.chrome()&&w.isFullScreen());this.$PhotoSnowliftr=null;sb('snowlift',xb,event).uai(la.pagingAction);}};vb.prototype.warnLeavePage=function(wb){"use strict";new p().setTitle("\u3053\u306e\u30da\u30fc\u30b8\u304b\u3089\u79fb\u52d5\u3057\u307e\u3059\u304b\uff1f").setBody("\u30da\u30fc\u30b8\u304b\u3089\u79fb\u52d5\u3059\u308b\u3068\u3001\u4fdd\u5b58\u3055\u308c\u3066\u3044\u306a\u3044\u5909\u66f4\u306f\u5931\u308f\u308c\u307e\u3059\u3002").setButtons([{name:'leave_page',label:"\u79fb\u52d5\u3059\u308b",handler:wb},{name:'continue_editing',label:"\u3053\u306e\u30da\u30fc\u30b8\u304b\u3089\u79fb\u52d5\u3057\u306a\u3044",className:'inputaux'}]).setModal(true).show();};vb.prototype.getUsesOpaqueCursor=function(){"use strict";return this.stream.getUsesOpaqueCursor();};vb.prototype.getOpaqueCursor=function(wb){"use strict";return this.stream.getOpaqueCursor(wb);};vb.prototype.setReachedLeftEnd=function(){"use strict";this.stream.setReachedLeftEnd();};vb.prototype.setReachedRightEnd=function(){"use strict";this.stream.setReachedRightEnd();};vb.prototype.page=function(wb,xb){"use strict";if(!this.stream.isValidMovement(wb)||!this.stream.nonCircularPhotoSetCanPage(wb)){this.showPagers(vb.PAGER_FADE);return;}var yb=this.stream.getCursorAt(this.stream.calculatePositionForMovement(wb));if(this.snowflake&&((this.stream.getCursor()==this.firstInSet&&wb<0)||(this.firstInSet==yb&&wb>0))){this.showPagers(vb.PAGER_FADE);return;}this.lastPage=Date.now();this.unhiliteAllTags();this.startingMousePos=null;this.haveLeftBufferRegion=false;this.$PhotoSnowlift0={};this.$PhotoSnowlift1+=wb;var zb=this.stream.allLoaded?Math.abs(this.$PhotoSnowlift1)-this.stream.getLength():null;if(this.$PhotoSnowlifta&&this.$PhotoSnowlifto){if(!this.$PhotoSnowliftn.end&&zb===0){this.$PhotoSnowliftn.end=this.stream.getCursor();}else if(zb===-1)oa.fetch(this.$PhotoSnowlifto,this.stream);if(!this.onExtraSlide){if(this.stream.getCursor()===this.$PhotoSnowliftn.end&&yb===this.$PhotoSnowliftn.start){this.showPivotSlide(this.$PhotoSnowlifto,xb);return;}else if(this.stream.getCursor()===this.$PhotoSnowliftn.start&&yb===this.$PhotoSnowliftn.end)this.showPivotSlide(this.$PhotoSnowlifto,xb);}else{this.hidePivotSlide();if(yb!==this.$PhotoSnowliftn.start)return;}}var ac=this.getVideoOnStage();if(ac)this.switchVideo(ac,false);if(this.pivots&&this.pivots.page(wb))return;l.inform('PhotoSnowlift.PAGE');za.hide();this.recacheData();this.stream.moveCursor(wb);o.hide(this.image);if(wb!==0){this.storyID=null;this.$PhotoSnowlift5();}if(wb!==0&&this.$PhotoSnowlift2)this.$PhotoSnowliftq();if(this.stream.errorInCurrent()){this.setLoadingState(vb.STATE_HTML,true);o.show(this.errorBox);return;}this.movementDelta+=wb;var bc=this.stream.getCurrentImageData();if(bc){var cc=this.getImageURL(bc);if(cc){if(!this.$PhotoSnowlift2&&this.$PhotoSnowlifts())this.$PhotoSnowliftw();this.switchImage(cc,null,true);}else if(bc.video)this.switchVideo(bc.video,true);if(!xb){this.replaceUrl=true;qb(bc.info.permalink);}this.setLoadingState(vb.STATE_IMAGE_DATA,false);}else{this.setLoadingState(vb.STATE_IMAGE_PIXELS,true);this.setLoadingState(vb.STATE_IMAGE_DATA,true);}if(this.stream.getCurrentHtml()){this.swapData();}else this.setLoadingState(vb.STATE_HTML,true);this.disableAds=!this.isLoggedInViewer||this.stream.isInViewAsMode();this.loadAds();this.setLeftAndRightPagersState();if(this.$PhotoSnowliftu){o.addClass(this.root,'slideshowStarted');}else if(this.slideshowAvailable)o.addClass(this.root,'slideshowAvailable');if(!this.$PhotoSnowlifta&&this.$PhotoSnowlift9&&this.$PhotoSnowlifto)if(zb===-1){oa.fetch(this.$PhotoSnowlifto,this.stream);}else if(zb===0){sa.logSuggestMorePhotos();this.showMorePhotos(this.$PhotoSnowlifto,true);this.showPagers();this.$PhotoSnowlift1=0;}else{this.hideMorePhotos();this.hidePagers();}};vb.prototype.showMorePhotos=function(wb,xb){"use strict";if(this.$PhotoSnowliftx)return;this.$PhotoSnowliftx=true;if(!this.searchPivot)this.searchPivot=this.overlay.appendChild(document.createElement('div'));o.addClass(this.stageWrapper,"_5ymv");this.searchPivotComponent=ua.render(ua.createElement(na,{className:"_27g",fbid:wb,onclose:this.hideMorePhotos.bind(this),endofalbum:xb||false,withBackground:true}),this.searchPivot);};vb.prototype.hideMorePhotos=function(){"use strict";if(this.searchPivotComponent&&this.$PhotoSnowliftx){this.$PhotoSnowliftx=false;o.removeClass(this.stageWrapper,"_5ymv");this.searchPivotComponent.setProps({fbid:null});}};vb.prototype.showPivotSlide=function(wb,xb){"use strict";if(this.onExtraSlide)return;this.onExtraSlide=true;o.addClass(this.stageWrapper,"_3tvf");if(!this.pivotSlide){this.pivotSlide=q.create('div');q.insertBefore(this.stageActions,this.pivotSlide);}this.pivotSlideComponent=ua.render(ua.createElement(ma,{fbid:wb,isAlbum:this.$PhotoSnowliftz,albumOwnerName:this.$PhotoSnowliftA,visible:true,onReturn:this.returnToBeginning.bind(this,xb)}),this.pivotSlide);};vb.prototype.hidePivotSlide=function(){"use strict";if(this.pivotSlideComponent&&this.onExtraSlide){this.pivotSlideComponent.setProps({visible:false});o.removeClass(this.stageWrapper,"_3tvf");}this.onExtraSlide=false;};vb.prototype.returnToBeginning=function(wb){"use strict";var xb=this.stream.getRelativeMovement(this.$PhotoSnowliftn.start);this.page(xb,wb);};vb.prototype.logImpressionDetailsForPhoto=function(){"use strict";var wb=[].concat(q.scry(hb('fbPhotoSnowliftTagList'),'input.photoImpressionDetails'),q.scry(hb('fbPhotoSnowliftFeedback'),'input.photoImpressionDetails'));if(wb.length===0)return;var xb={};for(var yb=0;yb<wb.length;yb++)xb[wb[yb].name]=wb[yb].value;if(this.getVideoOnStage()){xb.width=0;xb.height=0;}else{var zb=this.getImageDimensions(this.stream.getCurrentImageData());xb.width=zb.x;xb.height=zb.y;}la.addDetailData(this.stream.getCursor(),xb);pa.setIsLogAdData(true);};vb.prototype.loadAds=function(){"use strict";if(this.disableAds)return;pa.loadAdsFromUserActivity();};vb.prototype.transitionHandler=function(wb){"use strict";if(wb.getQueryData().closeTheater||wb.getQueryData().permPage||this.returningToStart){if(this.isOpen)this.close();this.transitionHandlerRegistered=false;return false;}if(this.replaceUrl){this.replaceUrl=false;this.$PhotoSnowlifte.push(wb.getQualifiedURI().toString());ga.transitionComplete(true);return true;}var xb=this.$PhotoSnowlifte.length;if(xb>=2&&this.$PhotoSnowlifte[xb-2]==wb.getQualifiedURI().toString())this.$PhotoSnowlifte.pop();var yb=this.stream.getCursorForURI(wb.getUnqualifiedURI().toString());if(yb){var zb=this.stream.getRelativeMovement(yb);this.page(zb,true);ga.transitionComplete(false);return true;}if(this.isOpen){ga.transitionComplete(true);this.close();return true;}this.transitionHandlerRegistered=false;return false;};vb.prototype.recacheData=function(){"use strict";if(!this.loadingStates.html){var wb=this.stream.getCurrentHtml();for(var xb in wb){wb[xb]=kb(hb(xb).childNodes);q.empty(hb(xb));}}};vb.prototype.reloadIfTimeout=function(){"use strict";if(!x.hasLoaded(this.image)){var wb=this.makeNewImage(this.image.src,true);t.listen(wb,'load',this.useImage.bind(this,wb,null,true));this.$PhotoSnowlift3(wb.src);}};vb.prototype.useImage=function(wb,xb,yb){"use strict";if(yb&&x.hasLoaded(this.image))return;q.replace(this.image,wb);this.image=wb;this.adjustStageSize(xb);};vb.prototype.makeNewImage=function(wb,xb){"use strict";if(this.imageLoadingTimer){clearTimeout(this.imageLoadingTimer);this.imageLoadingTimer=null;}else if(!xb)this.imageRefreshTimer=setTimeout(this.reloadIfTimeout.bind(this),vb.LOADING_TIMEOUT);var yb=q.create('img',{className:'spotlight',alt:''});yb.setAttribute('aria-describedby','fbPhotosSnowliftCaption');yb.setAttribute('aria-busy','true');var zb=function(){clearTimeout(this.imageRefreshTimer);this.image.setAttribute('aria-busy','false');this.setLoadingState(this.STATE_IMAGE_PIXELS,false);setTimeout((function(){if(this.isOpen){this.adjustStageSize();this.adjustForNewData();}}).bind(this),0);}.bind(this);t.listen(yb,'load',zb);this.$PhotoSnowlift3(wb);yb.src=wb;return yb;};vb.prototype.switchImage=function(wb,xb,yb){"use strict";o.hide(this.image);o.hide(this.errorBox);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);var zb=this.stream&&this.stream.getCurrentImageData();if(zb){la.addPhotoView(zb.info,this.shouldShowHiRes(zb),this.fullscreen&&w.isFullScreen());if(this.$PhotoSnowlift8){var ac=this.stream.getCurrentExtraData();if(ac)sa.logImageImpression('snowlift',String(this.stream.getCursor()),Object.keys(ac.tagRects));}}this.useImage(this.makeNewImage(wb,false),xb,false);if(yb)this.stream.preloadImages(this.shouldShowHiRes.bind(this));if(!this.$PhotoSnowlift2&&this.$PhotoSnowlifts(zb)){la.addPanoramaImpression();var bc=new fb(this.stage.clientWidth,this.stage.clientHeight);this.$PhotoSnowliftB(bc);}else if(this.$PhotoSnowliftb)o.hide(this.showZoomInButton);if(this.$PhotoSnowlift2){this.switchIntoZoomedImage();this.showPagers(vb.PAGER_FADE);}l.inform('PhotoSnowlift.SWITCH_IMAGE');};vb.prototype.$PhotoSnowliftc=function(){"use strict";if(!this.$PhotoSnowliftb)return;if(this.$PhotoSnowlifts()){var wb=new fb(this.stage.clientWidth,this.stage.clientHeight);this.$PhotoSnowliftB(wb);}else o.hide(this.showZoomInButton);};vb.prototype.$PhotoSnowliftB=function(wb){"use strict";var xb=parseInt(this.image.style.height,10),yb=(wb.y-xb)/2;if(yb>=vb.ZOOM_BUTTON_TOP_PAD+vb.ZOOM_BUTTON_BOT_PAD+vb.ZOOM_BUTTON_HEIGHT){var zb=yb-vb.ZOOM_BUTTON_HEIGHT-vb.ZOOM_BUTTON_TOP_PAD;ya.set(this.showZoomInButton,'bottom',zb+'px');}else ya.set(this.showZoomInButton,'bottom','60px');o.show(this.showZoomInButton);};vb.prototype.$PhotoSnowlifts=function(wb){"use strict";if(wb===(void 0))wb=this.stream&&this.stream.getCurrentImageData();if(!this.$PhotoSnowliftb||!wb||!wb.originalDimensions)return false;var xb=new fb(this.stage.clientWidth,this.stage.clientHeight),yb=wb.originalDimensions,zb=yb.x/yb.y,ac=Math.min(xb.y*zb,yb.x);if(!isNaN(zb)&&zb>2&&yb.y>vb.MIN_PANORAMA_Y&&xb.x*vb.MIN_PANO_TO_STAGE_RATIO<ac){return true;}else return false;};vb.prototype.$PhotoSnowliftw=function(){"use strict";this.$PhotoSnowlift2=true;o.hide(this.showZoomInButton);o.hide(this.stageActions);o.show(this.showZoomOutButton);ya.set(this.stage,'overflow','hidden');this.spotlight.disableBehavior(ba);this.collapseRHC();};vb.prototype.$PhotoSnowliftq=function(){"use strict";if(!this.$PhotoSnowliftb)return;this.$PhotoSnowlift2=false;this.spotlight.enableBehavior(ba);ya.set(this.stage,'overflow','visible');o.hide(this.showZoomInButton);o.hide(this.showZoomOutButton);o.hide(this.zoomedImage);o.hide(this.outerImageSlider);o.show(this.stageActions);this.uncollapseRHC();};vb.prototype.switchIntoZoomedImage=function(wb){"use strict";this.$PhotoSnowliftw();o.hide(this.zoomedImage);o.hide(this.outerImageSlider);var xb=this.stream.getCurrentImageData(),yb=xb.originalDimensions;this.zoomedImage.src=xb.url;this.adjustStageSize(yb);this.$PhotoSnowliftC(new fb(parseInt(ya.get(this.zoomedImage,'width'),10),parseInt(ya.get(this.zoomedImage,'height'),10)));o.hide(this.image);};vb.prototype.$PhotoSnowliftD=function(wb){"use strict";var xb=this.stage.clientWidth,yb=Math.min(100,(xb/wb.x)*100);ya.set(this.innerImageSlider,'width',yb+'%');return yb;};vb.prototype.$PhotoSnowliftE=function(wb){"use strict";var xb=vb.MAX_SLIDER_HEIGHT*this.stage.clientHeight/wb.y,yb=vb.MAX_SLIDER_WIDTH*this.stage.clientWidth/wb.x,zb=Math.min(xb,yb);return new fb(100*wb.x*zb/this.stage.clientWidth,100*wb.y*zb/this.stage.clientHeight);};vb.prototype.$PhotoSnowliftC=function(wb){"use strict";this.$PhotoSnowliftt(this.$PhotoSnowliftr);var xb=this.$PhotoSnowliftE(wb);ya.set(this.outerImageSlider,'width',xb.x+'%');ya.set(this.outerImageSlider,'height',xb.y+'%');ya.set(this.outerImageSlider,'left',(50-xb.x/2)+'%');ya.set(this.showZoomOutButton,'bottom',xb.y*this.stage.clientHeight/100+parseInt(ya.get(this.outerImageSlider,'bottom'),10)+20+'px');o.show(this.zoomedImage);o.show(this.outerImageSlider);};vb.prototype.$PhotoSnowliftj=function(event){"use strict";if(!this.$PhotoSnowlift2)return;o.addClass(this.stage,'showSlider');if(this.$PhotoSnowliftF)this.$PhotoSnowliftF.remove();var wb=false,xb=event.getTarget();if(ha.byClass(xb,"_10zv")){this.startSliderMargins=new fb(parseFloat(ya.get(this.innerImageSlider,'marginLeft')),parseFloat(ya.get(this.innerImageSlider,'marginTop')));this.startImageMargins=null;this.mouseDownStartPosition=new fb(event.clientX,event.clientY);}else if(ha.byClass(xb,"_10zx")){this.startSliderMargins=new fb(parseInt(ya.get(this.innerImageSlider,'marginLeft'),10),parseInt(ya.get(this.innerImageSlider,'marginTop'),10));this.startImageMargins=null;var yb=parseInt(ya.get(this.innerImageSlider,'width'),10);this.mouseDownStartPosition=new fb(this.innerImageSlider.getBoundingClientRect().left+yb/2,event.clientY);wb=true;}else if(ha.byClass(xb,"_10zw")){this.startImageMargins=new fb(parseInt(ya.get(this.zoomedImage,'marginLeft'),10),parseInt(ya.get(this.zoomedImage,'marginTop'),10));this.startSliderMargins=null;this.mouseDownStartPosition=new fb(event.clientX,event.clientY);}this.$PhotoSnowliftF=t.listen(this.stage,'mousemove',this.$PhotoSnowliftG.bind(this));if(wb){this.$PhotoSnowliftG(event);}else event.kill();};vb.prototype.$PhotoSnowliftk=function(event){"use strict";if(this.$PhotoSnowliftF){o.removeClass(this.stage,'showSlider');this.$PhotoSnowliftF.remove();this.$PhotoSnowliftF=null;var wb=parseFloat(ya.get(this.zoomedImage,'marginLeft')),xb=-this.zoomedImage.width+this.stage.clientWidth;this.$PhotoSnowliftr=wb/xb;}};vb.prototype.$PhotoSnowliftG=function(event){"use strict";var wb;if(this.startSliderMargins){wb=event.clientX-this.mouseDownStartPosition.x;var xb=parseFloat(ya.get(this.outerImageSlider,'width')),yb=parseFloat(ya.get(this.innerImageSlider,'width')),zb=Math.max(0,Math.min(xb-yb,this.startSliderMargins.x+wb))/xb;ya.set(this.innerImageSlider,'marginLeft',100*zb+"%");ya.set(this.zoomedImage,'marginLeft',-1*zb*this.zoomedImage.width+'px');event.kill();}else if(this.startImageMargins){wb=1.75*(this.mouseDownStartPosition.x-event.clientX);var ac=Math.min(0,Math.max(this.startImageMargins.x-wb,-this.zoomedImage.width+this.stage.clientWidth));ya.set(this.zoomedImage,'marginLeft',ac+'px');ya.set(this.innerImageSlider,'marginLeft',(-ac/this.zoomedImage.width*100)+"%");event.kill();}};vb.prototype.$PhotoSnowliftt=function(wb){"use strict";if(wb===(void 0)||wb===null)wb=.5;var xb=new fb(parseInt(ya.get(this.zoomedImage,'width'),10),parseInt(ya.get(this.zoomedImage,'height'),10));ya.set(this.innerImageSlider,'marginLeft',((100-this.$PhotoSnowliftD(xb))*wb)+'%');ya.set(this.zoomedImage,'marginLeft',((this.stage.clientWidth-xb.x)*wb)+'px');};vb.prototype.switchVideo=function(wb,xb){"use strict";this.$PhotoSnowliftp();var yb='swf_'+wb;q.empty(this.videoStage);if(xb){o.addClass(this.stageWrapper,'showVideo');var zb=this.stream.getCurrentImageData();if(this.videoPivotsGK){o.hide(this.nextPager);o.hide(this.prevPager);}var ac=zb.video_element;q.find(ac,"._ox1").style.cssText='';var bc=null;if(this.pivotsCarouselElement)bc=r.scry(this.pivotsCarouselElement,"._32_l");if(bc)bc.map(function(ec){return u.capture(ec,'click',function(){var fc=ec.getAttribute('data-fbid'),gc=this.stream.getCursor(),hc=this.stream.calculateDistance(gc,fc);this.page(hc,false);}.bind(this));}.bind(this));o.addClass(ac,'videoStageContainer');q.appendContent(this.videoStage,ac);q.appendContent(this.videoStage,this.pivotsCarouselElement);if(window[yb]&&!ob(yb))window[yb].write(wb);var cc='video_warning_'+wb,dc=ob(wb);if(!this.videoWarnings)this.videoWarnings=[];if(dc&&this.videoWarnings[cc])q.setContent(dc,this.videoWarnings[cc]);this.$PhotoSnowliftv=zb.controller;this.$PhotoSnowliftv.reset();if(this.$PhotoSnowliftH)this.$PhotoSnowliftv.play(gb.USER);if(this.$PhotoSnowliftI)this.$PhotoSnowliftv.addListener('finishPlayback',function(){var ec=zb.info.fbid.toString();if(ec===this.stream.getCursor())this.page(1,false);}.bind(this));setTimeout(this.adjustStageSizeForVideo.bind(this,wb),0);}else{window[yb]&&window[yb].addVariable('video_autoplay',0);this.videoLoadTimer&&clearTimeout(this.videoLoadTimer);o.removeClass(this.stageWrapper,'showVideo');}};vb.prototype.checkVideoStatus=function(wb){"use strict";if(this.videoLoadTimer)clearTimeout(this.videoLoadTimer);var xb=this.getVideoOnStage();if(!xb){return;}else{if(xb!==wb)return;this.adjustStageSizeForVideo(wb);}};vb.prototype.getVideoSize=function(wb){"use strict";return new fb(wb.getAttribute('data-video-width'),+wb.getAttribute('data-video-height')+this.getVideoComponentsHeight(wb));};vb.prototype.getVideoElement=function(wb){"use strict";return q.scry(this.videoStage,"._ox1")[0];};vb.prototype.getVideoComponentsHeight=function(wb){"use strict";var xb=0,yb=ha.byClass(wb,"_1c_u");if(!yb)return 0;var zb=q.scry(yb,"._2i84");if(zb.length){var ac=zb[0].getBoundingClientRect();xb=ac.bottom-ac.top;}return xb;};vb.prototype.adjustStageSizeForVideo=function(wb){"use strict";var xb=this.getVideoElement(wb);if(!xb){this.videoLoadTimer=setTimeout(this.checkVideoStatus.bind(this,wb),200);}else this.adjustStageSize(this.getVideoSize(xb));};vb.prototype.handleServerError=function(wb,xb){"use strict";q.setContent(this.errorBox,wb);this.storeFromData(xb);};vb.prototype.fixButtonText=function(wb){"use strict";if(!this.buttonTruncateGk)return;var xb=q.scry(wb,".photosTruncatingUIButton"),yb=parseInt(ya.get(wb,'width'),10);if(yb>k){var zb={tagPhoto:"\u5199\u771f\u306b\u30bf\u30b0\u4ed8\u3051",doneTagPhoto:"\u30bf\u30b0\u4ed8\u3051\u5b8c\u4e86",addLocation:"\u4f4d\u7f6e\u60c5\u5831\u3092\u8ffd\u52a0",editPhoto:"\u7de8\u96c6"};for(var ac=0;ac<xb.length;ac++){var bc=xb[ac];o.addClass(bc,"_2n0k");ab.set(bc,zb[bc.getAttribute('data-buttonname')],'below','center');}}};vb.prototype.swapData=function(){"use strict";var wb,xb=this.stream.getCurrentHtml();if(xb){this.setLoadingState(vb.STATE_HTML,false);for(var yb in xb){wb=ob(yb);wb&&q.setContent(wb,xb[yb]);}var zb=ob('photosTruncatingUIButtonGroup');zb&&this.fixButtonText(zb);l.inform('PhotoSnowlift.DATA_CHANGE',jb(this.stream.getCurrentImageData().info,{movement:this.movementDelta}),l.BEHAVIOR_STATE);this.movementDelta=0;if(this.stream.getCurrentExtraData())l.inform('PhotoSnowlift.EXTRA_DATA_CHANGE',this.stream.getCurrentExtraData(),l.BEHAVIOR_STATE);}this.adjustScroller();this.scrollableArea.showScrollbar(false);this.adjustForNewData();this.logImpressionDetailsForPhoto();};vb.prototype.updateTotalCount=function(wb,xb,yb){"use strict";var zb=this.stream.getCurrentHtml();if(zb){var ac=hb('fbPhotoSnowliftPositionAndCount');q.replace(ac,yb);ac=yb;o.show(ac);var bc='fbPhotoSnowliftPositionAndCount';zb[bc]=kb(ac.childNodes);}this.stream.setTotalCount(wb);this.stream.setFirstCursorIndex(xb);};vb.prototype.addPhotoFbids=function(wb,xb,yb,zb){"use strict";if(zb&&this.sessionID&&zb!=this.sessionID)return;var ac=this.stream.getCursor()===null;this.stream.attachToFbidsList(wb,xb,yb);if(yb&&ac)this.page(0,true);if(this.pivots&&yb)this.pivots.setCycleCount(this.stream.calculateDistance(this.stream.getCursor(),this.stream.firstCursor));if(!this.pagersShown&&this.stream.canPage())this.setStagePagersState('ready');if(!this.slideshowAvailable&&this.stream.canPage()){this.slideshowAvailable=true;o.addClass(this.root,'slideshowAvailable');}this.setLeftAndRightPagersState();};vb.prototype.attachTagger=function(wb){"use strict";q.appendContent(this.stageActions,wb);};vb.prototype.storeFromData=function(wb){"use strict";if(!this.isOpen)return;if(wb.pivots)this.pivotsCarouselElement=wb.pivots;this.videoPivotsGK=wb.pivotsgk;if(wb.ssid&&this.sessionID&&this.sessionID!=wb.ssid)return;var xb=this.stream.storeToCache(wb);if('error' in xb){this.checkState(vb.STATE_ERROR);return;}if('init' in wb){this.$PhotoSnowlifto=wb.init.album_fbid;this.$PhotoSnowliftz=wb.init.is_album;this.$PhotoSnowliftA=wb.init.album_owner_name;this.$PhotoSnowliftH=wb.init.autoplay_videos;this.$PhotoSnowliftI=wb.init.autoplay_next_video;}if('init' in xb){this.initDataFetched(xb.init);if(this.openExplicitly){this.replaceUrl=true;qb(this.stream.getCurrentImageData().info.permalink);}if(this.stream.canPage())this.setStagePagersState('ready');this.setLeftAndRightPagersState();this.ua&&this.ua.add_event('ufi');}if('image' in xb)this.checkState(vb.STATE_IMAGE_DATA);if('data' in xb)this.checkState(vb.STATE_HTML);};vb.prototype.setLeftAndRightPagersState=function(){"use strict";if(this.stream.isNonCircularPhotoSet()){o.conditionClass(this.root,'disableLeft',!this.stream.nonCircularPhotoSetCanPage(-1));o.conditionClass(this.root,'disableRight',!this.stream.nonCircularPhotoSetCanPage(1));}if(this.snowflake){o.conditionClass(this.root,'disableLeft',this.stream.getCursor()==this.firstInSet);var wb=this.stream.getCursorAt(this.stream.calculatePositionForMovement(1));o.conditionClass(this.root,'disableRight',wb==this.firstInSet);}};vb.prototype.setStagePagersState=function(wb){"use strict";switch(wb){case 'ready':o.addClass(this.root,'pagingReady');this.pagersShown=true;this.ua&&this.ua.add_event('arrows');return;case 'active':o.addClass(this.root,'pagingActivated');return;case 'inactive':o.removeClass(this.root,'pagingActivated');return;case 'disabled':case 'reset':o.removeClass(this.root,'pagingReady');return;}};vb.prototype.deletePhoto=function(wb){"use strict";this.closeRefresh();};vb.prototype.closeRefresh=function(){"use strict";this.refreshOnClose=true;this.spotlight.hide();};vb.prototype.onHiliteTag=function(wb,xb){"use strict";if(xb.version!=ka.VIEWER_SNOWLIFT)return;var yb=xb.tag;if(yb)this.switchHilitedTags(yb,true);};vb.prototype.onUpdateTagBox=function(wb,xb){"use strict";if(xb.version==ka.VIEWER_SNOWLIFT)this.updateTagBox(xb.id,xb.approve);};vb.prototype.$PhotoSnowlift3=function(wb){"use strict";if(this.$PhotoSnowlift6){this.$PhotoSnowlift7&&this.$PhotoSnowlift7.log(wb);return true;}return false;};vb.prototype.$PhotoSnowlifth=function(){"use strict";this.$PhotoSnowlifty=false;};vb.prototype.$PhotoSnowlifti=function(event){"use strict";if(this.$PhotoSnowlifty)event.kill();};vb.prototype.isReturningToStart=function(){"use strict";return !!this.returningToStart;};vb.prototype.$PhotoSnowliftp=function(){"use strict";if(this.$PhotoSnowliftv)this.$PhotoSnowliftv.logStopForUnload();};vb.getInstance=function(){"use strict";if(!vb.$PhotoSnowliftJ)vb.$PhotoSnowliftJ=new vb();return vb.$PhotoSnowliftJ;};vb.initWithSpotlight=function(wb,xb){"use strict";vb.getInstance().init(wb,xb);};vb.addPhotoFbids=function(wb,xb,yb,zb){"use strict";vb.getInstance().addPhotoFbids(wb,xb,yb,zb);};vb.setReachedLeftEnd=function(){"use strict";vb.getInstance().setReachedLeftEnd();};vb.setReachedRightEnd=function(){"use strict";vb.getInstance().setReachedRightEnd();};vb.attachFollowFlyout=function(wb){"use strict";q.insertAfter(hb('fbPhotoSnowliftSubscribe'),wb);};vb.attachSubscribeFlyout=function(wb){"use strict";q.insertAfter(hb('fbPhotoSnowliftSubscribe'),wb);};vb.attachTagger=function(wb){"use strict";vb.getInstance().attachTagger(wb);};vb.preload=function(wb,xb){"use strict";vb.getInstance().preload(wb,xb);};vb.bootstrap=function(wb,xb){"use strict";var yb=wb&&db(wb).getQueryData();if(yb&&yb.hasOwnProperty('share_id')){n.loadModules(["SpotlightShareViewer"],function(zb){zb.bootstrap(wb,xb);});return;}vb.getInstance().bootstrap(wb,xb);};vb.closeRefresh=function(){"use strict";vb.getInstance().closeRefresh();};vb.deletePhoto=function(wb){"use strict";vb.getInstance().deletePhoto(wb);};vb.getImage=function(){"use strict";return vb.getInstance().getImage();};vb.getImageId=function(){"use strict";return vb.getInstance().getImageId();};vb.getLoadQuery=function(){"use strict";return vb.getInstance().getLoadQuery();};vb.getRHCBody=function(){"use strict";return vb.getInstance().getRHCBody();};vb.getRHCFooter=function(){"use strict";return vb.getInstance().getRHCFooter();};vb.getRHCHeader=function(){"use strict";return vb.getInstance().getRHCHeader();};vb.getRoot=function(){"use strict";return vb.getInstance().getRoot();};vb.likePhotoSkipConfirmation=function(wb){"use strict";vb.getInstance().likePhotoSkipConfirmation(wb);};vb.saveTagsFromPayload=function(wb){"use strict";vb.getInstance().saveTagsFromPayload(wb);};vb.saveTagsFromPayloadDelayed=function(wb){"use strict";setTimeout(vb.saveTagsFromPayload.bind(null,wb),2000);};vb.handleServerError=function(wb,xb){"use strict";vb.getInstance().handleServerError(wb,xb);};vb.setVideoWarning=function(wb,xb){"use strict";var yb=vb.getInstance(),zb='video_warning_'+wb;if(!yb.videoWarnings)yb.videoWarnings=[];yb.videoWarnings[zb]=xb;};vb.storeFromData=function(wb){"use strict";vb.getInstance().storeFromData(wb);};vb.swapData=function(){"use strict";vb.getInstance().swapData();};vb.updateTotalCount=function(wb,xb,yb){"use strict";vb.getInstance().updateTotalCount(wb,xb,yb);};vb.setVideoRotateURI=function(wb){"use strict";vb.getInstance().videoRotateURI=wb;};jb(vb,{STATE_ERROR:'error',STATE_HTML:'html',STATE_IMAGE_PIXELS:'image_pixels',STATE_IMAGE_DATA:'image',LOADING_TIMEOUT:2000,PAGER_FADE:3000,FULL_SCREEN_PADDING:10,STAGE_NORMAL_MAX:{x:960,y:960},STAGE_MIN:{x:520,y:520},SIDEBAR_SIZE_MAX:360,MIN_PANORAMA_Y:240,ZOOM_BUTTON_HEIGHT:52,ZOOM_BUTTON_BOT_PAD:60,ZOOM_BUTTON_TOP_PAD:16,MAX_SLIDER_HEIGHT:.075,MAX_SLIDER_WIDTH:.75,MIN_PANO_TO_STAGE_RATIO:1.2,STAGE_CHROME:{x:82,y:42},VIDEO_BOTTOM_BAR_SPACE:40,GOPREV_AREA:120,TIMELINE_STRETCH_WIDTH:843,TIMELINE_STRETCH_MIN:480,MIN_TAG_DISTANCE:83,PADDING_MIN:40,MIN_UFI_HEIGHT:250,COLLECTIONS_UNTAGGED_PHOTOS:3,PHOTOS_OF_YOU_SUGGESTIONS:28,FRIENDS_IN_PHOTOS_SUGGESTIONS:31,MIN_ADS_VISIBLE:1,PINNED_UFI_ADJUSTMENT:11,ADD_COMMENT_HEIGHT:54,SLIDESHOW_TIME:3000,_instance:null,touch:nb,touchMarkup:nb});});(function(){var g=74,h=75,i=70,j=76,k=315,l='Arbiter',m='AsyncRequest',n='Bootloader',o='CSS',p='Dialog',q='DOM',r='DOMQuery',s='DOMControl',t='Event',u='EventListener',v='fbt',w='FullScreen',x='ImageUtils',y='Input',z='Keys',aa='Layer',ba='LayerHideOnEscape',ca='LikeConfirmer',da='LinkController',ea='LitestandStoryInsertionStatus',fa='Locale',ga='PageTransitions',ha='Parent',ia='PhotoLogger',ja='PhotoPermalinkURI',ka='PhotosConst',la='PhotoSessionLog',ma='PhotosetPivotSlide.react',na='PhotosetSearchPivot.react',oa='PhotosetSearchPivotData',pa='PhotoSnowliftAds',qa='PhotoStreamCache',ra='PhotosUtils',sa='PhotoTagSearchPivotLogger',ta='PhotoViewer',ua='React',va='Rect',wa='ScriptPath',xa='ScrollableArea',ya='Style',za='Toggler',ab='Tooltip',bb='UFIFeedbackTargets',cb='UIPagelet',db='URI',eb='UserAgent_DEPRECATED',fb='Vector',gb='VideoPlayerReason',hb='$',ib='computeRelativeURI',jb='copyProperties',kb='createArrayFromMixed',lb='csx',mb='cx',nb='emptyFunction',ob='ge',pb='getActiveElement',qb='goURI',rb='invariant',sb='userAction';for(var tb in ta)if(ta.hasOwnProperty(tb))vb[tb]=ta[tb];var ub=ta===null?null:ta.prototype;vb.prototype=Object.create(ub);vb.prototype.constructor=vb;vb.__superConstructor__=ta;function vb(){"use strict";ta.call(this);this.$PhotoSnowlift0={};this.$PhotoSnowlift1=0;this.$PhotoSnowlift2=false;this.clearAlbumBoundaries();}vb.prototype.preload=function(wb,xb){"use strict";n.loadModules(["PhotoTagger","Live","PhotoTagApproval","PhotoTags","TagTokenizer","css:fb-photos-snowlift-fullscreen-css"],function(zb){this.PhotoTagger=zb;}.bind(this));var yb=this.getImageSrc(db(wb).getQueryData());if(yb)if(!this.$PhotoSnowlift3(yb))(new Image()).src=yb;};vb.prototype.bootstrap=function(wb,xb){"use strict";this.preload(wb,xb);if(this.closeDirty){setTimeout(this.bootstrap.bind(this,wb,xb),0);return;}pa.reset();this.resetUriStack=true;if(this.isOpen)if(this.openExplicitly){this.closeCleanup();this.resetUriStack=false;}else return;this.$PhotoSnowlift4=null;var yb=ha.byAttribute(xb,'data-cursor');if(yb){try{var ac=JSON.parse(yb.getAttribute('data-ft'));this.$PhotoSnowlift4={qid:ac.qid,mf_story_key:ac.mf_story_key};}catch(zb){}}else try{yb=ha.byAttribute(xb,'data-ad');var bc=JSON.parse(yb.getAttribute('data-ad'));this.$PhotoSnowlift4={ad_id:bc.adid};}catch(zb){}this.ua=sb('snowlift',xb).uai('open');wa.openOverlayView('snowlift');this.returningToStart=false;this.loading&&o.removeClass(this.loading,'loading');if(xb){o.addClass((this.loading=xb),'loading');var cc=ha.byClass(xb,'uiStreamStory')||ha.byClass(xb,"_5jmm");if(cc){this.storyID=cc.id;}else{var dc=ha.byClass(xb,"_5b9c");if(dc)this.storyID=dc.getAttribute('data-ownerid');}this.$PhotoSnowlift5();this.getThumbAndSize(xb);}else this.loading=null;l.inform('PhotoSnowlift.GO',wb,l.BEHAVIOR_STATE);this.loadFrameIfUninitialized();};vb.prototype.$PhotoSnowlift5=function(){"use strict";if(this.container)if(this.storyID){this.container.setAttribute('data-ownerid',this.storyID);}else this.container.removeAttribute('data-ownerid');};vb.prototype.setupFromSnowflake=function(wb,xb){"use strict";this.extraClasses=wb;this.snowflake=true;this.firstInSet=xb;if(this.root){o.addClass(this.root,"snowflake");this.extraClasses.forEach(function(yb){o.addClass(this.root,yb);},this);}};vb.prototype.getCurrentImageServerSizeDimensions=function(){"use strict";var wb=this.stream.getCurrentImageData();return wb.originalDimensions||wb.dimensions;};vb.prototype.getEventPrefix=function(){"use strict";return 'PhotoSnowlift';};vb.prototype.getRoot=function(){"use strict";return this.root;};vb.prototype.getSourceString=function(){"use strict";return 'snowlift';};vb.prototype.getViewerSource=function(){"use strict";return this.source;};vb.prototype.getViewerSet=function(){"use strict";return this.stream.getPhotoSet();};vb.prototype.getVersionConst=function(){"use strict";return ka.VIEWER_SNOWLIFT;};vb.prototype.getImage=function(){"use strict";return this.image;};vb.prototype.getImageId=function(){"use strict";return this.stream.getCursor();};vb.prototype.getRHCHeader=function(){"use strict";return this.rhcHeader;};vb.prototype.getRHCBody=function(){"use strict";return this.ufiForm;};vb.prototype.getRHCFooter=function(){"use strict";return this.rhcFooter;};vb.prototype.getLoadQuery=function(){"use strict";return this.loadQuery;};vb.prototype.getCurrentPhotoInfo=function(){"use strict";var wb=this.stream.getCurrentImageData();if(wb)return wb.info;return null;};vb.prototype.getOwnerId=function(){"use strict";var wb=this.stream.getCurrentImageData();if(wb)return wb.info.owner;return null;};vb.prototype.getThumbAndSize=function(wb){"use strict";this.currentImageSize=null;this.thumbSrc=null;var xb=db(wb.getAttribute('ajaxify')).getQueryData();if(!xb.size)return;var yb=fb.deserialize(xb.size);if(!yb.x||!yb.y)return;this.currentImageSize=yb;if(wb.getAttribute('data-cropped'))return;var zb=q.scry(wb,'img')[0],ac=q.scry(wb,'i')[0],bc=ha.byAttribute(wb,'data-size');this.shouldStretch=bc&&this.currentImageSize&&zb&&bc.getAttribute('data-size')==="2"&&this.currentImageSize.x>this.currentImageSize.y&&this.currentImageSize.x<=vb.TIMELINE_STRETCH_WIDTH&&zb.offsetWidth===vb.TIMELINE_STRETCH_WIDTH;var cc;if(zb){cc=zb.src;}else if(ac){cc=ya.get(ac,'backgroundImage').replace(/.*url\("?([^"]*)"?\).*/,'$1');}else return;this.thumbSrc=cc;};vb.prototype.loadFrameIfUninitialized=function(){"use strict";if(this.root)return;new m('/ajax/photos/snowlift/init.php').setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();};vb.prototype.init=function(wb,xb){"use strict";this.init=nb;this.$PhotoSnowlift6=xb.photos_client_loading;this.$PhotoSnowlift7=null;if(this.$PhotoSnowlift6)this.$PhotoSnowlift7=new ia(ka.VIEWER_SNOWLIFT_STRING);this.$PhotoSnowlift8=xb.pivot_hover;this.$PhotoSnowlift9=xb.show_more_photos;this.$PhotoSnowlifta=xb.extra_slide_pivot;la.setEndMetrics(xb.pivot_end_metric);this.startingMousePos=null;this.haveLeftBufferRegion=false;this.showingTypeaheadSuggestions=false;this.fullscreen=w.isSupported();this.showOGVideos=xb.og_videos;this.resizeCommentsForAds=xb.resize_comments_for_ads;this.spotlight=wb;this.spotlight.subscribe('blur',function(){this.closingAction=la.OUTSIDE;}.bind(this));this.spotlight.subscribe('hide',this.closeHandler.bind(this));this.spotlight.subscribe('key',this.keyHandler.bind(this));this.initializeNodes(this.spotlight.getRoot());pa.init(this.sideAdUnit,this,xb,this.adsDisplayedCallback.bind(this));this.inAdsDisplayedCallback=false;this.lastAdsHeight=0;if(!this.subscription){da.registerHandler(this.handleNavigateAway.bind(this));this.subscription=l.subscribe('PhotoSnowlift.GO',function(yb,zb){this.openExplicitly=true;this.loading&&o.removeClass(this.loading,'loading');this.open(zb);}.bind(this));}this.transitionHandlerRegistered=false;this.returningToStart=false;ga.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;l.subscribe('PhotoTagApproval.HILITE_TAG',this.onHiliteTag.bind(this));l.subscribe('PhotoTagApproval.UPDATE_TAG_BOX',this.onUpdateTagBox.bind(this));if(this.fullscreen)w.subscribe('changed',this.onFullScreenChange.bind(this));this.slideshowGk=xb.snowlift_slideshow;this.buttonTruncateGk=xb.snowlift_button_truncate;this.$PhotoSnowliftb=this.$PhotoSnowliftb&&xb.www_panorama_viewer;this.allowIrrelevantRequests=!!xb.snowlift_allow_irrelevant_requests;if(this.snowflake){o.addClass(this.root,"snowflake");this.extraClasses.forEach(function(yb){o.addClass(this.root,yb);},this);}};vb.prototype.onFullScreenChange=function(){"use strict";if(!this.isOpen)return;var wb=w.isFullScreen();o.conditionClass(document.body,'fbPhotoSnowliftFullScreenMode',wb);if(wb){if(!o.hasClass(this.root,'fbPhotoSnowliftEditMode'))this.collapseRHC();var xb=this.stream.getCurrentImageData();if(xb&&xb.url&&this.image.src!==xb.url&&this.shouldShowHiRes(xb))this.switchImage(xb.url);this.adjustForResize();if(!this.$PhotoSnowlift2)this.$PhotoSnowliftc();}else{if(!this.$PhotoSnowlift2)this.uncollapseRHC();if(eb.chrome()&&!o.hasClass(this.root,'fbPhotoSnowliftEditMode'))this.page(0,false);l.inform('reflow');}za.hide();};vb.prototype.initializeNodes=function(wb){"use strict";this.root=wb;this.container=q.find(wb,'div.fbPhotoSnowliftContainer');this.$PhotoSnowlift5();this.snowliftPopup=q.find(this.container,'div.fbPhotoSnowliftPopup');this.rhc=q.find(this.snowliftPopup,'div.rhc');this.rhcHeader=q.find(this.rhc,'div.rhcHeader');this.rhcFooter=q.find(this.rhc,'div.rhcFooter');this.ufiForm=q.find(this.rhc,'form.fbPhotosSnowliftFeedbackForm');this.ufiInputContainer=q.find(this.rhc,'div.fbPhotosSnowboxFeedbackInput');this.scroller=q.find(this.ufiForm,'div.rhcScroller');this.scrollerBody=q.find(this.scroller,'div.uiScrollableAreaBody');this.stageWrapper=q.find(this.snowliftPopup,'div.stageWrapper');this.overlay=q.find(this.snowliftPopup,'div.snowliftOverlay');this.errorBox=q.find(this.stageWrapper,'div.stageError');this.image=q.find(this.stageWrapper,'img.spotlight');this.stage=q.find(this.stageWrapper,'div.stage');this.showZoomInButton=q.scry(this.stageWrapper,"._5qmg").pop();this.showZoomOutButton=q.scry(this.stageWrapper,"._5qmh").pop();this.zoomedImage=q.scry(this.stage,"._10zw").pop();this.outerImageSlider=q.scry(this.stage,"._10zx").pop();this.innerImageSlider=q.scry(this.stage,"._10zv").pop();this.$PhotoSnowliftb=this.showZoomInButton&&this.showZoomOutButton&&this.zoomedImage&&this.outerImageSlider&&this.innerImageSlider;if(this.$PhotoSnowliftb){o.hide(this.showZoomInButton);o.hide(this.showZoomOutButton);o.hide(this.zoomedImage);o.hide(this.outerImageSlider);}this.videoStage=q.find(this.stageWrapper,'div.videoStage');this.prevPager=q.find(this.snowliftPopup,'a.snowliftPager.prev');this.nextPager=q.find(this.snowliftPopup,'a.snowliftPager.next');this.stageActions=q.find(wb,'div.stageActions');this.buttonActions=q.find(this.stageActions,'div.fbPhotosPhotoButtons');this.placeInfo=q.find(this.rhc,'div.fbPhotosSnowliftPlaceInfo');this.sideAdUnit=q.find(wb,"._5ciw");o.conditionClass(this.root,'fullScreenAvailable',this.fullscreen);};vb.prototype.initializeScroller=function(){"use strict";this.initializeScroller=nb;this.scrollableArea=xa.fromNative(this.scroller,{fade:true,persistent:true});var wb=function(event){var xb=t.$E(event).getTarget();if(q.contains(this.ufiInputContainer,xb)){var yb=s.getInstance(xb);if(yb){this.scrollableArea.scrollToBottom();var zb=yb.subscribe('resize',function(){var bc=this.scrollableArea.isScrolledToBottom();this.adjustScroller();bc&&this.scrollableArea.scrollToBottom();}.bind(this)),ac=t.listen(xb,'blur',function(){yb.unsubscribe(zb);ac.remove();});}}}.bind(this);l.subscribe('ufi/inputHeightChanged',function(xb,yb){if(q.contains(this.ufiInputContainer,yb.node))this.adjustScroller();}.bind(this));l.subscribe('ufi/addCommentFacepileRendered',function(){this.adjustScroller();}.bind(this));l.subscribe('ufi/changed',function(xb,yb){if(this.ufiForm===yb.form)this.adjustScrollerIfNecessary();}.bind(this));l.subscribe('ufi/comment',function(xb,yb){if(this.ufiForm===yb.form){this.adjustScrollerIfNecessary();if(yb.isranked){this.scrollableArea.scrollToTop();}else this.scrollableArea.scrollToBottom();}}.bind(this));t.listen(this.rhc,'click',function(event){var xb=event.getTarget();if(ha.byTag(xb,'a')||ha.byTag(xb,'button')||q.isNodeOfType(xb,'input'))this.adjustScrollerIfNecessary();}.bind(this));l.subscribe(['reflow','CommentUFI.Pager'],function(){if(this.isOpen)this.adjustScrollerIfNecessary();}.bind(this));t.listen(this.ufiForm,'focusin',wb);};vb.prototype.openHandler=function(wb){"use strict";if(this.isOpen||!ja.isValid(wb)||this.returningToStart||wb.getQueryData().closeTheater||wb.getQueryData().permPage){this.openHandlerRegistered=false;return false;}this.open(wb);this.$PhotoSnowlifte.push(db(wb).getQualifiedURI().toString());ga.transitionComplete(true);return true;};vb.prototype.getImageSrc=function(wb){"use strict";if(wb.smallsrc){if(!wb.size)return wb.smallsrc;var xb=fb.deserialize(wb.size),yb=this.getStageSize(xb);yb=this.$PhotoSnowliftf(yb);if(yb.x<=vb.STAGE_NORMAL_MAX.x&&yb.y<=vb.STAGE_NORMAL_MAX.y)return wb.smallsrc;}return wb.src;};vb.prototype.open=function(wb){"use strict";var xb=db(wb),yb=xb.getQueryData(),zb=ja.parse(xb);if(zb!==null){yb.fbid=zb.photo_id;yb.set=zb.set_token;}var ac=this.getImageSrc(yb);if(ac){delete yb.src;delete yb.smallsrc;}if(this.resetUriStack)this.$PhotoSnowlifte=[];if(!this.initialLoad){yb.firstLoad=true;this.initialLoad=true;ea.registerBlocker(function(){return this.isOpen;}.bind(this));}this.sessionID=Date.now();this.loadQuery=jb(yb,{ssid:this.sessionID});if(this.$PhotoSnowlift4)this.loadQuery.data_ft=this.$PhotoSnowlift4;this.isOpen=true;this.pagersShown=false;this.refreshOnClose=false;this.hilitedTag=null;this.loadingStates={image:false,html:false};this.replaceUrl=false;this.movementDelta=0;this.pivotsCarouselElement=null;this.videoPivotsGK=false;o.show(this.nextPager);o.show(this.prevPager);this.source=null;this.saveTagSubscription=l.subscribe('PhotoTagger.SAVE_TAG',this.onTagSaved.bind(this));this.taggedPhotoIds=[];this.stream=new qa();this.stream.init(ka.VIEWER_SNOWLIFT,'PhotoViewerPagelet','pagelet_photo_viewer',this.$PhotoSnowlift6?this.$PhotoSnowlift7:null,yb.tagSuggestionMode||'everyone');if(!!db.getMostRecentURI().getQueryData().viewas)this.stream.setViewAs(db.getMostRecentURI().getQueryData().viewas+'');this.fetchInitialData();this.setLoadingState(vb.STATE_HTML,true);this.rhcCollapsed=false;this.$PhotoSnowliftg(wb,ac);n.loadModules(["PhotosButtonTooltips"],function(bc){bc.init();});};vb.prototype.$PhotoSnowliftg=function(wb,xb){"use strict";this.createLoader(xb);this.spotlight.show();this.ua&&this.ua.add_event('frame');l.inform('layer_shown',{type:'PhotoSnowlift'});l.inform('PhotoSnowlift.OPEN');this.stageHandlers=[t.listen(window,'resize',this.adjustForResize.bind(this)),t.listen(this.stageWrapper,'click',this.buttonListener.bind(this)),t.listen(this.stageWrapper,'mouseleave',function(event){var ac=event.getTarget();if(!(ha.byClass(ac,'snowliftOverlay')||ha.byClass(ac,'fbPhotoSnowliftTagApproval')||ha.byClass(ac,'tagPointer')||ha.byClass(ac,'arrow')||ha.byClass(ac,'faceboxSuggestion')||ha.byClass(ac,'typeaheadWrapper')||ha.byClass(ac,'photoTagTypeahead')||ha.byClass(ac,'fbPhotoTagger')))this.unhiliteAllTags();this.hidePagers();}.bind(this)),t.listen(this.stageWrapper,'mousemove',this.hilitePager.bind(this)),t.listen(this.stageWrapper,'mousemove',this.hiliteTagsOnMouseMove.bind(this)),t.listen(this.overlay,'mouseenter',this.unhiliteAllTags.bind(this)),t.listen(this.container,'mousemove',this.$PhotoSnowlifth.bind(this)),t.listen(this.container,'mouseover',this.$PhotoSnowlifti.bind(this)),t.listen(this.stageWrapper,'focusin',this.hilitePager.bind(this)),t.listen(this.rhc,'focusin',this.hidePagers.bind(this))];if(this.$PhotoSnowliftb){this.stageHandlers.push(t.listen(this.stage,'mousedown',this.$PhotoSnowliftj.bind(this)));this.stageHandlers.push(t.listen(this.root,'mouseup',this.$PhotoSnowliftk.bind(this)));}this.stageHandlers.push(t.listen(this.container,'click',function(event){var ac=event.getTarget();if(ha.byClass(ac,'rotateRight')){this.rotate('right');}else if(ha.byClass(ac,'rotateLeft')){this.rotate('left');}else if(ha.byClass(ac,'closeTheater')){if(w.isFullScreen()){w.toggleFullScreen();return;}this.closingAction=la.X;this.spotlight.hide();return false;}else if(this.fullscreen)if(ha.byClass(ac,'fbPhotoSnowliftFullScreen')){this.toggleFullScreen();}else if(ha.byClass(ac,'fbPhotoSnowliftCollapse'))this.toggleCollapse();}.bind(this)));var yb=ob('fbPhotoSnowliftFeedback');if(yb)this.stageHandlers.push(t.listen(yb,'click',function(event){var ac=event.getTarget();if(ha.byClass(ac,'like_link')||(ha.byClass(ac,'UFILikeLink')&&ha.byClass(ac,'UIActionLinks')))this.toggleLikeButton();var bc=ha.byClass(event.getTarget(),'uiUfiCollapsedComment');if(bc)o.addClass(bc,'uiUfiCollapsedCommentToggle');}.bind(this)));var zb=ob('fbPhotoSnowliftOnProfile');if(zb)this.stageHandlers.push(t.listen(zb,'click',function(event){if(ha.byClass(event.getTarget(),'fbPhotoRemoveFromProfileLink'))this.refreshOnClose=true;}.bind(this)));if(this.resetUriStack)this.startingURI=db.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI();if(!xb)this.setLoadingState(vb.STATE_IMAGE_DATA,true);if(!this.transitionHandlerRegistered){ga.registerHandler(this.transitionHandler.bind(this));this.transitionHandlerRegistered=true;}la.initLogging(la.SNOWLIFT);if(this.pivots)la.setRelevantCount(this.pivots.relevantCount);};vb.prototype.toggleFullScreen=function(){"use strict";var wb=w.toggleFullScreen(document.documentElement);if(wb){var xb=this.stream.getCurrentImageData();if(xb&&xb.url&&this.image.src!==xb.url&&this.shouldShowHiRes(xb))if(!this.$PhotoSnowlift3(xb.url))(new Image()).src=xb.url;la.logEnterFullScreen(this.stream.getCursor());}};vb.prototype.getStream=function(){"use strict";return this.stream;};vb.prototype.fetchInitialData=function(){"use strict";this.ua&&this.ua.add_event('init_data');this.stream.waitForInitData();cb.loadFromEndpoint('PhotoViewerInitPagelet',ob('pagelet_photo_viewer_init',this.root),this.loadQuery,{actorID:bb.getActorIDForFeedbackTargetIfExists(this.loadQuery.fbid),usePipe:true,jsNonblock:true,crossPage:true,allowIrrelevantRequests:this.allowIrrelevantRequests});};vb.prototype.toggleCollapse=function(){"use strict";if(this.rhcCollapsed){this.uncollapseRHC();}else this.collapseRHC();};vb.prototype.collapseRHC=function(){"use strict";this.rhcCollapsed=true;o.addClass(this.root,'collapseRHC');this.adjustForResize();};vb.prototype.uncollapseRHC=function(){"use strict";this.rhcCollapsed=false;o.removeClass(this.root,'collapseRHC');this.adjustForResize();};vb.prototype.closeHandler=function(){"use strict";if(!this.isOpen)return;this.closingAction=this.closingAction||la.ESC;if(db.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI().toString()==this.startingURI.toString()){this.close();return;}this.returnToStartingURI(this.refreshOnClose);this.close();};vb.prototype.returnToStartingURI=function(wb,xb){"use strict";if(!wb)if(xb){this.squashNextTransition(qb.bind(null,xb));}else this.squashNextTransition();this.returningToStart=true;var yb=l.subscribe('page_transition',(function(){this.returningToStart=false;yb.unsubscribe();}).bind(this)),zb=wb||isNaN(eb.opera()),ac=this.$PhotoSnowlifte.length;if(zb&&ac<window.history.length){window.history.go(-ac);}else{var bc=this.startingURI,cc=new db(bc).removeQueryData('closeTheater');if(bc.getQueryData().sk=='approve'&&bc.getPath()=='/profile.php'){cc.removeQueryData('highlight');cc.removeQueryData('notif_t');}qb(cc);}};vb.prototype.squashNextTransition=function(wb){"use strict";this.squashNext=true;ga.registerHandler(function xb(){if(this.squashNext){this.squashNext=false;if(wb)setTimeout(wb,0);ga.transitionComplete(true);return true;}return false;}.bind(this),7);};vb.prototype.handleNavigateAway=function(wb){"use strict";var xb=ib(ga.$PhotoSnowliftl.getQualifiedURI(),wb.getAttribute('href'));if(this.isOpen&&(xb instanceof db)&&xb.getUnqualifiedURI().toString()!=this.startingURI.toString()&&xb.getPath()!='/photo.php'){if(!this.closingAction)this.closingAction=la.NAVIGATE;this.returnToStartingURI(false,xb);this.close();return false;}return true;};vb.prototype.postProcessTaggedPhotos=function(){"use strict";if(this.taggedPhotoIds&&this.taggedPhotoIds.length>0){var wb=null;if(this.source===vb.COLLECTIONS_UNTAGGED_PHOTOS){wb='/ajax/photos/photo/edit/skiptag/';}else if(this.source===vb.PHOTOS_OF_YOU_SUGGESTIONS||this.source===vb.FRIENDS_IN_PHOTOS_SUGGESTIONS)wb='/ajax/photos/photo/add_to_star_grid/';if(wb)new m().setURI(wb).setAllowCrossPageTransition(true).setData({media_id:this.taggedPhotoIds,source:this.source}).send();}};vb.prototype.onTagSaved=function(wb,xb){"use strict";if(this.taggedPhotoIds){if(this.source===vb.PHOTOS_OF_YOU_SUGGESTIONS&&!xb.self_tag)return;this.taggedPhotoIds.push(xb.photo_fbid);}};vb.prototype.clearAlbumBoundaries=function(){"use strict";this.$PhotoSnowliftn={start:0,end:0};};vb.prototype.close=function(){"use strict";if(!this.isOpen)return;this.$PhotoSnowlifto=null;this.hideMorePhotos();this.hidePivotSlide();this.$PhotoSnowliftp();this.isOpen=false;this.$PhotoSnowlift1=0;this.clearAlbumBoundaries();if(this.fullscreen)w.disableFullScreen();sb('snowlift').uai('close');wa.closeOverlayView('snowlift');this.spotlight.hide();this.openExplicitly=false;this.postProcessTaggedPhotos();l.unsubscribe(this.saveTagSubscription);this.taggedPhotoIds=[];this.closeDirty=true;setTimeout(this.closeCleanup.bind(this),0);if(this.snowflake){o.removeClass(this.root,"snowflake");this.extraClasses.forEach(function(wb){o.removeClass(this.root,wb);},this);}this.extraClasses=[];this.snowflake=false;this.firstInSet=null;this.movementDelta=0;};vb.prototype.closeCleanup=function(){"use strict";this.closeDirty=false;o.removeClass(this.root,'dataLoading');la.logPhotoViews(this.closingAction);this.destroy();o.hide(this.errorBox);o.hide(this.image);this.currentImageSize=null;this.thumbSrc=null;this.shouldStretch=false;this.resetUriStack=true;var wb=this.stream.getCursor();o.removeClass(this.stageWrapper,'showVideo');q.empty(this.videoStage);this.uncollapseRHC();this.currentMinSize=null;this.setStagePagersState('reset');this.recacheData();q.empty(this.sideAdUnit);this.stream.destroy();this.root.setAttribute('aria-busy','true');var xb=this.closingAction===la.NAVIGATE;this.closingAction=null;if(!this.openHandlerRegistered){ga.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;}l.inform('layer_hidden',{type:'PhotoSnowlift'});l.inform('PhotoSnowlift.CLOSE',{is_navigating:xb,fbid:wb});this.$PhotoSnowliftq();this.$PhotoSnowliftr=null;};vb.prototype.createLoader=function(wb){"use strict";if(this.currentImageSize===null){this.adjustStageSize(vb.STAGE_MIN);}else{var xb=this.getStageSize(this.currentImageSize);xb=new fb(Math.max(xb.x,vb.STAGE_MIN.x),Math.max(xb.y,vb.STAGE_MIN.y));var yb=this.getImageSizeInStage(this.currentImageSize,xb);if(this.thumbSrc===null){this.adjustStageSize(yb);}else this.useImage(q.create('img',{className:'spotlight',alt:'',src:this.thumbSrc,style:{width:yb.x+'px',height:yb.y+'px'}}),yb,false);}this.setLoadingState(this.STATE_IMAGE_PIXELS,true);if(wb)setTimeout((function(){var zb=new Image(),ac=function(){if(!this.isOpen)return;if(!this.stream||!this.stream.errorInCurrent()){this.switchImage(wb,this.currentImageSize);this.ua&&this.ua.add_event('image');this.setLoadingState(vb.STATE_IMAGE_DATA,false);}}.bind(this),bc=t.listen(zb,'load',ac),cc=function(){if(bc){bc.remove();bc=null;}};l.subscribeOnce('PhotoSnowlift.SWITCH_IMAGE',cc);l.subscribeOnce('PhotoSnowlift.CLOSE',cc);this.$PhotoSnowlift3(wb);zb.src=wb;}).bind(this),0);o.hide(this.stageActions);this.setStagePagersState('disabled');};vb.prototype.initDataFetched=function(wb){"use strict";la.setPhotoSet(this.stream.getPhotoSet());la.setLogFbids(wb.logids);this.$PhotoSnowliftn.start=this.stream.getCursor();var xb=this.stream.getCurrentImageData();la.addPhotoView(xb.info,this.shouldShowHiRes(xb),this.fullscreen&&w.isFullScreen());var yb=this.stream.getCurrentExtraData();if(this.$PhotoSnowlift8&&yb)sa.logImageImpression('snowlift',String(this.stream.getCursor()),Object.keys(yb.tagRects));if(yb&&yb.source!==(void 0)){this.source=parseInt(yb.source,10);la.setSource(this.source);}if(!this.pageHandlers)this.pageHandlers=[t.listen(this.root,'click',this.pageListener.bind(this)),t.listen(this.root,'mouseleave',this.mouseLeaveListener.bind(this))];o.show(this.stageActions);this.root.setAttribute('aria-busy','false');this.isLoggedInViewer=wb.loggedin;this.disableAds=!this.isLoggedInViewer||wb.fromad||this.stream.isInViewAsMode();this.loadAds();if(this.$PhotoSnowlifts(xb)){la.addPanoramaImpression();this.switchIntoZoomedImage();}else if(this.$PhotoSnowliftb)o.hide(this.showZoomInButton);};vb.prototype.adjustScrollerIfNecessary=function(){"use strict";clearTimeout(this.scrollerTimeout);this.scrollerTimeout=setTimeout(this.adjustScroller.bind(this),0);};vb.prototype.adjustScroller=function(wb){"use strict";clearTimeout(this.scrollerTimeout);this.initializeScroller();this.scrollableArea.resize();var xb=fb.getElementDimensions(this.rhc),yb=xb.y;yb-=fb.getElementDimensions(this.rhcHeader).y;yb-=fb.getElementDimensions(this.ufiInputContainer).y;if(this.placeInfo){var zb=fb.getElementDimensions(this.placeInfo);yb-=zb.y;ya.set(this.sideAdUnit,'bottom',zb.y+'px');}if(wb==null)wb=this.resizeCommentsForAds?this.lastAdsHeight:0;this.lastAdsHeight=wb;yb=Math.max(0,yb);var ac=fb.getElementDimensions(this.scrollerBody).y,bc=Math.max(vb.MIN_UFI_HEIGHT,yb-wb);if(ac>=bc){if(yb>bc){o.removeClass(this.rhc,'pinnedUfi');yb-=bc;}else{o.addClass(this.rhc,'pinnedUfi');yb=0;}ya.set(this.scroller,'height',bc+'px');}else{ya.set(this.scroller,'height','auto');o.removeClass(this.rhc,'pinnedUfi');yb-=ac;}var cc=fb.getElementDimensions(this.ufiInputContainer).y;ya.set(this.ufiForm,'padding-bottom',cc+'px');pa.resize(new fb(xb.x,yb));this.scrollableArea.adjustGripper();};vb.prototype.adjustForResize=function(){"use strict";this.currentMinSize=null;this.adjustStageSize();this.adjustForNewData();if(this.$PhotoSnowliftb){if(!this.$PhotoSnowlift2)this.$PhotoSnowliftc();this.$PhotoSnowliftt(this.$PhotoSnowliftr);}};vb.prototype.shouldShowHiRes=function(wb){"use strict";if(!wb||!wb.smallurl)return false;var xb=this.getStageSize(wb.dimensions);xb=this.$PhotoSnowliftf(xb);var yb=this.getImageSizeInStage(wb.dimensions,xb);return (yb.x>vb.STAGE_NORMAL_MAX.x||yb.y>vb.STAGE_NORMAL_MAX.y);};vb.prototype.$PhotoSnowliftf=function(wb){"use strict";if(window.devicePixelRatio&&window.devicePixelRatio>1)wb=new fb(wb.x*window.devicePixelRatio,wb.y*window.devicePixelRatio);return wb;};vb.prototype.getImageURL=function(wb){"use strict";if(wb.video){return null;}else if(wb.smallurl&&!this.shouldShowHiRes(wb))return wb.smallurl;return wb.url;};vb.prototype.getImageOrVideoDimensions=function(wb){"use strict";if(wb.video){var xb=this.getVideoElement(wb.video);if(xb)return this.getVideoSize(xb);}return this.getImageDimensions(wb);};vb.prototype.getImageDimensions=function(wb){"use strict";if(this.$PhotoSnowlift2)return wb.originalDimensions;if(wb.smalldims&&(!this.shouldShowHiRes(wb)||this.image.src===wb.smallurl))return wb.smalldims;return wb.dimensions;};vb.prototype.getStageSize=function(wb,xb){"use strict";var yb=fb.getViewportDimensions(),zb=new fb(wb.x,wb.y+this.getExtraVerticalSpace());if(xb)zb=new fb(Math.max(wb.x,xb.x),Math.max(wb.y,xb.y));var ac,bc;if(this.fullscreen&&w.isFullScreen()){return new fb((this.rhcCollapsed?screen.width:screen.width-vb.SIDEBAR_SIZE_MAX),screen.height-vb.FULL_SCREEN_PADDING*2);}else{ac=Math.min(zb.x,(yb.x-vb.SIDEBAR_SIZE_MAX-vb.STAGE_CHROME.x));bc=Math.min(zb.y,yb.y-vb.STAGE_CHROME.y);}if(ac===0&&bc===0)return new fb(0,0);var cc=ac/bc,dc=zb.x/zb.y;if(cc<dc)return new fb(ac,Math.round(ac/dc));return new fb(Math.round(bc*dc),bc);};vb.prototype.getExtraVerticalSpace=function(){"use strict";if(this.getVideoOnStage())return vb.VIDEO_BOTTOM_BAR_SPACE*2;return 0;};vb.prototype.getComponentsHeight=function(){"use strict";var wb=this.getVideoOnStage();if(wb)return this.getVideoComponentsHeight(ob(wb));return 0;};vb.prototype.getImageSizeInStage=function(wb,xb){"use strict";var yb=wb.x,zb=wb.y,ac=this.getComponentsHeight(),bc=this.getExtraVerticalSpace();zb-=ac;xb=new fb(xb.x,xb.y-ac-bc);if(yb>=xb.x||zb>=xb.y){var cc=xb.x/xb.y,dc=yb/zb;if(cc<dc){yb=xb.x;zb=Math.round(yb/dc);}else if(cc>dc){zb=xb.y;yb=Math.round(zb*dc);}else{yb=xb.x;zb=xb.y;}}return new fb(yb,zb+ac);};vb.prototype.getStageSizeForZoomedImage=function(wb,xb){"use strict";if(this.fullscreen&&w.isFullScreen()){var yb=this.rhcCollapsed?screen.width:screen.width-vb.SIDEBAR_SIZE_MAX,zb=screen.height-vb.FULL_SCREEN_PADDING*2;return new fb(yb,zb);}var ac=fb.getViewportDimensions();if(xb===null)xb=new fb(0,0);var bc=new fb(Math.max(wb.x,vb.STAGE_MIN.x,xb.x),Math.max(wb.y,vb.STAGE_MIN.y,xb.y)),cc=ac.x-vb.STAGE_CHROME.x;if(!this.rhcCollapsed)cc-=vb.SIDEBAR_SIZE_MAX;yb=Math.min(bc.x,cc);zb=Math.min(bc.y,ac.y-vb.STAGE_CHROME.y);return new fb(yb,zb);};vb.prototype.adjustStageSize=function(wb){"use strict";var xb=this.currentImageSize;if(wb){xb=wb;}else{var yb=this.stream&&this.stream.getCurrentImageData();if(yb)xb=this.getImageOrVideoDimensions(yb);}if(!xb)return;this.currentImageSize=xb;var zb=this.getExtraVerticalSpace();if(this.shouldStretch&&!this.getVideoOnStage()&&xb.x>xb.y&&xb.x<=vb.TIMELINE_STRETCH_WIDTH&&xb.x>=vb.TIMELINE_STRETCH_MIN){xb.y=Math.round(xb.y*vb.TIMELINE_STRETCH_WIDTH/xb.x);xb.x=vb.TIMELINE_STRETCH_WIDTH;}var ac;if(this.$PhotoSnowlift2){ac=this.getStageSizeForZoomedImage(xb,this.currentMinSize);}else ac=this.getStageSize(xb,this.currentMinSize);if(!this.currentMinSize)this.currentMinSize=new fb(0,0);this.currentMinSize=new fb(Math.max(ac.x,vb.STAGE_MIN.x,this.currentMinSize.x),Math.max(ac.y,vb.STAGE_MIN.y,this.currentMinSize.y));var bc=this.getImageSizeInStage(xb,this.currentMinSize),cc=this.currentMinSize.x-bc.x,dc=this.currentMinSize.y-bc.y;if(cc>0&&cc<vb.PADDING_MIN){this.currentMinSize.x-=cc;}else if(dc>0&&dc<vb.PADDING_MIN)this.currentMinSize.y-=dc;var ec=this.currentMinSize.x+vb.SIDEBAR_SIZE_MAX;if(this.rhcCollapsed)ec=this.currentMinSize.x;var fc=this.getVideoOnStage()&&this.pivotsCarouselElement,gc=0,hc=this.currentMinSize.y;if(fc){var ic=this.pivotsCarouselElement.clientHeight;gc=Math.ceil(ic/100)*100;hc=hc+gc;}this.snowliftPopup.style.cssText='width:'+ec+'px;'+'height:'+hc+'px;';var jc=this.currentMinSize.y-zb,kc=jc+gc;if(eb.firefox()){var lc=ya.get(this.stageWrapper,'font-size');jc=(jc/parseFloat(lc))+'em';kc=(kc/parseFloat(lc))+'em';}else{jc=jc+'px';kc=kc+'px';}this.stageWrapper.style.cssText='width:'+this.currentMinSize.x+'px;'+'line-height:'+jc+';';if(this.getVideoOnStage())this.videoStage.style.cssText='width:'+this.currentMinSize.x+'px;'+'height:'+kc+';';if(this.$PhotoSnowlift2){var mc=this.currentMinSize.y-zb;if(xb.y>mc){var nc=(xb.x/xb.y)*mc;ya.apply(this.zoomedImage,{width:nc+"px",height:mc+"px"});}else ya.apply(this.zoomedImage,{width:xb.x+"px",height:xb.y+"px"});}else{bc.y-=this.getComponentsHeight();this.setMediaElementSize(bc);}if(fc)this.setPivotCarouselElementWidth(lc);var oc=this.getTagger();if(oc)oc.repositionTagger();this.adjustScrollerIfNecessary();};vb.prototype.setMediaElementSize=function(wb){"use strict";var xb=this.image;if(this.getVideoOnStage())xb=q.scry(this.videoStage,"._53j5")[0]||xb;xb.style.cssText='width:'+wb.x+'px;'+'height:'+wb.y+'px;';};vb.prototype.setPivotCarouselElementWidth=function(wb){"use strict";var xb=this.videoStage.clientWidth;if(eb.firefox()){xb=(xb/parseFloat(wb))+'em';}else xb=xb+'px';this.pivotsCarouselElement.style.width=xb;};vb.prototype.adjustForNewData=function(){"use strict";if(!this.image)return;var wb=q.scry(this.stage,'div.tagsWrapper')[0],xb=fb.getElementDimensions(this.image);if(wb){ya.set(wb,'width',xb.x+'px');ya.set(wb,'height',xb.y+'px');}};vb.prototype.adsDisplayedCallback=function(wb,xb){"use strict";var yb=this.resizeCommentsForAds&&!this.inAdsDisplayedCallback&&!this.disableAds&&wb<vb.MIN_ADS_VISIBLE&&xb.length>=vb.MIN_ADS_VISIBLE;if(yb){this.inAdsDisplayedCallback=true;var zb=xb[vb.MIN_ADS_VISIBLE-1];this.adjustScroller(zb);this.inAdsDisplayedCallback=false;}};vb.prototype.setLoadingState=function(wb,xb){"use strict";switch(wb){case vb.STATE_IMAGE_PIXELS:o.conditionClass(this.root,'imagePixelsLoading',xb);break;case vb.STATE_IMAGE_DATA:this.loadingStates[wb]=xb;o.conditionClass(this.root,'imageLoading',xb);break;case vb.STATE_HTML:this.loadingStates[wb]=xb;o.conditionClass(this.root,'dataLoading',xb);this.rhc.setAttribute('aria-busy',xb?'true':'false');break;}};vb.prototype.destroy=function(){"use strict";this.stageHandlers.forEach(function(wb){wb.remove();});if(this.pageHandlers){this.pageHandlers.forEach(function(wb){wb.remove();});this.pageHandlers=null;}this.$PhotoSnowliftu&&clearInterval(this.$PhotoSnowliftu);this.$PhotoSnowliftu=null;this.$PhotoSnowliftv=null;};vb.prototype.checkState=function(wb){"use strict";if(wb!=vb.STATE_ERROR&&!this.loadingStates[wb])return;switch(wb){case vb.STATE_IMAGE_DATA:var xb=this.stream.getCurrentImageData();if(xb){var yb=this.getImageURL(xb);if(yb){if(!this.$PhotoSnowlift2&&this.$PhotoSnowlifts())this.$PhotoSnowliftw();this.switchImage(yb,null,true);}else if(xb.video)this.switchVideo(xb.video,true);this.setLoadingState(wb,false);}break;case vb.STATE_HTML:if(this.stream.getCurrentHtml()){this.swapData();this.setLoadingState(wb,false);}break;default:if(this.stream.errorInCurrent()){o.hide(this.image);o.show(this.errorBox);}break;}};vb.prototype.buttonListener=function(event){"use strict";var wb=event.getTarget(),xb=Date.now();if(ha.byClass(wb,"_5qmg")){la.addPanoramaClick();this.switchIntoZoomedImage();return;}if(ha.byClass(wb,"_5qmh")){this.$PhotoSnowliftq();this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));return false;}if(ha.byClass(wb,'fbPhotoTagApprovalBox'))return;if(xb-this.lastPage<350)return;if(ha.byClass(wb,'fbPhotosPhotoLike')){this.likePhoto();}else if(ha.byClass(wb,'tagApproveIgnore')){this.updateTagBox(event,wb);}else if(ha.byClass(wb,"_5ge9")){this.hideMorePhotos();this.toggleSlideshow();return false;}else if(ha.byClass(wb,"_5ymu")){if(!this.$PhotoSnowliftx){sa.logShowMorePhotos();var yb=this.stream.getCursor();if(yb)this.showMorePhotos(String(yb));if(this.$PhotoSnowliftb)o.hide(this.showZoomInButton);}else{sa.logHideMorePhotos();this.$PhotoSnowliftc();this.hideMorePhotos();}return;}else if(ha.byClass(wb,"_27n"))this.$PhotoSnowliftc();this.hideMorePhotos();};vb.prototype.toggleSlideshow=function(){"use strict";if(!this.slideshowGk)return;if(this.$PhotoSnowliftu){this.stopSlideshow();}else this.startSlideshow();};vb.prototype.startSlideshow=function(){"use strict";this.$PhotoSnowliftu=window.setInterval(this.page.bind(this,1,eb.chrome()&&w.isFullScreen()),vb.SLIDESHOW_TIME);o.addClass(this.root,'slideshowStarted');o.removeClass(this.root,'slideshowAvailable');};vb.prototype.stopSlideshow=function(){"use strict";this.$PhotoSnowliftu&&clearInterval(this.$PhotoSnowliftu);this.$PhotoSnowliftu=null;o.addClass(this.root,'slideshowAvailable');o.removeClass(this.root,'slideshowStarted');};vb.prototype.likePhoto=function(){"use strict";la.addButtonLike();var wb=hb('fbPhotoSnowliftFeedback'),xb=q.scry(wb,'button.like_link')[0];if(!xb)xb=q.scry(wb,'a.UFILikeLink')[0];var yb=xb.getAttribute('href');if(w.isFullScreen())if(eb.chrome())xb.setAttribute('href','javascript:;');xb.click();xb.setAttribute('href',yb);};vb.prototype.toggleLikeButton=function(){"use strict";var wb=q.scry(this.buttonActions,'a.fbPhotosPhotoLike')[0];if(wb){var xb=q.find(this.root,'.likeCount'),yb=q.find(xb,'.likeCountNum');if(xb)if(o.hasClass(wb,'viewerLikesThis')){q.setContent(yb,parseInt(yb.textContent,10)-1);}else q.setContent(yb,parseInt(yb.textContent,10)+1);o.toggleClass(wb,'viewerLikesThis');o.removeClass(wb,'viewerAlreadyLikedThis');}};vb.prototype.likePhotoWithKey=function(){"use strict";return ca.like(this.likePhoto.bind(this),pb());};vb.prototype.updateTagBox=function(wb,xb){"use strict";this.unhiliteAllTags();var yb=ob(wb);if(!yb)return;o.addClass(yb,'tagBox');o.addClass(yb,'tagBoxPendingResponse');o.removeClass(yb,'tagBoxPending');o.hide(q.find(yb,'span.tagForm'));if(xb){o.show(q.find(yb,'span.tagApproved'));}else o.show(q.find(yb,'span.tagIgnored'));};vb.prototype.rotate=function(wb){"use strict";var xb=this.stream.getCursor();if(this.getVideoOnStage()){var yb=(wb=='left')?270:90;rb(!!this.videoRotateURI);n.loadModules(["VideoRotate"],function(ac){new ac(xb,this.videoRotateURI).motionRotate(yb);}.bind(this));return;}var zb=jb({fbid:xb,opaquecursor:this.stream.getOpaqueCursor(xb),cs_ver:ka.VIEWER_SNOWLIFT},this.stream.getPhotoSetQuery());zb[wb]=1;this.setLoadingState(vb.STATE_IMAGE_DATA,true);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);o.hide(this.image);new m('/ajax/photos/photo/rotate/').setAllowCrossPageTransition(true).setData(zb).setErrorHandler(this.rotationError.bind(this,xb)).setFinallyHandler(this.rotationComplete.bind(this,xb)).setMethod('POST').setReadOnly(false).send();};vb.prototype.rotationComplete=function(wb,xb){"use strict";if(wb==this.stream.getCursor()){this.setLoadingState(vb.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));this.swapData();}};vb.prototype.rotationError=function(wb,xb){"use strict";if(wb==this.stream.getCursor()){this.setLoadingState(vb.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));n.loadModules(["AsyncResponse"],function(yb){yb.defaultErrorHandler(xb);});}};vb.prototype.saveTagsFromPayload=function(wb){"use strict";this.storeFromData(wb);if('data' in wb&&this.stream.getCursor() in wb.data)this.swapData();};vb.prototype.saveEdit=function(){"use strict";if(!o.hasClass(this.root,'fbPhotoSnowliftEditMode'))return;n.loadModules(["PhotoInlineEditor","Form"],function(wb,xb){var yb=wb.getInstance(this.getViewerConst());yb&&xb.bootstrap(yb.getForm().controller);}.bind(this));};vb.prototype.mouseLeaveListener=function(event){"use strict";this.unhiliteAllTags();this.reHilitePendingTag();};vb.prototype.hilitePager=function(event){"use strict";var wb=fb.getEventPosition(event),xb=fb.getElementPosition(this.stage);if(fa.isRTL()){var yb=fb.getElementDimensions(this.stage);this.stagePagerPrev=yb.x-(wb.x-xb.x)<vb.GOPREV_AREA;}else this.stagePagerPrev=wb.x-xb.x<vb.GOPREV_AREA;o.conditionClass(this.prevPager,'hilightPager',this.stagePagerPrev);o.conditionClass(this.nextPager,'hilightPager',!this.stagePagerPrev);var zb,ac=event.getTarget();if(!ha.byClass(ac,'snowliftOverlay')&&!ha.byClass(ac,'bottomBarActions')&&!ha.byClass(ac,'snowliftPager'))zb=vb.PAGER_FADE;this.showPagers(zb);};vb.prototype.showPagers=function(wb){"use strict";clearTimeout(this.fadePagerTimer);this.setStagePagersState('active');if(wb===(void 0))this.fadePagerTimer=setTimeout(this.hidePagers.bind(this),wb);};vb.prototype.hidePagers=function(){"use strict";var wb=q.scry(this.getRoot(),'.fbPhotosPhotoActionsMenu')[0];if(wb)return;clearTimeout(this.fadePagerTimer);this.setStagePagersState('inactive');};vb.prototype.getTagger=function(){"use strict";return (this.PhotoTagger&&this.PhotoTagger.getInstance(ka.VIEWER_SNOWLIFT));};vb.prototype.unhiliteAllTags=function(){"use strict";clearTimeout(this.unhiliteTimer);q.scry(this.stage,'div.tagsWrapper div.hover').forEach(function(xb){o.removeClass(xb,'hover');});q.scry(this.stage,'div.tagsWrapper div.otherActive').forEach(function(xb){o.removeClass(xb,'otherActive');});this.hilitedTag=null;this.showingTypeaheadSuggestions=false;if(!o.hasClass(this.root,'taggingMode')){var wb=this.getTagger();if(wb){wb.hideTagger();wb.setCurrentFacebox(null);}}};vb.prototype.switchHilitedTags=function(wb,xb){"use strict";if(this.switchTimer!==null){clearTimeout(this.switchTimer);this.switchTimer=null;}this.unhiliteAllTags();this.hiliteAllBoxes();var yb=ob(wb);if(yb){this.hilitedTag=wb;if(!o.hasClass(this.root,'taggingMode')&&ra.isFacebox(this.hilitedTag)){var zb=this.getTagger();if(zb){o.addClass(yb,'hover');var ac=zb.getFacebox(wb);zb.setCurrentFacebox(ac);if(ac)zb.addTagFromFacebox(ac);}}else o.addClass(yb,'hover');if(o.hasClass(yb,'tagBoxPending')&&!o.hasClass(yb,'showPendingTagName')&&xb===true){q.scry(this.stage,'div.tagsWrapper div.showPendingTagName').forEach(function(bc){o.removeClass(bc,'showPendingTagName');});o.addClass(yb,'showPendingTagName');}}};vb.prototype.reHilitePendingTag=function(){"use strict";var wb=ob(this.hilitedTag);if(wb&&o.hasClass(wb,'showPendingTagName'))return;var xb=q.scry(this.stage,'div.tagsWrapper div.showPendingTagName')[0];if(xb)this.switchHilitedTags(xb.id);};vb.prototype.hiliteTagsOnMouseMove=function(event){"use strict";if(!this.stream.getCurrentExtraData()||this.getVideoOnStage())return;if(this.switchTimer!==null)return;var wb=event.getTarget();if(ha.byClass(wb,'snowliftOverlay')||ha.byClass(wb,'fbPhotoSnowliftTagApproval')||ha.byClass(wb,'tagPointer')||ha.byClass(wb,'arrow')||ha.byClass(wb,'faceboxSuggestion')||ha.byClass(wb,'typeaheadWrapper')||ha.byClass(wb,'photoTagTypeahead'))return;var xb=ha.byClass(wb,'tagBoxPending'),yb=false;if(this.hilitedTag){var zb=ob(this.hilitedTag);yb=zb&&o.hasClass(zb,'tagBoxPending');}var ac=((!this.hilitedTag&&xb)||(!yb&&xb));if(ac){this.switchHilitedTags(xb.id);return;}if(xb&&(xb.id==this.hilitedTag))return;var bc=250,cc=15,dc=fb.getEventPosition(event);if(!this.startingMousePos)this.startingMousePos=dc;var ec=ra.absoluteToNormalizedPosition(this.image,dc);if(!this.haveLeftBufferRegion&&this.startingMousePos.distanceTo(dc)<cc){return;}else this.haveLeftBufferRegion=true;if(this.currentTagHasPrecedence(ec))return;var fc=ra.getNearestBox(this.stream.getCurrentExtraData().tagRects,ec);if(!fc){if(!yb){this.unhiliteAllTags();this.reHilitePendingTag();}return;}var gc=null;if(yb){var hc={};hc[this.hilitedTag]=this.stream.getCurrentExtraData().tagRects[this.hilitedTag];gc=ra.getNearestBox(hc,ec);}if(gc!==null&&yb)return;if(this.hilitedTag!=fc)if(yb){this.switchTimer=setTimeout(this.switchHilitedTags.bind(this,fc),bc);}else{if(this.$PhotoSnowlift8&&!this.$PhotoSnowlift0[fc]){this.$PhotoSnowlift0[fc]=true;sa.logPivotImpression('snowlift',fc);}this.switchHilitedTags(fc);}};vb.prototype.currentTagHasPrecedence=function(wb){"use strict";if(!this.hilitedTag)return false;if(this.stream.getCurrentExtraData().tagRects[this.hilitedTag]===(void 0)){this.hilitedTag=null;return false;}var xb=this.stream.getCurrentExtraData().tagRects[this.hilitedTag],yb=new va(xb.t+(xb.h()/2),xb.r,xb.b+(ra.isFacebox(this.hilitedTag)?10:0),xb.l,xb.domain);return yb.contains(wb);};vb.prototype.getVideoOnStage=function(){"use strict";var wb=this.stream&&this.stream.getCurrentImageData();return wb&&wb.video;};vb.prototype.shouldPageOnAction=function(wb,xb){"use strict";if(!this.isOpen||ca.isShowingConfirmation())return false;var yb=q.isNode(xb)&&(ha.byClass(xb,'snowliftPager')||ha.byClass(xb,'stagePagers')||ha.byClass(xb,'pivotPageColumn')),zb=q.isNode(xb)&&ha.byClass(xb,'stage'),ac=o.hasClass(xb,'faceBox'),bc=(!o.hasClass(this.root,'taggingMode')&&ac&&!yb);if(bc){if(!this.showingTypeaheadSuggestions){this.getTagger().updateWithSuggestions();setTimeout((function(){q.find(this.getTagger().tagger,'input.textInput').focus();}).bind(this),0);}this.showingTypeaheadSuggestions=!this.showingTypeaheadSuggestions;return false;}var cc=((zb&&o.hasClass(this.root,'taggingMode'))||ha.byClass(xb,'tagBoxPending')||ha.byClass(xb,'tagBoxPendingResponse')||ha.byClass(xb,'fbPhotoTagApprovalBox')||ha.byClass(xb,'tag'));if(cc)return false;if(zb&&this.$PhotoSnowlift2)zb=false;return wb==z.LEFT||wb==z.RIGHT||wb==g||wb==h||yb||bc||zb;};vb.prototype.keyHandler=function(wb,event){"use strict";if(event.getModifiers().any||aa.getTopmostLayer()!==this.spotlight)return true;switch(t.getKeyCode(event)){case z.LEFT:case z.RIGHT:case g:case h:this.pageListener(event);return false;case i:return this.toggleFullScreen();case j:return this.likePhotoWithKey();case z.SPACE:this.toggleSlideshow();this.showPagers(vb.PAGER_FADE);return false;case z.ESC:if(this.$PhotoSnowlift2){this.$PhotoSnowliftq();this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));return false;}break;}};vb.prototype.shouldHandlePendingTag=function(event){"use strict";var wb=this.getTagger();if(!wb||!wb.tags.length)return false;var xb=ra.absoluteToNormalizedPosition(this.getImage(),fb.getEventPosition(event)),yb=wb.findNearestTag(xb);if(!yb||!o.hasClass(yb.node,'tagBoxPending'))return false;l.inform('PhotoTagApproval.PENDING_TAG_PHOTO_CLICK',{id:yb.id,version:this.getVersionConst()});return true;};vb.prototype.pageListener=function(event){"use strict";var wb=t.getKeyCode(event),xb=event.getTarget();if(this.$PhotoSnowliftu){this.stopSlideshow();return;}if(!this.shouldPageOnAction(wb,xb))return;if(this.shouldHandlePendingTag(event))return;var yb=0;if(wb==z.RIGHT||wb==h){yb=1;la.setPagingAction('key_right');this.$PhotoSnowlifty=true;}else if(wb==z.LEFT||wb==g){yb=-1;la.setPagingAction('key_left');this.$PhotoSnowlifty=true;}else if(ha.byClass(xb,'next')){yb=1;la.setPagingAction('click_next');}else if(ha.byClass(xb,'prev')){yb=-1;la.setPagingAction('click_prev');}else if(!this.stagePagerPrev){yb=1;la.setPagingAction('click_stage');}else{yb=-1;la.setPagingAction('click_stage_back');}var zb=q.scry(this.ufiForm,'input.mentionsHidden'),ac=false;for(var bc=0;bc<zb.length;bc++)if(!y.isEmpty(zb[bc])){ac=true;break;}if(ac||o.hasClass(this.root,'fbPhotoSnowliftEditMode')){this.warnLeavePage(this.page.bind(this,yb));}else{this.page(yb,eb.chrome()&&w.isFullScreen());this.$PhotoSnowliftr=null;sb('snowlift',xb,event).uai(la.pagingAction);}};vb.prototype.warnLeavePage=function(wb){"use strict";new p().setTitle("\u3053\u306e\u30da\u30fc\u30b8\u304b\u3089\u79fb\u52d5\u3057\u307e\u3059\u304b\uff1f").setBody("\u30da\u30fc\u30b8\u304b\u3089\u79fb\u52d5\u3059\u308b\u3068\u3001\u4fdd\u5b58\u3055\u308c\u3066\u3044\u306a\u3044\u5909\u66f4\u306f\u5931\u308f\u308c\u307e\u3059\u3002").setButtons([{name:'leave_page',label:"\u79fb\u52d5\u3059\u308b",handler:wb},{name:'continue_editing',label:"\u3053\u306e\u30da\u30fc\u30b8\u304b\u3089\u79fb\u52d5\u3057\u306a\u3044",className:'inputaux'}]).setModal(true).show();};vb.prototype.getUsesOpaqueCursor=function(){"use strict";return this.stream.getUsesOpaqueCursor();};vb.prototype.getOpaqueCursor=function(wb){"use strict";return this.stream.getOpaqueCursor(wb);};vb.prototype.setReachedLeftEnd=function(){"use strict";this.stream.setReachedLeftEnd();};vb.prototype.setReachedRightEnd=function(){"use strict";this.stream.setReachedRightEnd();};vb.prototype.page=function(wb,xb){"use strict";if(!this.stream.isValidMovement(wb)||!this.stream.nonCircularPhotoSetCanPage(wb)){this.showPagers(vb.PAGER_FADE);return;}var yb=this.stream.getCursorAt(this.stream.calculatePositionForMovement(wb));if(this.snowflake&&((this.stream.getCursor()==this.firstInSet&&wb<0)||(this.firstInSet==yb&&wb>0))){this.showPagers(vb.PAGER_FADE);return;}this.lastPage=Date.now();this.unhiliteAllTags();this.startingMousePos=null;this.haveLeftBufferRegion=false;this.$PhotoSnowlift0={};this.$PhotoSnowlift1+=wb;var zb=this.stream.allLoaded?Math.abs(this.$PhotoSnowlift1)-this.stream.getLength():null;if(this.$PhotoSnowlifta&&this.$PhotoSnowlifto){if(!this.$PhotoSnowliftn.end&&zb===0){this.$PhotoSnowliftn.end=this.stream.getCursor();}else if(zb===-1)oa.fetch(this.$PhotoSnowlifto,this.stream);if(!this.onExtraSlide){if(this.stream.getCursor()===this.$PhotoSnowliftn.end&&yb===this.$PhotoSnowliftn.start){this.showPivotSlide(this.$PhotoSnowlifto,xb);return;}else if(this.stream.getCursor()===this.$PhotoSnowliftn.start&&yb===this.$PhotoSnowliftn.end)this.showPivotSlide(this.$PhotoSnowlifto,xb);}else{this.hidePivotSlide();if(yb!==this.$PhotoSnowliftn.start)return;}}var ac=this.getVideoOnStage();if(ac)this.switchVideo(ac,false);if(this.pivots&&this.pivots.page(wb))return;l.inform('PhotoSnowlift.PAGE');za.hide();this.recacheData();this.stream.moveCursor(wb);o.hide(this.image);if(wb!==0){this.storyID=null;this.$PhotoSnowlift5();}if(wb!==0&&this.$PhotoSnowlift2)this.$PhotoSnowliftq();if(this.stream.errorInCurrent()){this.setLoadingState(vb.STATE_HTML,true);o.show(this.errorBox);return;}this.movementDelta+=wb;var bc=this.stream.getCurrentImageData();if(bc){var cc=this.getImageURL(bc);if(cc){if(!this.$PhotoSnowlift2&&this.$PhotoSnowlifts())this.$PhotoSnowliftw();this.switchImage(cc,null,true);}else if(bc.video)this.switchVideo(bc.video,true);if(!xb){this.replaceUrl=true;qb(bc.info.permalink);}this.setLoadingState(vb.STATE_IMAGE_DATA,false);}else{this.setLoadingState(vb.STATE_IMAGE_PIXELS,true);this.setLoadingState(vb.STATE_IMAGE_DATA,true);}if(this.stream.getCurrentHtml()){this.swapData();}else this.setLoadingState(vb.STATE_HTML,true);this.disableAds=!this.isLoggedInViewer||this.stream.isInViewAsMode();this.loadAds();this.setLeftAndRightPagersState();if(this.$PhotoSnowliftu){o.addClass(this.root,'slideshowStarted');}else if(this.slideshowAvailable)o.addClass(this.root,'slideshowAvailable');if(!this.$PhotoSnowlifta&&this.$PhotoSnowlift9&&this.$PhotoSnowlifto)if(zb===-1){oa.fetch(this.$PhotoSnowlifto,this.stream);}else if(zb===0){sa.logSuggestMorePhotos();this.showMorePhotos(this.$PhotoSnowlifto,true);this.showPagers();this.$PhotoSnowlift1=0;}else{this.hideMorePhotos();this.hidePagers();}};vb.prototype.showMorePhotos=function(wb,xb){"use strict";if(this.$PhotoSnowliftx)return;this.$PhotoSnowliftx=true;if(!this.searchPivot)this.searchPivot=this.overlay.appendChild(document.createElement('div'));o.addClass(this.stageWrapper,"_5ymv");this.searchPivotComponent=ua.render(ua.createElement(na,{className:"_27g",fbid:wb,onclose:this.hideMorePhotos.bind(this),endofalbum:xb||false,withBackground:true}),this.searchPivot);};vb.prototype.hideMorePhotos=function(){"use strict";if(this.searchPivotComponent&&this.$PhotoSnowliftx){this.$PhotoSnowliftx=false;o.removeClass(this.stageWrapper,"_5ymv");this.searchPivotComponent.setProps({fbid:null});}};vb.prototype.showPivotSlide=function(wb,xb){"use strict";if(this.onExtraSlide)return;this.onExtraSlide=true;o.addClass(this.stageWrapper,"_3tvf");if(!this.pivotSlide){this.pivotSlide=q.create('div');q.insertBefore(this.stageActions,this.pivotSlide);}this.pivotSlideComponent=ua.render(ua.createElement(ma,{fbid:wb,isAlbum:this.$PhotoSnowliftz,albumOwnerName:this.$PhotoSnowliftA,visible:true,onReturn:this.returnToBeginning.bind(this,xb)}),this.pivotSlide);};vb.prototype.hidePivotSlide=function(){"use strict";if(this.pivotSlideComponent&&this.onExtraSlide){this.pivotSlideComponent.setProps({visible:false});o.removeClass(this.stageWrapper,"_3tvf");}this.onExtraSlide=false;};vb.prototype.returnToBeginning=function(wb){"use strict";var xb=this.stream.getRelativeMovement(this.$PhotoSnowliftn.start);this.page(xb,wb);};vb.prototype.logImpressionDetailsForPhoto=function(){"use strict";var wb=[].concat(q.scry(hb('fbPhotoSnowliftTagList'),'input.photoImpressionDetails'),q.scry(hb('fbPhotoSnowliftFeedback'),'input.photoImpressionDetails'));if(wb.length===0)return;var xb={};for(var yb=0;yb<wb.length;yb++)xb[wb[yb].name]=wb[yb].value;if(this.getVideoOnStage()){xb.width=0;xb.height=0;}else{var zb=this.getImageDimensions(this.stream.getCurrentImageData());xb.width=zb.x;xb.height=zb.y;}la.addDetailData(this.stream.getCursor(),xb);pa.setIsLogAdData(true);};vb.prototype.loadAds=function(){"use strict";if(this.disableAds)return;pa.loadAdsFromUserActivity();};vb.prototype.transitionHandler=function(wb){"use strict";if(wb.getQueryData().closeTheater||wb.getQueryData().permPage||this.returningToStart){if(this.isOpen)this.close();this.transitionHandlerRegistered=false;return false;}if(this.replaceUrl){this.replaceUrl=false;this.$PhotoSnowlifte.push(wb.getQualifiedURI().toString());ga.transitionComplete(true);return true;}var xb=this.$PhotoSnowlifte.length;if(xb>=2&&this.$PhotoSnowlifte[xb-2]==wb.getQualifiedURI().toString())this.$PhotoSnowlifte.pop();var yb=this.stream.getCursorForURI(wb.getUnqualifiedURI().toString());if(yb){var zb=this.stream.getRelativeMovement(yb);this.page(zb,true);ga.transitionComplete(false);return true;}if(this.isOpen){ga.transitionComplete(true);this.close();return true;}this.transitionHandlerRegistered=false;return false;};vb.prototype.recacheData=function(){"use strict";if(!this.loadingStates.html){var wb=this.stream.getCurrentHtml();for(var xb in wb){wb[xb]=kb(hb(xb).childNodes);q.empty(hb(xb));}}};vb.prototype.reloadIfTimeout=function(){"use strict";if(!x.hasLoaded(this.image)){var wb=this.makeNewImage(this.image.src,true);t.listen(wb,'load',this.useImage.bind(this,wb,null,true));this.$PhotoSnowlift3(wb.src);}};vb.prototype.useImage=function(wb,xb,yb){"use strict";if(yb&&x.hasLoaded(this.image))return;q.replace(this.image,wb);this.image=wb;this.adjustStageSize(xb);};vb.prototype.makeNewImage=function(wb,xb){"use strict";if(this.imageLoadingTimer){clearTimeout(this.imageLoadingTimer);this.imageLoadingTimer=null;}else if(!xb)this.imageRefreshTimer=setTimeout(this.reloadIfTimeout.bind(this),vb.LOADING_TIMEOUT);var yb=q.create('img',{className:'spotlight',alt:''});yb.setAttribute('aria-describedby','fbPhotosSnowliftCaption');yb.setAttribute('aria-busy','true');var zb=function(){clearTimeout(this.imageRefreshTimer);this.image.setAttribute('aria-busy','false');this.setLoadingState(this.STATE_IMAGE_PIXELS,false);setTimeout((function(){if(this.isOpen){this.adjustStageSize();this.adjustForNewData();}}).bind(this),0);}.bind(this);t.listen(yb,'load',zb);this.$PhotoSnowlift3(wb);yb.src=wb;return yb;};vb.prototype.switchImage=function(wb,xb,yb){"use strict";o.hide(this.image);o.hide(this.errorBox);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);var zb=this.stream&&this.stream.getCurrentImageData();if(zb){la.addPhotoView(zb.info,this.shouldShowHiRes(zb),this.fullscreen&&w.isFullScreen());if(this.$PhotoSnowlift8){var ac=this.stream.getCurrentExtraData();if(ac)sa.logImageImpression('snowlift',String(this.stream.getCursor()),Object.keys(ac.tagRects));}}this.useImage(this.makeNewImage(wb,false),xb,false);if(yb)this.stream.preloadImages(this.shouldShowHiRes.bind(this));if(!this.$PhotoSnowlift2&&this.$PhotoSnowlifts(zb)){la.addPanoramaImpression();var bc=new fb(this.stage.clientWidth,this.stage.clientHeight);this.$PhotoSnowliftB(bc);}else if(this.$PhotoSnowliftb)o.hide(this.showZoomInButton);if(this.$PhotoSnowlift2){this.switchIntoZoomedImage();this.showPagers(vb.PAGER_FADE);}l.inform('PhotoSnowlift.SWITCH_IMAGE');};vb.prototype.$PhotoSnowliftc=function(){"use strict";if(!this.$PhotoSnowliftb)return;if(this.$PhotoSnowlifts()){var wb=new fb(this.stage.clientWidth,this.stage.clientHeight);this.$PhotoSnowliftB(wb);}else o.hide(this.showZoomInButton);};vb.prototype.$PhotoSnowliftB=function(wb){"use strict";var xb=parseInt(this.image.style.height,10),yb=(wb.y-xb)/2;if(yb>=vb.ZOOM_BUTTON_TOP_PAD+vb.ZOOM_BUTTON_BOT_PAD+vb.ZOOM_BUTTON_HEIGHT){var zb=yb-vb.ZOOM_BUTTON_HEIGHT-vb.ZOOM_BUTTON_TOP_PAD;ya.set(this.showZoomInButton,'bottom',zb+'px');}else ya.set(this.showZoomInButton,'bottom','60px');o.show(this.showZoomInButton);};vb.prototype.$PhotoSnowlifts=function(wb){"use strict";if(wb===(void 0))wb=this.stream&&this.stream.getCurrentImageData();if(!this.$PhotoSnowliftb||!wb||!wb.originalDimensions)return false;var xb=new fb(this.stage.clientWidth,this.stage.clientHeight),yb=wb.originalDimensions,zb=yb.x/yb.y,ac=Math.min(xb.y*zb,yb.x);if(!isNaN(zb)&&zb>2&&yb.y>vb.MIN_PANORAMA_Y&&xb.x*vb.MIN_PANO_TO_STAGE_RATIO<ac){return true;}else return false;};vb.prototype.$PhotoSnowliftw=function(){"use strict";this.$PhotoSnowlift2=true;o.hide(this.showZoomInButton);o.hide(this.stageActions);o.show(this.showZoomOutButton);ya.set(this.stage,'overflow','hidden');this.spotlight.disableBehavior(ba);this.collapseRHC();};vb.prototype.$PhotoSnowliftq=function(){"use strict";if(!this.$PhotoSnowliftb)return;this.$PhotoSnowlift2=false;this.spotlight.enableBehavior(ba);ya.set(this.stage,'overflow','visible');o.hide(this.showZoomInButton);o.hide(this.showZoomOutButton);o.hide(this.zoomedImage);o.hide(this.outerImageSlider);o.show(this.stageActions);this.uncollapseRHC();};vb.prototype.switchIntoZoomedImage=function(wb){"use strict";this.$PhotoSnowliftw();o.hide(this.zoomedImage);o.hide(this.outerImageSlider);var xb=this.stream.getCurrentImageData(),yb=xb.originalDimensions;this.zoomedImage.src=xb.url;this.adjustStageSize(yb);this.$PhotoSnowliftC(new fb(parseInt(ya.get(this.zoomedImage,'width'),10),parseInt(ya.get(this.zoomedImage,'height'),10)));o.hide(this.image);};vb.prototype.$PhotoSnowliftD=function(wb){"use strict";var xb=this.stage.clientWidth,yb=Math.min(100,(xb/wb.x)*100);ya.set(this.innerImageSlider,'width',yb+'%');return yb;};vb.prototype.$PhotoSnowliftE=function(wb){"use strict";var xb=vb.MAX_SLIDER_HEIGHT*this.stage.clientHeight/wb.y,yb=vb.MAX_SLIDER_WIDTH*this.stage.clientWidth/wb.x,zb=Math.min(xb,yb);return new fb(100*wb.x*zb/this.stage.clientWidth,100*wb.y*zb/this.stage.clientHeight);};vb.prototype.$PhotoSnowliftC=function(wb){"use strict";this.$PhotoSnowliftt(this.$PhotoSnowliftr);var xb=this.$PhotoSnowliftE(wb);ya.set(this.outerImageSlider,'width',xb.x+'%');ya.set(this.outerImageSlider,'height',xb.y+'%');ya.set(this.outerImageSlider,'left',(50-xb.x/2)+'%');ya.set(this.showZoomOutButton,'bottom',xb.y*this.stage.clientHeight/100+parseInt(ya.get(this.outerImageSlider,'bottom'),10)+20+'px');o.show(this.zoomedImage);o.show(this.outerImageSlider);};vb.prototype.$PhotoSnowliftj=function(event){"use strict";if(!this.$PhotoSnowlift2)return;o.addClass(this.stage,'showSlider');if(this.$PhotoSnowliftF)this.$PhotoSnowliftF.remove();var wb=false,xb=event.getTarget();if(ha.byClass(xb,"_10zv")){this.startSliderMargins=new fb(parseFloat(ya.get(this.innerImageSlider,'marginLeft')),parseFloat(ya.get(this.innerImageSlider,'marginTop')));this.startImageMargins=null;this.mouseDownStartPosition=new fb(event.clientX,event.clientY);}else if(ha.byClass(xb,"_10zx")){this.startSliderMargins=new fb(parseInt(ya.get(this.innerImageSlider,'marginLeft'),10),parseInt(ya.get(this.innerImageSlider,'marginTop'),10));this.startImageMargins=null;var yb=parseInt(ya.get(this.innerImageSlider,'width'),10);this.mouseDownStartPosition=new fb(this.innerImageSlider.getBoundingClientRect().left+yb/2,event.clientY);wb=true;}else if(ha.byClass(xb,"_10zw")){this.startImageMargins=new fb(parseInt(ya.get(this.zoomedImage,'marginLeft'),10),parseInt(ya.get(this.zoomedImage,'marginTop'),10));this.startSliderMargins=null;this.mouseDownStartPosition=new fb(event.clientX,event.clientY);}this.$PhotoSnowliftF=t.listen(this.stage,'mousemove',this.$PhotoSnowliftG.bind(this));if(wb){this.$PhotoSnowliftG(event);}else event.kill();};vb.prototype.$PhotoSnowliftk=function(event){"use strict";if(this.$PhotoSnowliftF){o.removeClass(this.stage,'showSlider');this.$PhotoSnowliftF.remove();this.$PhotoSnowliftF=null;var wb=parseFloat(ya.get(this.zoomedImage,'marginLeft')),xb=-this.zoomedImage.width+this.stage.clientWidth;this.$PhotoSnowliftr=wb/xb;}};vb.prototype.$PhotoSnowliftG=function(event){"use strict";var wb;if(this.startSliderMargins){wb=event.clientX-this.mouseDownStartPosition.x;var xb=parseFloat(ya.get(this.outerImageSlider,'width')),yb=parseFloat(ya.get(this.innerImageSlider,'width')),zb=Math.max(0,Math.min(xb-yb,this.startSliderMargins.x+wb))/xb;ya.set(this.innerImageSlider,'marginLeft',100*zb+"%");ya.set(this.zoomedImage,'marginLeft',-1*zb*this.zoomedImage.width+'px');event.kill();}else if(this.startImageMargins){wb=1.75*(this.mouseDownStartPosition.x-event.clientX);var ac=Math.min(0,Math.max(this.startImageMargins.x-wb,-this.zoomedImage.width+this.stage.clientWidth));ya.set(this.zoomedImage,'marginLeft',ac+'px');ya.set(this.innerImageSlider,'marginLeft',(-ac/this.zoomedImage.width*100)+"%");event.kill();}};vb.prototype.$PhotoSnowliftt=function(wb){"use strict";if(wb===(void 0)||wb===null)wb=.5;var xb=new fb(parseInt(ya.get(this.zoomedImage,'width'),10),parseInt(ya.get(this.zoomedImage,'height'),10));ya.set(this.innerImageSlider,'marginLeft',((100-this.$PhotoSnowliftD(xb))*wb)+'%');ya.set(this.zoomedImage,'marginLeft',((this.stage.clientWidth-xb.x)*wb)+'px');};vb.prototype.switchVideo=function(wb,xb){"use strict";this.$PhotoSnowliftp();var yb='swf_'+wb;q.empty(this.videoStage);if(xb){o.addClass(this.stageWrapper,'showVideo');var zb=this.stream.getCurrentImageData();if(this.videoPivotsGK){o.hide(this.nextPager);o.hide(this.prevPager);}var ac=zb.video_element;q.find(ac,"._ox1").style.cssText='';var bc=null;if(this.pivotsCarouselElement)bc=r.scry(this.pivotsCarouselElement,"._32_l");if(bc)bc.map(function(ec){return u.capture(ec,'click',function(){var fc=ec.getAttribute('data-fbid'),gc=this.stream.getCursor(),hc=this.stream.calculateDistance(gc,fc);this.page(hc,false);}.bind(this));}.bind(this));o.addClass(ac,'videoStageContainer');q.appendContent(this.videoStage,ac);q.appendContent(this.videoStage,this.pivotsCarouselElement);if(window[yb]&&!ob(yb))window[yb].write(wb);var cc='video_warning_'+wb,dc=ob(wb);if(!this.videoWarnings)this.videoWarnings=[];if(dc&&this.videoWarnings[cc])q.setContent(dc,this.videoWarnings[cc]);this.$PhotoSnowliftv=zb.controller;this.$PhotoSnowliftv.reset();if(this.$PhotoSnowliftH)this.$PhotoSnowliftv.play(gb.USER);if(this.$PhotoSnowliftI)this.$PhotoSnowliftv.addListener('finishPlayback',function(){var ec=zb.info.fbid.toString();if(ec===this.stream.getCursor())this.page(1,false);}.bind(this));setTimeout(this.adjustStageSizeForVideo.bind(this,wb),0);}else{window[yb]&&window[yb].addVariable('video_autoplay',0);this.videoLoadTimer&&clearTimeout(this.videoLoadTimer);o.removeClass(this.stageWrapper,'showVideo');}};vb.prototype.checkVideoStatus=function(wb){"use strict";if(this.videoLoadTimer)clearTimeout(this.videoLoadTimer);var xb=this.getVideoOnStage();if(!xb){return;}else{if(xb!==wb)return;this.adjustStageSizeForVideo(wb);}};vb.prototype.getVideoSize=function(wb){"use strict";return new fb(wb.getAttribute('data-video-width'),+wb.getAttribute('data-video-height')+this.getVideoComponentsHeight(wb));};vb.prototype.getVideoElement=function(wb){"use strict";return q.scry(this.videoStage,"._ox1")[0];};vb.prototype.getVideoComponentsHeight=function(wb){"use strict";var xb=0,yb=ha.byClass(wb,"_1c_u");if(!yb)return 0;var zb=q.scry(yb,"._2i84");if(zb.length){var ac=zb[0].getBoundingClientRect();xb=ac.bottom-ac.top;}return xb;};vb.prototype.adjustStageSizeForVideo=function(wb){"use strict";var xb=this.getVideoElement(wb);if(!xb){this.videoLoadTimer=setTimeout(this.checkVideoStatus.bind(this,wb),200);}else this.adjustStageSize(this.getVideoSize(xb));};vb.prototype.handleServerError=function(wb,xb){"use strict";q.setContent(this.errorBox,wb);this.storeFromData(xb);};vb.prototype.fixButtonText=function(wb){"use strict";if(!this.buttonTruncateGk)return;var xb=q.scry(wb,".photosTruncatingUIButton"),yb=parseInt(ya.get(wb,'width'),10);if(yb>k){var zb={tagPhoto:"\u5199\u771f\u306b\u30bf\u30b0\u4ed8\u3051",doneTagPhoto:"\u30bf\u30b0\u4ed8\u3051\u5b8c\u4e86",addLocation:"\u4f4d\u7f6e\u60c5\u5831\u3092\u8ffd\u52a0",editPhoto:"\u7de8\u96c6"};for(var ac=0;ac<xb.length;ac++){var bc=xb[ac];o.addClass(bc,"_2n0k");ab.set(bc,zb[bc.getAttribute('data-buttonname')],'below','center');}}};vb.prototype.swapData=function(){"use strict";var wb,xb=this.stream.getCurrentHtml();if(xb){this.setLoadingState(vb.STATE_HTML,false);for(var yb in xb){wb=ob(yb);wb&&q.setContent(wb,xb[yb]);}var zb=ob('photosTruncatingUIButtonGroup');zb&&this.fixButtonText(zb);l.inform('PhotoSnowlift.DATA_CHANGE',jb(this.stream.getCurrentImageData().info,{movement:this.movementDelta}),l.BEHAVIOR_STATE);this.movementDelta=0;if(this.stream.getCurrentExtraData())l.inform('PhotoSnowlift.EXTRA_DATA_CHANGE',this.stream.getCurrentExtraData(),l.BEHAVIOR_STATE);}this.adjustScroller();this.scrollableArea.showScrollbar(false);this.adjustForNewData();this.logImpressionDetailsForPhoto();};vb.prototype.updateTotalCount=function(wb,xb,yb){"use strict";var zb=this.stream.getCurrentHtml();if(zb){var ac=hb('fbPhotoSnowliftPositionAndCount');q.replace(ac,yb);ac=yb;o.show(ac);var bc='fbPhotoSnowliftPositionAndCount';zb[bc]=kb(ac.childNodes);}this.stream.setTotalCount(wb);this.stream.setFirstCursorIndex(xb);};vb.prototype.addPhotoFbids=function(wb,xb,yb,zb){"use strict";if(zb&&this.sessionID&&zb!=this.sessionID)return;var ac=this.stream.getCursor()===null;this.stream.attachToFbidsList(wb,xb,yb);if(yb&&ac)this.page(0,true);if(this.pivots&&yb)this.pivots.setCycleCount(this.stream.calculateDistance(this.stream.getCursor(),this.stream.firstCursor));if(!this.pagersShown&&this.stream.canPage())this.setStagePagersState('ready');if(!this.slideshowAvailable&&this.stream.canPage()){this.slideshowAvailable=true;o.addClass(this.root,'slideshowAvailable');}this.setLeftAndRightPagersState();};vb.prototype.attachTagger=function(wb){"use strict";q.appendContent(this.stageActions,wb);};vb.prototype.storeFromData=function(wb){"use strict";if(!this.isOpen)return;if(wb.pivots)this.pivotsCarouselElement=wb.pivots;this.videoPivotsGK=wb.pivotsgk;if(wb.ssid&&this.sessionID&&this.sessionID!=wb.ssid)return;var xb=this.stream.storeToCache(wb);if('error' in xb){this.checkState(vb.STATE_ERROR);return;}if('init' in wb){this.$PhotoSnowlifto=wb.init.album_fbid;this.$PhotoSnowliftz=wb.init.is_album;this.$PhotoSnowliftA=wb.init.album_owner_name;this.$PhotoSnowliftH=wb.init.autoplay_videos;this.$PhotoSnowliftI=wb.init.autoplay_next_video;}if('init' in xb){this.initDataFetched(xb.init);if(this.openExplicitly){this.replaceUrl=true;qb(this.stream.getCurrentImageData().info.permalink);}if(this.stream.canPage())this.setStagePagersState('ready');this.setLeftAndRightPagersState();this.ua&&this.ua.add_event('ufi');}if('image' in xb)this.checkState(vb.STATE_IMAGE_DATA);if('data' in xb)this.checkState(vb.STATE_HTML);};vb.prototype.setLeftAndRightPagersState=function(){"use strict";if(this.stream.isNonCircularPhotoSet()){o.conditionClass(this.root,'disableLeft',!this.stream.nonCircularPhotoSetCanPage(-1));o.conditionClass(this.root,'disableRight',!this.stream.nonCircularPhotoSetCanPage(1));}if(this.snowflake){o.conditionClass(this.root,'disableLeft',this.stream.getCursor()==this.firstInSet);var wb=this.stream.getCursorAt(this.stream.calculatePositionForMovement(1));o.conditionClass(this.root,'disableRight',wb==this.firstInSet);}};vb.prototype.setStagePagersState=function(wb){"use strict";switch(wb){case 'ready':o.addClass(this.root,'pagingReady');this.pagersShown=true;this.ua&&this.ua.add_event('arrows');return;case 'active':o.addClass(this.root,'pagingActivated');return;case 'inactive':o.removeClass(this.root,'pagingActivated');return;case 'disabled':case 'reset':o.removeClass(this.root,'pagingReady');return;}};vb.prototype.deletePhoto=function(wb){"use strict";this.closeRefresh();};vb.prototype.closeRefresh=function(){"use strict";this.refreshOnClose=true;this.spotlight.hide();};vb.prototype.onHiliteTag=function(wb,xb){"use strict";if(xb.version!=ka.VIEWER_SNOWLIFT)return;var yb=xb.tag;if(yb)this.switchHilitedTags(yb,true);};vb.prototype.onUpdateTagBox=function(wb,xb){"use strict";if(xb.version==ka.VIEWER_SNOWLIFT)this.updateTagBox(xb.id,xb.approve);};vb.prototype.$PhotoSnowlift3=function(wb){"use strict";if(this.$PhotoSnowlift6){this.$PhotoSnowlift7&&this.$PhotoSnowlift7.log(wb);return true;}return false;};vb.prototype.$PhotoSnowlifth=function(){"use strict";this.$PhotoSnowlifty=false;};vb.prototype.$PhotoSnowlifti=function(event){"use strict";if(this.$PhotoSnowlifty)event.kill();};vb.prototype.isReturningToStart=function(){"use strict";return !!this.returningToStart;};vb.prototype.$PhotoSnowliftp=function(){"use strict";if(this.$PhotoSnowliftv)this.$PhotoSnowliftv.logStopForUnload();};vb.getInstance=function(){"use strict";if(!vb.$PhotoSnowliftJ)vb.$PhotoSnowliftJ=new vb();return vb.$PhotoSnowliftJ;};vb.initWithSpotlight=function(wb,xb){"use strict";vb.getInstance().init(wb,xb);};vb.addPhotoFbids=function(wb,xb,yb,zb){"use strict";vb.getInstance().addPhotoFbids(wb,xb,yb,zb);};vb.setReachedLeftEnd=function(){"use strict";vb.getInstance().setReachedLeftEnd();};vb.setReachedRightEnd=function(){"use strict";vb.getInstance().setReachedRightEnd();};vb.attachFollowFlyout=function(wb){"use strict";q.insertAfter(hb('fbPhotoSnowliftSubscribe'),wb);};vb.attachSubscribeFlyout=function(wb){"use strict";q.insertAfter(hb('fbPhotoSnowliftSubscribe'),wb);};vb.attachTagger=function(wb){"use strict";vb.getInstance().attachTagger(wb);};vb.preload=function(wb,xb){"use strict";vb.getInstance().preload(wb,xb);};vb.bootstrap=function(wb,xb){"use strict";var yb=wb&&db(wb).getQueryData();if(yb&&yb.hasOwnProperty('share_id')){n.loadModules(["SpotlightShareViewer"],function(zb){zb.bootstrap(wb,xb);});return;}vb.getInstance().bootstrap(wb,xb);};vb.closeRefresh=function(){"use strict";vb.getInstance().closeRefresh();};vb.deletePhoto=function(wb){"use strict";vb.getInstance().deletePhoto(wb);};vb.getImage=function(){"use strict";return vb.getInstance().getImage();};vb.getImageId=function(){"use strict";return vb.getInstance().getImageId();};vb.getLoadQuery=function(){"use strict";return vb.getInstance().getLoadQuery();};vb.getRHCBody=function(){"use strict";return vb.getInstance().getRHCBody();};vb.getRHCFooter=function(){"use strict";return vb.getInstance().getRHCFooter();};vb.getRHCHeader=function(){"use strict";return vb.getInstance().getRHCHeader();};vb.getRoot=function(){"use strict";return vb.getInstance().getRoot();};vb.likePhotoSkipConfirmation=function(wb){"use strict";vb.getInstance().likePhotoSkipConfirmation(wb);};vb.saveTagsFromPayload=function(wb){"use strict";vb.getInstance().saveTagsFromPayload(wb);};vb.saveTagsFromPayloadDelayed=function(wb){"use strict";setTimeout(vb.saveTagsFromPayload.bind(null,wb),2000);};vb.handleServerError=function(wb,xb){"use strict";vb.getInstance().handleServerError(wb,xb);};vb.setVideoWarning=function(wb,xb){"use strict";var yb=vb.getInstance(),zb='video_warning_'+wb;if(!yb.videoWarnings)yb.videoWarnings=[];yb.videoWarnings[zb]=xb;};vb.storeFromData=function(wb){"use strict";vb.getInstance().storeFromData(wb);};vb.swapData=function(){"use strict";vb.getInstance().swapData();};vb.updateTotalCount=function(wb,xb,yb){"use strict";vb.getInstance().updateTotalCount(wb,xb,yb);};vb.setVideoRotateURI=function(wb){"use strict";vb.getInstance().videoRotateURI=wb;};jb(vb,{STATE_ERROR:'error',STATE_HTML:'html',STATE_IMAGE_PIXELS:'image_pixels',STATE_IMAGE_DATA:'image',LOADING_TIMEOUT:2000,PAGER_FADE:3000,FULL_SCREEN_PADDING:10,STAGE_NORMAL_MAX:{x:960,y:960},STAGE_MIN:{x:520,y:520},SIDEBAR_SIZE_MAX:360,MIN_PANORAMA_Y:240,ZOOM_BUTTON_HEIGHT:52,ZOOM_BUTTON_BOT_PAD:60,ZOOM_BUTTON_TOP_PAD:16,MAX_SLIDER_HEIGHT:.075,MAX_SLIDER_WIDTH:.75,MIN_PANO_TO_STAGE_RATIO:1.2,STAGE_CHROME:{x:82,y:42},VIDEO_BOTTOM_BAR_SPACE:40,GOPREV_AREA:120,TIMELINE_STRETCH_WIDTH:843,TIMELINE_STRETCH_MIN:480,MIN_TAG_DISTANCE:83,PADDING_MIN:40,MIN_UFI_HEIGHT:250,COLLECTIONS_UNTAGGED_PHOTOS:3,PHOTOS_OF_YOU_SUGGESTIONS:28,FRIENDS_IN_PHOTOS_SUGGESTIONS:31,MIN_ADS_VISIBLE:1,PINNED_UFI_ADJUSTMENT:11,ADD_COMMENT_HEIGHT:54,SLIDESHOW_TIME:3000,_instance:null,touch:nb,touchMarkup:nb});});(function(){var g=74,h=75,i=70,j=76,k=315,l='Arbiter',m='AsyncRequest',n='Bootloader',o='CSS',p='Dialog',q='DOM',r='DOMQuery',s='DOMControl',t='Event',u='EventListener',v='fbt',w='FullScreen',x='ImageUtils',y='Input',z='Keys',aa='Layer',ba='LayerHideOnEscape',ca='LikeConfirmer',da='LinkController',ea='LitestandStoryInsertionStatus',fa='Locale',ga='PageTransitions',ha='Parent',ia='PhotoLogger',ja='PhotoPermalinkURI',ka='PhotosConst',la='PhotoSessionLog',ma='PhotosetPivotSlide.react',na='PhotosetSearchPivot.react',oa='PhotosetSearchPivotData',pa='PhotoSnowliftAds',qa='PhotoStreamCache',ra='PhotosUtils',sa='PhotoTagSearchPivotLogger',ta='PhotoViewer',ua='React',va='Rect',wa='ScriptPath',xa='ScrollableArea',ya='Style',za='Toggler',ab='Tooltip',bb='UFIFeedbackTargets',cb='UIPagelet',db='URI',eb='UserAgent_DEPRECATED',fb='Vector',gb='VideoPlayerReason',hb='$',ib='computeRelativeURI',jb='copyProperties',kb='createArrayFromMixed',lb='csx',mb='cx',nb='emptyFunction',ob='ge',pb='getActiveElement',qb='goURI',rb='invariant',sb='userAction';for(var tb in ta)if(ta.hasOwnProperty(tb))vb[tb]=ta[tb];var ub=ta===null?null:ta.prototype;vb.prototype=Object.create(ub);vb.prototype.constructor=vb;vb.__superConstructor__=ta;function vb(){"use strict";ta.call(this);this.$PhotoSnowlift0={};this.$PhotoSnowlift1=0;this.$PhotoSnowlift2=false;this.clearAlbumBoundaries();}vb.prototype.preload=function(wb,xb){"use strict";n.loadModules(["PhotoTagger","Live","PhotoTagApproval","PhotoTags","TagTokenizer","css:fb-photos-snowlift-fullscreen-css"],function(zb){this.PhotoTagger=zb;}.bind(this));var yb=this.getImageSrc(db(wb).getQueryData());if(yb)if(!this.$PhotoSnowlift3(yb))(new Image()).src=yb;};vb.prototype.bootstrap=function(wb,xb){"use strict";this.preload(wb,xb);if(this.closeDirty){setTimeout(this.bootstrap.bind(this,wb,xb),0);return;}pa.reset();this.resetUriStack=true;if(this.isOpen)if(this.openExplicitly){this.closeCleanup();this.resetUriStack=false;}else return;this.$PhotoSnowlift4=null;var yb=ha.byAttribute(xb,'data-cursor');if(yb){try{var ac=JSON.parse(yb.getAttribute('data-ft'));this.$PhotoSnowlift4={qid:ac.qid,mf_story_key:ac.mf_story_key};}catch(zb){}}else try{yb=ha.byAttribute(xb,'data-ad');var bc=JSON.parse(yb.getAttribute('data-ad'));this.$PhotoSnowlift4={ad_id:bc.adid};}catch(zb){}this.ua=sb('snowlift',xb).uai('open');wa.openOverlayView('snowlift');this.returningToStart=false;this.loading&&o.removeClass(this.loading,'loading');if(xb){o.addClass((this.loading=xb),'loading');var cc=ha.byClass(xb,'uiStreamStory')||ha.byClass(xb,"_5jmm");if(cc){this.storyID=cc.id;}else{var dc=ha.byClass(xb,"_5b9c");if(dc)this.storyID=dc.getAttribute('data-ownerid');}this.$PhotoSnowlift5();this.getThumbAndSize(xb);}else this.loading=null;l.inform('PhotoSnowlift.GO',wb,l.BEHAVIOR_STATE);this.loadFrameIfUninitialized();};vb.prototype.$PhotoSnowlift5=function(){"use strict";if(this.container)if(this.storyID){this.container.setAttribute('data-ownerid',this.storyID);}else this.container.removeAttribute('data-ownerid');};vb.prototype.setupFromSnowflake=function(wb,xb){"use strict";this.extraClasses=wb;this.snowflake=true;this.firstInSet=xb;if(this.root){o.addClass(this.root,"snowflake");this.extraClasses.forEach(function(yb){o.addClass(this.root,yb);},this);}};vb.prototype.getCurrentImageServerSizeDimensions=function(){"use strict";var wb=this.stream.getCurrentImageData();return wb.originalDimensions||wb.dimensions;};vb.prototype.getEventPrefix=function(){"use strict";return 'PhotoSnowlift';};vb.prototype.getRoot=function(){"use strict";return this.root;};vb.prototype.getSourceString=function(){"use strict";return 'snowlift';};vb.prototype.getViewerSource=function(){"use strict";return this.source;};vb.prototype.getViewerSet=function(){"use strict";return this.stream.getPhotoSet();};vb.prototype.getVersionConst=function(){"use strict";return ka.VIEWER_SNOWLIFT;};vb.prototype.getImage=function(){"use strict";return this.image;};vb.prototype.getImageId=function(){"use strict";return this.stream.getCursor();};vb.prototype.getRHCHeader=function(){"use strict";return this.rhcHeader;};vb.prototype.getRHCBody=function(){"use strict";return this.ufiForm;};vb.prototype.getRHCFooter=function(){"use strict";return this.rhcFooter;};vb.prototype.getLoadQuery=function(){"use strict";return this.loadQuery;};vb.prototype.getCurrentPhotoInfo=function(){"use strict";var wb=this.stream.getCurrentImageData();if(wb)return wb.info;return null;};vb.prototype.getOwnerId=function(){"use strict";var wb=this.stream.getCurrentImageData();if(wb)return wb.info.owner;return null;};vb.prototype.getThumbAndSize=function(wb){"use strict";this.currentImageSize=null;this.thumbSrc=null;var xb=db(wb.getAttribute('ajaxify')).getQueryData();if(!xb.size)return;var yb=fb.deserialize(xb.size);if(!yb.x||!yb.y)return;this.currentImageSize=yb;if(wb.getAttribute('data-cropped'))return;var zb=q.scry(wb,'img')[0],ac=q.scry(wb,'i')[0],bc=ha.byAttribute(wb,'data-size');this.shouldStretch=bc&&this.currentImageSize&&zb&&bc.getAttribute('data-size')==="2"&&this.currentImageSize.x>this.currentImageSize.y&&this.currentImageSize.x<=vb.TIMELINE_STRETCH_WIDTH&&zb.offsetWidth===vb.TIMELINE_STRETCH_WIDTH;var cc;if(zb){cc=zb.src;}else if(ac){cc=ya.get(ac,'backgroundImage').replace(/.*url\("?([^"]*)"?\).*/,'$1');}else return;this.thumbSrc=cc;};vb.prototype.loadFrameIfUninitialized=function(){"use strict";if(this.root)return;new m('/ajax/photos/snowlift/init.php').setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();};vb.prototype.init=function(wb,xb){"use strict";this.init=nb;this.$PhotoSnowlift6=xb.photos_client_loading;this.$PhotoSnowlift7=null;if(this.$PhotoSnowlift6)this.$PhotoSnowlift7=new ia(ka.VIEWER_SNOWLIFT_STRING);this.$PhotoSnowlift8=xb.pivot_hover;this.$PhotoSnowlift9=xb.show_more_photos;this.$PhotoSnowlifta=xb.extra_slide_pivot;la.setEndMetrics(xb.pivot_end_metric);this.startingMousePos=null;this.haveLeftBufferRegion=false;this.showingTypeaheadSuggestions=false;this.fullscreen=w.isSupported();this.showOGVideos=xb.og_videos;this.resizeCommentsForAds=xb.resize_comments_for_ads;this.spotlight=wb;this.spotlight.subscribe('blur',function(){this.closingAction=la.OUTSIDE;}.bind(this));this.spotlight.subscribe('hide',this.closeHandler.bind(this));this.spotlight.subscribe('key',this.keyHandler.bind(this));this.initializeNodes(this.spotlight.getRoot());pa.init(this.sideAdUnit,this,xb,this.adsDisplayedCallback.bind(this));this.inAdsDisplayedCallback=false;this.lastAdsHeight=0;if(!this.subscription){da.registerHandler(this.handleNavigateAway.bind(this));this.subscription=l.subscribe('PhotoSnowlift.GO',function(yb,zb){this.openExplicitly=true;this.loading&&o.removeClass(this.loading,'loading');this.open(zb);}.bind(this));}this.transitionHandlerRegistered=false;this.returningToStart=false;ga.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;l.subscribe('PhotoTagApproval.HILITE_TAG',this.onHiliteTag.bind(this));l.subscribe('PhotoTagApproval.UPDATE_TAG_BOX',this.onUpdateTagBox.bind(this));if(this.fullscreen)w.subscribe('changed',this.onFullScreenChange.bind(this));this.slideshowGk=xb.snowlift_slideshow;this.buttonTruncateGk=xb.snowlift_button_truncate;this.$PhotoSnowliftb=this.$PhotoSnowliftb&&xb.www_panorama_viewer;this.allowIrrelevantRequests=!!xb.snowlift_allow_irrelevant_requests;if(this.snowflake){o.addClass(this.root,"snowflake");this.extraClasses.forEach(function(yb){o.addClass(this.root,yb);},this);}};vb.prototype.onFullScreenChange=function(){"use strict";if(!this.isOpen)return;var wb=w.isFullScreen();o.conditionClass(document.body,'fbPhotoSnowliftFullScreenMode',wb);if(wb){if(!o.hasClass(this.root,'fbPhotoSnowliftEditMode'))this.collapseRHC();var xb=this.stream.getCurrentImageData();if(xb&&xb.url&&this.image.src!==xb.url&&this.shouldShowHiRes(xb))this.switchImage(xb.url);this.adjustForResize();if(!this.$PhotoSnowlift2)this.$PhotoSnowliftc();}else{if(!this.$PhotoSnowlift2)this.uncollapseRHC();if(eb.chrome()&&!o.hasClass(this.root,'fbPhotoSnowliftEditMode'))this.page(0,false);l.inform('reflow');}za.hide();};vb.prototype.initializeNodes=function(wb){"use strict";this.root=wb;this.container=q.find(wb,'div.fbPhotoSnowliftContainer');this.$PhotoSnowlift5();this.snowliftPopup=q.find(this.container,'div.fbPhotoSnowliftPopup');this.rhc=q.find(this.snowliftPopup,'div.rhc');this.rhcHeader=q.find(this.rhc,'div.rhcHeader');this.rhcFooter=q.find(this.rhc,'div.rhcFooter');this.ufiForm=q.find(this.rhc,'form.fbPhotosSnowliftFeedbackForm');this.ufiInputContainer=q.find(this.rhc,'div.fbPhotosSnowboxFeedbackInput');this.scroller=q.find(this.ufiForm,'div.rhcScroller');this.scrollerBody=q.find(this.scroller,'div.uiScrollableAreaBody');this.stageWrapper=q.find(this.snowliftPopup,'div.stageWrapper');this.overlay=q.find(this.snowliftPopup,'div.snowliftOverlay');this.errorBox=q.find(this.stageWrapper,'div.stageError');this.image=q.find(this.stageWrapper,'img.spotlight');this.stage=q.find(this.stageWrapper,'div.stage');this.showZoomInButton=q.scry(this.stageWrapper,"._5qmg").pop();this.showZoomOutButton=q.scry(this.stageWrapper,"._5qmh").pop();this.zoomedImage=q.scry(this.stage,"._10zw").pop();this.outerImageSlider=q.scry(this.stage,"._10zx").pop();this.innerImageSlider=q.scry(this.stage,"._10zv").pop();this.$PhotoSnowliftb=this.showZoomInButton&&this.showZoomOutButton&&this.zoomedImage&&this.outerImageSlider&&this.innerImageSlider;if(this.$PhotoSnowliftb){o.hide(this.showZoomInButton);o.hide(this.showZoomOutButton);o.hide(this.zoomedImage);o.hide(this.outerImageSlider);}this.videoStage=q.find(this.stageWrapper,'div.videoStage');this.prevPager=q.find(this.snowliftPopup,'a.snowliftPager.prev');this.nextPager=q.find(this.snowliftPopup,'a.snowliftPager.next');this.stageActions=q.find(wb,'div.stageActions');this.buttonActions=q.find(this.stageActions,'div.fbPhotosPhotoButtons');this.placeInfo=q.find(this.rhc,'div.fbPhotosSnowliftPlaceInfo');this.sideAdUnit=q.find(wb,"._5ciw");o.conditionClass(this.root,'fullScreenAvailable',this.fullscreen);};vb.prototype.initializeScroller=function(){"use strict";this.initializeScroller=nb;this.scrollableArea=xa.fromNative(this.scroller,{fade:true,persistent:true});var wb=function(event){var xb=t.$E(event).getTarget();if(q.contains(this.ufiInputContainer,xb)){var yb=s.getInstance(xb);if(yb){this.scrollableArea.scrollToBottom();var zb=yb.subscribe('resize',function(){var bc=this.scrollableArea.isScrolledToBottom();this.adjustScroller();bc&&this.scrollableArea.scrollToBottom();}.bind(this)),ac=t.listen(xb,'blur',function(){yb.unsubscribe(zb);ac.remove();});}}}.bind(this);l.subscribe('ufi/inputHeightChanged',function(xb,yb){if(q.contains(this.ufiInputContainer,yb.node))this.adjustScroller();}.bind(this));l.subscribe('ufi/addCommentFacepileRendered',function(){this.adjustScroller();}.bind(this));l.subscribe('ufi/changed',function(xb,yb){if(this.ufiForm===yb.form)this.adjustScrollerIfNecessary();}.bind(this));l.subscribe('ufi/comment',function(xb,yb){if(this.ufiForm===yb.form){this.adjustScrollerIfNecessary();if(yb.isranked){this.scrollableArea.scrollToTop();}else this.scrollableArea.scrollToBottom();}}.bind(this));t.listen(this.rhc,'click',function(event){var xb=event.getTarget();if(ha.byTag(xb,'a')||ha.byTag(xb,'button')||q.isNodeOfType(xb,'input'))this.adjustScrollerIfNecessary();}.bind(this));l.subscribe(['reflow','CommentUFI.Pager'],function(){if(this.isOpen)this.adjustScrollerIfNecessary();}.bind(this));t.listen(this.ufiForm,'focusin',wb);};vb.prototype.openHandler=function(wb){"use strict";if(this.isOpen||!ja.isValid(wb)||this.returningToStart||wb.getQueryData().closeTheater||wb.getQueryData().permPage){this.openHandlerRegistered=false;return false;}this.open(wb);this.$PhotoSnowlifte.push(db(wb).getQualifiedURI().toString());ga.transitionComplete(true);return true;};vb.prototype.getImageSrc=function(wb){"use strict";if(wb.smallsrc){if(!wb.size)return wb.smallsrc;var xb=fb.deserialize(wb.size),yb=this.getStageSize(xb);yb=this.$PhotoSnowliftf(yb);if(yb.x<=vb.STAGE_NORMAL_MAX.x&&yb.y<=vb.STAGE_NORMAL_MAX.y)return wb.smallsrc;}return wb.src;};vb.prototype.open=function(wb){"use strict";var xb=db(wb),yb=xb.getQueryData(),zb=ja.parse(xb);if(zb!==null){yb.fbid=zb.photo_id;yb.set=zb.set_token;}var ac=this.getImageSrc(yb);if(ac){delete yb.src;delete yb.smallsrc;}if(this.resetUriStack)this.$PhotoSnowlifte=[];if(!this.initialLoad){yb.firstLoad=true;this.initialLoad=true;ea.registerBlocker(function(){return this.isOpen;}.bind(this));}this.sessionID=Date.now();this.loadQuery=jb(yb,{ssid:this.sessionID});if(this.$PhotoSnowlift4)this.loadQuery.data_ft=this.$PhotoSnowlift4;this.isOpen=true;this.pagersShown=false;this.refreshOnClose=false;this.hilitedTag=null;this.loadingStates={image:false,html:false};this.replaceUrl=false;this.movementDelta=0;this.pivotsCarouselElement=null;this.videoPivotsGK=false;o.show(this.nextPager);o.show(this.prevPager);this.source=null;this.saveTagSubscription=l.subscribe('PhotoTagger.SAVE_TAG',this.onTagSaved.bind(this));this.taggedPhotoIds=[];this.stream=new qa();this.stream.init(ka.VIEWER_SNOWLIFT,'PhotoViewerPagelet','pagelet_photo_viewer',this.$PhotoSnowlift6?this.$PhotoSnowlift7:null,yb.tagSuggestionMode||'everyone');if(!!db.getMostRecentURI().getQueryData().viewas)this.stream.setViewAs(db.getMostRecentURI().getQueryData().viewas+'');this.fetchInitialData();this.setLoadingState(vb.STATE_HTML,true);this.rhcCollapsed=false;this.$PhotoSnowliftg(wb,ac);n.loadModules(["PhotosButtonTooltips"],function(bc){bc.init();});};vb.prototype.$PhotoSnowliftg=function(wb,xb){"use strict";this.createLoader(xb);this.spotlight.show();this.ua&&this.ua.add_event('frame');l.inform('layer_shown',{type:'PhotoSnowlift'});l.inform('PhotoSnowlift.OPEN');this.stageHandlers=[t.listen(window,'resize',this.adjustForResize.bind(this)),t.listen(this.stageWrapper,'click',this.buttonListener.bind(this)),t.listen(this.stageWrapper,'mouseleave',function(event){var ac=event.getTarget();if(!(ha.byClass(ac,'snowliftOverlay')||ha.byClass(ac,'fbPhotoSnowliftTagApproval')||ha.byClass(ac,'tagPointer')||ha.byClass(ac,'arrow')||ha.byClass(ac,'faceboxSuggestion')||ha.byClass(ac,'typeaheadWrapper')||ha.byClass(ac,'photoTagTypeahead')||ha.byClass(ac,'fbPhotoTagger')))this.unhiliteAllTags();this.hidePagers();}.bind(this)),t.listen(this.stageWrapper,'mousemove',this.hilitePager.bind(this)),t.listen(this.stageWrapper,'mousemove',this.hiliteTagsOnMouseMove.bind(this)),t.listen(this.overlay,'mouseenter',this.unhiliteAllTags.bind(this)),t.listen(this.container,'mousemove',this.$PhotoSnowlifth.bind(this)),t.listen(this.container,'mouseover',this.$PhotoSnowlifti.bind(this)),t.listen(this.stageWrapper,'focusin',this.hilitePager.bind(this)),t.listen(this.rhc,'focusin',this.hidePagers.bind(this))];if(this.$PhotoSnowliftb){this.stageHandlers.push(t.listen(this.stage,'mousedown',this.$PhotoSnowliftj.bind(this)));this.stageHandlers.push(t.listen(this.root,'mouseup',this.$PhotoSnowliftk.bind(this)));}this.stageHandlers.push(t.listen(this.container,'click',function(event){var ac=event.getTarget();if(ha.byClass(ac,'rotateRight')){this.rotate('right');}else if(ha.byClass(ac,'rotateLeft')){this.rotate('left');}else if(ha.byClass(ac,'closeTheater')){if(w.isFullScreen()){w.toggleFullScreen();return;}this.closingAction=la.X;this.spotlight.hide();return false;}else if(this.fullscreen)if(ha.byClass(ac,'fbPhotoSnowliftFullScreen')){this.toggleFullScreen();}else if(ha.byClass(ac,'fbPhotoSnowliftCollapse'))this.toggleCollapse();}.bind(this)));var yb=ob('fbPhotoSnowliftFeedback');if(yb)this.stageHandlers.push(t.listen(yb,'click',function(event){var ac=event.getTarget();if(ha.byClass(ac,'like_link')||(ha.byClass(ac,'UFILikeLink')&&ha.byClass(ac,'UIActionLinks')))this.toggleLikeButton();var bc=ha.byClass(event.getTarget(),'uiUfiCollapsedComment');if(bc)o.addClass(bc,'uiUfiCollapsedCommentToggle');}.bind(this)));var zb=ob('fbPhotoSnowliftOnProfile');if(zb)this.stageHandlers.push(t.listen(zb,'click',function(event){if(ha.byClass(event.getTarget(),'fbPhotoRemoveFromProfileLink'))this.refreshOnClose=true;}.bind(this)));if(this.resetUriStack)this.startingURI=db.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI();if(!xb)this.setLoadingState(vb.STATE_IMAGE_DATA,true);if(!this.transitionHandlerRegistered){ga.registerHandler(this.transitionHandler.bind(this));this.transitionHandlerRegistered=true;}la.initLogging(la.SNOWLIFT);if(this.pivots)la.setRelevantCount(this.pivots.relevantCount);};vb.prototype.toggleFullScreen=function(){"use strict";var wb=w.toggleFullScreen(document.documentElement);if(wb){var xb=this.stream.getCurrentImageData();if(xb&&xb.url&&this.image.src!==xb.url&&this.shouldShowHiRes(xb))if(!this.$PhotoSnowlift3(xb.url))(new Image()).src=xb.url;la.logEnterFullScreen(this.stream.getCursor());}};vb.prototype.getStream=function(){"use strict";return this.stream;};vb.prototype.fetchInitialData=function(){"use strict";this.ua&&this.ua.add_event('init_data');this.stream.waitForInitData();cb.loadFromEndpoint('PhotoViewerInitPagelet',ob('pagelet_photo_viewer_init',this.root),this.loadQuery,{actorID:bb.getActorIDForFeedbackTargetIfExists(this.loadQuery.fbid),usePipe:true,jsNonblock:true,crossPage:true,allowIrrelevantRequests:this.allowIrrelevantRequests});};vb.prototype.toggleCollapse=function(){"use strict";if(this.rhcCollapsed){this.uncollapseRHC();}else this.collapseRHC();};vb.prototype.collapseRHC=function(){"use strict";this.rhcCollapsed=true;o.addClass(this.root,'collapseRHC');this.adjustForResize();};vb.prototype.uncollapseRHC=function(){"use strict";this.rhcCollapsed=false;o.removeClass(this.root,'collapseRHC');this.adjustForResize();};vb.prototype.closeHandler=function(){"use strict";if(!this.isOpen)return;this.closingAction=this.closingAction||la.ESC;if(db.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI().toString()==this.startingURI.toString()){this.close();return;}this.returnToStartingURI(this.refreshOnClose);this.close();};vb.prototype.returnToStartingURI=function(wb,xb){"use strict";if(!wb)if(xb){this.squashNextTransition(qb.bind(null,xb));}else this.squashNextTransition();this.returningToStart=true;var yb=l.subscribe('page_transition',(function(){this.returningToStart=false;yb.unsubscribe();}).bind(this)),zb=wb||isNaN(eb.opera()),ac=this.$PhotoSnowlifte.length;if(zb&&ac<window.history.length){window.history.go(-ac);}else{var bc=this.startingURI,cc=new db(bc).removeQueryData('closeTheater');if(bc.getQueryData().sk=='approve'&&bc.getPath()=='/profile.php'){cc.removeQueryData('highlight');cc.removeQueryData('notif_t');}qb(cc);}};vb.prototype.squashNextTransition=function(wb){"use strict";this.squashNext=true;ga.registerHandler(function xb(){if(this.squashNext){this.squashNext=false;if(wb)setTimeout(wb,0);ga.transitionComplete(true);return true;}return false;}.bind(this),7);};vb.prototype.handleNavigateAway=function(wb){"use strict";var xb=ib(ga.$PhotoSnowliftl.getQualifiedURI(),wb.getAttribute('href'));if(this.isOpen&&(xb instanceof db)&&xb.getUnqualifiedURI().toString()!=this.startingURI.toString()&&xb.getPath()!='/photo.php'){if(!this.closingAction)this.closingAction=la.NAVIGATE;this.returnToStartingURI(false,xb);this.close();return false;}return true;};vb.prototype.postProcessTaggedPhotos=function(){"use strict";if(this.taggedPhotoIds&&this.taggedPhotoIds.length>0){var wb=null;if(this.source===vb.COLLECTIONS_UNTAGGED_PHOTOS){wb='/ajax/photos/photo/edit/skiptag/';}else if(this.source===vb.PHOTOS_OF_YOU_SUGGESTIONS||this.source===vb.FRIENDS_IN_PHOTOS_SUGGESTIONS)wb='/ajax/photos/photo/add_to_star_grid/';if(wb)new m().setURI(wb).setAllowCrossPageTransition(true).setData({media_id:this.taggedPhotoIds,source:this.source}).send();}};vb.prototype.onTagSaved=function(wb,xb){"use strict";if(this.taggedPhotoIds){if(this.source===vb.PHOTOS_OF_YOU_SUGGESTIONS&&!xb.self_tag)return;this.taggedPhotoIds.push(xb.photo_fbid);}};vb.prototype.clearAlbumBoundaries=function(){"use strict";this.$PhotoSnowliftn={start:0,end:0};};vb.prototype.close=function(){"use strict";if(!this.isOpen)return;this.$PhotoSnowlifto=null;this.hideMorePhotos();this.hidePivotSlide();this.$PhotoSnowliftp();this.isOpen=false;this.$PhotoSnowlift1=0;this.clearAlbumBoundaries();if(this.fullscreen)w.disableFullScreen();sb('snowlift').uai('close');wa.closeOverlayView('snowlift');this.spotlight.hide();this.openExplicitly=false;this.postProcessTaggedPhotos();l.unsubscribe(this.saveTagSubscription);this.taggedPhotoIds=[];this.closeDirty=true;setTimeout(this.closeCleanup.bind(this),0);if(this.snowflake){o.removeClass(this.root,"snowflake");this.extraClasses.forEach(function(wb){o.removeClass(this.root,wb);},this);}this.extraClasses=[];this.snowflake=false;this.firstInSet=null;this.movementDelta=0;};vb.prototype.closeCleanup=function(){"use strict";this.closeDirty=false;o.removeClass(this.root,'dataLoading');la.logPhotoViews(this.closingAction);this.destroy();o.hide(this.errorBox);o.hide(this.image);this.currentImageSize=null;this.thumbSrc=null;this.shouldStretch=false;this.resetUriStack=true;var wb=this.stream.getCursor();o.removeClass(this.stageWrapper,'showVideo');q.empty(this.videoStage);this.uncollapseRHC();this.currentMinSize=null;this.setStagePagersState('reset');this.recacheData();q.empty(this.sideAdUnit);this.stream.destroy();this.root.setAttribute('aria-busy','true');var xb=this.closingAction===la.NAVIGATE;this.closingAction=null;if(!this.openHandlerRegistered){ga.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;}l.inform('layer_hidden',{type:'PhotoSnowlift'});l.inform('PhotoSnowlift.CLOSE',{is_navigating:xb,fbid:wb});this.$PhotoSnowliftq();this.$PhotoSnowliftr=null;};vb.prototype.createLoader=function(wb){"use strict";if(this.currentImageSize===null){this.adjustStageSize(vb.STAGE_MIN);}else{var xb=this.getStageSize(this.currentImageSize);xb=new fb(Math.max(xb.x,vb.STAGE_MIN.x),Math.max(xb.y,vb.STAGE_MIN.y));var yb=this.getImageSizeInStage(this.currentImageSize,xb);if(this.thumbSrc===null){this.adjustStageSize(yb);}else this.useImage(q.create('img',{className:'spotlight',alt:'',src:this.thumbSrc,style:{width:yb.x+'px',height:yb.y+'px'}}),yb,false);}this.setLoadingState(this.STATE_IMAGE_PIXELS,true);if(wb)setTimeout((function(){var zb=new Image(),ac=function(){if(!this.isOpen)return;if(!this.stream||!this.stream.errorInCurrent()){this.switchImage(wb,this.currentImageSize);this.ua&&this.ua.add_event('image');this.setLoadingState(vb.STATE_IMAGE_DATA,false);}}.bind(this),bc=t.listen(zb,'load',ac),cc=function(){if(bc){bc.remove();bc=null;}};l.subscribeOnce('PhotoSnowlift.SWITCH_IMAGE',cc);l.subscribeOnce('PhotoSnowlift.CLOSE',cc);this.$PhotoSnowlift3(wb);zb.src=wb;}).bind(this),0);o.hide(this.stageActions);this.setStagePagersState('disabled');};vb.prototype.initDataFetched=function(wb){"use strict";la.setPhotoSet(this.stream.getPhotoSet());la.setLogFbids(wb.logids);this.$PhotoSnowliftn.start=this.stream.getCursor();var xb=this.stream.getCurrentImageData();la.addPhotoView(xb.info,this.shouldShowHiRes(xb),this.fullscreen&&w.isFullScreen());var yb=this.stream.getCurrentExtraData();if(this.$PhotoSnowlift8&&yb)sa.logImageImpression('snowlift',String(this.stream.getCursor()),Object.keys(yb.tagRects));if(yb&&yb.source!==(void 0)){this.source=parseInt(yb.source,10);la.setSource(this.source);}if(!this.pageHandlers)this.pageHandlers=[t.listen(this.root,'click',this.pageListener.bind(this)),t.listen(this.root,'mouseleave',this.mouseLeaveListener.bind(this))];o.show(this.stageActions);this.root.setAttribute('aria-busy','false');this.isLoggedInViewer=wb.loggedin;this.disableAds=!this.isLoggedInViewer||wb.fromad||this.stream.isInViewAsMode();this.loadAds();if(this.$PhotoSnowlifts(xb)){la.addPanoramaImpression();this.switchIntoZoomedImage();}else if(this.$PhotoSnowliftb)o.hide(this.showZoomInButton);};vb.prototype.adjustScrollerIfNecessary=function(){"use strict";clearTimeout(this.scrollerTimeout);this.scrollerTimeout=setTimeout(this.adjustScroller.bind(this),0);};vb.prototype.adjustScroller=function(wb){"use strict";clearTimeout(this.scrollerTimeout);this.initializeScroller();this.scrollableArea.resize();var xb=fb.getElementDimensions(this.rhc),yb=xb.y;yb-=fb.getElementDimensions(this.rhcHeader).y;yb-=fb.getElementDimensions(this.ufiInputContainer).y;if(this.placeInfo){var zb=fb.getElementDimensions(this.placeInfo);yb-=zb.y;ya.set(this.sideAdUnit,'bottom',zb.y+'px');}if(wb==null)wb=this.resizeCommentsForAds?this.lastAdsHeight:0;this.lastAdsHeight=wb;yb=Math.max(0,yb);var ac=fb.getElementDimensions(this.scrollerBody).y,bc=Math.max(vb.MIN_UFI_HEIGHT,yb-wb);if(ac>=bc){if(yb>bc){o.removeClass(this.rhc,'pinnedUfi');yb-=bc;}else{o.addClass(this.rhc,'pinnedUfi');yb=0;}ya.set(this.scroller,'height',bc+'px');}else{ya.set(this.scroller,'height','auto');o.removeClass(this.rhc,'pinnedUfi');yb-=ac;}var cc=fb.getElementDimensions(this.ufiInputContainer).y;ya.set(this.ufiForm,'padding-bottom',cc+'px');pa.resize(new fb(xb.x,yb));this.scrollableArea.adjustGripper();};vb.prototype.adjustForResize=function(){"use strict";this.currentMinSize=null;this.adjustStageSize();this.adjustForNewData();if(this.$PhotoSnowliftb){if(!this.$PhotoSnowlift2)this.$PhotoSnowliftc();this.$PhotoSnowliftt(this.$PhotoSnowliftr);}};vb.prototype.shouldShowHiRes=function(wb){"use strict";if(!wb||!wb.smallurl)return false;var xb=this.getStageSize(wb.dimensions);xb=this.$PhotoSnowliftf(xb);var yb=this.getImageSizeInStage(wb.dimensions,xb);return (yb.x>vb.STAGE_NORMAL_MAX.x||yb.y>vb.STAGE_NORMAL_MAX.y);};vb.prototype.$PhotoSnowliftf=function(wb){"use strict";if(window.devicePixelRatio&&window.devicePixelRatio>1)wb=new fb(wb.x*window.devicePixelRatio,wb.y*window.devicePixelRatio);return wb;};vb.prototype.getImageURL=function(wb){"use strict";if(wb.video){return null;}else if(wb.smallurl&&!this.shouldShowHiRes(wb))return wb.smallurl;return wb.url;};vb.prototype.getImageOrVideoDimensions=function(wb){"use strict";if(wb.video){var xb=this.getVideoElement(wb.video);if(xb)return this.getVideoSize(xb);}return this.getImageDimensions(wb);};vb.prototype.getImageDimensions=function(wb){"use strict";if(this.$PhotoSnowlift2)return wb.originalDimensions;if(wb.smalldims&&(!this.shouldShowHiRes(wb)||this.image.src===wb.smallurl))return wb.smalldims;return wb.dimensions;};vb.prototype.getStageSize=function(wb,xb){"use strict";var yb=fb.getViewportDimensions(),zb=new fb(wb.x,wb.y+this.getExtraVerticalSpace());if(xb)zb=new fb(Math.max(wb.x,xb.x),Math.max(wb.y,xb.y));var ac,bc;if(this.fullscreen&&w.isFullScreen()){return new fb((this.rhcCollapsed?screen.width:screen.width-vb.SIDEBAR_SIZE_MAX),screen.height-vb.FULL_SCREEN_PADDING*2);}else{ac=Math.min(zb.x,(yb.x-vb.SIDEBAR_SIZE_MAX-vb.STAGE_CHROME.x));bc=Math.min(zb.y,yb.y-vb.STAGE_CHROME.y);}if(ac===0&&bc===0)return new fb(0,0);var cc=ac/bc,dc=zb.x/zb.y;if(cc<dc)return new fb(ac,Math.round(ac/dc));return new fb(Math.round(bc*dc),bc);};vb.prototype.getExtraVerticalSpace=function(){"use strict";if(this.getVideoOnStage())return vb.VIDEO_BOTTOM_BAR_SPACE*2;return 0;};vb.prototype.getComponentsHeight=function(){"use strict";var wb=this.getVideoOnStage();if(wb)return this.getVideoComponentsHeight(ob(wb));return 0;};vb.prototype.getImageSizeInStage=function(wb,xb){"use strict";var yb=wb.x,zb=wb.y,ac=this.getComponentsHeight(),bc=this.getExtraVerticalSpace();zb-=ac;xb=new fb(xb.x,xb.y-ac-bc);if(yb>=xb.x||zb>=xb.y){var cc=xb.x/xb.y,dc=yb/zb;if(cc<dc){yb=xb.x;zb=Math.round(yb/dc);}else if(cc>dc){zb=xb.y;yb=Math.round(zb*dc);}else{yb=xb.x;zb=xb.y;}}return new fb(yb,zb+ac);};vb.prototype.getStageSizeForZoomedImage=function(wb,xb){"use strict";if(this.fullscreen&&w.isFullScreen()){var yb=this.rhcCollapsed?screen.width:screen.width-vb.SIDEBAR_SIZE_MAX,zb=screen.height-vb.FULL_SCREEN_PADDING*2;return new fb(yb,zb);}var ac=fb.getViewportDimensions();if(xb===null)xb=new fb(0,0);var bc=new fb(Math.max(wb.x,vb.STAGE_MIN.x,xb.x),Math.max(wb.y,vb.STAGE_MIN.y,xb.y)),cc=ac.x-vb.STAGE_CHROME.x;if(!this.rhcCollapsed)cc-=vb.SIDEBAR_SIZE_MAX;yb=Math.min(bc.x,cc);zb=Math.min(bc.y,ac.y-vb.STAGE_CHROME.y);return new fb(yb,zb);};vb.prototype.adjustStageSize=function(wb){"use strict";var xb=this.currentImageSize;if(wb){xb=wb;}else{var yb=this.stream&&this.stream.getCurrentImageData();if(yb)xb=this.getImageOrVideoDimensions(yb);}if(!xb)return;this.currentImageSize=xb;var zb=this.getExtraVerticalSpace();if(this.shouldStretch&&!this.getVideoOnStage()&&xb.x>xb.y&&xb.x<=vb.TIMELINE_STRETCH_WIDTH&&xb.x>=vb.TIMELINE_STRETCH_MIN){xb.y=Math.round(xb.y*vb.TIMELINE_STRETCH_WIDTH/xb.x);xb.x=vb.TIMELINE_STRETCH_WIDTH;}var ac;if(this.$PhotoSnowlift2){ac=this.getStageSizeForZoomedImage(xb,this.currentMinSize);}else ac=this.getStageSize(xb,this.currentMinSize);if(!this.currentMinSize)this.currentMinSize=new fb(0,0);this.currentMinSize=new fb(Math.max(ac.x,vb.STAGE_MIN.x,this.currentMinSize.x),Math.max(ac.y,vb.STAGE_MIN.y,this.currentMinSize.y));var bc=this.getImageSizeInStage(xb,this.currentMinSize),cc=this.currentMinSize.x-bc.x,dc=this.currentMinSize.y-bc.y;if(cc>0&&cc<vb.PADDING_MIN){this.currentMinSize.x-=cc;}else if(dc>0&&dc<vb.PADDING_MIN)this.currentMinSize.y-=dc;var ec=this.currentMinSize.x+vb.SIDEBAR_SIZE_MAX;if(this.rhcCollapsed)ec=this.currentMinSize.x;var fc=this.getVideoOnStage()&&this.pivotsCarouselElement,gc=0,hc=this.currentMinSize.y;if(fc){var ic=this.pivotsCarouselElement.clientHeight;gc=Math.ceil(ic/100)*100;hc=hc+gc;}this.snowliftPopup.style.cssText='width:'+ec+'px;'+'height:'+hc+'px;';var jc=this.currentMinSize.y-zb,kc=jc+gc;if(eb.firefox()){var lc=ya.get(this.stageWrapper,'font-size');jc=(jc/parseFloat(lc))+'em';kc=(kc/parseFloat(lc))+'em';}else{jc=jc+'px';kc=kc+'px';}this.stageWrapper.style.cssText='width:'+this.currentMinSize.x+'px;'+'line-height:'+jc+';';if(this.getVideoOnStage())this.videoStage.style.cssText='width:'+this.currentMinSize.x+'px;'+'height:'+kc+';';if(this.$PhotoSnowlift2){var mc=this.currentMinSize.y-zb;if(xb.y>mc){var nc=(xb.x/xb.y)*mc;ya.apply(this.zoomedImage,{width:nc+"px",height:mc+"px"});}else ya.apply(this.zoomedImage,{width:xb.x+"px",height:xb.y+"px"});}else{bc.y-=this.getComponentsHeight();this.setMediaElementSize(bc);}if(fc)this.setPivotCarouselElementWidth(lc);var oc=this.getTagger();if(oc)oc.repositionTagger();this.adjustScrollerIfNecessary();};vb.prototype.setMediaElementSize=function(wb){"use strict";var xb=this.image;if(this.getVideoOnStage())xb=q.scry(this.videoStage,"._53j5")[0]||xb;xb.style.cssText='width:'+wb.x+'px;'+'height:'+wb.y+'px;';};vb.prototype.setPivotCarouselElementWidth=function(wb){"use strict";var xb=this.videoStage.clientWidth;if(eb.firefox()){xb=(xb/parseFloat(wb))+'em';}else xb=xb+'px';this.pivotsCarouselElement.style.width=xb;};vb.prototype.adjustForNewData=function(){"use strict";if(!this.image)return;var wb=q.scry(this.stage,'div.tagsWrapper')[0],xb=fb.getElementDimensions(this.image);if(wb){ya.set(wb,'width',xb.x+'px');ya.set(wb,'height',xb.y+'px');}};vb.prototype.adsDisplayedCallback=function(wb,xb){"use strict";var yb=this.resizeCommentsForAds&&!this.inAdsDisplayedCallback&&!this.disableAds&&wb<vb.MIN_ADS_VISIBLE&&xb.length>=vb.MIN_ADS_VISIBLE;if(yb){this.inAdsDisplayedCallback=true;var zb=xb[vb.MIN_ADS_VISIBLE-1];this.adjustScroller(zb);this.inAdsDisplayedCallback=false;}};vb.prototype.setLoadingState=function(wb,xb){"use strict";switch(wb){case vb.STATE_IMAGE_PIXELS:o.conditionClass(this.root,'imagePixelsLoading',xb);break;case vb.STATE_IMAGE_DATA:this.loadingStates[wb]=xb;o.conditionClass(this.root,'imageLoading',xb);break;case vb.STATE_HTML:this.loadingStates[wb]=xb;o.conditionClass(this.root,'dataLoading',xb);this.rhc.setAttribute('aria-busy',xb?'true':'false');break;}};vb.prototype.destroy=function(){"use strict";this.stageHandlers.forEach(function(wb){wb.remove();});if(this.pageHandlers){this.pageHandlers.forEach(function(wb){wb.remove();});this.pageHandlers=null;}this.$PhotoSnowliftu&&clearInterval(this.$PhotoSnowliftu);this.$PhotoSnowliftu=null;this.$PhotoSnowliftv=null;};vb.prototype.checkState=function(wb){"use strict";if(wb!=vb.STATE_ERROR&&!this.loadingStates[wb])return;switch(wb){case vb.STATE_IMAGE_DATA:var xb=this.stream.getCurrentImageData();if(xb){var yb=this.getImageURL(xb);if(yb){if(!this.$PhotoSnowlift2&&this.$PhotoSnowlifts())this.$PhotoSnowliftw();this.switchImage(yb,null,true);}else if(xb.video)this.switchVideo(xb.video,true);this.setLoadingState(wb,false);}break;case vb.STATE_HTML:if(this.stream.getCurrentHtml()){this.swapData();this.setLoadingState(wb,false);}break;default:if(this.stream.errorInCurrent()){o.hide(this.image);o.show(this.errorBox);}break;}};vb.prototype.buttonListener=function(event){"use strict";var wb=event.getTarget(),xb=Date.now();if(ha.byClass(wb,"_5qmg")){la.addPanoramaClick();this.switchIntoZoomedImage();return;}if(ha.byClass(wb,"_5qmh")){this.$PhotoSnowliftq();this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));return false;}if(ha.byClass(wb,'fbPhotoTagApprovalBox'))return;if(xb-this.lastPage<350)return;if(ha.byClass(wb,'fbPhotosPhotoLike')){this.likePhoto();}else if(ha.byClass(wb,'tagApproveIgnore')){this.updateTagBox(event,wb);}else if(ha.byClass(wb,"_5ge9")){this.hideMorePhotos();this.toggleSlideshow();return false;}else if(ha.byClass(wb,"_5ymu")){if(!this.$PhotoSnowliftx){sa.logShowMorePhotos();var yb=this.stream.getCursor();if(yb)this.showMorePhotos(String(yb));if(this.$PhotoSnowliftb)o.hide(this.showZoomInButton);}else{sa.logHideMorePhotos();this.$PhotoSnowliftc();this.hideMorePhotos();}return;}else if(ha.byClass(wb,"_27n"))this.$PhotoSnowliftc();this.hideMorePhotos();};vb.prototype.toggleSlideshow=function(){"use strict";if(!this.slideshowGk)return;if(this.$PhotoSnowliftu){this.stopSlideshow();}else this.startSlideshow();};vb.prototype.startSlideshow=function(){"use strict";this.$PhotoSnowliftu=window.setInterval(this.page.bind(this,1,eb.chrome()&&w.isFullScreen()),vb.SLIDESHOW_TIME);o.addClass(this.root,'slideshowStarted');o.removeClass(this.root,'slideshowAvailable');};vb.prototype.stopSlideshow=function(){"use strict";this.$PhotoSnowliftu&&clearInterval(this.$PhotoSnowliftu);this.$PhotoSnowliftu=null;o.addClass(this.root,'slideshowAvailable');o.removeClass(this.root,'slideshowStarted');};vb.prototype.likePhoto=function(){"use strict";la.addButtonLike();var wb=hb('fbPhotoSnowliftFeedback'),xb=q.scry(wb,'button.like_link')[0];if(!xb)xb=q.scry(wb,'a.UFILikeLink')[0];var yb=xb.getAttribute('href');if(w.isFullScreen())if(eb.chrome())xb.setAttribute('href','javascript:;');xb.click();xb.setAttribute('href',yb);};vb.prototype.toggleLikeButton=function(){"use strict";var wb=q.scry(this.buttonActions,'a.fbPhotosPhotoLike')[0];if(wb){var xb=q.find(this.root,'.likeCount'),yb=q.find(xb,'.likeCountNum');if(xb)if(o.hasClass(wb,'viewerLikesThis')){q.setContent(yb,parseInt(yb.textContent,10)-1);}else q.setContent(yb,parseInt(yb.textContent,10)+1);o.toggleClass(wb,'viewerLikesThis');o.removeClass(wb,'viewerAlreadyLikedThis');}};vb.prototype.likePhotoWithKey=function(){"use strict";return ca.like(this.likePhoto.bind(this),pb());};vb.prototype.updateTagBox=function(wb,xb){"use strict";this.unhiliteAllTags();var yb=ob(wb);if(!yb)return;o.addClass(yb,'tagBox');o.addClass(yb,'tagBoxPendingResponse');o.removeClass(yb,'tagBoxPending');o.hide(q.find(yb,'span.tagForm'));if(xb){o.show(q.find(yb,'span.tagApproved'));}else o.show(q.find(yb,'span.tagIgnored'));};vb.prototype.rotate=function(wb){"use strict";var xb=this.stream.getCursor();if(this.getVideoOnStage()){var yb=(wb=='left')?270:90;rb(!!this.videoRotateURI);n.loadModules(["VideoRotate"],function(ac){new ac(xb,this.videoRotateURI).motionRotate(yb);}.bind(this));return;}var zb=jb({fbid:xb,opaquecursor:this.stream.getOpaqueCursor(xb),cs_ver:ka.VIEWER_SNOWLIFT},this.stream.getPhotoSetQuery());zb[wb]=1;this.setLoadingState(vb.STATE_IMAGE_DATA,true);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);o.hide(this.image);new m('/ajax/photos/photo/rotate/').setAllowCrossPageTransition(true).setData(zb).setErrorHandler(this.rotationError.bind(this,xb)).setFinallyHandler(this.rotationComplete.bind(this,xb)).setMethod('POST').setReadOnly(false).send();};vb.prototype.rotationComplete=function(wb,xb){"use strict";if(wb==this.stream.getCursor()){this.setLoadingState(vb.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));this.swapData();}};vb.prototype.rotationError=function(wb,xb){"use strict";if(wb==this.stream.getCursor()){this.setLoadingState(vb.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));n.loadModules(["AsyncResponse"],function(yb){yb.defaultErrorHandler(xb);});}};vb.prototype.saveTagsFromPayload=function(wb){"use strict";this.storeFromData(wb);if('data' in wb&&this.stream.getCursor() in wb.data)this.swapData();};vb.prototype.saveEdit=function(){"use strict";if(!o.hasClass(this.root,'fbPhotoSnowliftEditMode'))return;n.loadModules(["PhotoInlineEditor","Form"],function(wb,xb){var yb=wb.getInstance(this.getViewerConst());yb&&xb.bootstrap(yb.getForm().controller);}.bind(this));};vb.prototype.mouseLeaveListener=function(event){"use strict";this.unhiliteAllTags();this.reHilitePendingTag();};vb.prototype.hilitePager=function(event){"use strict";var wb=fb.getEventPosition(event),xb=fb.getElementPosition(this.stage);if(fa.isRTL()){var yb=fb.getElementDimensions(this.stage);this.stagePagerPrev=yb.x-(wb.x-xb.x)<vb.GOPREV_AREA;}else this.stagePagerPrev=wb.x-xb.x<vb.GOPREV_AREA;o.conditionClass(this.prevPager,'hilightPager',this.stagePagerPrev);o.conditionClass(this.nextPager,'hilightPager',!this.stagePagerPrev);var zb,ac=event.getTarget();if(!ha.byClass(ac,'snowliftOverlay')&&!ha.byClass(ac,'bottomBarActions')&&!ha.byClass(ac,'snowliftPager'))zb=vb.PAGER_FADE;this.showPagers(zb);};vb.prototype.showPagers=function(wb){"use strict";clearTimeout(this.fadePagerTimer);this.setStagePagersState('active');if(wb===(void 0))this.fadePagerTimer=setTimeout(this.hidePagers.bind(this),wb);};vb.prototype.hidePagers=function(){"use strict";var wb=q.scry(this.getRoot(),'.fbPhotosPhotoActionsMenu')[0];if(wb)return;clearTimeout(this.fadePagerTimer);this.setStagePagersState('inactive');};vb.prototype.getTagger=function(){"use strict";return (this.PhotoTagger&&this.PhotoTagger.getInstance(ka.VIEWER_SNOWLIFT));};vb.prototype.unhiliteAllTags=function(){"use strict";clearTimeout(this.unhiliteTimer);q.scry(this.stage,'div.tagsWrapper div.hover').forEach(function(xb){o.removeClass(xb,'hover');});q.scry(this.stage,'div.tagsWrapper div.otherActive').forEach(function(xb){o.removeClass(xb,'otherActive');});this.hilitedTag=null;this.showingTypeaheadSuggestions=false;if(!o.hasClass(this.root,'taggingMode')){var wb=this.getTagger();if(wb){wb.hideTagger();wb.setCurrentFacebox(null);}}};vb.prototype.switchHilitedTags=function(wb,xb){"use strict";if(this.switchTimer!==null){clearTimeout(this.switchTimer);this.switchTimer=null;}this.unhiliteAllTags();this.hiliteAllBoxes();var yb=ob(wb);if(yb){this.hilitedTag=wb;if(!o.hasClass(this.root,'taggingMode')&&ra.isFacebox(this.hilitedTag)){var zb=this.getTagger();if(zb){o.addClass(yb,'hover');var ac=zb.getFacebox(wb);zb.setCurrentFacebox(ac);if(ac)zb.addTagFromFacebox(ac);}}else o.addClass(yb,'hover');if(o.hasClass(yb,'tagBoxPending')&&!o.hasClass(yb,'showPendingTagName')&&xb===true){q.scry(this.stage,'div.tagsWrapper div.showPendingTagName').forEach(function(bc){o.removeClass(bc,'showPendingTagName');});o.addClass(yb,'showPendingTagName');}}};vb.prototype.reHilitePendingTag=function(){"use strict";var wb=ob(this.hilitedTag);if(wb&&o.hasClass(wb,'showPendingTagName'))return;var xb=q.scry(this.stage,'div.tagsWrapper div.showPendingTagName')[0];if(xb)this.switchHilitedTags(xb.id);};vb.prototype.hiliteTagsOnMouseMove=function(event){"use strict";if(!this.stream.getCurrentExtraData()||this.getVideoOnStage())return;if(this.switchTimer!==null)return;var wb=event.getTarget();if(ha.byClass(wb,'snowliftOverlay')||ha.byClass(wb,'fbPhotoSnowliftTagApproval')||ha.byClass(wb,'tagPointer')||ha.byClass(wb,'arrow')||ha.byClass(wb,'faceboxSuggestion')||ha.byClass(wb,'typeaheadWrapper')||ha.byClass(wb,'photoTagTypeahead'))return;var xb=ha.byClass(wb,'tagBoxPending'),yb=false;if(this.hilitedTag){var zb=ob(this.hilitedTag);yb=zb&&o.hasClass(zb,'tagBoxPending');}var ac=((!this.hilitedTag&&xb)||(!yb&&xb));if(ac){this.switchHilitedTags(xb.id);return;}if(xb&&(xb.id==this.hilitedTag))return;var bc=250,cc=15,dc=fb.getEventPosition(event);if(!this.startingMousePos)this.startingMousePos=dc;var ec=ra.absoluteToNormalizedPosition(this.image,dc);if(!this.haveLeftBufferRegion&&this.startingMousePos.distanceTo(dc)<cc){return;}else this.haveLeftBufferRegion=true;if(this.currentTagHasPrecedence(ec))return;var fc=ra.getNearestBox(this.stream.getCurrentExtraData().tagRects,ec);if(!fc){if(!yb){this.unhiliteAllTags();this.reHilitePendingTag();}return;}var gc=null;if(yb){var hc={};hc[this.hilitedTag]=this.stream.getCurrentExtraData().tagRects[this.hilitedTag];gc=ra.getNearestBox(hc,ec);}if(gc!==null&&yb)return;if(this.hilitedTag!=fc)if(yb){this.switchTimer=setTimeout(this.switchHilitedTags.bind(this,fc),bc);}else{if(this.$PhotoSnowlift8&&!this.$PhotoSnowlift0[fc]){this.$PhotoSnowlift0[fc]=true;sa.logPivotImpression('snowlift',fc);}this.switchHilitedTags(fc);}};vb.prototype.currentTagHasPrecedence=function(wb){"use strict";if(!this.hilitedTag)return false;if(this.stream.getCurrentExtraData().tagRects[this.hilitedTag]===(void 0)){this.hilitedTag=null;return false;}var xb=this.stream.getCurrentExtraData().tagRects[this.hilitedTag],yb=new va(xb.t+(xb.h()/2),xb.r,xb.b+(ra.isFacebox(this.hilitedTag)?10:0),xb.l,xb.domain);return yb.contains(wb);};vb.prototype.getVideoOnStage=function(){"use strict";var wb=this.stream&&this.stream.getCurrentImageData();return wb&&wb.video;};vb.prototype.shouldPageOnAction=function(wb,xb){"use strict";if(!this.isOpen||ca.isShowingConfirmation())return false;var yb=q.isNode(xb)&&(ha.byClass(xb,'snowliftPager')||ha.byClass(xb,'stagePagers')||ha.byClass(xb,'pivotPageColumn')),zb=q.isNode(xb)&&ha.byClass(xb,'stage'),ac=o.hasClass(xb,'faceBox'),bc=(!o.hasClass(this.root,'taggingMode')&&ac&&!yb);if(bc){if(!this.showingTypeaheadSuggestions){this.getTagger().updateWithSuggestions();setTimeout((function(){q.find(this.getTagger().tagger,'input.textInput').focus();}).bind(this),0);}this.showingTypeaheadSuggestions=!this.showingTypeaheadSuggestions;return false;}var cc=((zb&&o.hasClass(this.root,'taggingMode'))||ha.byClass(xb,'tagBoxPending')||ha.byClass(xb,'tagBoxPendingResponse')||ha.byClass(xb,'fbPhotoTagApprovalBox')||ha.byClass(xb,'tag'));if(cc)return false;if(zb&&this.$PhotoSnowlift2)zb=false;return wb==z.LEFT||wb==z.RIGHT||wb==g||wb==h||yb||bc||zb;};vb.prototype.keyHandler=function(wb,event){"use strict";if(event.getModifiers().any||aa.getTopmostLayer()!==this.spotlight)return true;switch(t.getKeyCode(event)){case z.LEFT:case z.RIGHT:case g:case h:this.pageListener(event);return false;case i:return this.toggleFullScreen();case j:return this.likePhotoWithKey();case z.SPACE:this.toggleSlideshow();this.showPagers(vb.PAGER_FADE);return false;case z.ESC:if(this.$PhotoSnowlift2){this.$PhotoSnowliftq();this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));return false;}break;}};vb.prototype.shouldHandlePendingTag=function(event){"use strict";var wb=this.getTagger();if(!wb||!wb.tags.length)return false;var xb=ra.absoluteToNormalizedPosition(this.getImage(),fb.getEventPosition(event)),yb=wb.findNearestTag(xb);if(!yb||!o.hasClass(yb.node,'tagBoxPending'))return false;l.inform('PhotoTagApproval.PENDING_TAG_PHOTO_CLICK',{id:yb.id,version:this.getVersionConst()});return true;};vb.prototype.pageListener=function(event){"use strict";var wb=t.getKeyCode(event),xb=event.getTarget();if(this.$PhotoSnowliftu){this.stopSlideshow();return;}if(!this.shouldPageOnAction(wb,xb))return;if(this.shouldHandlePendingTag(event))return;var yb=0;if(wb==z.RIGHT||wb==h){yb=1;la.setPagingAction('key_right');this.$PhotoSnowlifty=true;}else if(wb==z.LEFT||wb==g){yb=-1;la.setPagingAction('key_left');this.$PhotoSnowlifty=true;}else if(ha.byClass(xb,'next')){yb=1;la.setPagingAction('click_next');}else if(ha.byClass(xb,'prev')){yb=-1;la.setPagingAction('click_prev');}else if(!this.stagePagerPrev){yb=1;la.setPagingAction('click_stage');}else{yb=-1;la.setPagingAction('click_stage_back');}var zb=q.scry(this.ufiForm,'input.mentionsHidden'),ac=false;for(var bc=0;bc<zb.length;bc++)if(!y.isEmpty(zb[bc])){ac=true;break;}if(ac||o.hasClass(this.root,'fbPhotoSnowliftEditMode')){this.warnLeavePage(this.page.bind(this,yb));}else{this.page(yb,eb.chrome()&&w.isFullScreen());this.$PhotoSnowliftr=null;sb('snowlift',xb,event).uai(la.pagingAction);}};vb.prototype.warnLeavePage=function(wb){"use strict";new p().setTitle("\u3053\u306e\u30da\u30fc\u30b8\u304b\u3089\u79fb\u52d5\u3057\u307e\u3059\u304b\uff1f").setBody("\u30da\u30fc\u30b8\u304b\u3089\u79fb\u52d5\u3059\u308b\u3068\u3001\u4fdd\u5b58\u3055\u308c\u3066\u3044\u306a\u3044\u5909\u66f4\u306f\u5931\u308f\u308c\u307e\u3059\u3002").setButtons([{name:'leave_page',label:"\u79fb\u52d5\u3059\u308b",handler:wb},{name:'continue_editing',label:"\u3053\u306e\u30da\u30fc\u30b8\u304b\u3089\u79fb\u52d5\u3057\u306a\u3044",className:'inputaux'}]).setModal(true).show();};vb.prototype.getUsesOpaqueCursor=function(){"use strict";return this.stream.getUsesOpaqueCursor();};vb.prototype.getOpaqueCursor=function(wb){"use strict";return this.stream.getOpaqueCursor(wb);};vb.prototype.setReachedLeftEnd=function(){"use strict";this.stream.setReachedLeftEnd();};vb.prototype.setReachedRightEnd=function(){"use strict";this.stream.setReachedRightEnd();};vb.prototype.page=function(wb,xb){"use strict";if(!this.stream.isValidMovement(wb)||!this.stream.nonCircularPhotoSetCanPage(wb)){this.showPagers(vb.PAGER_FADE);return;}var yb=this.stream.getCursorAt(this.stream.calculatePositionForMovement(wb));if(this.snowflake&&((this.stream.getCursor()==this.firstInSet&&wb<0)||(this.firstInSet==yb&&wb>0))){this.showPagers(vb.PAGER_FADE);return;}this.lastPage=Date.now();this.unhiliteAllTags();this.startingMousePos=null;this.haveLeftBufferRegion=false;this.$PhotoSnowlift0={};this.$PhotoSnowlift1+=wb;var zb=this.stream.allLoaded?Math.abs(this.$PhotoSnowlift1)-this.stream.getLength():null;if(this.$PhotoSnowlifta&&this.$PhotoSnowlifto){if(!this.$PhotoSnowliftn.end&&zb===0){this.$PhotoSnowliftn.end=this.stream.getCursor();}else if(zb===-1)oa.fetch(this.$PhotoSnowlifto,this.stream);if(!this.onExtraSlide){if(this.stream.getCursor()===this.$PhotoSnowliftn.end&&yb===this.$PhotoSnowliftn.start){this.showPivotSlide(this.$PhotoSnowlifto,xb);return;}else if(this.stream.getCursor()===this.$PhotoSnowliftn.start&&yb===this.$PhotoSnowliftn.end)this.showPivotSlide(this.$PhotoSnowlifto,xb);}else{this.hidePivotSlide();if(yb!==this.$PhotoSnowliftn.start)return;}}var ac=this.getVideoOnStage();if(ac)this.switchVideo(ac,false);if(this.pivots&&this.pivots.page(wb))return;l.inform('PhotoSnowlift.PAGE');za.hide();this.recacheData();this.stream.moveCursor(wb);o.hide(this.image);if(wb!==0){this.storyID=null;this.$PhotoSnowlift5();}if(wb!==0&&this.$PhotoSnowlift2)this.$PhotoSnowliftq();if(this.stream.errorInCurrent()){this.setLoadingState(vb.STATE_HTML,true);o.show(this.errorBox);return;}this.movementDelta+=wb;var bc=this.stream.getCurrentImageData();if(bc){var cc=this.getImageURL(bc);if(cc){if(!this.$PhotoSnowlift2&&this.$PhotoSnowlifts())this.$PhotoSnowliftw();this.switchImage(cc,null,true);}else if(bc.video)this.switchVideo(bc.video,true);if(!xb){this.replaceUrl=true;qb(bc.info.permalink);}this.setLoadingState(vb.STATE_IMAGE_DATA,false);}else{this.setLoadingState(vb.STATE_IMAGE_PIXELS,true);this.setLoadingState(vb.STATE_IMAGE_DATA,true);}if(this.stream.getCurrentHtml()){this.swapData();}else this.setLoadingState(vb.STATE_HTML,true);this.disableAds=!this.isLoggedInViewer||this.stream.isInViewAsMode();this.loadAds();this.setLeftAndRightPagersState();if(this.$PhotoSnowliftu){o.addClass(this.root,'slideshowStarted');}else if(this.slideshowAvailable)o.addClass(this.root,'slideshowAvailable');if(!this.$PhotoSnowlifta&&this.$PhotoSnowlift9&&this.$PhotoSnowlifto)if(zb===-1){oa.fetch(this.$PhotoSnowlifto,this.stream);}else if(zb===0){sa.logSuggestMorePhotos();this.showMorePhotos(this.$PhotoSnowlifto,true);this.showPagers();this.$PhotoSnowlift1=0;}else{this.hideMorePhotos();this.hidePagers();}};vb.prototype.showMorePhotos=function(wb,xb){"use strict";if(this.$PhotoSnowliftx)return;this.$PhotoSnowliftx=true;if(!this.searchPivot)this.searchPivot=this.overlay.appendChild(document.createElement('div'));o.addClass(this.stageWrapper,"_5ymv");this.searchPivotComponent=ua.render(ua.createElement(na,{className:"_27g",fbid:wb,onclose:this.hideMorePhotos.bind(this),endofalbum:xb||false,withBackground:true}),this.searchPivot);};vb.prototype.hideMorePhotos=function(){"use strict";if(this.searchPivotComponent&&this.$PhotoSnowliftx){this.$PhotoSnowliftx=false;o.removeClass(this.stageWrapper,"_5ymv");this.searchPivotComponent.setProps({fbid:null});}};vb.prototype.showPivotSlide=function(wb,xb){"use strict";if(this.onExtraSlide)return;this.onExtraSlide=true;o.addClass(this.stageWrapper,"_3tvf");if(!this.pivotSlide){this.pivotSlide=q.create('div');q.insertBefore(this.stageActions,this.pivotSlide);}this.pivotSlideComponent=ua.render(ua.createElement(ma,{fbid:wb,isAlbum:this.$PhotoSnowliftz,albumOwnerName:this.$PhotoSnowliftA,visible:true,onReturn:this.returnToBeginning.bind(this,xb)}),this.pivotSlide);};vb.prototype.hidePivotSlide=function(){"use strict";if(this.pivotSlideComponent&&this.onExtraSlide){this.pivotSlideComponent.setProps({visible:false});o.removeClass(this.stageWrapper,"_3tvf");}this.onExtraSlide=false;};vb.prototype.returnToBeginning=function(wb){"use strict";var xb=this.stream.getRelativeMovement(this.$PhotoSnowliftn.start);this.page(xb,wb);};vb.prototype.logImpressionDetailsForPhoto=function(){"use strict";var wb=[].concat(q.scry(hb('fbPhotoSnowliftTagList'),'input.photoImpressionDetails'),q.scry(hb('fbPhotoSnowliftFeedback'),'input.photoImpressionDetails'));if(wb.length===0)return;var xb={};for(var yb=0;yb<wb.length;yb++)xb[wb[yb].name]=wb[yb].value;if(this.getVideoOnStage()){xb.width=0;xb.height=0;}else{var zb=this.getImageDimensions(this.stream.getCurrentImageData());xb.width=zb.x;xb.height=zb.y;}la.addDetailData(this.stream.getCursor(),xb);pa.setIsLogAdData(true);};vb.prototype.loadAds=function(){"use strict";if(this.disableAds)return;pa.loadAdsFromUserActivity();};vb.prototype.transitionHandler=function(wb){"use strict";if(wb.getQueryData().closeTheater||wb.getQueryData().permPage||this.returningToStart){if(this.isOpen)this.close();this.transitionHandlerRegistered=false;return false;}if(this.replaceUrl){this.replaceUrl=false;this.$PhotoSnowlifte.push(wb.getQualifiedURI().toString());ga.transitionComplete(true);return true;}var xb=this.$PhotoSnowlifte.length;if(xb>=2&&this.$PhotoSnowlifte[xb-2]==wb.getQualifiedURI().toString())this.$PhotoSnowlifte.pop();var yb=this.stream.getCursorForURI(wb.getUnqualifiedURI().toString());if(yb){var zb=this.stream.getRelativeMovement(yb);this.page(zb,true);ga.transitionComplete(false);return true;}if(this.isOpen){ga.transitionComplete(true);this.close();return true;}this.transitionHandlerRegistered=false;return false;};vb.prototype.recacheData=function(){"use strict";if(!this.loadingStates.html){var wb=this.stream.getCurrentHtml();for(var xb in wb){wb[xb]=kb(hb(xb).childNodes);q.empty(hb(xb));}}};vb.prototype.reloadIfTimeout=function(){"use strict";if(!x.hasLoaded(this.image)){var wb=this.makeNewImage(this.image.src,true);t.listen(wb,'load',this.useImage.bind(this,wb,null,true));this.$PhotoSnowlift3(wb.src);}};vb.prototype.useImage=function(wb,xb,yb){"use strict";if(yb&&x.hasLoaded(this.image))return;q.replace(this.image,wb);this.image=wb;this.adjustStageSize(xb);};vb.prototype.makeNewImage=function(wb,xb){"use strict";if(this.imageLoadingTimer){clearTimeout(this.imageLoadingTimer);this.imageLoadingTimer=null;}else if(!xb)this.imageRefreshTimer=setTimeout(this.reloadIfTimeout.bind(this),vb.LOADING_TIMEOUT);var yb=q.create('img',{className:'spotlight',alt:''});yb.setAttribute('aria-describedby','fbPhotosSnowliftCaption');yb.setAttribute('aria-busy','true');var zb=function(){clearTimeout(this.imageRefreshTimer);this.image.setAttribute('aria-busy','false');this.setLoadingState(this.STATE_IMAGE_PIXELS,false);setTimeout((function(){if(this.isOpen){this.adjustStageSize();this.adjustForNewData();}}).bind(this),0);}.bind(this);t.listen(yb,'load',zb);this.$PhotoSnowlift3(wb);yb.src=wb;return yb;};vb.prototype.switchImage=function(wb,xb,yb){"use strict";o.hide(this.image);o.hide(this.errorBox);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);var zb=this.stream&&this.stream.getCurrentImageData();if(zb){la.addPhotoView(zb.info,this.shouldShowHiRes(zb),this.fullscreen&&w.isFullScreen());if(this.$PhotoSnowlift8){var ac=this.stream.getCurrentExtraData();if(ac)sa.logImageImpression('snowlift',String(this.stream.getCursor()),Object.keys(ac.tagRects));}}this.useImage(this.makeNewImage(wb,false),xb,false);if(yb)this.stream.preloadImages(this.shouldShowHiRes.bind(this));if(!this.$PhotoSnowlift2&&this.$PhotoSnowlifts(zb)){la.addPanoramaImpression();var bc=new fb(this.stage.clientWidth,this.stage.clientHeight);this.$PhotoSnowliftB(bc);}else if(this.$PhotoSnowliftb)o.hide(this.showZoomInButton);if(this.$PhotoSnowlift2){this.switchIntoZoomedImage();this.showPagers(vb.PAGER_FADE);}l.inform('PhotoSnowlift.SWITCH_IMAGE');};vb.prototype.$PhotoSnowliftc=function(){"use strict";if(!this.$PhotoSnowliftb)return;if(this.$PhotoSnowlifts()){var wb=new fb(this.stage.clientWidth,this.stage.clientHeight);this.$PhotoSnowliftB(wb);}else o.hide(this.showZoomInButton);};vb.prototype.$PhotoSnowliftB=function(wb){"use strict";var xb=parseInt(this.image.style.height,10),yb=(wb.y-xb)/2;if(yb>=vb.ZOOM_BUTTON_TOP_PAD+vb.ZOOM_BUTTON_BOT_PAD+vb.ZOOM_BUTTON_HEIGHT){var zb=yb-vb.ZOOM_BUTTON_HEIGHT-vb.ZOOM_BUTTON_TOP_PAD;ya.set(this.showZoomInButton,'bottom',zb+'px');}else ya.set(this.showZoomInButton,'bottom','60px');o.show(this.showZoomInButton);};vb.prototype.$PhotoSnowlifts=function(wb){"use strict";if(wb===(void 0))wb=this.stream&&this.stream.getCurrentImageData();if(!this.$PhotoSnowliftb||!wb||!wb.originalDimensions)return false;var xb=new fb(this.stage.clientWidth,this.stage.clientHeight),yb=wb.originalDimensions,zb=yb.x/yb.y,ac=Math.min(xb.y*zb,yb.x);if(!isNaN(zb)&&zb>2&&yb.y>vb.MIN_PANORAMA_Y&&xb.x*vb.MIN_PANO_TO_STAGE_RATIO<ac){return true;}else return false;};vb.prototype.$PhotoSnowliftw=function(){"use strict";this.$PhotoSnowlift2=true;o.hide(this.showZoomInButton);o.hide(this.stageActions);o.show(this.showZoomOutButton);ya.set(this.stage,'overflow','hidden');this.spotlight.disableBehavior(ba);this.collapseRHC();};vb.prototype.$PhotoSnowliftq=function(){"use strict";if(!this.$PhotoSnowliftb)return;this.$PhotoSnowlift2=false;this.spotlight.enableBehavior(ba);ya.set(this.stage,'overflow','visible');o.hide(this.showZoomInButton);o.hide(this.showZoomOutButton);o.hide(this.zoomedImage);o.hide(this.outerImageSlider);o.show(this.stageActions);this.uncollapseRHC();};vb.prototype.switchIntoZoomedImage=function(wb){"use strict";this.$PhotoSnowliftw();o.hide(this.zoomedImage);o.hide(this.outerImageSlider);var xb=this.stream.getCurrentImageData(),yb=xb.originalDimensions;this.zoomedImage.src=xb.url;this.adjustStageSize(yb);this.$PhotoSnowliftC(new fb(parseInt(ya.get(this.zoomedImage,'width'),10),parseInt(ya.get(this.zoomedImage,'height'),10)));o.hide(this.image);};vb.prototype.$PhotoSnowliftD=function(wb){"use strict";var xb=this.stage.clientWidth,yb=Math.min(100,(xb/wb.x)*100);ya.set(this.innerImageSlider,'width',yb+'%');return yb;};vb.prototype.$PhotoSnowliftE=function(wb){"use strict";var xb=vb.MAX_SLIDER_HEIGHT*this.stage.clientHeight/wb.y,yb=vb.MAX_SLIDER_WIDTH*this.stage.clientWidth/wb.x,zb=Math.min(xb,yb);return new fb(100*wb.x*zb/this.stage.clientWidth,100*wb.y*zb/this.stage.clientHeight);};vb.prototype.$PhotoSnowliftC=function(wb){"use strict";this.$PhotoSnowliftt(this.$PhotoSnowliftr);var xb=this.$PhotoSnowliftE(wb);ya.set(this.outerImageSlider,'width',xb.x+'%');ya.set(this.outerImageSlider,'height',xb.y+'%');ya.set(this.outerImageSlider,'left',(50-xb.x/2)+'%');ya.set(this.showZoomOutButton,'bottom',xb.y*this.stage.clientHeight/100+parseInt(ya.get(this.outerImageSlider,'bottom'),10)+20+'px');o.show(this.zoomedImage);o.show(this.outerImageSlider);};vb.prototype.$PhotoSnowliftj=function(event){"use strict";if(!this.$PhotoSnowlift2)return;o.addClass(this.stage,'showSlider');if(this.$PhotoSnowliftF)this.$PhotoSnowliftF.remove();var wb=false,xb=event.getTarget();if(ha.byClass(xb,"_10zv")){this.startSliderMargins=new fb(parseFloat(ya.get(this.innerImageSlider,'marginLeft')),parseFloat(ya.get(this.innerImageSlider,'marginTop')));this.startImageMargins=null;this.mouseDownStartPosition=new fb(event.clientX,event.clientY);}else if(ha.byClass(xb,"_10zx")){this.startSliderMargins=new fb(parseInt(ya.get(this.innerImageSlider,'marginLeft'),10),parseInt(ya.get(this.innerImageSlider,'marginTop'),10));this.startImageMargins=null;var yb=parseInt(ya.get(this.innerImageSlider,'width'),10);this.mouseDownStartPosition=new fb(this.innerImageSlider.getBoundingClientRect().left+yb/2,event.clientY);wb=true;}else if(ha.byClass(xb,"_10zw")){this.startImageMargins=new fb(parseInt(ya.get(this.zoomedImage,'marginLeft'),10),parseInt(ya.get(this.zoomedImage,'marginTop'),10));this.startSliderMargins=null;this.mouseDownStartPosition=new fb(event.clientX,event.clientY);}this.$PhotoSnowliftF=t.listen(this.stage,'mousemove',this.$PhotoSnowliftG.bind(this));if(wb){this.$PhotoSnowliftG(event);}else event.kill();};vb.prototype.$PhotoSnowliftk=function(event){"use strict";if(this.$PhotoSnowliftF){o.removeClass(this.stage,'showSlider');this.$PhotoSnowliftF.remove();this.$PhotoSnowliftF=null;var wb=parseFloat(ya.get(this.zoomedImage,'marginLeft')),xb=-this.zoomedImage.width+this.stage.clientWidth;this.$PhotoSnowliftr=wb/xb;}};vb.prototype.$PhotoSnowliftG=function(event){"use strict";var wb;if(this.startSliderMargins){wb=event.clientX-this.mouseDownStartPosition.x;var xb=parseFloat(ya.get(this.outerImageSlider,'width')),yb=parseFloat(ya.get(this.innerImageSlider,'width')),zb=Math.max(0,Math.min(xb-yb,this.startSliderMargins.x+wb))/xb;ya.set(this.innerImageSlider,'marginLeft',100*zb+"%");ya.set(this.zoomedImage,'marginLeft',-1*zb*this.zoomedImage.width+'px');event.kill();}else if(this.startImageMargins){wb=1.75*(this.mouseDownStartPosition.x-event.clientX);var ac=Math.min(0,Math.max(this.startImageMargins.x-wb,-this.zoomedImage.width+this.stage.clientWidth));ya.set(this.zoomedImage,'marginLeft',ac+'px');ya.set(this.innerImageSlider,'marginLeft',(-ac/this.zoomedImage.width*100)+"%");event.kill();}};vb.prototype.$PhotoSnowliftt=function(wb){"use strict";if(wb===(void 0)||wb===null)wb=.5;var xb=new fb(parseInt(ya.get(this.zoomedImage,'width'),10),parseInt(ya.get(this.zoomedImage,'height'),10));ya.set(this.innerImageSlider,'marginLeft',((100-this.$PhotoSnowliftD(xb))*wb)+'%');ya.set(this.zoomedImage,'marginLeft',((this.stage.clientWidth-xb.x)*wb)+'px');};vb.prototype.switchVideo=function(wb,xb){"use strict";this.$PhotoSnowliftp();var yb='swf_'+wb;q.empty(this.videoStage);if(xb){o.addClass(this.stageWrapper,'showVideo');var zb=this.stream.getCurrentImageData();if(this.videoPivotsGK){o.hide(this.nextPager);o.hide(this.prevPager);}var ac=zb.video_element;q.find(ac,"._ox1").style.cssText='';var bc=null;if(this.pivotsCarouselElement)bc=r.scry(this.pivotsCarouselElement,"._32_l");if(bc)bc.map(function(ec){return u.capture(ec,'click',function(){var fc=ec.getAttribute('data-fbid'),gc=this.stream.getCursor(),hc=this.stream.calculateDistance(gc,fc);this.page(hc,false);}.bind(this));}.bind(this));o.addClass(ac,'videoStageContainer');q.appendContent(this.videoStage,ac);q.appendContent(this.videoStage,this.pivotsCarouselElement);if(window[yb]&&!ob(yb))window[yb].write(wb);var cc='video_warning_'+wb,dc=ob(wb);if(!this.videoWarnings)this.videoWarnings=[];if(dc&&this.videoWarnings[cc])q.setContent(dc,this.videoWarnings[cc]);this.$PhotoSnowliftv=zb.controller;this.$PhotoSnowliftv.reset();if(this.$PhotoSnowliftH)this.$PhotoSnowliftv.play(gb.USER);if(this.$PhotoSnowliftI)this.$PhotoSnowliftv.addListener('finishPlayback',function(){var ec=zb.info.fbid.toString();if(ec===this.stream.getCursor())this.page(1,false);}.bind(this));setTimeout(this.adjustStageSizeForVideo.bind(this,wb),0);}else{window[yb]&&window[yb].addVariable('video_autoplay',0);this.videoLoadTimer&&clearTimeout(this.videoLoadTimer);o.removeClass(this.stageWrapper,'showVideo');}};vb.prototype.checkVideoStatus=function(wb){"use strict";if(this.videoLoadTimer)clearTimeout(this.videoLoadTimer);var xb=this.getVideoOnStage();if(!xb){return;}else{if(xb!==wb)return;this.adjustStageSizeForVideo(wb);}};vb.prototype.getVideoSize=function(wb){"use strict";return new fb(wb.getAttribute('data-video-width'),+wb.getAttribute('data-video-height')+this.getVideoComponentsHeight(wb));};vb.prototype.getVideoElement=function(wb){"use strict";return q.scry(this.videoStage,"._ox1")[0];};vb.prototype.getVideoComponentsHeight=function(wb){"use strict";var xb=0,yb=ha.byClass(wb,"_1c_u");if(!yb)return 0;var zb=q.scry(yb,"._2i84");if(zb.length){var ac=zb[0].getBoundingClientRect();xb=ac.bottom-ac.top;}return xb;};vb.prototype.adjustStageSizeForVideo=function(wb){"use strict";var xb=this.getVideoElement(wb);if(!xb){this.videoLoadTimer=setTimeout(this.checkVideoStatus.bind(this,wb),200);}else this.adjustStageSize(this.getVideoSize(xb));};vb.prototype.handleServerError=function(wb,xb){"use strict";q.setContent(this.errorBox,wb);this.storeFromData(xb);};vb.prototype.fixButtonText=function(wb){"use strict";if(!this.buttonTruncateGk)return;var xb=q.scry(wb,".photosTruncatingUIButton"),yb=parseInt(ya.get(wb,'width'),10);if(yb>k){var zb={tagPhoto:"\u5199\u771f\u306b\u30bf\u30b0\u4ed8\u3051",doneTagPhoto:"\u30bf\u30b0\u4ed8\u3051\u5b8c\u4e86",addLocation:"\u4f4d\u7f6e\u60c5\u5831\u3092\u8ffd\u52a0",editPhoto:"\u7de8\u96c6"};for(var ac=0;ac<xb.length;ac++){var bc=xb[ac];o.addClass(bc,"_2n0k");ab.set(bc,zb[bc.getAttribute('data-buttonname')],'below','center');}}};vb.prototype.swapData=function(){"use strict";var wb,xb=this.stream.getCurrentHtml();if(xb){this.setLoadingState(vb.STATE_HTML,false);for(var yb in xb){wb=ob(yb);wb&&q.setContent(wb,xb[yb]);}var zb=ob('photosTruncatingUIButtonGroup');zb&&this.fixButtonText(zb);l.inform('PhotoSnowlift.DATA_CHANGE',jb(this.stream.getCurrentImageData().info,{movement:this.movementDelta}),l.BEHAVIOR_STATE);this.movementDelta=0;if(this.stream.getCurrentExtraData())l.inform('PhotoSnowlift.EXTRA_DATA_CHANGE',this.stream.getCurrentExtraData(),l.BEHAVIOR_STATE);}this.adjustScroller();this.scrollableArea.showScrollbar(false);this.adjustForNewData();this.logImpressionDetailsForPhoto();};vb.prototype.updateTotalCount=function(wb,xb,yb){"use strict";var zb=this.stream.getCurrentHtml();if(zb){var ac=hb('fbPhotoSnowliftPositionAndCount');q.replace(ac,yb);ac=yb;o.show(ac);var bc='fbPhotoSnowliftPositionAndCount';zb[bc]=kb(ac.childNodes);}this.stream.setTotalCount(wb);this.stream.setFirstCursorIndex(xb);};vb.prototype.addPhotoFbids=function(wb,xb,yb,zb){"use strict";if(zb&&this.sessionID&&zb!=this.sessionID)return;var ac=this.stream.getCursor()===null;this.stream.attachToFbidsList(wb,xb,yb);if(yb&&ac)this.page(0,true);if(this.pivots&&yb)this.pivots.setCycleCount(this.stream.calculateDistance(this.stream.getCursor(),this.stream.firstCursor));if(!this.pagersShown&&this.stream.canPage())this.setStagePagersState('ready');if(!this.slideshowAvailable&&this.stream.canPage()){this.slideshowAvailable=true;o.addClass(this.root,'slideshowAvailable');}this.setLeftAndRightPagersState();};vb.prototype.attachTagger=function(wb){"use strict";q.appendContent(this.stageActions,wb);};vb.prototype.storeFromData=function(wb){"use strict";if(!this.isOpen)return;if(wb.pivots)this.pivotsCarouselElement=wb.pivots;this.videoPivotsGK=wb.pivotsgk;if(wb.ssid&&this.sessionID&&this.sessionID!=wb.ssid)return;var xb=this.stream.storeToCache(wb);if('error' in xb){this.checkState(vb.STATE_ERROR);return;}if('init' in wb){this.$PhotoSnowlifto=wb.init.album_fbid;this.$PhotoSnowliftz=wb.init.is_album;this.$PhotoSnowliftA=wb.init.album_owner_name;this.$PhotoSnowliftH=wb.init.autoplay_videos;this.$PhotoSnowliftI=wb.init.autoplay_next_video;}if('init' in xb){this.initDataFetched(xb.init);if(this.openExplicitly){this.replaceUrl=true;qb(this.stream.getCurrentImageData().info.permalink);}if(this.stream.canPage())this.setStagePagersState('ready');this.setLeftAndRightPagersState();this.ua&&this.ua.add_event('ufi');}if('image' in xb)this.checkState(vb.STATE_IMAGE_DATA);if('data' in xb)this.checkState(vb.STATE_HTML);};vb.prototype.setLeftAndRightPagersState=function(){"use strict";if(this.stream.isNonCircularPhotoSet()){o.conditionClass(this.root,'disableLeft',!this.stream.nonCircularPhotoSetCanPage(-1));o.conditionClass(this.root,'disableRight',!this.stream.nonCircularPhotoSetCanPage(1));}if(this.snowflake){o.conditionClass(this.root,'disableLeft',this.stream.getCursor()==this.firstInSet);var wb=this.stream.getCursorAt(this.stream.calculatePositionForMovement(1));o.conditionClass(this.root,'disableRight',wb==this.firstInSet);}};vb.prototype.setStagePagersState=function(wb){"use strict";switch(wb){case 'ready':o.addClass(this.root,'pagingReady');this.pagersShown=true;this.ua&&this.ua.add_event('arrows');return;case 'active':o.addClass(this.root,'pagingActivated');return;case 'inactive':o.removeClass(this.root,'pagingActivated');return;case 'disabled':case 'reset':o.removeClass(this.root,'pagingReady');return;}};vb.prototype.deletePhoto=function(wb){"use strict";this.closeRefresh();};vb.prototype.closeRefresh=function(){"use strict";this.refreshOnClose=true;this.spotlight.hide();};vb.prototype.onHiliteTag=function(wb,xb){"use strict";if(xb.version!=ka.VIEWER_SNOWLIFT)return;var yb=xb.tag;if(yb)this.switchHilitedTags(yb,true);};vb.prototype.onUpdateTagBox=function(wb,xb){"use strict";if(xb.version==ka.VIEWER_SNOWLIFT)this.updateTagBox(xb.id,xb.approve);};vb.prototype.$PhotoSnowlift3=function(wb){"use strict";if(this.$PhotoSnowlift6){this.$PhotoSnowlift7&&this.$PhotoSnowlift7.log(wb);return true;}return false;};vb.prototype.$PhotoSnowlifth=function(){"use strict";this.$PhotoSnowlifty=false;};vb.prototype.$PhotoSnowlifti=function(event){"use strict";if(this.$PhotoSnowlifty)event.kill();};vb.prototype.isReturningToStart=function(){"use strict";return !!this.returningToStart;};vb.prototype.$PhotoSnowliftp=function(){"use strict";if(this.$PhotoSnowliftv)this.$PhotoSnowliftv.logStopForUnload();};vb.getInstance=function(){"use strict";if(!vb.$PhotoSnowliftJ)vb.$PhotoSnowliftJ=new vb();return vb.$PhotoSnowliftJ;};vb.initWithSpotlight=function(wb,xb){"use strict";vb.getInstance().init(wb,xb);};vb.addPhotoFbids=function(wb,xb,yb,zb){"use strict";vb.getInstance().addPhotoFbids(wb,xb,yb,zb);};vb.setReachedLeftEnd=function(){"use strict";vb.getInstance().setReachedLeftEnd();};vb.setReachedRightEnd=function(){"use strict";vb.getInstance().setReachedRightEnd();};vb.attachFollowFlyout=function(wb){"use strict";q.insertAfter(hb('fbPhotoSnowliftSubscribe'),wb);};vb.attachSubscribeFlyout=function(wb){"use strict";q.insertAfter(hb('fbPhotoSnowliftSubscribe'),wb);};vb.attachTagger=function(wb){"use strict";vb.getInstance().attachTagger(wb);};vb.preload=function(wb,xb){"use strict";vb.getInstance().preload(wb,xb);};vb.bootstrap=function(wb,xb){"use strict";var yb=wb&&db(wb).getQueryData();if(yb&&yb.hasOwnProperty('share_id')){n.loadModules(["SpotlightShareViewer"],function(zb){zb.bootstrap(wb,xb);});return;}vb.getInstance().bootstrap(wb,xb);};vb.closeRefresh=function(){"use strict";vb.getInstance().closeRefresh();};vb.deletePhoto=function(wb){"use strict";vb.getInstance().deletePhoto(wb);};vb.getImage=function(){"use strict";return vb.getInstance().getImage();};vb.getImageId=function(){"use strict";return vb.getInstance().getImageId();};vb.getLoadQuery=function(){"use strict";return vb.getInstance().getLoadQuery();};vb.getRHCBody=function(){"use strict";return vb.getInstance().getRHCBody();};vb.getRHCFooter=function(){"use strict";return vb.getInstance().getRHCFooter();};vb.getRHCHeader=function(){"use strict";return vb.getInstance().getRHCHeader();};vb.getRoot=function(){"use strict";return vb.getInstance().getRoot();};vb.likePhotoSkipConfirmation=function(wb){"use strict";vb.getInstance().likePhotoSkipConfirmation(wb);};vb.saveTagsFromPayload=function(wb){"use strict";vb.getInstance().saveTagsFromPayload(wb);};vb.saveTagsFromPayloadDelayed=function(wb){"use strict";setTimeout(vb.saveTagsFromPayload.bind(null,wb),2000);};vb.handleServerError=function(wb,xb){"use strict";vb.getInstance().handleServerError(wb,xb);};vb.setVideoWarning=function(wb,xb){"use strict";var yb=vb.getInstance(),zb='video_warning_'+wb;if(!yb.videoWarnings)yb.videoWarnings=[];yb.videoWarnings[zb]=xb;};vb.storeFromData=function(wb){"use strict";vb.getInstance().storeFromData(wb);};vb.swapData=function(){"use strict";vb.getInstance().swapData();};vb.updateTotalCount=function(wb,xb,yb){"use strict";vb.getInstance().updateTotalCount(wb,xb,yb);};vb.setVideoRotateURI=function(wb){"use strict";vb.getInstance().videoRotateURI=wb;};jb(vb,{STATE_ERROR:'error',STATE_HTML:'html',STATE_IMAGE_PIXELS:'image_pixels',STATE_IMAGE_DATA:'image',LOADING_TIMEOUT:2000,PAGER_FADE:3000,FULL_SCREEN_PADDING:10,STAGE_NORMAL_MAX:{x:960,y:960},STAGE_MIN:{x:520,y:520},SIDEBAR_SIZE_MAX:360,MIN_PANORAMA_Y:240,ZOOM_BUTTON_HEIGHT:52,ZOOM_BUTTON_BOT_PAD:60,ZOOM_BUTTON_TOP_PAD:16,MAX_SLIDER_HEIGHT:.075,MAX_SLIDER_WIDTH:.75,MIN_PANO_TO_STAGE_RATIO:1.2,STAGE_CHROME:{x:82,y:42},VIDEO_BOTTOM_BAR_SPACE:40,GOPREV_AREA:120,TIMELINE_STRETCH_WIDTH:843,TIMELINE_STRETCH_MIN:480,MIN_TAG_DISTANCE:83,PADDING_MIN:40,MIN_UFI_HEIGHT:250,COLLECTIONS_UNTAGGED_PHOTOS:3,PHOTOS_OF_YOU_SUGGESTIONS:28,FRIENDS_IN_PHOTOS_SUGGESTIONS:31,MIN_ADS_VISIBLE:1,PINNED_UFI_ADJUSTMENT:11,ADD_COMMENT_HEIGHT:54,SLIDESHOW_TIME:3000,_instance:null,touch:nb,touchMarkup:nb});});(function(){var g=74,h=75,i=70,j=76,k=315,l='Arbiter',m='AsyncRequest',n='Bootloader',o='CSS',p='Dialog',q='DOM',r='DOMQuery',s='DOMControl',t='Event',u='EventListener',v='fbt',w='FullScreen',x='ImageUtils',y='Input',z='Keys',aa='Layer',ba='LayerHideOnEscape',ca='LikeConfirmer',da='LinkController',ea='LitestandStoryInsertionStatus',fa='Locale',ga='PageTransitions',ha='Parent',ia='PhotoLogger',ja='PhotoPermalinkURI',ka='PhotosConst',la='PhotoSessionLog',ma='PhotosetPivotSlide.react',na='PhotosetSearchPivot.react',oa='PhotosetSearchPivotData',pa='PhotoSnowliftAds',qa='PhotoStreamCache',ra='PhotosUtils',sa='PhotoTagSearchPivotLogger',ta='PhotoViewer',ua='React',va='Rect',wa='ScriptPath',xa='ScrollableArea',ya='Style',za='Toggler',ab='Tooltip',bb='UFIFeedbackTargets',cb='UIPagelet',db='URI',eb='UserAgent_DEPRECATED',fb='Vector',gb='VideoPlayerReason',hb='$',ib='computeRelativeURI',jb='copyProperties',kb='createArrayFromMixed',lb='csx',mb='cx',nb='emptyFunction',ob='ge',pb='getActiveElement',qb='goURI',rb='invariant',sb='userAction';for(var tb in ta)if(ta.hasOwnProperty(tb))vb[tb]=ta[tb];var ub=ta===null?null:ta.prototype;vb.prototype=Object.create(ub);vb.prototype.constructor=vb;vb.__superConstructor__=ta;function vb(){"use strict";ta.call(this);this.$PhotoSnowlift0={};this.$PhotoSnowlift1=0;this.$PhotoSnowlift2=false;this.clearAlbumBoundaries();}vb.prototype.preload=function(wb,xb){"use strict";n.loadModules(["PhotoTagger","Live","PhotoTagApproval","PhotoTags","TagTokenizer","css:fb-photos-snowlift-fullscreen-css"],function(zb){this.PhotoTagger=zb;}.bind(this));var yb=this.getImageSrc(db(wb).getQueryData());if(yb)if(!this.$PhotoSnowlift3(yb))(new Image()).src=yb;};vb.prototype.bootstrap=function(wb,xb){"use strict";this.preload(wb,xb);if(this.closeDirty){setTimeout(this.bootstrap.bind(this,wb,xb),0);return;}pa.reset();this.resetUriStack=true;if(this.isOpen)if(this.openExplicitly){this.closeCleanup();this.resetUriStack=false;}else return;this.$PhotoSnowlift4=null;var yb=ha.byAttribute(xb,'data-cursor');if(yb){try{var ac=JSON.parse(yb.getAttribute('data-ft'));this.$PhotoSnowlift4={qid:ac.qid,mf_story_key:ac.mf_story_key};}catch(zb){}}else try{yb=ha.byAttribute(xb,'data-ad');var bc=JSON.parse(yb.getAttribute('data-ad'));this.$PhotoSnowlift4={ad_id:bc.adid};}catch(zb){}this.ua=sb('snowlift',xb).uai('open');wa.openOverlayView('snowlift');this.returningToStart=false;this.loading&&o.removeClass(this.loading,'loading');if(xb){o.addClass((this.loading=xb),'loading');var cc=ha.byClass(xb,'uiStreamStory')||ha.byClass(xb,"_5jmm");if(cc){this.storyID=cc.id;}else{var dc=ha.byClass(xb,"_5b9c");if(dc)this.storyID=dc.getAttribute('data-ownerid');}this.$PhotoSnowlift5();this.getThumbAndSize(xb);}else this.loading=null;l.inform('PhotoSnowlift.GO',wb,l.BEHAVIOR_STATE);this.loadFrameIfUninitialized();};vb.prototype.$PhotoSnowlift5=function(){"use strict";if(this.container)if(this.storyID){this.container.setAttribute('data-ownerid',this.storyID);}else this.container.removeAttribute('data-ownerid');};vb.prototype.setupFromSnowflake=function(wb,xb){"use strict";this.extraClasses=wb;this.snowflake=true;this.firstInSet=xb;if(this.root){o.addClass(this.root,"snowflake");this.extraClasses.forEach(function(yb){o.addClass(this.root,yb);},this);}};vb.prototype.getCurrentImageServerSizeDimensions=function(){"use strict";var wb=this.stream.getCurrentImageData();return wb.originalDimensions||wb.dimensions;};vb.prototype.getEventPrefix=function(){"use strict";return 'PhotoSnowlift';};vb.prototype.getRoot=function(){"use strict";return this.root;};vb.prototype.getSourceString=function(){"use strict";return 'snowlift';};vb.prototype.getViewerSource=function(){"use strict";return this.source;};vb.prototype.getViewerSet=function(){"use strict";return this.stream.getPhotoSet();};vb.prototype.getVersionConst=function(){"use strict";return ka.VIEWER_SNOWLIFT;};vb.prototype.getImage=function(){"use strict";return this.image;};vb.prototype.getImageId=function(){"use strict";return this.stream.getCursor();};vb.prototype.getRHCHeader=function(){"use strict";return this.rhcHeader;};vb.prototype.getRHCBody=function(){"use strict";return this.ufiForm;};vb.prototype.getRHCFooter=function(){"use strict";return this.rhcFooter;};vb.prototype.getLoadQuery=function(){"use strict";return this.loadQuery;};vb.prototype.getCurrentPhotoInfo=function(){"use strict";var wb=this.stream.getCurrentImageData();if(wb)return wb.info;return null;};vb.prototype.getOwnerId=function(){"use strict";var wb=this.stream.getCurrentImageData();if(wb)return wb.info.owner;return null;};vb.prototype.getThumbAndSize=function(wb){"use strict";this.currentImageSize=null;this.thumbSrc=null;var xb=db(wb.getAttribute('ajaxify')).getQueryData();if(!xb.size)return;var yb=fb.deserialize(xb.size);if(!yb.x||!yb.y)return;this.currentImageSize=yb;if(wb.getAttribute('data-cropped'))return;var zb=q.scry(wb,'img')[0],ac=q.scry(wb,'i')[0],bc=ha.byAttribute(wb,'data-size');this.shouldStretch=bc&&this.currentImageSize&&zb&&bc.getAttribute('data-size')==="2"&&this.currentImageSize.x>this.currentImageSize.y&&this.currentImageSize.x<=vb.TIMELINE_STRETCH_WIDTH&&zb.offsetWidth===vb.TIMELINE_STRETCH_WIDTH;var cc;if(zb){cc=zb.src;}else if(ac){cc=ya.get(ac,'backgroundImage').replace(/.*url\("?([^"]*)"?\).*/,'$1');}else return;this.thumbSrc=cc;};vb.prototype.loadFrameIfUninitialized=function(){"use strict";if(this.root)return;new m('/ajax/photos/snowlift/init.php').setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();};vb.prototype.init=function(wb,xb){"use strict";this.init=nb;this.$PhotoSnowlift6=xb.photos_client_loading;this.$PhotoSnowlift7=null;if(this.$PhotoSnowlift6)this.$PhotoSnowlift7=new ia(ka.VIEWER_SNOWLIFT_STRING);this.$PhotoSnowlift8=xb.pivot_hover;this.$PhotoSnowlift9=xb.show_more_photos;this.$PhotoSnowlifta=xb.extra_slide_pivot;la.setEndMetrics(xb.pivot_end_metric);this.startingMousePos=null;this.haveLeftBufferRegion=false;this.showingTypeaheadSuggestions=false;this.fullscreen=w.isSupported();this.showOGVideos=xb.og_videos;this.resizeCommentsForAds=xb.resize_comments_for_ads;this.spotlight=wb;this.spotlight.subscribe('blur',function(){this.closingAction=la.OUTSIDE;}.bind(this));this.spotlight.subscribe('hide',this.closeHandler.bind(this));this.spotlight.subscribe('key',this.keyHandler.bind(this));this.initializeNodes(this.spotlight.getRoot());pa.init(this.sideAdUnit,this,xb,this.adsDisplayedCallback.bind(this));this.inAdsDisplayedCallback=false;this.lastAdsHeight=0;if(!this.subscription){da.registerHandler(this.handleNavigateAway.bind(this));this.subscription=l.subscribe('PhotoSnowlift.GO',function(yb,zb){this.openExplicitly=true;this.loading&&o.removeClass(this.loading,'loading');this.open(zb);}.bind(this));}this.transitionHandlerRegistered=false;this.returningToStart=false;ga.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;l.subscribe('PhotoTagApproval.HILITE_TAG',this.onHiliteTag.bind(this));l.subscribe('PhotoTagApproval.UPDATE_TAG_BOX',this.onUpdateTagBox.bind(this));if(this.fullscreen)w.subscribe('changed',this.onFullScreenChange.bind(this));this.slideshowGk=xb.snowlift_slideshow;this.buttonTruncateGk=xb.snowlift_button_truncate;this.$PhotoSnowliftb=this.$PhotoSnowliftb&&xb.www_panorama_viewer;this.allowIrrelevantRequests=!!xb.snowlift_allow_irrelevant_requests;if(this.snowflake){o.addClass(this.root,"snowflake");this.extraClasses.forEach(function(yb){o.addClass(this.root,yb);},this);}};vb.prototype.onFullScreenChange=function(){"use strict";if(!this.isOpen)return;var wb=w.isFullScreen();o.conditionClass(document.body,'fbPhotoSnowliftFullScreenMode',wb);if(wb){if(!o.hasClass(this.root,'fbPhotoSnowliftEditMode'))this.collapseRHC();var xb=this.stream.getCurrentImageData();if(xb&&xb.url&&this.image.src!==xb.url&&this.shouldShowHiRes(xb))this.switchImage(xb.url);this.adjustForResize();if(!this.$PhotoSnowlift2)this.$PhotoSnowliftc();}else{if(!this.$PhotoSnowlift2)this.uncollapseRHC();if(eb.chrome()&&!o.hasClass(this.root,'fbPhotoSnowliftEditMode'))this.page(0,false);l.inform('reflow');}za.hide();};vb.prototype.initializeNodes=function(wb){"use strict";this.root=wb;this.container=q.find(wb,'div.fbPhotoSnowliftContainer');this.$PhotoSnowlift5();this.snowliftPopup=q.find(this.container,'div.fbPhotoSnowliftPopup');this.rhc=q.find(this.snowliftPopup,'div.rhc');this.rhcHeader=q.find(this.rhc,'div.rhcHeader');this.rhcFooter=q.find(this.rhc,'div.rhcFooter');this.ufiForm=q.find(this.rhc,'form.fbPhotosSnowliftFeedbackForm');this.ufiInputContainer=q.find(this.rhc,'div.fbPhotosSnowboxFeedbackInput');this.scroller=q.find(this.ufiForm,'div.rhcScroller');this.scrollerBody=q.find(this.scroller,'div.uiScrollableAreaBody');this.stageWrapper=q.find(this.snowliftPopup,'div.stageWrapper');this.overlay=q.find(this.snowliftPopup,'div.snowliftOverlay');this.errorBox=q.find(this.stageWrapper,'div.stageError');this.image=q.find(this.stageWrapper,'img.spotlight');this.stage=q.find(this.stageWrapper,'div.stage');this.showZoomInButton=q.scry(this.stageWrapper,"._5qmg").pop();this.showZoomOutButton=q.scry(this.stageWrapper,"._5qmh").pop();this.zoomedImage=q.scry(this.stage,"._10zw").pop();this.outerImageSlider=q.scry(this.stage,"._10zx").pop();this.innerImageSlider=q.scry(this.stage,"._10zv").pop();this.$PhotoSnowliftb=this.showZoomInButton&&this.showZoomOutButton&&this.zoomedImage&&this.outerImageSlider&&this.innerImageSlider;if(this.$PhotoSnowliftb){o.hide(this.showZoomInButton);o.hide(this.showZoomOutButton);o.hide(this.zoomedImage);o.hide(this.outerImageSlider);}this.videoStage=q.find(this.stageWrapper,'div.videoStage');this.prevPager=q.find(this.snowliftPopup,'a.snowliftPager.prev');this.nextPager=q.find(this.snowliftPopup,'a.snowliftPager.next');this.stageActions=q.find(wb,'div.stageActions');this.buttonActions=q.find(this.stageActions,'div.fbPhotosPhotoButtons');this.placeInfo=q.find(this.rhc,'div.fbPhotosSnowliftPlaceInfo');this.sideAdUnit=q.find(wb,"._5ciw");o.conditionClass(this.root,'fullScreenAvailable',this.fullscreen);};vb.prototype.initializeScroller=function(){"use strict";this.initializeScroller=nb;this.scrollableArea=xa.fromNative(this.scroller,{fade:true,persistent:true});var wb=function(event){var xb=t.$E(event).getTarget();if(q.contains(this.ufiInputContainer,xb)){var yb=s.getInstance(xb);if(yb){this.scrollableArea.scrollToBottom();var zb=yb.subscribe('resize',function(){var bc=this.scrollableArea.isScrolledToBottom();this.adjustScroller();bc&&this.scrollableArea.scrollToBottom();}.bind(this)),ac=t.listen(xb,'blur',function(){yb.unsubscribe(zb);ac.remove();});}}}.bind(this);l.subscribe('ufi/inputHeightChanged',function(xb,yb){if(q.contains(this.ufiInputContainer,yb.node))this.adjustScroller();}.bind(this));l.subscribe('ufi/addCommentFacepileRendered',function(){this.adjustScroller();}.bind(this));l.subscribe('ufi/changed',function(xb,yb){if(this.ufiForm===yb.form)this.adjustScrollerIfNecessary();}.bind(this));l.subscribe('ufi/comment',function(xb,yb){if(this.ufiForm===yb.form){this.adjustScrollerIfNecessary();if(yb.isranked){this.scrollableArea.scrollToTop();}else this.scrollableArea.scrollToBottom();}}.bind(this));t.listen(this.rhc,'click',function(event){var xb=event.getTarget();if(ha.byTag(xb,'a')||ha.byTag(xb,'button')||q.isNodeOfType(xb,'input'))this.adjustScrollerIfNecessary();}.bind(this));l.subscribe(['reflow','CommentUFI.Pager'],function(){if(this.isOpen)this.adjustScrollerIfNecessary();}.bind(this));t.listen(this.ufiForm,'focusin',wb);};vb.prototype.openHandler=function(wb){"use strict";if(this.isOpen||!ja.isValid(wb)||this.returningToStart||wb.getQueryData().closeTheater||wb.getQueryData().permPage){this.openHandlerRegistered=false;return false;}this.open(wb);this.$PhotoSnowlifte.push(db(wb).getQualifiedURI().toString());ga.transitionComplete(true);return true;};vb.prototype.getImageSrc=function(wb){"use strict";if(wb.smallsrc){if(!wb.size)return wb.smallsrc;var xb=fb.deserialize(wb.size),yb=this.getStageSize(xb);yb=this.$PhotoSnowliftf(yb);if(yb.x<=vb.STAGE_NORMAL_MAX.x&&yb.y<=vb.STAGE_NORMAL_MAX.y)return wb.smallsrc;}return wb.src;};vb.prototype.open=function(wb){"use strict";var xb=db(wb),yb=xb.getQueryData(),zb=ja.parse(xb);if(zb!==null){yb.fbid=zb.photo_id;yb.set=zb.set_token;}var ac=this.getImageSrc(yb);if(ac){delete yb.src;delete yb.smallsrc;}if(this.resetUriStack)this.$PhotoSnowlifte=[];if(!this.initialLoad){yb.firstLoad=true;this.initialLoad=true;ea.registerBlocker(function(){return this.isOpen;}.bind(this));}this.sessionID=Date.now();this.loadQuery=jb(yb,{ssid:this.sessionID});if(this.$PhotoSnowlift4)this.loadQuery.data_ft=this.$PhotoSnowlift4;this.isOpen=true;this.pagersShown=false;this.refreshOnClose=false;this.hilitedTag=null;this.loadingStates={image:false,html:false};this.replaceUrl=false;this.movementDelta=0;this.pivotsCarouselElement=null;this.videoPivotsGK=false;o.show(this.nextPager);o.show(this.prevPager);this.source=null;this.saveTagSubscription=l.subscribe('PhotoTagger.SAVE_TAG',this.onTagSaved.bind(this));this.taggedPhotoIds=[];this.stream=new qa();this.stream.init(ka.VIEWER_SNOWLIFT,'PhotoViewerPagelet','pagelet_photo_viewer',this.$PhotoSnowlift6?this.$PhotoSnowlift7:null,yb.tagSuggestionMode||'everyone');if(!!db.getMostRecentURI().getQueryData().viewas)this.stream.setViewAs(db.getMostRecentURI().getQueryData().viewas+'');this.fetchInitialData();this.setLoadingState(vb.STATE_HTML,true);this.rhcCollapsed=false;this.$PhotoSnowliftg(wb,ac);n.loadModules(["PhotosButtonTooltips"],function(bc){bc.init();});};vb.prototype.$PhotoSnowliftg=function(wb,xb){"use strict";this.createLoader(xb);this.spotlight.show();this.ua&&this.ua.add_event('frame');l.inform('layer_shown',{type:'PhotoSnowlift'});l.inform('PhotoSnowlift.OPEN');this.stageHandlers=[t.listen(window,'resize',this.adjustForResize.bind(this)),t.listen(this.stageWrapper,'click',this.buttonListener.bind(this)),t.listen(this.stageWrapper,'mouseleave',function(event){var ac=event.getTarget();if(!(ha.byClass(ac,'snowliftOverlay')||ha.byClass(ac,'fbPhotoSnowliftTagApproval')||ha.byClass(ac,'tagPointer')||ha.byClass(ac,'arrow')||ha.byClass(ac,'faceboxSuggestion')||ha.byClass(ac,'typeaheadWrapper')||ha.byClass(ac,'photoTagTypeahead')||ha.byClass(ac,'fbPhotoTagger')))this.unhiliteAllTags();this.hidePagers();}.bind(this)),t.listen(this.stageWrapper,'mousemove',this.hilitePager.bind(this)),t.listen(this.stageWrapper,'mousemove',this.hiliteTagsOnMouseMove.bind(this)),t.listen(this.overlay,'mouseenter',this.unhiliteAllTags.bind(this)),t.listen(this.container,'mousemove',this.$PhotoSnowlifth.bind(this)),t.listen(this.container,'mouseover',this.$PhotoSnowlifti.bind(this)),t.listen(this.stageWrapper,'focusin',this.hilitePager.bind(this)),t.listen(this.rhc,'focusin',this.hidePagers.bind(this))];if(this.$PhotoSnowliftb){this.stageHandlers.push(t.listen(this.stage,'mousedown',this.$PhotoSnowliftj.bind(this)));this.stageHandlers.push(t.listen(this.root,'mouseup',this.$PhotoSnowliftk.bind(this)));}this.stageHandlers.push(t.listen(this.container,'click',function(event){var ac=event.getTarget();if(ha.byClass(ac,'rotateRight')){this.rotate('right');}else if(ha.byClass(ac,'rotateLeft')){this.rotate('left');}else if(ha.byClass(ac,'closeTheater')){if(w.isFullScreen()){w.toggleFullScreen();return;}this.closingAction=la.X;this.spotlight.hide();return false;}else if(this.fullscreen)if(ha.byClass(ac,'fbPhotoSnowliftFullScreen')){this.toggleFullScreen();}else if(ha.byClass(ac,'fbPhotoSnowliftCollapse'))this.toggleCollapse();}.bind(this)));var yb=ob('fbPhotoSnowliftFeedback');if(yb)this.stageHandlers.push(t.listen(yb,'click',function(event){var ac=event.getTarget();if(ha.byClass(ac,'like_link')||(ha.byClass(ac,'UFILikeLink')&&ha.byClass(ac,'UIActionLinks')))this.toggleLikeButton();var bc=ha.byClass(event.getTarget(),'uiUfiCollapsedComment');if(bc)o.addClass(bc,'uiUfiCollapsedCommentToggle');}.bind(this)));var zb=ob('fbPhotoSnowliftOnProfile');if(zb)this.stageHandlers.push(t.listen(zb,'click',function(event){if(ha.byClass(event.getTarget(),'fbPhotoRemoveFromProfileLink'))this.refreshOnClose=true;}.bind(this)));if(this.resetUriStack)this.startingURI=db.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI();if(!xb)this.setLoadingState(vb.STATE_IMAGE_DATA,true);if(!this.transitionHandlerRegistered){ga.registerHandler(this.transitionHandler.bind(this));this.transitionHandlerRegistered=true;}la.initLogging(la.SNOWLIFT);if(this.pivots)la.setRelevantCount(this.pivots.relevantCount);};vb.prototype.toggleFullScreen=function(){"use strict";var wb=w.toggleFullScreen(document.documentElement);if(wb){var xb=this.stream.getCurrentImageData();if(xb&&xb.url&&this.image.src!==xb.url&&this.shouldShowHiRes(xb))if(!this.$PhotoSnowlift3(xb.url))(new Image()).src=xb.url;la.logEnterFullScreen(this.stream.getCursor());}};vb.prototype.getStream=function(){"use strict";return this.stream;};vb.prototype.fetchInitialData=function(){"use strict";this.ua&&this.ua.add_event('init_data');this.stream.waitForInitData();cb.loadFromEndpoint('PhotoViewerInitPagelet',ob('pagelet_photo_viewer_init',this.root),this.loadQuery,{actorID:bb.getActorIDForFeedbackTargetIfExists(this.loadQuery.fbid),usePipe:true,jsNonblock:true,crossPage:true,allowIrrelevantRequests:this.allowIrrelevantRequests});};vb.prototype.toggleCollapse=function(){"use strict";if(this.rhcCollapsed){this.uncollapseRHC();}else this.collapseRHC();};vb.prototype.collapseRHC=function(){"use strict";this.rhcCollapsed=true;o.addClass(this.root,'collapseRHC');this.adjustForResize();};vb.prototype.uncollapseRHC=function(){"use strict";this.rhcCollapsed=false;o.removeClass(this.root,'collapseRHC');this.adjustForResize();};vb.prototype.closeHandler=function(){"use strict";if(!this.isOpen)return;this.closingAction=this.closingAction||la.ESC;if(db.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI().toString()==this.startingURI.toString()){this.close();return;}this.returnToStartingURI(this.refreshOnClose);this.close();};vb.prototype.returnToStartingURI=function(wb,xb){"use strict";if(!wb)if(xb){this.squashNextTransition(qb.bind(null,xb));}else this.squashNextTransition();this.returningToStart=true;var yb=l.subscribe('page_transition',(function(){this.returningToStart=false;yb.unsubscribe();}).bind(this)),zb=wb||isNaN(eb.opera()),ac=this.$PhotoSnowlifte.length;if(zb&&ac<window.history.length){window.history.go(-ac);}else{var bc=this.startingURI,cc=new db(bc).removeQueryData('closeTheater');if(bc.getQueryData().sk=='approve'&&bc.getPath()=='/profile.php'){cc.removeQueryData('highlight');cc.removeQueryData('notif_t');}qb(cc);}};vb.prototype.squashNextTransition=function(wb){"use strict";this.squashNext=true;ga.registerHandler(function xb(){if(this.squashNext){this.squashNext=false;if(wb)setTimeout(wb,0);ga.transitionComplete(true);return true;}return false;}.bind(this),7);};vb.prototype.handleNavigateAway=function(wb){"use strict";var xb=ib(ga.$PhotoSnowliftl.getQualifiedURI(),wb.getAttribute('href'));if(this.isOpen&&(xb instanceof db)&&xb.getUnqualifiedURI().toString()!=this.startingURI.toString()&&xb.getPath()!='/photo.php'){if(!this.closingAction)this.closingAction=la.NAVIGATE;this.returnToStartingURI(false,xb);this.close();return false;}return true;};vb.prototype.postProcessTaggedPhotos=function(){"use strict";if(this.taggedPhotoIds&&this.taggedPhotoIds.length>0){var wb=null;if(this.source===vb.COLLECTIONS_UNTAGGED_PHOTOS){wb='/ajax/photos/photo/edit/skiptag/';}else if(this.source===vb.PHOTOS_OF_YOU_SUGGESTIONS||this.source===vb.FRIENDS_IN_PHOTOS_SUGGESTIONS)wb='/ajax/photos/photo/add_to_star_grid/';if(wb)new m().setURI(wb).setAllowCrossPageTransition(true).setData({media_id:this.taggedPhotoIds,source:this.source}).send();}};vb.prototype.onTagSaved=function(wb,xb){"use strict";if(this.taggedPhotoIds){if(this.source===vb.PHOTOS_OF_YOU_SUGGESTIONS&&!xb.self_tag)return;this.taggedPhotoIds.push(xb.photo_fbid);}};vb.prototype.clearAlbumBoundaries=function(){"use strict";this.$PhotoSnowliftn={start:0,end:0};};vb.prototype.close=function(){"use strict";if(!this.isOpen)return;this.$PhotoSnowlifto=null;this.hideMorePhotos();this.hidePivotSlide();this.$PhotoSnowliftp();this.isOpen=false;this.$PhotoSnowlift1=0;this.clearAlbumBoundaries();if(this.fullscreen)w.disableFullScreen();sb('snowlift').uai('close');wa.closeOverlayView('snowlift');this.spotlight.hide();this.openExplicitly=false;this.postProcessTaggedPhotos();l.unsubscribe(this.saveTagSubscription);this.taggedPhotoIds=[];this.closeDirty=true;setTimeout(this.closeCleanup.bind(this),0);if(this.snowflake){o.removeClass(this.root,"snowflake");this.extraClasses.forEach(function(wb){o.removeClass(this.root,wb);},this);}this.extraClasses=[];this.snowflake=false;this.firstInSet=null;this.movementDelta=0;};vb.prototype.closeCleanup=function(){"use strict";this.closeDirty=false;o.removeClass(this.root,'dataLoading');la.logPhotoViews(this.closingAction);this.destroy();o.hide(this.errorBox);o.hide(this.image);this.currentImageSize=null;this.thumbSrc=null;this.shouldStretch=false;this.resetUriStack=true;var wb=this.stream.getCursor();o.removeClass(this.stageWrapper,'showVideo');q.empty(this.videoStage);this.uncollapseRHC();this.currentMinSize=null;this.setStagePagersState('reset');this.recacheData();q.empty(this.sideAdUnit);this.stream.destroy();this.root.setAttribute('aria-busy','true');var xb=this.closingAction===la.NAVIGATE;this.closingAction=null;if(!this.openHandlerRegistered){ga.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;}l.inform('layer_hidden',{type:'PhotoSnowlift'});l.inform('PhotoSnowlift.CLOSE',{is_navigating:xb,fbid:wb});this.$PhotoSnowliftq();this.$PhotoSnowliftr=null;};vb.prototype.createLoader=function(wb){"use strict";if(this.currentImageSize===null){this.adjustStageSize(vb.STAGE_MIN);}else{var xb=this.getStageSize(this.currentImageSize);xb=new fb(Math.max(xb.x,vb.STAGE_MIN.x),Math.max(xb.y,vb.STAGE_MIN.y));var yb=this.getImageSizeInStage(this.currentImageSize,xb);if(this.thumbSrc===null){this.adjustStageSize(yb);}else this.useImage(q.create('img',{className:'spotlight',alt:'',src:this.thumbSrc,style:{width:yb.x+'px',height:yb.y+'px'}}),yb,false);}this.setLoadingState(this.STATE_IMAGE_PIXELS,true);if(wb)setTimeout((function(){var zb=new Image(),ac=function(){if(!this.isOpen)return;if(!this.stream||!this.stream.errorInCurrent()){this.switchImage(wb,this.currentImageSize);this.ua&&this.ua.add_event('image');this.setLoadingState(vb.STATE_IMAGE_DATA,false);}}.bind(this),bc=t.listen(zb,'load',ac),cc=function(){if(bc){bc.remove();bc=null;}};l.subscribeOnce('PhotoSnowlift.SWITCH_IMAGE',cc);l.subscribeOnce('PhotoSnowlift.CLOSE',cc);this.$PhotoSnowlift3(wb);zb.src=wb;}).bind(this),0);o.hide(this.stageActions);this.setStagePagersState('disabled');};vb.prototype.initDataFetched=function(wb){"use strict";la.setPhotoSet(this.stream.getPhotoSet());la.setLogFbids(wb.logids);this.$PhotoSnowliftn.start=this.stream.getCursor();var xb=this.stream.getCurrentImageData();la.addPhotoView(xb.info,this.shouldShowHiRes(xb),this.fullscreen&&w.isFullScreen());var yb=this.stream.getCurrentExtraData();if(this.$PhotoSnowlift8&&yb)sa.logImageImpression('snowlift',String(this.stream.getCursor()),Object.keys(yb.tagRects));if(yb&&yb.source!==(void 0)){this.source=parseInt(yb.source,10);la.setSource(this.source);}if(!this.pageHandlers)this.pageHandlers=[t.listen(this.root,'click',this.pageListener.bind(this)),t.listen(this.root,'mouseleave',this.mouseLeaveListener.bind(this))];o.show(this.stageActions);this.root.setAttribute('aria-busy','false');this.isLoggedInViewer=wb.loggedin;this.disableAds=!this.isLoggedInViewer||wb.fromad||this.stream.isInViewAsMode();this.loadAds();if(this.$PhotoSnowlifts(xb)){la.addPanoramaImpression();this.switchIntoZoomedImage();}else if(this.$PhotoSnowliftb)o.hide(this.showZoomInButton);};vb.prototype.adjustScrollerIfNecessary=function(){"use strict";clearTimeout(this.scrollerTimeout);this.scrollerTimeout=setTimeout(this.adjustScroller.bind(this),0);};vb.prototype.adjustScroller=function(wb){"use strict";clearTimeout(this.scrollerTimeout);this.initializeScroller();this.scrollableArea.resize();var xb=fb.getElementDimensions(this.rhc),yb=xb.y;yb-=fb.getElementDimensions(this.rhcHeader).y;yb-=fb.getElementDimensions(this.ufiInputContainer).y;if(this.placeInfo){var zb=fb.getElementDimensions(this.placeInfo);yb-=zb.y;ya.set(this.sideAdUnit,'bottom',zb.y+'px');}if(wb==null)wb=this.resizeCommentsForAds?this.lastAdsHeight:0;this.lastAdsHeight=wb;yb=Math.max(0,yb);var ac=fb.getElementDimensions(this.scrollerBody).y,bc=Math.max(vb.MIN_UFI_HEIGHT,yb-wb);if(ac>=bc){if(yb>bc){o.removeClass(this.rhc,'pinnedUfi');yb-=bc;}else{o.addClass(this.rhc,'pinnedUfi');yb=0;}ya.set(this.scroller,'height',bc+'px');}else{ya.set(this.scroller,'height','auto');o.removeClass(this.rhc,'pinnedUfi');yb-=ac;}var cc=fb.getElementDimensions(this.ufiInputContainer).y;ya.set(this.ufiForm,'padding-bottom',cc+'px');pa.resize(new fb(xb.x,yb));this.scrollableArea.adjustGripper();};vb.prototype.adjustForResize=function(){"use strict";this.currentMinSize=null;this.adjustStageSize();this.adjustForNewData();if(this.$PhotoSnowliftb){if(!this.$PhotoSnowlift2)this.$PhotoSnowliftc();this.$PhotoSnowliftt(this.$PhotoSnowliftr);}};vb.prototype.shouldShowHiRes=function(wb){"use strict";if(!wb||!wb.smallurl)return false;var xb=this.getStageSize(wb.dimensions);xb=this.$PhotoSnowliftf(xb);var yb=this.getImageSizeInStage(wb.dimensions,xb);return (yb.x>vb.STAGE_NORMAL_MAX.x||yb.y>vb.STAGE_NORMAL_MAX.y);};vb.prototype.$PhotoSnowliftf=function(wb){"use strict";if(window.devicePixelRatio&&window.devicePixelRatio>1)wb=new fb(wb.x*window.devicePixelRatio,wb.y*window.devicePixelRatio);return wb;};vb.prototype.getImageURL=function(wb){"use strict";if(wb.video){return null;}else if(wb.smallurl&&!this.shouldShowHiRes(wb))return wb.smallurl;return wb.url;};vb.prototype.getImageOrVideoDimensions=function(wb){"use strict";if(wb.video){var xb=this.getVideoElement(wb.video);if(xb)return this.getVideoSize(xb);}return this.getImageDimensions(wb);};vb.prototype.getImageDimensions=function(wb){"use strict";if(this.$PhotoSnowlift2)return wb.originalDimensions;if(wb.smalldims&&(!this.shouldShowHiRes(wb)||this.image.src===wb.smallurl))return wb.smalldims;return wb.dimensions;};vb.prototype.getStageSize=function(wb,xb){"use strict";var yb=fb.getViewportDimensions(),zb=new fb(wb.x,wb.y+this.getExtraVerticalSpace());if(xb)zb=new fb(Math.max(wb.x,xb.x),Math.max(wb.y,xb.y));var ac,bc;if(this.fullscreen&&w.isFullScreen()){return new fb((this.rhcCollapsed?screen.width:screen.width-vb.SIDEBAR_SIZE_MAX),screen.height-vb.FULL_SCREEN_PADDING*2);}else{ac=Math.min(zb.x,(yb.x-vb.SIDEBAR_SIZE_MAX-vb.STAGE_CHROME.x));bc=Math.min(zb.y,yb.y-vb.STAGE_CHROME.y);}if(ac===0&&bc===0)return new fb(0,0);var cc=ac/bc,dc=zb.x/zb.y;if(cc<dc)return new fb(ac,Math.round(ac/dc));return new fb(Math.round(bc*dc),bc);};vb.prototype.getExtraVerticalSpace=function(){"use strict";if(this.getVideoOnStage())return vb.VIDEO_BOTTOM_BAR_SPACE*2;return 0;};vb.prototype.getComponentsHeight=function(){"use strict";var wb=this.getVideoOnStage();if(wb)return this.getVideoComponentsHeight(ob(wb));return 0;};vb.prototype.getImageSizeInStage=function(wb,xb){"use strict";var yb=wb.x,zb=wb.y,ac=this.getComponentsHeight(),bc=this.getExtraVerticalSpace();zb-=ac;xb=new fb(xb.x,xb.y-ac-bc);if(yb>=xb.x||zb>=xb.y){var cc=xb.x/xb.y,dc=yb/zb;if(cc<dc){yb=xb.x;zb=Math.round(yb/dc);}else if(cc>dc){zb=xb.y;yb=Math.round(zb*dc);}else{yb=xb.x;zb=xb.y;}}return new fb(yb,zb+ac);};vb.prototype.getStageSizeForZoomedImage=function(wb,xb){"use strict";if(this.fullscreen&&w.isFullScreen()){var yb=this.rhcCollapsed?screen.width:screen.width-vb.SIDEBAR_SIZE_MAX,zb=screen.height-vb.FULL_SCREEN_PADDING*2;return new fb(yb,zb);}var ac=fb.getViewportDimensions();if(xb===null)xb=new fb(0,0);var bc=new fb(Math.max(wb.x,vb.STAGE_MIN.x,xb.x),Math.max(wb.y,vb.STAGE_MIN.y,xb.y)),cc=ac.x-vb.STAGE_CHROME.x;if(!this.rhcCollapsed)cc-=vb.SIDEBAR_SIZE_MAX;yb=Math.min(bc.x,cc);zb=Math.min(bc.y,ac.y-vb.STAGE_CHROME.y);return new fb(yb,zb);};vb.prototype.adjustStageSize=function(wb){"use strict";var xb=this.currentImageSize;if(wb){xb=wb;}else{var yb=this.stream&&this.stream.getCurrentImageData();if(yb)xb=this.getImageOrVideoDimensions(yb);}if(!xb)return;this.currentImageSize=xb;var zb=this.getExtraVerticalSpace();if(this.shouldStretch&&!this.getVideoOnStage()&&xb.x>xb.y&&xb.x<=vb.TIMELINE_STRETCH_WIDTH&&xb.x>=vb.TIMELINE_STRETCH_MIN){xb.y=Math.round(xb.y*vb.TIMELINE_STRETCH_WIDTH/xb.x);xb.x=vb.TIMELINE_STRETCH_WIDTH;}var ac;if(this.$PhotoSnowlift2){ac=this.getStageSizeForZoomedImage(xb,this.currentMinSize);}else ac=this.getStageSize(xb,this.currentMinSize);if(!this.currentMinSize)this.currentMinSize=new fb(0,0);this.currentMinSize=new fb(Math.max(ac.x,vb.STAGE_MIN.x,this.currentMinSize.x),Math.max(ac.y,vb.STAGE_MIN.y,this.currentMinSize.y));var bc=this.getImageSizeInStage(xb,this.currentMinSize),cc=this.currentMinSize.x-bc.x,dc=this.currentMinSize.y-bc.y;if(cc>0&&cc<vb.PADDING_MIN){this.currentMinSize.x-=cc;}else if(dc>0&&dc<vb.PADDING_MIN)this.currentMinSize.y-=dc;var ec=this.currentMinSize.x+vb.SIDEBAR_SIZE_MAX;if(this.rhcCollapsed)ec=this.currentMinSize.x;var fc=this.getVideoOnStage()&&this.pivotsCarouselElement,gc=0,hc=this.currentMinSize.y;if(fc){var ic=this.pivotsCarouselElement.clientHeight;gc=Math.ceil(ic/100)*100;hc=hc+gc;}this.snowliftPopup.style.cssText='width:'+ec+'px;'+'height:'+hc+'px;';var jc=this.currentMinSize.y-zb,kc=jc+gc;if(eb.firefox()){var lc=ya.get(this.stageWrapper,'font-size');jc=(jc/parseFloat(lc))+'em';kc=(kc/parseFloat(lc))+'em';}else{jc=jc+'px';kc=kc+'px';}this.stageWrapper.style.cssText='width:'+this.currentMinSize.x+'px;'+'line-height:'+jc+';';if(this.getVideoOnStage())this.videoStage.style.cssText='width:'+this.currentMinSize.x+'px;'+'height:'+kc+';';if(this.$PhotoSnowlift2){var mc=this.currentMinSize.y-zb;if(xb.y>mc){var nc=(xb.x/xb.y)*mc;ya.apply(this.zoomedImage,{width:nc+"px",height:mc+"px"});}else ya.apply(this.zoomedImage,{width:xb.x+"px",height:xb.y+"px"});}else{bc.y-=this.getComponentsHeight();this.setMediaElementSize(bc);}if(fc)this.setPivotCarouselElementWidth(lc);var oc=this.getTagger();if(oc)oc.repositionTagger();this.adjustScrollerIfNecessary();};vb.prototype.setMediaElementSize=function(wb){"use strict";var xb=this.image;if(this.getVideoOnStage())xb=q.scry(this.videoStage,"._53j5")[0]||xb;xb.style.cssText='width:'+wb.x+'px;'+'height:'+wb.y+'px;';};vb.prototype.setPivotCarouselElementWidth=function(wb){"use strict";var xb=this.videoStage.clientWidth;if(eb.firefox()){xb=(xb/parseFloat(wb))+'em';}else xb=xb+'px';this.pivotsCarouselElement.style.width=xb;};vb.prototype.adjustForNewData=function(){"use strict";if(!this.image)return;var wb=q.scry(this.stage,'div.tagsWrapper')[0],xb=fb.getElementDimensions(this.image);if(wb){ya.set(wb,'width',xb.x+'px');ya.set(wb,'height',xb.y+'px');}};vb.prototype.adsDisplayedCallback=function(wb,xb){"use strict";var yb=this.resizeCommentsForAds&&!this.inAdsDisplayedCallback&&!this.disableAds&&wb<vb.MIN_ADS_VISIBLE&&xb.length>=vb.MIN_ADS_VISIBLE;if(yb){this.inAdsDisplayedCallback=true;var zb=xb[vb.MIN_ADS_VISIBLE-1];this.adjustScroller(zb);this.inAdsDisplayedCallback=false;}};vb.prototype.setLoadingState=function(wb,xb){"use strict";switch(wb){case vb.STATE_IMAGE_PIXELS:o.conditionClass(this.root,'imagePixelsLoading',xb);break;case vb.STATE_IMAGE_DATA:this.loadingStates[wb]=xb;o.conditionClass(this.root,'imageLoading',xb);break;case vb.STATE_HTML:this.loadingStates[wb]=xb;o.conditionClass(this.root,'dataLoading',xb);this.rhc.setAttribute('aria-busy',xb?'true':'false');break;}};vb.prototype.destroy=function(){"use strict";this.stageHandlers.forEach(function(wb){wb.remove();});if(this.pageHandlers){this.pageHandlers.forEach(function(wb){wb.remove();});this.pageHandlers=null;}this.$PhotoSnowliftu&&clearInterval(this.$PhotoSnowliftu);this.$PhotoSnowliftu=null;this.$PhotoSnowliftv=null;};vb.prototype.checkState=function(wb){"use strict";if(wb!=vb.STATE_ERROR&&!this.loadingStates[wb])return;switch(wb){case vb.STATE_IMAGE_DATA:var xb=this.stream.getCurrentImageData();if(xb){var yb=this.getImageURL(xb);if(yb){if(!this.$PhotoSnowlift2&&this.$PhotoSnowlifts())this.$PhotoSnowliftw();this.switchImage(yb,null,true);}else if(xb.video)this.switchVideo(xb.video,true);this.setLoadingState(wb,false);}break;case vb.STATE_HTML:if(this.stream.getCurrentHtml()){this.swapData();this.setLoadingState(wb,false);}break;default:if(this.stream.errorInCurrent()){o.hide(this.image);o.show(this.errorBox);}break;}};vb.prototype.buttonListener=function(event){"use strict";var wb=event.getTarget(),xb=Date.now();if(ha.byClass(wb,"_5qmg")){la.addPanoramaClick();this.switchIntoZoomedImage();return;}if(ha.byClass(wb,"_5qmh")){this.$PhotoSnowliftq();this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));return false;}if(ha.byClass(wb,'fbPhotoTagApprovalBox'))return;if(xb-this.lastPage<350)return;if(ha.byClass(wb,'fbPhotosPhotoLike')){this.likePhoto();}else if(ha.byClass(wb,'tagApproveIgnore')){this.updateTagBox(event,wb);}else if(ha.byClass(wb,"_5ge9")){this.hideMorePhotos();this.toggleSlideshow();return false;}else if(ha.byClass(wb,"_5ymu")){if(!this.$PhotoSnowliftx){sa.logShowMorePhotos();var yb=this.stream.getCursor();if(yb)this.showMorePhotos(String(yb));if(this.$PhotoSnowliftb)o.hide(this.showZoomInButton);}else{sa.logHideMorePhotos();this.$PhotoSnowliftc();this.hideMorePhotos();}return;}else if(ha.byClass(wb,"_27n"))this.$PhotoSnowliftc();this.hideMorePhotos();};vb.prototype.toggleSlideshow=function(){"use strict";if(!this.slideshowGk)return;if(this.$PhotoSnowliftu){this.stopSlideshow();}else this.startSlideshow();};vb.prototype.startSlideshow=function(){"use strict";this.$PhotoSnowliftu=window.setInterval(this.page.bind(this,1,eb.chrome()&&w.isFullScreen()),vb.SLIDESHOW_TIME);o.addClass(this.root,'slideshowStarted');o.removeClass(this.root,'slideshowAvailable');};vb.prototype.stopSlideshow=function(){"use strict";this.$PhotoSnowliftu&&clearInterval(this.$PhotoSnowliftu);this.$PhotoSnowliftu=null;o.addClass(this.root,'slideshowAvailable');o.removeClass(this.root,'slideshowStarted');};vb.prototype.likePhoto=function(){"use strict";la.addButtonLike();var wb=hb('fbPhotoSnowliftFeedback'),xb=q.scry(wb,'button.like_link')[0];if(!xb)xb=q.scry(wb,'a.UFILikeLink')[0];var yb=xb.getAttribute('href');if(w.isFullScreen())if(eb.chrome())xb.setAttribute('href','javascript:;');xb.click();xb.setAttribute('href',yb);};vb.prototype.toggleLikeButton=function(){"use strict";var wb=q.scry(this.buttonActions,'a.fbPhotosPhotoLike')[0];if(wb){var xb=q.find(this.root,'.likeCount'),yb=q.find(xb,'.likeCountNum');if(xb)if(o.hasClass(wb,'viewerLikesThis')){q.setContent(yb,parseInt(yb.textContent,10)-1);}else q.setContent(yb,parseInt(yb.textContent,10)+1);o.toggleClass(wb,'viewerLikesThis');o.removeClass(wb,'viewerAlreadyLikedThis');}};vb.prototype.likePhotoWithKey=function(){"use strict";return ca.like(this.likePhoto.bind(this),pb());};vb.prototype.updateTagBox=function(wb,xb){"use strict";this.unhiliteAllTags();var yb=ob(wb);if(!yb)return;o.addClass(yb,'tagBox');o.addClass(yb,'tagBoxPendingResponse');o.removeClass(yb,'tagBoxPending');o.hide(q.find(yb,'span.tagForm'));if(xb){o.show(q.find(yb,'span.tagApproved'));}else o.show(q.find(yb,'span.tagIgnored'));};vb.prototype.rotate=function(wb){"use strict";var xb=this.stream.getCursor();if(this.getVideoOnStage()){var yb=(wb=='left')?270:90;rb(!!this.videoRotateURI);n.loadModules(["VideoRotate"],function(ac){new ac(xb,this.videoRotateURI).motionRotate(yb);}.bind(this));return;}var zb=jb({fbid:xb,opaquecursor:this.stream.getOpaqueCursor(xb),cs_ver:ka.VIEWER_SNOWLIFT},this.stream.getPhotoSetQuery());zb[wb]=1;this.setLoadingState(vb.STATE_IMAGE_DATA,true);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);o.hide(this.image);new m('/ajax/photos/photo/rotate/').setAllowCrossPageTransition(true).setData(zb).setErrorHandler(this.rotationError.bind(this,xb)).setFinallyHandler(this.rotationComplete.bind(this,xb)).setMethod('POST').setReadOnly(false).send();};vb.prototype.rotationComplete=function(wb,xb){"use strict";if(wb==this.stream.getCursor()){this.setLoadingState(vb.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));this.swapData();}};vb.prototype.rotationError=function(wb,xb){"use strict";if(wb==this.stream.getCursor()){this.setLoadingState(vb.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));n.loadModules(["AsyncResponse"],function(yb){yb.defaultErrorHandler(xb);});}};vb.prototype.saveTagsFromPayload=function(wb){"use strict";this.storeFromData(wb);if('data' in wb&&this.stream.getCursor() in wb.data)this.swapData();};vb.prototype.saveEdit=function(){"use strict";if(!o.hasClass(this.root,'fbPhotoSnowliftEditMode'))return;n.loadModules(["PhotoInlineEditor","Form"],function(wb,xb){var yb=wb.getInstance(this.getViewerConst());yb&&xb.bootstrap(yb.getForm().controller);}.bind(this));};vb.prototype.mouseLeaveListener=function(event){"use strict";this.unhiliteAllTags();this.reHilitePendingTag();};vb.prototype.hilitePager=function(event){"use strict";var wb=fb.getEventPosition(event),xb=fb.getElementPosition(this.stage);if(fa.isRTL()){var yb=fb.getElementDimensions(this.stage);this.stagePagerPrev=yb.x-(wb.x-xb.x)<vb.GOPREV_AREA;}else this.stagePagerPrev=wb.x-xb.x<vb.GOPREV_AREA;o.conditionClass(this.prevPager,'hilightPager',this.stagePagerPrev);o.conditionClass(this.nextPager,'hilightPager',!this.stagePagerPrev);var zb,ac=event.getTarget();if(!ha.byClass(ac,'snowliftOverlay')&&!ha.byClass(ac,'bottomBarActions')&&!ha.byClass(ac,'snowliftPager'))zb=vb.PAGER_FADE;this.showPagers(zb);};vb.prototype.showPagers=function(wb){"use strict";clearTimeout(this.fadePagerTimer);this.setStagePagersState('active');if(wb===(void 0))this.fadePagerTimer=setTimeout(this.hidePagers.bind(this),wb);};vb.prototype.hidePagers=function(){"use strict";var wb=q.scry(this.getRoot(),'.fbPhotosPhotoActionsMenu')[0];if(wb)return;clearTimeout(this.fadePagerTimer);this.setStagePagersState('inactive');};vb.prototype.getTagger=function(){"use strict";return (this.PhotoTagger&&this.PhotoTagger.getInstance(ka.VIEWER_SNOWLIFT));};vb.prototype.unhiliteAllTags=function(){"use strict";clearTimeout(this.unhiliteTimer);q.scry(this.stage,'div.tagsWrapper div.hover').forEach(function(xb){o.removeClass(xb,'hover');});q.scry(this.stage,'div.tagsWrapper div.otherActive').forEach(function(xb){o.removeClass(xb,'otherActive');});this.hilitedTag=null;this.showingTypeaheadSuggestions=false;if(!o.hasClass(this.root,'taggingMode')){var wb=this.getTagger();if(wb){wb.hideTagger();wb.setCurrentFacebox(null);}}};vb.prototype.switchHilitedTags=function(wb,xb){"use strict";if(this.switchTimer!==null){clearTimeout(this.switchTimer);this.switchTimer=null;}this.unhiliteAllTags();this.hiliteAllBoxes();var yb=ob(wb);if(yb){this.hilitedTag=wb;if(!o.hasClass(this.root,'taggingMode')&&ra.isFacebox(this.hilitedTag)){var zb=this.getTagger();if(zb){o.addClass(yb,'hover');var ac=zb.getFacebox(wb);zb.setCurrentFacebox(ac);if(ac)zb.addTagFromFacebox(ac);}}else o.addClass(yb,'hover');if(o.hasClass(yb,'tagBoxPending')&&!o.hasClass(yb,'showPendingTagName')&&xb===true){q.scry(this.stage,'div.tagsWrapper div.showPendingTagName').forEach(function(bc){o.removeClass(bc,'showPendingTagName');});o.addClass(yb,'showPendingTagName');}}};vb.prototype.reHilitePendingTag=function(){"use strict";var wb=ob(this.hilitedTag);if(wb&&o.hasClass(wb,'showPendingTagName'))return;var xb=q.scry(this.stage,'div.tagsWrapper div.showPendingTagName')[0];if(xb)this.switchHilitedTags(xb.id);};vb.prototype.hiliteTagsOnMouseMove=function(event){"use strict";if(!this.stream.getCurrentExtraData()||this.getVideoOnStage())return;if(this.switchTimer!==null)return;var wb=event.getTarget();if(ha.byClass(wb,'snowliftOverlay')||ha.byClass(wb,'fbPhotoSnowliftTagApproval')||ha.byClass(wb,'tagPointer')||ha.byClass(wb,'arrow')||ha.byClass(wb,'faceboxSuggestion')||ha.byClass(wb,'typeaheadWrapper')||ha.byClass(wb,'photoTagTypeahead'))return;var xb=ha.byClass(wb,'tagBoxPending'),yb=false;if(this.hilitedTag){var zb=ob(this.hilitedTag);yb=zb&&o.hasClass(zb,'tagBoxPending');}var ac=((!this.hilitedTag&&xb)||(!yb&&xb));if(ac){this.switchHilitedTags(xb.id);return;}if(xb&&(xb.id==this.hilitedTag))return;var bc=250,cc=15,dc=fb.getEventPosition(event);if(!this.startingMousePos)this.startingMousePos=dc;var ec=ra.absoluteToNormalizedPosition(this.image,dc);if(!this.haveLeftBufferRegion&&this.startingMousePos.distanceTo(dc)<cc){return;}else this.haveLeftBufferRegion=true;if(this.currentTagHasPrecedence(ec))return;var fc=ra.getNearestBox(this.stream.getCurrentExtraData().tagRects,ec);if(!fc){if(!yb){this.unhiliteAllTags();this.reHilitePendingTag();}return;}var gc=null;if(yb){var hc={};hc[this.hilitedTag]=this.stream.getCurrentExtraData().tagRects[this.hilitedTag];gc=ra.getNearestBox(hc,ec);}if(gc!==null&&yb)return;if(this.hilitedTag!=fc)if(yb){this.switchTimer=setTimeout(this.switchHilitedTags.bind(this,fc),bc);}else{if(this.$PhotoSnowlift8&&!this.$PhotoSnowlift0[fc]){this.$PhotoSnowlift0[fc]=true;sa.logPivotImpression('snowlift',fc);}this.switchHilitedTags(fc);}};vb.prototype.currentTagHasPrecedence=function(wb){"use strict";if(!this.hilitedTag)return false;if(this.stream.getCurrentExtraData().tagRects[this.hilitedTag]===(void 0)){this.hilitedTag=null;return false;}var xb=this.stream.getCurrentExtraData().tagRects[this.hilitedTag],yb=new va(xb.t+(xb.h()/2),xb.r,xb.b+(ra.isFacebox(this.hilitedTag)?10:0),xb.l,xb.domain);return yb.contains(wb);};vb.prototype.getVideoOnStage=function(){"use strict";var wb=this.stream&&this.stream.getCurrentImageData();return wb&&wb.video;};vb.prototype.shouldPageOnAction=function(wb,xb){"use strict";if(!this.isOpen||ca.isShowingConfirmation())return false;var yb=q.isNode(xb)&&(ha.byClass(xb,'snowliftPager')||ha.byClass(xb,'stagePagers')||ha.byClass(xb,'pivotPageColumn')),zb=q.isNode(xb)&&ha.byClass(xb,'stage'),ac=o.hasClass(xb,'faceBox'),bc=(!o.hasClass(this.root,'taggingMode')&&ac&&!yb);if(bc){if(!this.showingTypeaheadSuggestions){this.getTagger().updateWithSuggestions();setTimeout((function(){q.find(this.getTagger().tagger,'input.textInput').focus();}).bind(this),0);}this.showingTypeaheadSuggestions=!this.showingTypeaheadSuggestions;return false;}var cc=((zb&&o.hasClass(this.root,'taggingMode'))||ha.byClass(xb,'tagBoxPending')||ha.byClass(xb,'tagBoxPendingResponse')||ha.byClass(xb,'fbPhotoTagApprovalBox')||ha.byClass(xb,'tag'));if(cc)return false;if(zb&&this.$PhotoSnowlift2)zb=false;return wb==z.LEFT||wb==z.RIGHT||wb==g||wb==h||yb||bc||zb;};vb.prototype.keyHandler=function(wb,event){"use strict";if(event.getModifiers().any||aa.getTopmostLayer()!==this.spotlight)return true;switch(t.getKeyCode(event)){case z.LEFT:case z.RIGHT:case g:case h:this.pageListener(event);return false;case i:return this.toggleFullScreen();case j:return this.likePhotoWithKey();case z.SPACE:this.toggleSlideshow();this.showPagers(vb.PAGER_FADE);return false;case z.ESC:if(this.$PhotoSnowlift2){this.$PhotoSnowliftq();this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));return false;}break;}};vb.prototype.shouldHandlePendingTag=function(event){"use strict";var wb=this.getTagger();if(!wb||!wb.tags.length)return false;var xb=ra.absoluteToNormalizedPosition(this.getImage(),fb.getEventPosition(event)),yb=wb.findNearestTag(xb);if(!yb||!o.hasClass(yb.node,'tagBoxPending'))return false;l.inform('PhotoTagApproval.PENDING_TAG_PHOTO_CLICK',{id:yb.id,version:this.getVersionConst()});return true;};vb.prototype.pageListener=function(event){"use strict";var wb=t.getKeyCode(event),xb=event.getTarget();if(this.$PhotoSnowliftu){this.stopSlideshow();return;}if(!this.shouldPageOnAction(wb,xb))return;if(this.shouldHandlePendingTag(event))return;var yb=0;if(wb==z.RIGHT||wb==h){yb=1;la.setPagingAction('key_right');this.$PhotoSnowlifty=true;}else if(wb==z.LEFT||wb==g){yb=-1;la.setPagingAction('key_left');this.$PhotoSnowlifty=true;}else if(ha.byClass(xb,'next')){yb=1;la.setPagingAction('click_next');}else if(ha.byClass(xb,'prev')){yb=-1;la.setPagingAction('click_prev');}else if(!this.stagePagerPrev){yb=1;la.setPagingAction('click_stage');}else{yb=-1;la.setPagingAction('click_stage_back');}var zb=q.scry(this.ufiForm,'input.mentionsHidden'),ac=false;for(var bc=0;bc<zb.length;bc++)if(!y.isEmpty(zb[bc])){ac=true;break;}if(ac||o.hasClass(this.root,'fbPhotoSnowliftEditMode')){this.warnLeavePage(this.page.bind(this,yb));}else{this.page(yb,eb.chrome()&&w.isFullScreen());this.$PhotoSnowliftr=null;sb('snowlift',xb,event).uai(la.pagingAction);}};vb.prototype.warnLeavePage=function(wb){"use strict";new p().setTitle("\u3053\u306e\u30da\u30fc\u30b8\u304b\u3089\u79fb\u52d5\u3057\u307e\u3059\u304b\uff1f").setBody("\u30da\u30fc\u30b8\u304b\u3089\u79fb\u52d5\u3059\u308b\u3068\u3001\u4fdd\u5b58\u3055\u308c\u3066\u3044\u306a\u3044\u5909\u66f4\u306f\u5931\u308f\u308c\u307e\u3059\u3002").setButtons([{name:'leave_page',label:"\u79fb\u52d5\u3059\u308b",handler:wb},{name:'continue_editing',label:"\u3053\u306e\u30da\u30fc\u30b8\u304b\u3089\u79fb\u52d5\u3057\u306a\u3044",className:'inputaux'}]).setModal(true).show();};vb.prototype.getUsesOpaqueCursor=function(){"use strict";return this.stream.getUsesOpaqueCursor();};vb.prototype.getOpaqueCursor=function(wb){"use strict";return this.stream.getOpaqueCursor(wb);};vb.prototype.setReachedLeftEnd=function(){"use strict";this.stream.setReachedLeftEnd();};vb.prototype.setReachedRightEnd=function(){"use strict";this.stream.setReachedRightEnd();};vb.prototype.page=function(wb,xb){"use strict";if(!this.stream.isValidMovement(wb)||!this.stream.nonCircularPhotoSetCanPage(wb)){this.showPagers(vb.PAGER_FADE);return;}var yb=this.stream.getCursorAt(this.stream.calculatePositionForMovement(wb));if(this.snowflake&&((this.stream.getCursor()==this.firstInSet&&wb<0)||(this.firstInSet==yb&&wb>0))){this.showPagers(vb.PAGER_FADE);return;}this.lastPage=Date.now();this.unhiliteAllTags();this.startingMousePos=null;this.haveLeftBufferRegion=false;this.$PhotoSnowlift0={};this.$PhotoSnowlift1+=wb;var zb=this.stream.allLoaded?Math.abs(this.$PhotoSnowlift1)-this.stream.getLength():null;if(this.$PhotoSnowlifta&&this.$PhotoSnowlifto){if(!this.$PhotoSnowliftn.end&&zb===0){this.$PhotoSnowliftn.end=this.stream.getCursor();}else if(zb===-1)oa.fetch(this.$PhotoSnowlifto,this.stream);if(!this.onExtraSlide){if(this.stream.getCursor()===this.$PhotoSnowliftn.end&&yb===this.$PhotoSnowliftn.start){this.showPivotSlide(this.$PhotoSnowlifto,xb);return;}else if(this.stream.getCursor()===this.$PhotoSnowliftn.start&&yb===this.$PhotoSnowliftn.end)this.showPivotSlide(this.$PhotoSnowlifto,xb);}else{this.hidePivotSlide();if(yb!==this.$PhotoSnowliftn.start)return;}}var ac=this.getVideoOnStage();if(ac)this.switchVideo(ac,false);if(this.pivots&&this.pivots.page(wb))return;l.inform('PhotoSnowlift.PAGE');za.hide();this.recacheData();this.stream.moveCursor(wb);o.hide(this.image);if(wb!==0){this.storyID=null;this.$PhotoSnowlift5();}if(wb!==0&&this.$PhotoSnowlift2)this.$PhotoSnowliftq();if(this.stream.errorInCurrent()){this.setLoadingState(vb.STATE_HTML,true);o.show(this.errorBox);return;}this.movementDelta+=wb;var bc=this.stream.getCurrentImageData();if(bc){var cc=this.getImageURL(bc);if(cc){if(!this.$PhotoSnowlift2&&this.$PhotoSnowlifts())this.$PhotoSnowliftw();this.switchImage(cc,null,true);}else if(bc.video)this.switchVideo(bc.video,true);if(!xb){this.replaceUrl=true;qb(bc.info.permalink);}this.setLoadingState(vb.STATE_IMAGE_DATA,false);}else{this.setLoadingState(vb.STATE_IMAGE_PIXELS,true);this.setLoadingState(vb.STATE_IMAGE_DATA,true);}if(this.stream.getCurrentHtml()){this.swapData();}else this.setLoadingState(vb.STATE_HTML,true);this.disableAds=!this.isLoggedInViewer||this.stream.isInViewAsMode();this.loadAds();this.setLeftAndRightPagersState();if(this.$PhotoSnowliftu){o.addClass(this.root,'slideshowStarted');}else if(this.slideshowAvailable)o.addClass(this.root,'slideshowAvailable');if(!this.$PhotoSnowlifta&&this.$PhotoSnowlift9&&this.$PhotoSnowlifto)if(zb===-1){oa.fetch(this.$PhotoSnowlifto,this.stream);}else if(zb===0){sa.logSuggestMorePhotos();this.showMorePhotos(this.$PhotoSnowlifto,true);this.showPagers();this.$PhotoSnowlift1=0;}else{this.hideMorePhotos();this.hidePagers();}};vb.prototype.showMorePhotos=function(wb,xb){"use strict";if(this.$PhotoSnowliftx)return;this.$PhotoSnowliftx=true;if(!this.searchPivot)this.searchPivot=this.overlay.appendChild(document.createElement('div'));o.addClass(this.stageWrapper,"_5ymv");this.searchPivotComponent=ua.render(ua.createElement(na,{className:"_27g",fbid:wb,onclose:this.hideMorePhotos.bind(this),endofalbum:xb||false,withBackground:true}),this.searchPivot);};vb.prototype.hideMorePhotos=function(){"use strict";if(this.searchPivotComponent&&this.$PhotoSnowliftx){this.$PhotoSnowliftx=false;o.removeClass(this.stageWrapper,"_5ymv");this.searchPivotComponent.setProps({fbid:null});}};vb.prototype.showPivotSlide=function(wb,xb){"use strict";if(this.onExtraSlide)return;this.onExtraSlide=true;o.addClass(this.stageWrapper,"_3tvf");if(!this.pivotSlide){this.pivotSlide=q.create('div');q.insertBefore(this.stageActions,this.pivotSlide);}this.pivotSlideComponent=ua.render(ua.createElement(ma,{fbid:wb,isAlbum:this.$PhotoSnowliftz,albumOwnerName:this.$PhotoSnowliftA,visible:true,onReturn:this.returnToBeginning.bind(this,xb)}),this.pivotSlide);};vb.prototype.hidePivotSlide=function(){"use strict";if(this.pivotSlideComponent&&this.onExtraSlide){this.pivotSlideComponent.setProps({visible:false});o.removeClass(this.stageWrapper,"_3tvf");}this.onExtraSlide=false;};vb.prototype.returnToBeginning=function(wb){"use strict";var xb=this.stream.getRelativeMovement(this.$PhotoSnowliftn.start);this.page(xb,wb);};vb.prototype.logImpressionDetailsForPhoto=function(){"use strict";var wb=[].concat(q.scry(hb('fbPhotoSnowliftTagList'),'input.photoImpressionDetails'),q.scry(hb('fbPhotoSnowliftFeedback'),'input.photoImpressionDetails'));if(wb.length===0)return;var xb={};for(var yb=0;yb<wb.length;yb++)xb[wb[yb].name]=wb[yb].value;if(this.getVideoOnStage()){xb.width=0;xb.height=0;}else{var zb=this.getImageDimensions(this.stream.getCurrentImageData());xb.width=zb.x;xb.height=zb.y;}la.addDetailData(this.stream.getCursor(),xb);pa.setIsLogAdData(true);};vb.prototype.loadAds=function(){"use strict";if(this.disableAds)return;pa.loadAdsFromUserActivity();};vb.prototype.transitionHandler=function(wb){"use strict";if(wb.getQueryData().closeTheater||wb.getQueryData().permPage||this.returningToStart){if(this.isOpen)this.close();this.transitionHandlerRegistered=false;return false;}if(this.replaceUrl){this.replaceUrl=false;this.$PhotoSnowlifte.push(wb.getQualifiedURI().toString());ga.transitionComplete(true);return true;}var xb=this.$PhotoSnowlifte.length;if(xb>=2&&this.$PhotoSnowlifte[xb-2]==wb.getQualifiedURI().toString())this.$PhotoSnowlifte.pop();var yb=this.stream.getCursorForURI(wb.getUnqualifiedURI().toString());if(yb){var zb=this.stream.getRelativeMovement(yb);this.page(zb,true);ga.transitionComplete(false);return true;}if(this.isOpen){ga.transitionComplete(true);this.close();return true;}this.transitionHandlerRegistered=false;return false;};vb.prototype.recacheData=function(){"use strict";if(!this.loadingStates.html){var wb=this.stream.getCurrentHtml();for(var xb in wb){wb[xb]=kb(hb(xb).childNodes);q.empty(hb(xb));}}};vb.prototype.reloadIfTimeout=function(){"use strict";if(!x.hasLoaded(this.image)){var wb=this.makeNewImage(this.image.src,true);t.listen(wb,'load',this.useImage.bind(this,wb,null,true));this.$PhotoSnowlift3(wb.src);}};vb.prototype.useImage=function(wb,xb,yb){"use strict";if(yb&&x.hasLoaded(this.image))return;q.replace(this.image,wb);this.image=wb;this.adjustStageSize(xb);};vb.prototype.makeNewImage=function(wb,xb){"use strict";if(this.imageLoadingTimer){clearTimeout(this.imageLoadingTimer);this.imageLoadingTimer=null;}else if(!xb)this.imageRefreshTimer=setTimeout(this.reloadIfTimeout.bind(this),vb.LOADING_TIMEOUT);var yb=q.create('img',{className:'spotlight',alt:''});yb.setAttribute('aria-describedby','fbPhotosSnowliftCaption');yb.setAttribute('aria-busy','true');var zb=function(){clearTimeout(this.imageRefreshTimer);this.image.setAttribute('aria-busy','false');this.setLoadingState(this.STATE_IMAGE_PIXELS,false);setTimeout((function(){if(this.isOpen){this.adjustStageSize();this.adjustForNewData();}}).bind(this),0);}.bind(this);t.listen(yb,'load',zb);this.$PhotoSnowlift3(wb);yb.src=wb;return yb;};vb.prototype.switchImage=function(wb,xb,yb){"use strict";o.hide(this.image);o.hide(this.errorBox);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);var zb=this.stream&&this.stream.getCurrentImageData();if(zb){la.addPhotoView(zb.info,this.shouldShowHiRes(zb),this.fullscreen&&w.isFullScreen());if(this.$PhotoSnowlift8){var ac=this.stream.getCurrentExtraData();if(ac)sa.logImageImpression('snowlift',String(this.stream.getCursor()),Object.keys(ac.tagRects));}}this.useImage(this.makeNewImage(wb,false),xb,false);if(yb)this.stream.preloadImages(this.shouldShowHiRes.bind(this));if(!this.$PhotoSnowlift2&&this.$PhotoSnowlifts(zb)){la.addPanoramaImpression();var bc=new fb(this.stage.clientWidth,this.stage.clientHeight);this.$PhotoSnowliftB(bc);}else if(this.$PhotoSnowliftb)o.hide(this.showZoomInButton);if(this.$PhotoSnowlift2){this.switchIntoZoomedImage();this.showPagers(vb.PAGER_FADE);}l.inform('PhotoSnowlift.SWITCH_IMAGE');};vb.prototype.$PhotoSnowliftc=function(){"use strict";if(!this.$PhotoSnowliftb)return;if(this.$PhotoSnowlifts()){var wb=new fb(this.stage.clientWidth,this.stage.clientHeight);this.$PhotoSnowliftB(wb);}else o.hide(this.showZoomInButton);};vb.prototype.$PhotoSnowliftB=function(wb){"use strict";var xb=parseInt(this.image.style.height,10),yb=(wb.y-xb)/2;if(yb>=vb.ZOOM_BUTTON_TOP_PAD+vb.ZOOM_BUTTON_BOT_PAD+vb.ZOOM_BUTTON_HEIGHT){var zb=yb-vb.ZOOM_BUTTON_HEIGHT-vb.ZOOM_BUTTON_TOP_PAD;ya.set(this.showZoomInButton,'bottom',zb+'px');}else ya.set(this.showZoomInButton,'bottom','60px');o.show(this.showZoomInButton);};vb.prototype.$PhotoSnowlifts=function(wb){"use strict";if(wb===(void 0))wb=this.stream&&this.stream.getCurrentImageData();if(!this.$PhotoSnowliftb||!wb||!wb.originalDimensions)return false;var xb=new fb(this.stage.clientWidth,this.stage.clientHeight),yb=wb.originalDimensions,zb=yb.x/yb.y,ac=Math.min(xb.y*zb,yb.x);if(!isNaN(zb)&&zb>2&&yb.y>vb.MIN_PANORAMA_Y&&xb.x*vb.MIN_PANO_TO_STAGE_RATIO<ac){return true;}else return false;};vb.prototype.$PhotoSnowliftw=function(){"use strict";this.$PhotoSnowlift2=true;o.hide(this.showZoomInButton);o.hide(this.stageActions);o.show(this.showZoomOutButton);ya.set(this.stage,'overflow','hidden');this.spotlight.disableBehavior(ba);this.collapseRHC();};vb.prototype.$PhotoSnowliftq=function(){"use strict";if(!this.$PhotoSnowliftb)return;this.$PhotoSnowlift2=false;this.spotlight.enableBehavior(ba);ya.set(this.stage,'overflow','visible');o.hide(this.showZoomInButton);o.hide(this.showZoomOutButton);o.hide(this.zoomedImage);o.hide(this.outerImageSlider);o.show(this.stageActions);this.uncollapseRHC();};vb.prototype.switchIntoZoomedImage=function(wb){"use strict";this.$PhotoSnowliftw();o.hide(this.zoomedImage);o.hide(this.outerImageSlider);var xb=this.stream.getCurrentImageData(),yb=xb.originalDimensions;this.zoomedImage.src=xb.url;this.adjustStageSize(yb);this.$PhotoSnowliftC(new fb(parseInt(ya.get(this.zoomedImage,'width'),10),parseInt(ya.get(this.zoomedImage,'height'),10)));o.hide(this.image);};vb.prototype.$PhotoSnowliftD=function(wb){"use strict";var xb=this.stage.clientWidth,yb=Math.min(100,(xb/wb.x)*100);ya.set(this.innerImageSlider,'width',yb+'%');return yb;};vb.prototype.$PhotoSnowliftE=function(wb){"use strict";var xb=vb.MAX_SLIDER_HEIGHT*this.stage.clientHeight/wb.y,yb=vb.MAX_SLIDER_WIDTH*this.stage.clientWidth/wb.x,zb=Math.min(xb,yb);return new fb(100*wb.x*zb/this.stage.clientWidth,100*wb.y*zb/this.stage.clientHeight);};vb.prototype.$PhotoSnowliftC=function(wb){"use strict";this.$PhotoSnowliftt(this.$PhotoSnowliftr);var xb=this.$PhotoSnowliftE(wb);ya.set(this.outerImageSlider,'width',xb.x+'%');ya.set(this.outerImageSlider,'height',xb.y+'%');ya.set(this.outerImageSlider,'left',(50-xb.x/2)+'%');ya.set(this.showZoomOutButton,'bottom',xb.y*this.stage.clientHeight/100+parseInt(ya.get(this.outerImageSlider,'bottom'),10)+20+'px');o.show(this.zoomedImage);o.show(this.outerImageSlider);};vb.prototype.$PhotoSnowliftj=function(event){"use strict";if(!this.$PhotoSnowlift2)return;o.addClass(this.stage,'showSlider');if(this.$PhotoSnowliftF)this.$PhotoSnowliftF.remove();var wb=false,xb=event.getTarget();if(ha.byClass(xb,"_10zv")){this.startSliderMargins=new fb(parseFloat(ya.get(this.innerImageSlider,'marginLeft')),parseFloat(ya.get(this.innerImageSlider,'marginTop')));this.startImageMargins=null;this.mouseDownStartPosition=new fb(event.clientX,event.clientY);}else if(ha.byClass(xb,"_10zx")){this.startSliderMargins=new fb(parseInt(ya.get(this.innerImageSlider,'marginLeft'),10),parseInt(ya.get(this.innerImageSlider,'marginTop'),10));this.startImageMargins=null;var yb=parseInt(ya.get(this.innerImageSlider,'width'),10);this.mouseDownStartPosition=new fb(this.innerImageSlider.getBoundingClientRect().left+yb/2,event.clientY);wb=true;}else if(ha.byClass(xb,"_10zw")){this.startImageMargins=new fb(parseInt(ya.get(this.zoomedImage,'marginLeft'),10),parseInt(ya.get(this.zoomedImage,'marginTop'),10));this.startSliderMargins=null;this.mouseDownStartPosition=new fb(event.clientX,event.clientY);}this.$PhotoSnowliftF=t.listen(this.stage,'mousemove',this.$PhotoSnowliftG.bind(this));if(wb){this.$PhotoSnowliftG(event);}else event.kill();};vb.prototype.$PhotoSnowliftk=function(event){"use strict";if(this.$PhotoSnowliftF){o.removeClass(this.stage,'showSlider');this.$PhotoSnowliftF.remove();this.$PhotoSnowliftF=null;var wb=parseFloat(ya.get(this.zoomedImage,'marginLeft')),xb=-this.zoomedImage.width+this.stage.clientWidth;this.$PhotoSnowliftr=wb/xb;}};vb.prototype.$PhotoSnowliftG=function(event){"use strict";var wb;if(this.startSliderMargins){wb=event.clientX-this.mouseDownStartPosition.x;var xb=parseFloat(ya.get(this.outerImageSlider,'width')),yb=parseFloat(ya.get(this.innerImageSlider,'width')),zb=Math.max(0,Math.min(xb-yb,this.startSliderMargins.x+wb))/xb;ya.set(this.innerImageSlider,'marginLeft',100*zb+"%");ya.set(this.zoomedImage,'marginLeft',-1*zb*this.zoomedImage.width+'px');event.kill();}else if(this.startImageMargins){wb=1.75*(this.mouseDownStartPosition.x-event.clientX);var ac=Math.min(0,Math.max(this.startImageMargins.x-wb,-this.zoomedImage.width+this.stage.clientWidth));ya.set(this.zoomedImage,'marginLeft',ac+'px');ya.set(this.innerImageSlider,'marginLeft',(-ac/this.zoomedImage.width*100)+"%");event.kill();}};vb.prototype.$PhotoSnowliftt=function(wb){"use strict";if(wb===(void 0)||wb===null)wb=.5;var xb=new fb(parseInt(ya.get(this.zoomedImage,'width'),10),parseInt(ya.get(this.zoomedImage,'height'),10));ya.set(this.innerImageSlider,'marginLeft',((100-this.$PhotoSnowliftD(xb))*wb)+'%');ya.set(this.zoomedImage,'marginLeft',((this.stage.clientWidth-xb.x)*wb)+'px');};vb.prototype.switchVideo=function(wb,xb){"use strict";this.$PhotoSnowliftp();var yb='swf_'+wb;q.empty(this.videoStage);if(xb){o.addClass(this.stageWrapper,'showVideo');var zb=this.stream.getCurrentImageData();if(this.videoPivotsGK){o.hide(this.nextPager);o.hide(this.prevPager);}var ac=zb.video_element;q.find(ac,"._ox1").style.cssText='';var bc=null;if(this.pivotsCarouselElement)bc=r.scry(this.pivotsCarouselElement,"._32_l");if(bc)bc.map(function(ec){return u.capture(ec,'click',function(){var fc=ec.getAttribute('data-fbid'),gc=this.stream.getCursor(),hc=this.stream.calculateDistance(gc,fc);this.page(hc,false);}.bind(this));}.bind(this));o.addClass(ac,'videoStageContainer');q.appendContent(this.videoStage,ac);q.appendContent(this.videoStage,this.pivotsCarouselElement);if(window[yb]&&!ob(yb))window[yb].write(wb);var cc='video_warning_'+wb,dc=ob(wb);if(!this.videoWarnings)this.videoWarnings=[];if(dc&&this.videoWarnings[cc])q.setContent(dc,this.videoWarnings[cc]);this.$PhotoSnowliftv=zb.controller;this.$PhotoSnowliftv.reset();if(this.$PhotoSnowliftH)this.$PhotoSnowliftv.play(gb.USER);if(this.$PhotoSnowliftI)this.$PhotoSnowliftv.addListener('finishPlayback',function(){var ec=zb.info.fbid.toString();if(ec===this.stream.getCursor())this.page(1,false);}.bind(this));setTimeout(this.adjustStageSizeForVideo.bind(this,wb),0);}else{window[yb]&&window[yb].addVariable('video_autoplay',0);this.videoLoadTimer&&clearTimeout(this.videoLoadTimer);o.removeClass(this.stageWrapper,'showVideo');}};vb.prototype.checkVideoStatus=function(wb){"use strict";if(this.videoLoadTimer)clearTimeout(this.videoLoadTimer);var xb=this.getVideoOnStage();if(!xb){return;}else{if(xb!==wb)return;this.adjustStageSizeForVideo(wb);}};vb.prototype.getVideoSize=function(wb){"use strict";return new fb(wb.getAttribute('data-video-width'),+wb.getAttribute('data-video-height')+this.getVideoComponentsHeight(wb));};vb.prototype.getVideoElement=function(wb){"use strict";return q.scry(this.videoStage,"._ox1")[0];};vb.prototype.getVideoComponentsHeight=function(wb){"use strict";var xb=0,yb=ha.byClass(wb,"_1c_u");if(!yb)return 0;var zb=q.scry(yb,"._2i84");if(zb.length){var ac=zb[0].getBoundingClientRect();xb=ac.bottom-ac.top;}return xb;};vb.prototype.adjustStageSizeForVideo=function(wb){"use strict";var xb=this.getVideoElement(wb);if(!xb){this.videoLoadTimer=setTimeout(this.checkVideoStatus.bind(this,wb),200);}else this.adjustStageSize(this.getVideoSize(xb));};vb.prototype.handleServerError=function(wb,xb){"use strict";q.setContent(this.errorBox,wb);this.storeFromData(xb);};vb.prototype.fixButtonText=function(wb){"use strict";if(!this.buttonTruncateGk)return;var xb=q.scry(wb,".photosTruncatingUIButton"),yb=parseInt(ya.get(wb,'width'),10);if(yb>k){var zb={tagPhoto:"\u5199\u771f\u306b\u30bf\u30b0\u4ed8\u3051",doneTagPhoto:"\u30bf\u30b0\u4ed8\u3051\u5b8c\u4e86",addLocation:"\u4f4d\u7f6e\u60c5\u5831\u3092\u8ffd\u52a0",editPhoto:"\u7de8\u96c6"};for(var ac=0;ac<xb.length;ac++){var bc=xb[ac];o.addClass(bc,"_2n0k");ab.set(bc,zb[bc.getAttribute('data-buttonname')],'below','center');}}};vb.prototype.swapData=function(){"use strict";var wb,xb=this.stream.getCurrentHtml();if(xb){this.setLoadingState(vb.STATE_HTML,false);for(var yb in xb){wb=ob(yb);wb&&q.setContent(wb,xb[yb]);}var zb=ob('photosTruncatingUIButtonGroup');zb&&this.fixButtonText(zb);l.inform('PhotoSnowlift.DATA_CHANGE',jb(this.stream.getCurrentImageData().info,{movement:this.movementDelta}),l.BEHAVIOR_STATE);this.movementDelta=0;if(this.stream.getCurrentExtraData())l.inform('PhotoSnowlift.EXTRA_DATA_CHANGE',this.stream.getCurrentExtraData(),l.BEHAVIOR_STATE);}this.adjustScroller();this.scrollableArea.showScrollbar(false);this.adjustForNewData();this.logImpressionDetailsForPhoto();};vb.prototype.updateTotalCount=function(wb,xb,yb){"use strict";var zb=this.stream.getCurrentHtml();if(zb){var ac=hb('fbPhotoSnowliftPositionAndCount');q.replace(ac,yb);ac=yb;o.show(ac);var bc='fbPhotoSnowliftPositionAndCount';zb[bc]=kb(ac.childNodes);}this.stream.setTotalCount(wb);this.stream.setFirstCursorIndex(xb);};vb.prototype.addPhotoFbids=function(wb,xb,yb,zb){"use strict";if(zb&&this.sessionID&&zb!=this.sessionID)return;var ac=this.stream.getCursor()===null;this.stream.attachToFbidsList(wb,xb,yb);if(yb&&ac)this.page(0,true);if(this.pivots&&yb)this.pivots.setCycleCount(this.stream.calculateDistance(this.stream.getCursor(),this.stream.firstCursor));if(!this.pagersShown&&this.stream.canPage())this.setStagePagersState('ready');if(!this.slideshowAvailable&&this.stream.canPage()){this.slideshowAvailable=true;o.addClass(this.root,'slideshowAvailable');}this.setLeftAndRightPagersState();};vb.prototype.attachTagger=function(wb){"use strict";q.appendContent(this.stageActions,wb);};vb.prototype.storeFromData=function(wb){"use strict";if(!this.isOpen)return;if(wb.pivots)this.pivotsCarouselElement=wb.pivots;this.videoPivotsGK=wb.pivotsgk;if(wb.ssid&&this.sessionID&&this.sessionID!=wb.ssid)return;var xb=this.stream.storeToCache(wb);if('error' in xb){this.checkState(vb.STATE_ERROR);return;}if('init' in wb){this.$PhotoSnowlifto=wb.init.album_fbid;this.$PhotoSnowliftz=wb.init.is_album;this.$PhotoSnowliftA=wb.init.album_owner_name;this.$PhotoSnowliftH=wb.init.autoplay_videos;this.$PhotoSnowliftI=wb.init.autoplay_next_video;}if('init' in xb){this.initDataFetched(xb.init);if(this.openExplicitly){this.replaceUrl=true;qb(this.stream.getCurrentImageData().info.permalink);}if(this.stream.canPage())this.setStagePagersState('ready');this.setLeftAndRightPagersState();this.ua&&this.ua.add_event('ufi');}if('image' in xb)this.checkState(vb.STATE_IMAGE_DATA);if('data' in xb)this.checkState(vb.STATE_HTML);};vb.prototype.setLeftAndRightPagersState=function(){"use strict";if(this.stream.isNonCircularPhotoSet()){o.conditionClass(this.root,'disableLeft',!this.stream.nonCircularPhotoSetCanPage(-1));o.conditionClass(this.root,'disableRight',!this.stream.nonCircularPhotoSetCanPage(1));}if(this.snowflake){o.conditionClass(this.root,'disableLeft',this.stream.getCursor()==this.firstInSet);var wb=this.stream.getCursorAt(this.stream.calculatePositionForMovement(1));o.conditionClass(this.root,'disableRight',wb==this.firstInSet);}};vb.prototype.setStagePagersState=function(wb){"use strict";switch(wb){case 'ready':o.addClass(this.root,'pagingReady');this.pagersShown=true;this.ua&&this.ua.add_event('arrows');return;case 'active':o.addClass(this.root,'pagingActivated');return;case 'inactive':o.removeClass(this.root,'pagingActivated');return;case 'disabled':case 'reset':o.removeClass(this.root,'pagingReady');return;}};vb.prototype.deletePhoto=function(wb){"use strict";this.closeRefresh();};vb.prototype.closeRefresh=function(){"use strict";this.refreshOnClose=true;this.spotlight.hide();};vb.prototype.onHiliteTag=function(wb,xb){"use strict";if(xb.version!=ka.VIEWER_SNOWLIFT)return;var yb=xb.tag;if(yb)this.switchHilitedTags(yb,true);};vb.prototype.onUpdateTagBox=function(wb,xb){"use strict";if(xb.version==ka.VIEWER_SNOWLIFT)this.updateTagBox(xb.id,xb.approve);};vb.prototype.$PhotoSnowlift3=function(wb){"use strict";if(this.$PhotoSnowlift6){this.$PhotoSnowlift7&&this.$PhotoSnowlift7.log(wb);return true;}return false;};vb.prototype.$PhotoSnowlifth=function(){"use strict";this.$PhotoSnowlifty=false;};vb.prototype.$PhotoSnowlifti=function(event){"use strict";if(this.$PhotoSnowlifty)event.kill();};vb.prototype.isReturningToStart=function(){"use strict";return !!this.returningToStart;};vb.prototype.$PhotoSnowliftp=function(){"use strict";if(this.$PhotoSnowliftv)this.$PhotoSnowliftv.logStopForUnload();};vb.getInstance=function(){"use strict";if(!vb.$PhotoSnowliftJ)vb.$PhotoSnowliftJ=new vb();return vb.$PhotoSnowliftJ;};vb.initWithSpotlight=function(wb,xb){"use strict";vb.getInstance().init(wb,xb);};vb.addPhotoFbids=function(wb,xb,yb,zb){"use strict";vb.getInstance().addPhotoFbids(wb,xb,yb,zb);};vb.setReachedLeftEnd=function(){"use strict";vb.getInstance().setReachedLeftEnd();};vb.setReachedRightEnd=function(){"use strict";vb.getInstance().setReachedRightEnd();};vb.attachFollowFlyout=function(wb){"use strict";q.insertAfter(hb('fbPhotoSnowliftSubscribe'),wb);};vb.attachSubscribeFlyout=function(wb){"use strict";q.insertAfter(hb('fbPhotoSnowliftSubscribe'),wb);};vb.attachTagger=function(wb){"use strict";vb.getInstance().attachTagger(wb);};vb.preload=function(wb,xb){"use strict";vb.getInstance().preload(wb,xb);};vb.bootstrap=function(wb,xb){"use strict";var yb=wb&&db(wb).getQueryData();if(yb&&yb.hasOwnProperty('share_id')){n.loadModules(["SpotlightShareViewer"],function(zb){zb.bootstrap(wb,xb);});return;}vb.getInstance().bootstrap(wb,xb);};vb.closeRefresh=function(){"use strict";vb.getInstance().closeRefresh();};vb.deletePhoto=function(wb){"use strict";vb.getInstance().deletePhoto(wb);};vb.getImage=function(){"use strict";return vb.getInstance().getImage();};vb.getImageId=function(){"use strict";return vb.getInstance().getImageId();};vb.getLoadQuery=function(){"use strict";return vb.getInstance().getLoadQuery();};vb.getRHCBody=function(){"use strict";return vb.getInstance().getRHCBody();};vb.getRHCFooter=function(){"use strict";return vb.getInstance().getRHCFooter();};vb.getRHCHeader=function(){"use strict";return vb.getInstance().getRHCHeader();};vb.getRoot=function(){"use strict";return vb.getInstance().getRoot();};vb.likePhotoSkipConfirmation=function(wb){"use strict";vb.getInstance().likePhotoSkipConfirmation(wb);};vb.saveTagsFromPayload=function(wb){"use strict";vb.getInstance().saveTagsFromPayload(wb);};vb.saveTagsFromPayloadDelayed=function(wb){"use strict";setTimeout(vb.saveTagsFromPayload.bind(null,wb),2000);};vb.handleServerError=function(wb,xb){"use strict";vb.getInstance().handleServerError(wb,xb);};vb.setVideoWarning=function(wb,xb){"use strict";var yb=vb.getInstance(),zb='video_warning_'+wb;if(!yb.videoWarnings)yb.videoWarnings=[];yb.videoWarnings[zb]=xb;};vb.storeFromData=function(wb){"use strict";vb.getInstance().storeFromData(wb);};vb.swapData=function(){"use strict";vb.getInstance().swapData();};vb.updateTotalCount=function(wb,xb,yb){"use strict";vb.getInstance().updateTotalCount(wb,xb,yb);};vb.setVideoRotateURI=function(wb){"use strict";vb.getInstance().videoRotateURI=wb;};jb(vb,{STATE_ERROR:'error',STATE_HTML:'html',STATE_IMAGE_PIXELS:'image_pixels',STATE_IMAGE_DATA:'image',LOADING_TIMEOUT:2000,PAGER_FADE:3000,FULL_SCREEN_PADDING:10,STAGE_NORMAL_MAX:{x:960,y:960},STAGE_MIN:{x:520,y:520},SIDEBAR_SIZE_MAX:360,MIN_PANORAMA_Y:240,ZOOM_BUTTON_HEIGHT:52,ZOOM_BUTTON_BOT_PAD:60,ZOOM_BUTTON_TOP_PAD:16,MAX_SLIDER_HEIGHT:.075,MAX_SLIDER_WIDTH:.75,MIN_PANO_TO_STAGE_RATIO:1.2,STAGE_CHROME:{x:82,y:42},VIDEO_BOTTOM_BAR_SPACE:40,GOPREV_AREA:120,TIMELINE_STRETCH_WIDTH:843,TIMELINE_STRETCH_MIN:480,MIN_TAG_DISTANCE:83,PADDING_MIN:40,MIN_UFI_HEIGHT:250,COLLECTIONS_UNTAGGED_PHOTOS:3,PHOTOS_OF_YOU_SUGGESTIONS:28,FRIENDS_IN_PHOTOS_SUGGESTIONS:31,MIN_ADS_VISIBLE:1,PINNED_UFI_ADJUSTMENT:11,ADD_COMMENT_HEIGHT:54,SLIDESHOW_TIME:3000,_instance:null,touch:nb,touchMarkup:nb});});(function(){var g=74,h=75,i=70,j=76,k=315,l='Arbiter',m='AsyncRequest',n='Bootloader',o='CSS',p='Dialog',q='DOM',r='DOMQuery',s='DOMControl',t='Event',u='EventListener',v='fbt',w='FullScreen',x='ImageUtils',y='Input',z='Keys',aa='Layer',ba='LayerHideOnEscape',ca='LikeConfirmer',da='LinkController',ea='LitestandStoryInsertionStatus',fa='Locale',ga='PageTransitions',ha='Parent',ia='PhotoLogger',ja='PhotoPermalinkURI',ka='PhotosConst',la='PhotoSessionLog',ma='PhotosetPivotSlide.react',na='PhotosetSearchPivot.react',oa='PhotosetSearchPivotData',pa='PhotoSnowliftAds',qa='PhotoStreamCache',ra='PhotosUtils',sa='PhotoTagSearchPivotLogger',ta='PhotoViewer',ua='React',va='Rect',wa='ScriptPath',xa='ScrollableArea',ya='Style',za='Toggler',ab='Tooltip',bb='UFIFeedbackTargets',cb='UIPagelet',db='URI',eb='UserAgent_DEPRECATED',fb='Vector',gb='VideoPlayerReason',hb='$',ib='computeRelativeURI',jb='copyProperties',kb='createArrayFromMixed',lb='csx',mb='cx',nb='emptyFunction',ob='ge',pb='getActiveElement',qb='goURI',rb='invariant',sb='userAction';for(var tb in ta)if(ta.hasOwnProperty(tb))vb[tb]=ta[tb];var ub=ta===null?null:ta.prototype;vb.prototype=Object.create(ub);vb.prototype.constructor=vb;vb.__superConstructor__=ta;function vb(){"use strict";ta.call(this);this.$PhotoSnowlift0={};this.$PhotoSnowlift1=0;this.$PhotoSnowlift2=false;this.clearAlbumBoundaries();}vb.prototype.preload=function(wb,xb){"use strict";n.loadModules(["PhotoTagger","Live","PhotoTagApproval","PhotoTags","TagTokenizer","css:fb-photos-snowlift-fullscreen-css"],function(zb){this.PhotoTagger=zb;}.bind(this));var yb=this.getImageSrc(db(wb).getQueryData());if(yb)if(!this.$PhotoSnowlift3(yb))(new Image()).src=yb;};vb.prototype.bootstrap=function(wb,xb){"use strict";this.preload(wb,xb);if(this.closeDirty){setTimeout(this.bootstrap.bind(this,wb,xb),0);return;}pa.reset();this.resetUriStack=true;if(this.isOpen)if(this.openExplicitly){this.closeCleanup();this.resetUriStack=false;}else return;this.$PhotoSnowlift4=null;var yb=ha.byAttribute(xb,'data-cursor');if(yb){try{var ac=JSON.parse(yb.getAttribute('data-ft'));this.$PhotoSnowlift4={qid:ac.qid,mf_story_key:ac.mf_story_key};}catch(zb){}}else try{yb=ha.byAttribute(xb,'data-ad');var bc=JSON.parse(yb.getAttribute('data-ad'));this.$PhotoSnowlift4={ad_id:bc.adid};}catch(zb){}this.ua=sb('snowlift',xb).uai('open');wa.openOverlayView('snowlift');this.returningToStart=false;this.loading&&o.removeClass(this.loading,'loading');if(xb){o.addClass((this.loading=xb),'loading');var cc=ha.byClass(xb,'uiStreamStory')||ha.byClass(xb,"_5jmm");if(cc){this.storyID=cc.id;}else{var dc=ha.byClass(xb,"_5b9c");if(dc)this.storyID=dc.getAttribute('data-ownerid');}this.$PhotoSnowlift5();this.getThumbAndSize(xb);}else this.loading=null;l.inform('PhotoSnowlift.GO',wb,l.BEHAVIOR_STATE);this.loadFrameIfUninitialized();};vb.prototype.$PhotoSnowlift5=function(){"use strict";if(this.container)if(this.storyID){this.container.setAttribute('data-ownerid',this.storyID);}else this.container.removeAttribute('data-ownerid');};vb.prototype.setupFromSnowflake=function(wb,xb){"use strict";this.extraClasses=wb;this.snowflake=true;this.firstInSet=xb;if(this.root){o.addClass(this.root,"snowflake");this.extraClasses.forEach(function(yb){o.addClass(this.root,yb);},this);}};vb.prototype.getCurrentImageServerSizeDimensions=function(){"use strict";var wb=this.stream.getCurrentImageData();return wb.originalDimensions||wb.dimensions;};vb.prototype.getEventPrefix=function(){"use strict";return 'PhotoSnowlift';};vb.prototype.getRoot=function(){"use strict";return this.root;};vb.prototype.getSourceString=function(){"use strict";return 'snowlift';};vb.prototype.getViewerSource=function(){"use strict";return this.source;};vb.prototype.getViewerSet=function(){"use strict";return this.stream.getPhotoSet();};vb.prototype.getVersionConst=function(){"use strict";return ka.VIEWER_SNOWLIFT;};vb.prototype.getImage=function(){"use strict";return this.image;};vb.prototype.getImageId=function(){"use strict";return this.stream.getCursor();};vb.prototype.getRHCHeader=function(){"use strict";return this.rhcHeader;};vb.prototype.getRHCBody=function(){"use strict";return this.ufiForm;};vb.prototype.getRHCFooter=function(){"use strict";return this.rhcFooter;};vb.prototype.getLoadQuery=function(){"use strict";return this.loadQuery;};vb.prototype.getCurrentPhotoInfo=function(){"use strict";var wb=this.stream.getCurrentImageData();if(wb)return wb.info;return null;};vb.prototype.getOwnerId=function(){"use strict";var wb=this.stream.getCurrentImageData();if(wb)return wb.info.owner;return null;};vb.prototype.getThumbAndSize=function(wb){"use strict";this.currentImageSize=null;this.thumbSrc=null;var xb=db(wb.getAttribute('ajaxify')).getQueryData();if(!xb.size)return;var yb=fb.deserialize(xb.size);if(!yb.x||!yb.y)return;this.currentImageSize=yb;if(wb.getAttribute('data-cropped'))return;var zb=q.scry(wb,'img')[0],ac=q.scry(wb,'i')[0],bc=ha.byAttribute(wb,'data-size');this.shouldStretch=bc&&this.currentImageSize&&zb&&bc.getAttribute('data-size')==="2"&&this.currentImageSize.x>this.currentImageSize.y&&this.currentImageSize.x<=vb.TIMELINE_STRETCH_WIDTH&&zb.offsetWidth===vb.TIMELINE_STRETCH_WIDTH;var cc;if(zb){cc=zb.src;}else if(ac){cc=ya.get(ac,'backgroundImage').replace(/.*url\("?([^"]*)"?\).*/,'$1');}else return;this.thumbSrc=cc;};vb.prototype.loadFrameIfUninitialized=function(){"use strict";if(this.root)return;new m('/ajax/photos/snowlift/init.php').setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();};vb.prototype.init=function(wb,xb){"use strict";this.init=nb;this.$PhotoSnowlift6=xb.photos_client_loading;this.$PhotoSnowlift7=null;if(this.$PhotoSnowlift6)this.$PhotoSnowlift7=new ia(ka.VIEWER_SNOWLIFT_STRING);this.$PhotoSnowlift8=xb.pivot_hover;this.$PhotoSnowlift9=xb.show_more_photos;this.$PhotoSnowlifta=xb.extra_slide_pivot;la.setEndMetrics(xb.pivot_end_metric);this.startingMousePos=null;this.haveLeftBufferRegion=false;this.showingTypeaheadSuggestions=false;this.fullscreen=w.isSupported();this.showOGVideos=xb.og_videos;this.resizeCommentsForAds=xb.resize_comments_for_ads;this.spotlight=wb;this.spotlight.subscribe('blur',function(){this.closingAction=la.OUTSIDE;}.bind(this));this.spotlight.subscribe('hide',this.closeHandler.bind(this));this.spotlight.subscribe('key',this.keyHandler.bind(this));this.initializeNodes(this.spotlight.getRoot());pa.init(this.sideAdUnit,this,xb,this.adsDisplayedCallback.bind(this));this.inAdsDisplayedCallback=false;this.lastAdsHeight=0;if(!this.subscription){da.registerHandler(this.handleNavigateAway.bind(this));this.subscription=l.subscribe('PhotoSnowlift.GO',function(yb,zb){this.openExplicitly=true;this.loading&&o.removeClass(this.loading,'loading');this.open(zb);}.bind(this));}this.transitionHandlerRegistered=false;this.returningToStart=false;ga.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;l.subscribe('PhotoTagApproval.HILITE_TAG',this.onHiliteTag.bind(this));l.subscribe('PhotoTagApproval.UPDATE_TAG_BOX',this.onUpdateTagBox.bind(this));if(this.fullscreen)w.subscribe('changed',this.onFullScreenChange.bind(this));this.slideshowGk=xb.snowlift_slideshow;this.buttonTruncateGk=xb.snowlift_button_truncate;this.$PhotoSnowliftb=this.$PhotoSnowliftb&&xb.www_panorama_viewer;this.allowIrrelevantRequests=!!xb.snowlift_allow_irrelevant_requests;if(this.snowflake){o.addClass(this.root,"snowflake");this.extraClasses.forEach(function(yb){o.addClass(this.root,yb);},this);}};vb.prototype.onFullScreenChange=function(){"use strict";if(!this.isOpen)return;var wb=w.isFullScreen();o.conditionClass(document.body,'fbPhotoSnowliftFullScreenMode',wb);if(wb){if(!o.hasClass(this.root,'fbPhotoSnowliftEditMode'))this.collapseRHC();var xb=this.stream.getCurrentImageData();if(xb&&xb.url&&this.image.src!==xb.url&&this.shouldShowHiRes(xb))this.switchImage(xb.url);this.adjustForResize();if(!this.$PhotoSnowlift2)this.$PhotoSnowliftc();}else{if(!this.$PhotoSnowlift2)this.uncollapseRHC();if(eb.chrome()&&!o.hasClass(this.root,'fbPhotoSnowliftEditMode'))this.page(0,false);l.inform('reflow');}za.hide();};vb.prototype.initializeNodes=function(wb){"use strict";this.root=wb;this.container=q.find(wb,'div.fbPhotoSnowliftContainer');this.$PhotoSnowlift5();this.snowliftPopup=q.find(this.container,'div.fbPhotoSnowliftPopup');this.rhc=q.find(this.snowliftPopup,'div.rhc');this.rhcHeader=q.find(this.rhc,'div.rhcHeader');this.rhcFooter=q.find(this.rhc,'div.rhcFooter');this.ufiForm=q.find(this.rhc,'form.fbPhotosSnowliftFeedbackForm');this.ufiInputContainer=q.find(this.rhc,'div.fbPhotosSnowboxFeedbackInput');this.scroller=q.find(this.ufiForm,'div.rhcScroller');this.scrollerBody=q.find(this.scroller,'div.uiScrollableAreaBody');this.stageWrapper=q.find(this.snowliftPopup,'div.stageWrapper');this.overlay=q.find(this.snowliftPopup,'div.snowliftOverlay');this.errorBox=q.find(this.stageWrapper,'div.stageError');this.image=q.find(this.stageWrapper,'img.spotlight');this.stage=q.find(this.stageWrapper,'div.stage');this.showZoomInButton=q.scry(this.stageWrapper,"._5qmg").pop();this.showZoomOutButton=q.scry(this.stageWrapper,"._5qmh").pop();this.zoomedImage=q.scry(this.stage,"._10zw").pop();this.outerImageSlider=q.scry(this.stage,"._10zx").pop();this.innerImageSlider=q.scry(this.stage,"._10zv").pop();this.$PhotoSnowliftb=this.showZoomInButton&&this.showZoomOutButton&&this.zoomedImage&&this.outerImageSlider&&this.innerImageSlider;if(this.$PhotoSnowliftb){o.hide(this.showZoomInButton);o.hide(this.showZoomOutButton);o.hide(this.zoomedImage);o.hide(this.outerImageSlider);}this.videoStage=q.find(this.stageWrapper,'div.videoStage');this.prevPager=q.find(this.snowliftPopup,'a.snowliftPager.prev');this.nextPager=q.find(this.snowliftPopup,'a.snowliftPager.next');this.stageActions=q.find(wb,'div.stageActions');this.buttonActions=q.find(this.stageActions,'div.fbPhotosPhotoButtons');this.placeInfo=q.find(this.rhc,'div.fbPhotosSnowliftPlaceInfo');this.sideAdUnit=q.find(wb,"._5ciw");o.conditionClass(this.root,'fullScreenAvailable',this.fullscreen);};vb.prototype.initializeScroller=function(){"use strict";this.initializeScroller=nb;this.scrollableArea=xa.fromNative(this.scroller,{fade:true,persistent:true});var wb=function(event){var xb=t.$E(event).getTarget();if(q.contains(this.ufiInputContainer,xb)){var yb=s.getInstance(xb);if(yb){this.scrollableArea.scrollToBottom();var zb=yb.subscribe('resize',function(){var bc=this.scrollableArea.isScrolledToBottom();this.adjustScroller();bc&&this.scrollableArea.scrollToBottom();}.bind(this)),ac=t.listen(xb,'blur',function(){yb.unsubscribe(zb);ac.remove();});}}}.bind(this);l.subscribe('ufi/inputHeightChanged',function(xb,yb){if(q.contains(this.ufiInputContainer,yb.node))this.adjustScroller();}.bind(this));l.subscribe('ufi/addCommentFacepileRendered',function(){this.adjustScroller();}.bind(this));l.subscribe('ufi/changed',function(xb,yb){if(this.ufiForm===yb.form)this.adjustScrollerIfNecessary();}.bind(this));l.subscribe('ufi/comment',function(xb,yb){if(this.ufiForm===yb.form){this.adjustScrollerIfNecessary();if(yb.isranked){this.scrollableArea.scrollToTop();}else this.scrollableArea.scrollToBottom();}}.bind(this));t.listen(this.rhc,'click',function(event){var xb=event.getTarget();if(ha.byTag(xb,'a')||ha.byTag(xb,'button')||q.isNodeOfType(xb,'input'))this.adjustScrollerIfNecessary();}.bind(this));l.subscribe(['reflow','CommentUFI.Pager'],function(){if(this.isOpen)this.adjustScrollerIfNecessary();}.bind(this));t.listen(this.ufiForm,'focusin',wb);};vb.prototype.openHandler=function(wb){"use strict";if(this.isOpen||!ja.isValid(wb)||this.returningToStart||wb.getQueryData().closeTheater||wb.getQueryData().permPage){this.openHandlerRegistered=false;return false;}this.open(wb);this.$PhotoSnowlifte.push(db(wb).getQualifiedURI().toString());ga.transitionComplete(true);return true;};vb.prototype.getImageSrc=function(wb){"use strict";if(wb.smallsrc){if(!wb.size)return wb.smallsrc;var xb=fb.deserialize(wb.size),yb=this.getStageSize(xb);yb=this.$PhotoSnowliftf(yb);if(yb.x<=vb.STAGE_NORMAL_MAX.x&&yb.y<=vb.STAGE_NORMAL_MAX.y)return wb.smallsrc;}return wb.src;};vb.prototype.open=function(wb){"use strict";var xb=db(wb),yb=xb.getQueryData(),zb=ja.parse(xb);if(zb!==null){yb.fbid=zb.photo_id;yb.set=zb.set_token;}var ac=this.getImageSrc(yb);if(ac){delete yb.src;delete yb.smallsrc;}if(this.resetUriStack)this.$PhotoSnowlifte=[];if(!this.initialLoad){yb.firstLoad=true;this.initialLoad=true;ea.registerBlocker(function(){return this.isOpen;}.bind(this));}this.sessionID=Date.now();this.loadQuery=jb(yb,{ssid:this.sessionID});if(this.$PhotoSnowlift4)this.loadQuery.data_ft=this.$PhotoSnowlift4;this.isOpen=true;this.pagersShown=false;this.refreshOnClose=false;this.hilitedTag=null;this.loadingStates={image:false,html:false};this.replaceUrl=false;this.movementDelta=0;this.pivotsCarouselElement=null;this.videoPivotsGK=false;o.show(this.nextPager);o.show(this.prevPager);this.source=null;this.saveTagSubscription=l.subscribe('PhotoTagger.SAVE_TAG',this.onTagSaved.bind(this));this.taggedPhotoIds=[];this.stream=new qa();this.stream.init(ka.VIEWER_SNOWLIFT,'PhotoViewerPagelet','pagelet_photo_viewer',this.$PhotoSnowlift6?this.$PhotoSnowlift7:null,yb.tagSuggestionMode||'everyone');if(!!db.getMostRecentURI().getQueryData().viewas)this.stream.setViewAs(db.getMostRecentURI().getQueryData().viewas+'');this.fetchInitialData();this.setLoadingState(vb.STATE_HTML,true);this.rhcCollapsed=false;this.$PhotoSnowliftg(wb,ac);n.loadModules(["PhotosButtonTooltips"],function(bc){bc.init();});};vb.prototype.$PhotoSnowliftg=function(wb,xb){"use strict";this.createLoader(xb);this.spotlight.show();this.ua&&this.ua.add_event('frame');l.inform('layer_shown',{type:'PhotoSnowlift'});l.inform('PhotoSnowlift.OPEN');this.stageHandlers=[t.listen(window,'resize',this.adjustForResize.bind(this)),t.listen(this.stageWrapper,'click',this.buttonListener.bind(this)),t.listen(this.stageWrapper,'mouseleave',function(event){var ac=event.getTarget();if(!(ha.byClass(ac,'snowliftOverlay')||ha.byClass(ac,'fbPhotoSnowliftTagApproval')||ha.byClass(ac,'tagPointer')||ha.byClass(ac,'arrow')||ha.byClass(ac,'faceboxSuggestion')||ha.byClass(ac,'typeaheadWrapper')||ha.byClass(ac,'photoTagTypeahead')||ha.byClass(ac,'fbPhotoTagger')))this.unhiliteAllTags();this.hidePagers();}.bind(this)),t.listen(this.stageWrapper,'mousemove',this.hilitePager.bind(this)),t.listen(this.stageWrapper,'mousemove',this.hiliteTagsOnMouseMove.bind(this)),t.listen(this.overlay,'mouseenter',this.unhiliteAllTags.bind(this)),t.listen(this.container,'mousemove',this.$PhotoSnowlifth.bind(this)),t.listen(this.container,'mouseover',this.$PhotoSnowlifti.bind(this)),t.listen(this.stageWrapper,'focusin',this.hilitePager.bind(this)),t.listen(this.rhc,'focusin',this.hidePagers.bind(this))];if(this.$PhotoSnowliftb){this.stageHandlers.push(t.listen(this.stage,'mousedown',this.$PhotoSnowliftj.bind(this)));this.stageHandlers.push(t.listen(this.root,'mouseup',this.$PhotoSnowliftk.bind(this)));}this.stageHandlers.push(t.listen(this.container,'click',function(event){var ac=event.getTarget();if(ha.byClass(ac,'rotateRight')){this.rotate('right');}else if(ha.byClass(ac,'rotateLeft')){this.rotate('left');}else if(ha.byClass(ac,'closeTheater')){if(w.isFullScreen()){w.toggleFullScreen();return;}this.closingAction=la.X;this.spotlight.hide();return false;}else if(this.fullscreen)if(ha.byClass(ac,'fbPhotoSnowliftFullScreen')){this.toggleFullScreen();}else if(ha.byClass(ac,'fbPhotoSnowliftCollapse'))this.toggleCollapse();}.bind(this)));var yb=ob('fbPhotoSnowliftFeedback');if(yb)this.stageHandlers.push(t.listen(yb,'click',function(event){var ac=event.getTarget();if(ha.byClass(ac,'like_link')||(ha.byClass(ac,'UFILikeLink')&&ha.byClass(ac,'UIActionLinks')))this.toggleLikeButton();var bc=ha.byClass(event.getTarget(),'uiUfiCollapsedComment');if(bc)o.addClass(bc,'uiUfiCollapsedCommentToggle');}.bind(this)));var zb=ob('fbPhotoSnowliftOnProfile');if(zb)this.stageHandlers.push(t.listen(zb,'click',function(event){if(ha.byClass(event.getTarget(),'fbPhotoRemoveFromProfileLink'))this.refreshOnClose=true;}.bind(this)));if(this.resetUriStack)this.startingURI=db.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI();if(!xb)this.setLoadingState(vb.STATE_IMAGE_DATA,true);if(!this.transitionHandlerRegistered){ga.registerHandler(this.transitionHandler.bind(this));this.transitionHandlerRegistered=true;}la.initLogging(la.SNOWLIFT);if(this.pivots)la.setRelevantCount(this.pivots.relevantCount);};vb.prototype.toggleFullScreen=function(){"use strict";var wb=w.toggleFullScreen(document.documentElement);if(wb){var xb=this.stream.getCurrentImageData();if(xb&&xb.url&&this.image.src!==xb.url&&this.shouldShowHiRes(xb))if(!this.$PhotoSnowlift3(xb.url))(new Image()).src=xb.url;la.logEnterFullScreen(this.stream.getCursor());}};vb.prototype.getStream=function(){"use strict";return this.stream;};vb.prototype.fetchInitialData=function(){"use strict";this.ua&&this.ua.add_event('init_data');this.stream.waitForInitData();cb.loadFromEndpoint('PhotoViewerInitPagelet',ob('pagelet_photo_viewer_init',this.root),this.loadQuery,{actorID:bb.getActorIDForFeedbackTargetIfExists(this.loadQuery.fbid),usePipe:true,jsNonblock:true,crossPage:true,allowIrrelevantRequests:this.allowIrrelevantRequests});};vb.prototype.toggleCollapse=function(){"use strict";if(this.rhcCollapsed){this.uncollapseRHC();}else this.collapseRHC();};vb.prototype.collapseRHC=function(){"use strict";this.rhcCollapsed=true;o.addClass(this.root,'collapseRHC');this.adjustForResize();};vb.prototype.uncollapseRHC=function(){"use strict";this.rhcCollapsed=false;o.removeClass(this.root,'collapseRHC');this.adjustForResize();};vb.prototype.closeHandler=function(){"use strict";if(!this.isOpen)return;this.closingAction=this.closingAction||la.ESC;if(db.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI().toString()==this.startingURI.toString()){this.close();return;}this.returnToStartingURI(this.refreshOnClose);this.close();};vb.prototype.returnToStartingURI=function(wb,xb){"use strict";if(!wb)if(xb){this.squashNextTransition(qb.bind(null,xb));}else this.squashNextTransition();this.returningToStart=true;var yb=l.subscribe('page_transition',(function(){this.returningToStart=false;yb.unsubscribe();}).bind(this)),zb=wb||isNaN(eb.opera()),ac=this.$PhotoSnowlifte.length;if(zb&&ac<window.history.length){window.history.go(-ac);}else{var bc=this.startingURI,cc=new db(bc).removeQueryData('closeTheater');if(bc.getQueryData().sk=='approve'&&bc.getPath()=='/profile.php'){cc.removeQueryData('highlight');cc.removeQueryData('notif_t');}qb(cc);}};vb.prototype.squashNextTransition=function(wb){"use strict";this.squashNext=true;ga.registerHandler(function xb(){if(this.squashNext){this.squashNext=false;if(wb)setTimeout(wb,0);ga.transitionComplete(true);return true;}return false;}.bind(this),7);};vb.prototype.handleNavigateAway=function(wb){"use strict";var xb=ib(ga.$PhotoSnowliftl.getQualifiedURI(),wb.getAttribute('href'));if(this.isOpen&&(xb instanceof db)&&xb.getUnqualifiedURI().toString()!=this.startingURI.toString()&&xb.getPath()!='/photo.php'){if(!this.closingAction)this.closingAction=la.NAVIGATE;this.returnToStartingURI(false,xb);this.close();return false;}return true;};vb.prototype.postProcessTaggedPhotos=function(){"use strict";if(this.taggedPhotoIds&&this.taggedPhotoIds.length>0){var wb=null;if(this.source===vb.COLLECTIONS_UNTAGGED_PHOTOS){wb='/ajax/photos/photo/edit/skiptag/';}else if(this.source===vb.PHOTOS_OF_YOU_SUGGESTIONS||this.source===vb.FRIENDS_IN_PHOTOS_SUGGESTIONS)wb='/ajax/photos/photo/add_to_star_grid/';if(wb)new m().setURI(wb).setAllowCrossPageTransition(true).setData({media_id:this.taggedPhotoIds,source:this.source}).send();}};vb.prototype.onTagSaved=function(wb,xb){"use strict";if(this.taggedPhotoIds){if(this.source===vb.PHOTOS_OF_YOU_SUGGESTIONS&&!xb.self_tag)return;this.taggedPhotoIds.push(xb.photo_fbid);}};vb.prototype.clearAlbumBoundaries=function(){"use strict";this.$PhotoSnowliftn={start:0,end:0};};vb.prototype.close=function(){"use strict";if(!this.isOpen)return;this.$PhotoSnowlifto=null;this.hideMorePhotos();this.hidePivotSlide();this.$PhotoSnowliftp();this.isOpen=false;this.$PhotoSnowlift1=0;this.clearAlbumBoundaries();if(this.fullscreen)w.disableFullScreen();sb('snowlift').uai('close');wa.closeOverlayView('snowlift');this.spotlight.hide();this.openExplicitly=false;this.postProcessTaggedPhotos();l.unsubscribe(this.saveTagSubscription);this.taggedPhotoIds=[];this.closeDirty=true;setTimeout(this.closeCleanup.bind(this),0);if(this.snowflake){o.removeClass(this.root,"snowflake");this.extraClasses.forEach(function(wb){o.removeClass(this.root,wb);},this);}this.extraClasses=[];this.snowflake=false;this.firstInSet=null;this.movementDelta=0;};vb.prototype.closeCleanup=function(){"use strict";this.closeDirty=false;o.removeClass(this.root,'dataLoading');la.logPhotoViews(this.closingAction);this.destroy();o.hide(this.errorBox);o.hide(this.image);this.currentImageSize=null;this.thumbSrc=null;this.shouldStretch=false;this.resetUriStack=true;var wb=this.stream.getCursor();o.removeClass(this.stageWrapper,'showVideo');q.empty(this.videoStage);this.uncollapseRHC();this.currentMinSize=null;this.setStagePagersState('reset');this.recacheData();q.empty(this.sideAdUnit);this.stream.destroy();this.root.setAttribute('aria-busy','true');var xb=this.closingAction===la.NAVIGATE;this.closingAction=null;if(!this.openHandlerRegistered){ga.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;}l.inform('layer_hidden',{type:'PhotoSnowlift'});l.inform('PhotoSnowlift.CLOSE',{is_navigating:xb,fbid:wb});this.$PhotoSnowliftq();this.$PhotoSnowliftr=null;};vb.prototype.createLoader=function(wb){"use strict";if(this.currentImageSize===null){this.adjustStageSize(vb.STAGE_MIN);}else{var xb=this.getStageSize(this.currentImageSize);xb=new fb(Math.max(xb.x,vb.STAGE_MIN.x),Math.max(xb.y,vb.STAGE_MIN.y));var yb=this.getImageSizeInStage(this.currentImageSize,xb);if(this.thumbSrc===null){this.adjustStageSize(yb);}else this.useImage(q.create('img',{className:'spotlight',alt:'',src:this.thumbSrc,style:{width:yb.x+'px',height:yb.y+'px'}}),yb,false);}this.setLoadingState(this.STATE_IMAGE_PIXELS,true);if(wb)setTimeout((function(){var zb=new Image(),ac=function(){if(!this.isOpen)return;if(!this.stream||!this.stream.errorInCurrent()){this.switchImage(wb,this.currentImageSize);this.ua&&this.ua.add_event('image');this.setLoadingState(vb.STATE_IMAGE_DATA,false);}}.bind(this),bc=t.listen(zb,'load',ac),cc=function(){if(bc){bc.remove();bc=null;}};l.subscribeOnce('PhotoSnowlift.SWITCH_IMAGE',cc);l.subscribeOnce('PhotoSnowlift.CLOSE',cc);this.$PhotoSnowlift3(wb);zb.src=wb;}).bind(this),0);o.hide(this.stageActions);this.setStagePagersState('disabled');};vb.prototype.initDataFetched=function(wb){"use strict";la.setPhotoSet(this.stream.getPhotoSet());la.setLogFbids(wb.logids);this.$PhotoSnowliftn.start=this.stream.getCursor();var xb=this.stream.getCurrentImageData();la.addPhotoView(xb.info,this.shouldShowHiRes(xb),this.fullscreen&&w.isFullScreen());var yb=this.stream.getCurrentExtraData();if(this.$PhotoSnowlift8&&yb)sa.logImageImpression('snowlift',String(this.stream.getCursor()),Object.keys(yb.tagRects));if(yb&&yb.source!==(void 0)){this.source=parseInt(yb.source,10);la.setSource(this.source);}if(!this.pageHandlers)this.pageHandlers=[t.listen(this.root,'click',this.pageListener.bind(this)),t.listen(this.root,'mouseleave',this.mouseLeaveListener.bind(this))];o.show(this.stageActions);this.root.setAttribute('aria-busy','false');this.isLoggedInViewer=wb.loggedin;this.disableAds=!this.isLoggedInViewer||wb.fromad||this.stream.isInViewAsMode();this.loadAds();if(this.$PhotoSnowlifts(xb)){la.addPanoramaImpression();this.switchIntoZoomedImage();}else if(this.$PhotoSnowliftb)o.hide(this.showZoomInButton);};vb.prototype.adjustScrollerIfNecessary=function(){"use strict";clearTimeout(this.scrollerTimeout);this.scrollerTimeout=setTimeout(this.adjustScroller.bind(this),0);};vb.prototype.adjustScroller=function(wb){"use strict";clearTimeout(this.scrollerTimeout);this.initializeScroller();this.scrollableArea.resize();var xb=fb.getElementDimensions(this.rhc),yb=xb.y;yb-=fb.getElementDimensions(this.rhcHeader).y;yb-=fb.getElementDimensions(this.ufiInputContainer).y;if(this.placeInfo){var zb=fb.getElementDimensions(this.placeInfo);yb-=zb.y;ya.set(this.sideAdUnit,'bottom',zb.y+'px');}if(wb==null)wb=this.resizeCommentsForAds?this.lastAdsHeight:0;this.lastAdsHeight=wb;yb=Math.max(0,yb);var ac=fb.getElementDimensions(this.scrollerBody).y,bc=Math.max(vb.MIN_UFI_HEIGHT,yb-wb);if(ac>=bc){if(yb>bc){o.removeClass(this.rhc,'pinnedUfi');yb-=bc;}else{o.addClass(this.rhc,'pinnedUfi');yb=0;}ya.set(this.scroller,'height',bc+'px');}else{ya.set(this.scroller,'height','auto');o.removeClass(this.rhc,'pinnedUfi');yb-=ac;}var cc=fb.getElementDimensions(this.ufiInputContainer).y;ya.set(this.ufiForm,'padding-bottom',cc+'px');pa.resize(new fb(xb.x,yb));this.scrollableArea.adjustGripper();};vb.prototype.adjustForResize=function(){"use strict";this.currentMinSize=null;this.adjustStageSize();this.adjustForNewData();if(this.$PhotoSnowliftb){if(!this.$PhotoSnowlift2)this.$PhotoSnowliftc();this.$PhotoSnowliftt(this.$PhotoSnowliftr);}};vb.prototype.shouldShowHiRes=function(wb){"use strict";if(!wb||!wb.smallurl)return false;var xb=this.getStageSize(wb.dimensions);xb=this.$PhotoSnowliftf(xb);var yb=this.getImageSizeInStage(wb.dimensions,xb);return (yb.x>vb.STAGE_NORMAL_MAX.x||yb.y>vb.STAGE_NORMAL_MAX.y);};vb.prototype.$PhotoSnowliftf=function(wb){"use strict";if(window.devicePixelRatio&&window.devicePixelRatio>1)wb=new fb(wb.x*window.devicePixelRatio,wb.y*window.devicePixelRatio);return wb;};vb.prototype.getImageURL=function(wb){"use strict";if(wb.video){return null;}else if(wb.smallurl&&!this.shouldShowHiRes(wb))return wb.smallurl;return wb.url;};vb.prototype.getImageOrVideoDimensions=function(wb){"use strict";if(wb.video){var xb=this.getVideoElement(wb.video);if(xb)return this.getVideoSize(xb);}return this.getImageDimensions(wb);};vb.prototype.getImageDimensions=function(wb){"use strict";if(this.$PhotoSnowlift2)return wb.originalDimensions;if(wb.smalldims&&(!this.shouldShowHiRes(wb)||this.image.src===wb.smallurl))return wb.smalldims;return wb.dimensions;};vb.prototype.getStageSize=function(wb,xb){"use strict";var yb=fb.getViewportDimensions(),zb=new fb(wb.x,wb.y+this.getExtraVerticalSpace());if(xb)zb=new fb(Math.max(wb.x,xb.x),Math.max(wb.y,xb.y));var ac,bc;if(this.fullscreen&&w.isFullScreen()){return new fb((this.rhcCollapsed?screen.width:screen.width-vb.SIDEBAR_SIZE_MAX),screen.height-vb.FULL_SCREEN_PADDING*2);}else{ac=Math.min(zb.x,(yb.x-vb.SIDEBAR_SIZE_MAX-vb.STAGE_CHROME.x));bc=Math.min(zb.y,yb.y-vb.STAGE_CHROME.y);}if(ac===0&&bc===0)return new fb(0,0);var cc=ac/bc,dc=zb.x/zb.y;if(cc<dc)return new fb(ac,Math.round(ac/dc));return new fb(Math.round(bc*dc),bc);};vb.prototype.getExtraVerticalSpace=function(){"use strict";if(this.getVideoOnStage())return vb.VIDEO_BOTTOM_BAR_SPACE*2;return 0;};vb.prototype.getComponentsHeight=function(){"use strict";var wb=this.getVideoOnStage();if(wb)return this.getVideoComponentsHeight(ob(wb));return 0;};vb.prototype.getImageSizeInStage=function(wb,xb){"use strict";var yb=wb.x,zb=wb.y,ac=this.getComponentsHeight(),bc=this.getExtraVerticalSpace();zb-=ac;xb=new fb(xb.x,xb.y-ac-bc);if(yb>=xb.x||zb>=xb.y){var cc=xb.x/xb.y,dc=yb/zb;if(cc<dc){yb=xb.x;zb=Math.round(yb/dc);}else if(cc>dc){zb=xb.y;yb=Math.round(zb*dc);}else{yb=xb.x;zb=xb.y;}}return new fb(yb,zb+ac);};vb.prototype.getStageSizeForZoomedImage=function(wb,xb){"use strict";if(this.fullscreen&&w.isFullScreen()){var yb=this.rhcCollapsed?screen.width:screen.width-vb.SIDEBAR_SIZE_MAX,zb=screen.height-vb.FULL_SCREEN_PADDING*2;return new fb(yb,zb);}var ac=fb.getViewportDimensions();if(xb===null)xb=new fb(0,0);var bc=new fb(Math.max(wb.x,vb.STAGE_MIN.x,xb.x),Math.max(wb.y,vb.STAGE_MIN.y,xb.y)),cc=ac.x-vb.STAGE_CHROME.x;if(!this.rhcCollapsed)cc-=vb.SIDEBAR_SIZE_MAX;yb=Math.min(bc.x,cc);zb=Math.min(bc.y,ac.y-vb.STAGE_CHROME.y);return new fb(yb,zb);};vb.prototype.adjustStageSize=function(wb){"use strict";var xb=this.currentImageSize;if(wb){xb=wb;}else{var yb=this.stream&&this.stream.getCurrentImageData();if(yb)xb=this.getImageOrVideoDimensions(yb);}if(!xb)return;this.currentImageSize=xb;var zb=this.getExtraVerticalSpace();if(this.shouldStretch&&!this.getVideoOnStage()&&xb.x>xb.y&&xb.x<=vb.TIMELINE_STRETCH_WIDTH&&xb.x>=vb.TIMELINE_STRETCH_MIN){xb.y=Math.round(xb.y*vb.TIMELINE_STRETCH_WIDTH/xb.x);xb.x=vb.TIMELINE_STRETCH_WIDTH;}var ac;if(this.$PhotoSnowlift2){ac=this.getStageSizeForZoomedImage(xb,this.currentMinSize);}else ac=this.getStageSize(xb,this.currentMinSize);if(!this.currentMinSize)this.currentMinSize=new fb(0,0);this.currentMinSize=new fb(Math.max(ac.x,vb.STAGE_MIN.x,this.currentMinSize.x),Math.max(ac.y,vb.STAGE_MIN.y,this.currentMinSize.y));var bc=this.getImageSizeInStage(xb,this.currentMinSize),cc=this.currentMinSize.x-bc.x,dc=this.currentMinSize.y-bc.y;if(cc>0&&cc<vb.PADDING_MIN){this.currentMinSize.x-=cc;}else if(dc>0&&dc<vb.PADDING_MIN)this.currentMinSize.y-=dc;var ec=this.currentMinSize.x+vb.SIDEBAR_SIZE_MAX;if(this.rhcCollapsed)ec=this.currentMinSize.x;var fc=this.getVideoOnStage()&&this.pivotsCarouselElement,gc=0,hc=this.currentMinSize.y;if(fc){var ic=this.pivotsCarouselElement.clientHeight;gc=Math.ceil(ic/100)*100;hc=hc+gc;}this.snowliftPopup.style.cssText='width:'+ec+'px;'+'height:'+hc+'px;';var jc=this.currentMinSize.y-zb,kc=jc+gc;if(eb.firefox()){var lc=ya.get(this.stageWrapper,'font-size');jc=(jc/parseFloat(lc))+'em';kc=(kc/parseFloat(lc))+'em';}else{jc=jc+'px';kc=kc+'px';}this.stageWrapper.style.cssText='width:'+this.currentMinSize.x+'px;'+'line-height:'+jc+';';if(this.getVideoOnStage())this.videoStage.style.cssText='width:'+this.currentMinSize.x+'px;'+'height:'+kc+';';if(this.$PhotoSnowlift2){var mc=this.currentMinSize.y-zb;if(xb.y>mc){var nc=(xb.x/xb.y)*mc;ya.apply(this.zoomedImage,{width:nc+"px",height:mc+"px"});}else ya.apply(this.zoomedImage,{width:xb.x+"px",height:xb.y+"px"});}else{bc.y-=this.getComponentsHeight();this.setMediaElementSize(bc);}if(fc)this.setPivotCarouselElementWidth(lc);var oc=this.getTagger();if(oc)oc.repositionTagger();this.adjustScrollerIfNecessary();};vb.prototype.setMediaElementSize=function(wb){"use strict";var xb=this.image;if(this.getVideoOnStage())xb=q.scry(this.videoStage,"._53j5")[0]||xb;xb.style.cssText='width:'+wb.x+'px;'+'height:'+wb.y+'px;';};vb.prototype.setPivotCarouselElementWidth=function(wb){"use strict";var xb=this.videoStage.clientWidth;if(eb.firefox()){xb=(xb/parseFloat(wb))+'em';}else xb=xb+'px';this.pivotsCarouselElement.style.width=xb;};vb.prototype.adjustForNewData=function(){"use strict";if(!this.image)return;var wb=q.scry(this.stage,'div.tagsWrapper')[0],xb=fb.getElementDimensions(this.image);if(wb){ya.set(wb,'width',xb.x+'px');ya.set(wb,'height',xb.y+'px');}};vb.prototype.adsDisplayedCallback=function(wb,xb){"use strict";var yb=this.resizeCommentsForAds&&!this.inAdsDisplayedCallback&&!this.disableAds&&wb<vb.MIN_ADS_VISIBLE&&xb.length>=vb.MIN_ADS_VISIBLE;if(yb){this.inAdsDisplayedCallback=true;var zb=xb[vb.MIN_ADS_VISIBLE-1];this.adjustScroller(zb);this.inAdsDisplayedCallback=false;}};vb.prototype.setLoadingState=function(wb,xb){"use strict";switch(wb){case vb.STATE_IMAGE_PIXELS:o.conditionClass(this.root,'imagePixelsLoading',xb);break;case vb.STATE_IMAGE_DATA:this.loadingStates[wb]=xb;o.conditionClass(this.root,'imageLoading',xb);break;case vb.STATE_HTML:this.loadingStates[wb]=xb;o.conditionClass(this.root,'dataLoading',xb);this.rhc.setAttribute('aria-busy',xb?'true':'false');break;}};vb.prototype.destroy=function(){"use strict";this.stageHandlers.forEach(function(wb){wb.remove();});if(this.pageHandlers){this.pageHandlers.forEach(function(wb){wb.remove();});this.pageHandlers=null;}this.$PhotoSnowliftu&&clearInterval(this.$PhotoSnowliftu);this.$PhotoSnowliftu=null;this.$PhotoSnowliftv=null;};vb.prototype.checkState=function(wb){"use strict";if(wb!=vb.STATE_ERROR&&!this.loadingStates[wb])return;switch(wb){case vb.STATE_IMAGE_DATA:var xb=this.stream.getCurrentImageData();if(xb){var yb=this.getImageURL(xb);if(yb){if(!this.$PhotoSnowlift2&&this.$PhotoSnowlifts())this.$PhotoSnowliftw();this.switchImage(yb,null,true);}else if(xb.video)this.switchVideo(xb.video,true);this.setLoadingState(wb,false);}break;case vb.STATE_HTML:if(this.stream.getCurrentHtml()){this.swapData();this.setLoadingState(wb,false);}break;default:if(this.stream.errorInCurrent()){o.hide(this.image);o.show(this.errorBox);}break;}};vb.prototype.buttonListener=function(event){"use strict";var wb=event.getTarget(),xb=Date.now();if(ha.byClass(wb,"_5qmg")){la.addPanoramaClick();this.switchIntoZoomedImage();return;}if(ha.byClass(wb,"_5qmh")){this.$PhotoSnowliftq();this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));return false;}if(ha.byClass(wb,'fbPhotoTagApprovalBox'))return;if(xb-this.lastPage<350)return;if(ha.byClass(wb,'fbPhotosPhotoLike')){this.likePhoto();}else if(ha.byClass(wb,'tagApproveIgnore')){this.updateTagBox(event,wb);}else if(ha.byClass(wb,"_5ge9")){this.hideMorePhotos();this.toggleSlideshow();return false;}else if(ha.byClass(wb,"_5ymu")){if(!this.$PhotoSnowliftx){sa.logShowMorePhotos();var yb=this.stream.getCursor();if(yb)this.showMorePhotos(String(yb));if(this.$PhotoSnowliftb)o.hide(this.showZoomInButton);}else{sa.logHideMorePhotos();this.$PhotoSnowliftc();this.hideMorePhotos();}return;}else if(ha.byClass(wb,"_27n"))this.$PhotoSnowliftc();this.hideMorePhotos();};vb.prototype.toggleSlideshow=function(){"use strict";if(!this.slideshowGk)return;if(this.$PhotoSnowliftu){this.stopSlideshow();}else this.startSlideshow();};vb.prototype.startSlideshow=function(){"use strict";this.$PhotoSnowliftu=window.setInterval(this.page.bind(this,1,eb.chrome()&&w.isFullScreen()),vb.SLIDESHOW_TIME);o.addClass(this.root,'slideshowStarted');o.removeClass(this.root,'slideshowAvailable');};vb.prototype.stopSlideshow=function(){"use strict";this.$PhotoSnowliftu&&clearInterval(this.$PhotoSnowliftu);this.$PhotoSnowliftu=null;o.addClass(this.root,'slideshowAvailable');o.removeClass(this.root,'slideshowStarted');};vb.prototype.likePhoto=function(){"use strict";la.addButtonLike();var wb=hb('fbPhotoSnowliftFeedback'),xb=q.scry(wb,'button.like_link')[0];if(!xb)xb=q.scry(wb,'a.UFILikeLink')[0];var yb=xb.getAttribute('href');if(w.isFullScreen())if(eb.chrome())xb.setAttribute('href','javascript:;');xb.click();xb.setAttribute('href',yb);};vb.prototype.toggleLikeButton=function(){"use strict";var wb=q.scry(this.buttonActions,'a.fbPhotosPhotoLike')[0];if(wb){var xb=q.find(this.root,'.likeCount'),yb=q.find(xb,'.likeCountNum');if(xb)if(o.hasClass(wb,'viewerLikesThis')){q.setContent(yb,parseInt(yb.textContent,10)-1);}else q.setContent(yb,parseInt(yb.textContent,10)+1);o.toggleClass(wb,'viewerLikesThis');o.removeClass(wb,'viewerAlreadyLikedThis');}};vb.prototype.likePhotoWithKey=function(){"use strict";return ca.like(this.likePhoto.bind(this),pb());};vb.prototype.updateTagBox=function(wb,xb){"use strict";this.unhiliteAllTags();var yb=ob(wb);if(!yb)return;o.addClass(yb,'tagBox');o.addClass(yb,'tagBoxPendingResponse');o.removeClass(yb,'tagBoxPending');o.hide(q.find(yb,'span.tagForm'));if(xb){o.show(q.find(yb,'span.tagApproved'));}else o.show(q.find(yb,'span.tagIgnored'));};vb.prototype.rotate=function(wb){"use strict";var xb=this.stream.getCursor();if(this.getVideoOnStage()){var yb=(wb=='left')?270:90;rb(!!this.videoRotateURI);n.loadModules(["VideoRotate"],function(ac){new ac(xb,this.videoRotateURI).motionRotate(yb);}.bind(this));return;}var zb=jb({fbid:xb,opaquecursor:this.stream.getOpaqueCursor(xb),cs_ver:ka.VIEWER_SNOWLIFT},this.stream.getPhotoSetQuery());zb[wb]=1;this.setLoadingState(vb.STATE_IMAGE_DATA,true);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);o.hide(this.image);new m('/ajax/photos/photo/rotate/').setAllowCrossPageTransition(true).setData(zb).setErrorHandler(this.rotationError.bind(this,xb)).setFinallyHandler(this.rotationComplete.bind(this,xb)).setMethod('POST').setReadOnly(false).send();};vb.prototype.rotationComplete=function(wb,xb){"use strict";if(wb==this.stream.getCursor()){this.setLoadingState(vb.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));this.swapData();}};vb.prototype.rotationError=function(wb,xb){"use strict";if(wb==this.stream.getCursor()){this.setLoadingState(vb.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));n.loadModules(["AsyncResponse"],function(yb){yb.defaultErrorHandler(xb);});}};vb.prototype.saveTagsFromPayload=function(wb){"use strict";this.storeFromData(wb);if('data' in wb&&this.stream.getCursor() in wb.data)this.swapData();};vb.prototype.saveEdit=function(){"use strict";if(!o.hasClass(this.root,'fbPhotoSnowliftEditMode'))return;n.loadModules(["PhotoInlineEditor","Form"],function(wb,xb){var yb=wb.getInstance(this.getViewerConst());yb&&xb.bootstrap(yb.getForm().controller);}.bind(this));};vb.prototype.mouseLeaveListener=function(event){"use strict";this.unhiliteAllTags();this.reHilitePendingTag();};vb.prototype.hilitePager=function(event){"use strict";var wb=fb.getEventPosition(event),xb=fb.getElementPosition(this.stage);if(fa.isRTL()){var yb=fb.getElementDimensions(this.stage);this.stagePagerPrev=yb.x-(wb.x-xb.x)<vb.GOPREV_AREA;}else this.stagePagerPrev=wb.x-xb.x<vb.GOPREV_AREA;o.conditionClass(this.prevPager,'hilightPager',this.stagePagerPrev);o.conditionClass(this.nextPager,'hilightPager',!this.stagePagerPrev);var zb,ac=event.getTarget();if(!ha.byClass(ac,'snowliftOverlay')&&!ha.byClass(ac,'bottomBarActions')&&!ha.byClass(ac,'snowliftPager'))zb=vb.PAGER_FADE;this.showPagers(zb);};vb.prototype.showPagers=function(wb){"use strict";clearTimeout(this.fadePagerTimer);this.setStagePagersState('active');if(wb===(void 0))this.fadePagerTimer=setTimeout(this.hidePagers.bind(this),wb);};vb.prototype.hidePagers=function(){"use strict";var wb=q.scry(this.getRoot(),'.fbPhotosPhotoActionsMenu')[0];if(wb)return;clearTimeout(this.fadePagerTimer);this.setStagePagersState('inactive');};vb.prototype.getTagger=function(){"use strict";return (this.PhotoTagger&&this.PhotoTagger.getInstance(ka.VIEWER_SNOWLIFT));};vb.prototype.unhiliteAllTags=function(){"use strict";clearTimeout(this.unhiliteTimer);q.scry(this.stage,'div.tagsWrapper div.hover').forEach(function(xb){o.removeClass(xb,'hover');});q.scry(this.stage,'div.tagsWrapper div.otherActive').forEach(function(xb){o.removeClass(xb,'otherActive');});this.hilitedTag=null;this.showingTypeaheadSuggestions=false;if(!o.hasClass(this.root,'taggingMode')){var wb=this.getTagger();if(wb){wb.hideTagger();wb.setCurrentFacebox(null);}}};vb.prototype.switchHilitedTags=function(wb,xb){"use strict";if(this.switchTimer!==null){clearTimeout(this.switchTimer);this.switchTimer=null;}this.unhiliteAllTags();this.hiliteAllBoxes();var yb=ob(wb);if(yb){this.hilitedTag=wb;if(!o.hasClass(this.root,'taggingMode')&&ra.isFacebox(this.hilitedTag)){var zb=this.getTagger();if(zb){o.addClass(yb,'hover');var ac=zb.getFacebox(wb);zb.setCurrentFacebox(ac);if(ac)zb.addTagFromFacebox(ac);}}else o.addClass(yb,'hover');if(o.hasClass(yb,'tagBoxPending')&&!o.hasClass(yb,'showPendingTagName')&&xb===true){q.scry(this.stage,'div.tagsWrapper div.showPendingTagName').forEach(function(bc){o.removeClass(bc,'showPendingTagName');});o.addClass(yb,'showPendingTagName');}}};vb.prototype.reHilitePendingTag=function(){"use strict";var wb=ob(this.hilitedTag);if(wb&&o.hasClass(wb,'showPendingTagName'))return;var xb=q.scry(this.stage,'div.tagsWrapper div.showPendingTagName')[0];if(xb)this.switchHilitedTags(xb.id);};vb.prototype.hiliteTagsOnMouseMove=function(event){"use strict";if(!this.stream.getCurrentExtraData()||this.getVideoOnStage())return;if(this.switchTimer!==null)return;var wb=event.getTarget();if(ha.byClass(wb,'snowliftOverlay')||ha.byClass(wb,'fbPhotoSnowliftTagApproval')||ha.byClass(wb,'tagPointer')||ha.byClass(wb,'arrow')||ha.byClass(wb,'faceboxSuggestion')||ha.byClass(wb,'typeaheadWrapper')||ha.byClass(wb,'photoTagTypeahead'))return;var xb=ha.byClass(wb,'tagBoxPending'),yb=false;if(this.hilitedTag){var zb=ob(this.hilitedTag);yb=zb&&o.hasClass(zb,'tagBoxPending');}var ac=((!this.hilitedTag&&xb)||(!yb&&xb));if(ac){this.switchHilitedTags(xb.id);return;}if(xb&&(xb.id==this.hilitedTag))return;var bc=250,cc=15,dc=fb.getEventPosition(event);if(!this.startingMousePos)this.startingMousePos=dc;var ec=ra.absoluteToNormalizedPosition(this.image,dc);if(!this.haveLeftBufferRegion&&this.startingMousePos.distanceTo(dc)<cc){return;}else this.haveLeftBufferRegion=true;if(this.currentTagHasPrecedence(ec))return;var fc=ra.getNearestBox(this.stream.getCurrentExtraData().tagRects,ec);if(!fc){if(!yb){this.unhiliteAllTags();this.reHilitePendingTag();}return;}var gc=null;if(yb){var hc={};hc[this.hilitedTag]=this.stream.getCurrentExtraData().tagRects[this.hilitedTag];gc=ra.getNearestBox(hc,ec);}if(gc!==null&&yb)return;if(this.hilitedTag!=fc)if(yb){this.switchTimer=setTimeout(this.switchHilitedTags.bind(this,fc),bc);}else{if(this.$PhotoSnowlift8&&!this.$PhotoSnowlift0[fc]){this.$PhotoSnowlift0[fc]=true;sa.logPivotImpression('snowlift',fc);}this.switchHilitedTags(fc);}};vb.prototype.currentTagHasPrecedence=function(wb){"use strict";if(!this.hilitedTag)return false;if(this.stream.getCurrentExtraData().tagRects[this.hilitedTag]===(void 0)){this.hilitedTag=null;return false;}var xb=this.stream.getCurrentExtraData().tagRects[this.hilitedTag],yb=new va(xb.t+(xb.h()/2),xb.r,xb.b+(ra.isFacebox(this.hilitedTag)?10:0),xb.l,xb.domain);return yb.contains(wb);};vb.prototype.getVideoOnStage=function(){"use strict";var wb=this.stream&&this.stream.getCurrentImageData();return wb&&wb.video;};vb.prototype.shouldPageOnAction=function(wb,xb){"use strict";if(!this.isOpen||ca.isShowingConfirmation())return false;var yb=q.isNode(xb)&&(ha.byClass(xb,'snowliftPager')||ha.byClass(xb,'stagePagers')||ha.byClass(xb,'pivotPageColumn')),zb=q.isNode(xb)&&ha.byClass(xb,'stage'),ac=o.hasClass(xb,'faceBox'),bc=(!o.hasClass(this.root,'taggingMode')&&ac&&!yb);if(bc){if(!this.showingTypeaheadSuggestions){this.getTagger().updateWithSuggestions();setTimeout((function(){q.find(this.getTagger().tagger,'input.textInput').focus();}).bind(this),0);}this.showingTypeaheadSuggestions=!this.showingTypeaheadSuggestions;return false;}var cc=((zb&&o.hasClass(this.root,'taggingMode'))||ha.byClass(xb,'tagBoxPending')||ha.byClass(xb,'tagBoxPendingResponse')||ha.byClass(xb,'fbPhotoTagApprovalBox')||ha.byClass(xb,'tag'));if(cc)return false;if(zb&&this.$PhotoSnowlift2)zb=false;return wb==z.LEFT||wb==z.RIGHT||wb==g||wb==h||yb||bc||zb;};vb.prototype.keyHandler=function(wb,event){"use strict";if(event.getModifiers().any||aa.getTopmostLayer()!==this.spotlight)return true;switch(t.getKeyCode(event)){case z.LEFT:case z.RIGHT:case g:case h:this.pageListener(event);return false;case i:return this.toggleFullScreen();case j:return this.likePhotoWithKey();case z.SPACE:this.toggleSlideshow();this.showPagers(vb.PAGER_FADE);return false;case z.ESC:if(this.$PhotoSnowlift2){this.$PhotoSnowliftq();this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));return false;}break;}};vb.prototype.shouldHandlePendingTag=function(event){"use strict";var wb=this.getTagger();if(!wb||!wb.tags.length)return false;var xb=ra.absoluteToNormalizedPosition(this.getImage(),fb.getEventPosition(event)),yb=wb.findNearestTag(xb);if(!yb||!o.hasClass(yb.node,'tagBoxPending'))return false;l.inform('PhotoTagApproval.PENDING_TAG_PHOTO_CLICK',{id:yb.id,version:this.getVersionConst()});return true;};vb.prototype.pageListener=function(event){"use strict";var wb=t.getKeyCode(event),xb=event.getTarget();if(this.$PhotoSnowliftu){this.stopSlideshow();return;}if(!this.shouldPageOnAction(wb,xb))return;if(this.shouldHandlePendingTag(event))return;var yb=0;if(wb==z.RIGHT||wb==h){yb=1;la.setPagingAction('key_right');this.$PhotoSnowlifty=true;}else if(wb==z.LEFT||wb==g){yb=-1;la.setPagingAction('key_left');this.$PhotoSnowlifty=true;}else if(ha.byClass(xb,'next')){yb=1;la.setPagingAction('click_next');}else if(ha.byClass(xb,'prev')){yb=-1;la.setPagingAction('click_prev');}else if(!this.stagePagerPrev){yb=1;la.setPagingAction('click_stage');}else{yb=-1;la.setPagingAction('click_stage_back');}var zb=q.scry(this.ufiForm,'input.mentionsHidden'),ac=false;for(var bc=0;bc<zb.length;bc++)if(!y.isEmpty(zb[bc])){ac=true;break;}if(ac||o.hasClass(this.root,'fbPhotoSnowliftEditMode')){this.warnLeavePage(this.page.bind(this,yb));}else{this.page(yb,eb.chrome()&&w.isFullScreen());this.$PhotoSnowliftr=null;sb('snowlift',xb,event).uai(la.pagingAction);}};vb.prototype.warnLeavePage=function(wb){"use strict";new p().setTitle("\u3053\u306e\u30da\u30fc\u30b8\u304b\u3089\u79fb\u52d5\u3057\u307e\u3059\u304b\uff1f").setBody("\u30da\u30fc\u30b8\u304b\u3089\u79fb\u52d5\u3059\u308b\u3068\u3001\u4fdd\u5b58\u3055\u308c\u3066\u3044\u306a\u3044\u5909\u66f4\u306f\u5931\u308f\u308c\u307e\u3059\u3002").setButtons([{name:'leave_page',label:"\u79fb\u52d5\u3059\u308b",handler:wb},{name:'continue_editing',label:"\u3053\u306e\u30da\u30fc\u30b8\u304b\u3089\u79fb\u52d5\u3057\u306a\u3044",className:'inputaux'}]).setModal(true).show();};vb.prototype.getUsesOpaqueCursor=function(){"use strict";return this.stream.getUsesOpaqueCursor();};vb.prototype.getOpaqueCursor=function(wb){"use strict";return this.stream.getOpaqueCursor(wb);};vb.prototype.setReachedLeftEnd=function(){"use strict";this.stream.setReachedLeftEnd();};vb.prototype.setReachedRightEnd=function(){"use strict";this.stream.setReachedRightEnd();};vb.prototype.page=function(wb,xb){"use strict";if(!this.stream.isValidMovement(wb)||!this.stream.nonCircularPhotoSetCanPage(wb)){this.showPagers(vb.PAGER_FADE);return;}var yb=this.stream.getCursorAt(this.stream.calculatePositionForMovement(wb));if(this.snowflake&&((this.stream.getCursor()==this.firstInSet&&wb<0)||(this.firstInSet==yb&&wb>0))){this.showPagers(vb.PAGER_FADE);return;}this.lastPage=Date.now();this.unhiliteAllTags();this.startingMousePos=null;this.haveLeftBufferRegion=false;this.$PhotoSnowlift0={};this.$PhotoSnowlift1+=wb;var zb=this.stream.allLoaded?Math.abs(this.$PhotoSnowlift1)-this.stream.getLength():null;if(this.$PhotoSnowlifta&&this.$PhotoSnowlifto){if(!this.$PhotoSnowliftn.end&&zb===0){this.$PhotoSnowliftn.end=this.stream.getCursor();}else if(zb===-1)oa.fetch(this.$PhotoSnowlifto,this.stream);if(!this.onExtraSlide){if(this.stream.getCursor()===this.$PhotoSnowliftn.end&&yb===this.$PhotoSnowliftn.start){this.showPivotSlide(this.$PhotoSnowlifto,xb);return;}else if(this.stream.getCursor()===this.$PhotoSnowliftn.start&&yb===this.$PhotoSnowliftn.end)this.showPivotSlide(this.$PhotoSnowlifto,xb);}else{this.hidePivotSlide();if(yb!==this.$PhotoSnowliftn.start)return;}}var ac=this.getVideoOnStage();if(ac)this.switchVideo(ac,false);if(this.pivots&&this.pivots.page(wb))return;l.inform('PhotoSnowlift.PAGE');za.hide();this.recacheData();this.stream.moveCursor(wb);o.hide(this.image);if(wb!==0){this.storyID=null;this.$PhotoSnowlift5();}if(wb!==0&&this.$PhotoSnowlift2)this.$PhotoSnowliftq();if(this.stream.errorInCurrent()){this.setLoadingState(vb.STATE_HTML,true);o.show(this.errorBox);return;}this.movementDelta+=wb;var bc=this.stream.getCurrentImageData();if(bc){var cc=this.getImageURL(bc);if(cc){if(!this.$PhotoSnowlift2&&this.$PhotoSnowlifts())this.$PhotoSnowliftw();this.switchImage(cc,null,true);}else if(bc.video)this.switchVideo(bc.video,true);if(!xb){this.replaceUrl=true;qb(bc.info.permalink);}this.setLoadingState(vb.STATE_IMAGE_DATA,false);}else{this.setLoadingState(vb.STATE_IMAGE_PIXELS,true);this.setLoadingState(vb.STATE_IMAGE_DATA,true);}if(this.stream.getCurrentHtml()){this.swapData();}else this.setLoadingState(vb.STATE_HTML,true);this.disableAds=!this.isLoggedInViewer||this.stream.isInViewAsMode();this.loadAds();this.setLeftAndRightPagersState();if(this.$PhotoSnowliftu){o.addClass(this.root,'slideshowStarted');}else if(this.slideshowAvailable)o.addClass(this.root,'slideshowAvailable');if(!this.$PhotoSnowlifta&&this.$PhotoSnowlift9&&this.$PhotoSnowlifto)if(zb===-1){oa.fetch(this.$PhotoSnowlifto,this.stream);}else if(zb===0){sa.logSuggestMorePhotos();this.showMorePhotos(this.$PhotoSnowlifto,true);this.showPagers();this.$PhotoSnowlift1=0;}else{this.hideMorePhotos();this.hidePagers();}};vb.prototype.showMorePhotos=function(wb,xb){"use strict";if(this.$PhotoSnowliftx)return;this.$PhotoSnowliftx=true;if(!this.searchPivot)this.searchPivot=this.overlay.appendChild(document.createElement('div'));o.addClass(this.stageWrapper,"_5ymv");this.searchPivotComponent=ua.render(ua.createElement(na,{className:"_27g",fbid:wb,onclose:this.hideMorePhotos.bind(this),endofalbum:xb||false,withBackground:true}),this.searchPivot);};vb.prototype.hideMorePhotos=function(){"use strict";if(this.searchPivotComponent&&this.$PhotoSnowliftx){this.$PhotoSnowliftx=false;o.removeClass(this.stageWrapper,"_5ymv");this.searchPivotComponent.setProps({fbid:null});}};vb.prototype.showPivotSlide=function(wb,xb){"use strict";if(this.onExtraSlide)return;this.onExtraSlide=true;o.addClass(this.stageWrapper,"_3tvf");if(!this.pivotSlide){this.pivotSlide=q.create('div');q.insertBefore(this.stageActions,this.pivotSlide);}this.pivotSlideComponent=ua.render(ua.createElement(ma,{fbid:wb,isAlbum:this.$PhotoSnowliftz,albumOwnerName:this.$PhotoSnowliftA,visible:true,onReturn:this.returnToBeginning.bind(this,xb)}),this.pivotSlide);};vb.prototype.hidePivotSlide=function(){"use strict";if(this.pivotSlideComponent&&this.onExtraSlide){this.pivotSlideComponent.setProps({visible:false});o.removeClass(this.stageWrapper,"_3tvf");}this.onExtraSlide=false;};vb.prototype.returnToBeginning=function(wb){"use strict";var xb=this.stream.getRelativeMovement(this.$PhotoSnowliftn.start);this.page(xb,wb);};vb.prototype.logImpressionDetailsForPhoto=function(){"use strict";var wb=[].concat(q.scry(hb('fbPhotoSnowliftTagList'),'input.photoImpressionDetails'),q.scry(hb('fbPhotoSnowliftFeedback'),'input.photoImpressionDetails'));if(wb.length===0)return;var xb={};for(var yb=0;yb<wb.length;yb++)xb[wb[yb].name]=wb[yb].value;if(this.getVideoOnStage()){xb.width=0;xb.height=0;}else{var zb=this.getImageDimensions(this.stream.getCurrentImageData());xb.width=zb.x;xb.height=zb.y;}la.addDetailData(this.stream.getCursor(),xb);pa.setIsLogAdData(true);};vb.prototype.loadAds=function(){"use strict";if(this.disableAds)return;pa.loadAdsFromUserActivity();};vb.prototype.transitionHandler=function(wb){"use strict";if(wb.getQueryData().closeTheater||wb.getQueryData().permPage||this.returningToStart){if(this.isOpen)this.close();this.transitionHandlerRegistered=false;return false;}if(this.replaceUrl){this.replaceUrl=false;this.$PhotoSnowlifte.push(wb.getQualifiedURI().toString());ga.transitionComplete(true);return true;}var xb=this.$PhotoSnowlifte.length;if(xb>=2&&this.$PhotoSnowlifte[xb-2]==wb.getQualifiedURI().toString())this.$PhotoSnowlifte.pop();var yb=this.stream.getCursorForURI(wb.getUnqualifiedURI().toString());if(yb){var zb=this.stream.getRelativeMovement(yb);this.page(zb,true);ga.transitionComplete(false);return true;}if(this.isOpen){ga.transitionComplete(true);this.close();return true;}this.transitionHandlerRegistered=false;return false;};vb.prototype.recacheData=function(){"use strict";if(!this.loadingStates.html){var wb=this.stream.getCurrentHtml();for(var xb in wb){wb[xb]=kb(hb(xb).childNodes);q.empty(hb(xb));}}};vb.prototype.reloadIfTimeout=function(){"use strict";if(!x.hasLoaded(this.image)){var wb=this.makeNewImage(this.image.src,true);t.listen(wb,'load',this.useImage.bind(this,wb,null,true));this.$PhotoSnowlift3(wb.src);}};vb.prototype.useImage=function(wb,xb,yb){"use strict";if(yb&&x.hasLoaded(this.image))return;q.replace(this.image,wb);this.image=wb;this.adjustStageSize(xb);};vb.prototype.makeNewImage=function(wb,xb){"use strict";if(this.imageLoadingTimer){clearTimeout(this.imageLoadingTimer);this.imageLoadingTimer=null;}else if(!xb)this.imageRefreshTimer=setTimeout(this.reloadIfTimeout.bind(this),vb.LOADING_TIMEOUT);var yb=q.create('img',{className:'spotlight',alt:''});yb.setAttribute('aria-describedby','fbPhotosSnowliftCaption');yb.setAttribute('aria-busy','true');var zb=function(){clearTimeout(this.imageRefreshTimer);this.image.setAttribute('aria-busy','false');this.setLoadingState(this.STATE_IMAGE_PIXELS,false);setTimeout((function(){if(this.isOpen){this.adjustStageSize();this.adjustForNewData();}}).bind(this),0);}.bind(this);t.listen(yb,'load',zb);this.$PhotoSnowlift3(wb);yb.src=wb;return yb;};vb.prototype.switchImage=function(wb,xb,yb){"use strict";o.hide(this.image);o.hide(this.errorBox);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);var zb=this.stream&&this.stream.getCurrentImageData();if(zb){la.addPhotoView(zb.info,this.shouldShowHiRes(zb),this.fullscreen&&w.isFullScreen());if(this.$PhotoSnowlift8){var ac=this.stream.getCurrentExtraData();if(ac)sa.logImageImpression('snowlift',String(this.stream.getCursor()),Object.keys(ac.tagRects));}}this.useImage(this.makeNewImage(wb,false),xb,false);if(yb)this.stream.preloadImages(this.shouldShowHiRes.bind(this));if(!this.$PhotoSnowlift2&&this.$PhotoSnowlifts(zb)){la.addPanoramaImpression();var bc=new fb(this.stage.clientWidth,this.stage.clientHeight);this.$PhotoSnowliftB(bc);}else if(this.$PhotoSnowliftb)o.hide(this.showZoomInButton);if(this.$PhotoSnowlift2){this.switchIntoZoomedImage();this.showPagers(vb.PAGER_FADE);}l.inform('PhotoSnowlift.SWITCH_IMAGE');};vb.prototype.$PhotoSnowliftc=function(){"use strict";if(!this.$PhotoSnowliftb)return;if(this.$PhotoSnowlifts()){var wb=new fb(this.stage.clientWidth,this.stage.clientHeight);this.$PhotoSnowliftB(wb);}else o.hide(this.showZoomInButton);};vb.prototype.$PhotoSnowliftB=function(wb){"use strict";var xb=parseInt(this.image.style.height,10),yb=(wb.y-xb)/2;if(yb>=vb.ZOOM_BUTTON_TOP_PAD+vb.ZOOM_BUTTON_BOT_PAD+vb.ZOOM_BUTTON_HEIGHT){var zb=yb-vb.ZOOM_BUTTON_HEIGHT-vb.ZOOM_BUTTON_TOP_PAD;ya.set(this.showZoomInButton,'bottom',zb+'px');}else ya.set(this.showZoomInButton,'bottom','60px');o.show(this.showZoomInButton);};vb.prototype.$PhotoSnowlifts=function(wb){"use strict";if(wb===(void 0))wb=this.stream&&this.stream.getCurrentImageData();if(!this.$PhotoSnowliftb||!wb||!wb.originalDimensions)return false;var xb=new fb(this.stage.clientWidth,this.stage.clientHeight),yb=wb.originalDimensions,zb=yb.x/yb.y,ac=Math.min(xb.y*zb,yb.x);if(!isNaN(zb)&&zb>2&&yb.y>vb.MIN_PANORAMA_Y&&xb.x*vb.MIN_PANO_TO_STAGE_RATIO<ac){return true;}else return false;};vb.prototype.$PhotoSnowliftw=function(){"use strict";this.$PhotoSnowlift2=true;o.hide(this.showZoomInButton);o.hide(this.stageActions);o.show(this.showZoomOutButton);ya.set(this.stage,'overflow','hidden');this.spotlight.disableBehavior(ba);this.collapseRHC();};vb.prototype.$PhotoSnowliftq=function(){"use strict";if(!this.$PhotoSnowliftb)return;this.$PhotoSnowlift2=false;this.spotlight.enableBehavior(ba);ya.set(this.stage,'overflow','visible');o.hide(this.showZoomInButton);o.hide(this.showZoomOutButton);o.hide(this.zoomedImage);o.hide(this.outerImageSlider);o.show(this.stageActions);this.uncollapseRHC();};vb.prototype.switchIntoZoomedImage=function(wb){"use strict";this.$PhotoSnowliftw();o.hide(this.zoomedImage);o.hide(this.outerImageSlider);var xb=this.stream.getCurrentImageData(),yb=xb.originalDimensions;this.zoomedImage.src=xb.url;this.adjustStageSize(yb);this.$PhotoSnowliftC(new fb(parseInt(ya.get(this.zoomedImage,'width'),10),parseInt(ya.get(this.zoomedImage,'height'),10)));o.hide(this.image);};vb.prototype.$PhotoSnowliftD=function(wb){"use strict";var xb=this.stage.clientWidth,yb=Math.min(100,(xb/wb.x)*100);ya.set(this.innerImageSlider,'width',yb+'%');return yb;};vb.prototype.$PhotoSnowliftE=function(wb){"use strict";var xb=vb.MAX_SLIDER_HEIGHT*this.stage.clientHeight/wb.y,yb=vb.MAX_SLIDER_WIDTH*this.stage.clientWidth/wb.x,zb=Math.min(xb,yb);return new fb(100*wb.x*zb/this.stage.clientWidth,100*wb.y*zb/this.stage.clientHeight);};vb.prototype.$PhotoSnowliftC=function(wb){"use strict";this.$PhotoSnowliftt(this.$PhotoSnowliftr);var xb=this.$PhotoSnowliftE(wb);ya.set(this.outerImageSlider,'width',xb.x+'%');ya.set(this.outerImageSlider,'height',xb.y+'%');ya.set(this.outerImageSlider,'left',(50-xb.x/2)+'%');ya.set(this.showZoomOutButton,'bottom',xb.y*this.stage.clientHeight/100+parseInt(ya.get(this.outerImageSlider,'bottom'),10)+20+'px');o.show(this.zoomedImage);o.show(this.outerImageSlider);};vb.prototype.$PhotoSnowliftj=function(event){"use strict";if(!this.$PhotoSnowlift2)return;o.addClass(this.stage,'showSlider');if(this.$PhotoSnowliftF)this.$PhotoSnowliftF.remove();var wb=false,xb=event.getTarget();if(ha.byClass(xb,"_10zv")){this.startSliderMargins=new fb(parseFloat(ya.get(this.innerImageSlider,'marginLeft')),parseFloat(ya.get(this.innerImageSlider,'marginTop')));this.startImageMargins=null;this.mouseDownStartPosition=new fb(event.clientX,event.clientY);}else if(ha.byClass(xb,"_10zx")){this.startSliderMargins=new fb(parseInt(ya.get(this.innerImageSlider,'marginLeft'),10),parseInt(ya.get(this.innerImageSlider,'marginTop'),10));this.startImageMargins=null;var yb=parseInt(ya.get(this.innerImageSlider,'width'),10);this.mouseDownStartPosition=new fb(this.innerImageSlider.getBoundingClientRect().left+yb/2,event.clientY);wb=true;}else if(ha.byClass(xb,"_10zw")){this.startImageMargins=new fb(parseInt(ya.get(this.zoomedImage,'marginLeft'),10),parseInt(ya.get(this.zoomedImage,'marginTop'),10));this.startSliderMargins=null;this.mouseDownStartPosition=new fb(event.clientX,event.clientY);}this.$PhotoSnowliftF=t.listen(this.stage,'mousemove',this.$PhotoSnowliftG.bind(this));if(wb){this.$PhotoSnowliftG(event);}else event.kill();};vb.prototype.$PhotoSnowliftk=function(event){"use strict";if(this.$PhotoSnowliftF){o.removeClass(this.stage,'showSlider');this.$PhotoSnowliftF.remove();this.$PhotoSnowliftF=null;var wb=parseFloat(ya.get(this.zoomedImage,'marginLeft')),xb=-this.zoomedImage.width+this.stage.clientWidth;this.$PhotoSnowliftr=wb/xb;}};vb.prototype.$PhotoSnowliftG=function(event){"use strict";var wb;if(this.startSliderMargins){wb=event.clientX-this.mouseDownStartPosition.x;var xb=parseFloat(ya.get(this.outerImageSlider,'width')),yb=parseFloat(ya.get(this.innerImageSlider,'width')),zb=Math.max(0,Math.min(xb-yb,this.startSliderMargins.x+wb))/xb;ya.set(this.innerImageSlider,'marginLeft',100*zb+"%");ya.set(this.zoomedImage,'marginLeft',-1*zb*this.zoomedImage.width+'px');event.kill();}else if(this.startImageMargins){wb=1.75*(this.mouseDownStartPosition.x-event.clientX);var ac=Math.min(0,Math.max(this.startImageMargins.x-wb,-this.zoomedImage.width+this.stage.clientWidth));ya.set(this.zoomedImage,'marginLeft',ac+'px');ya.set(this.innerImageSlider,'marginLeft',(-ac/this.zoomedImage.width*100)+"%");event.kill();}};vb.prototype.$PhotoSnowliftt=function(wb){"use strict";if(wb===(void 0)||wb===null)wb=.5;var xb=new fb(parseInt(ya.get(this.zoomedImage,'width'),10),parseInt(ya.get(this.zoomedImage,'height'),10));ya.set(this.innerImageSlider,'marginLeft',((100-this.$PhotoSnowliftD(xb))*wb)+'%');ya.set(this.zoomedImage,'marginLeft',((this.stage.clientWidth-xb.x)*wb)+'px');};vb.prototype.switchVideo=function(wb,xb){"use strict";this.$PhotoSnowliftp();var yb='swf_'+wb;q.empty(this.videoStage);if(xb){o.addClass(this.stageWrapper,'showVideo');var zb=this.stream.getCurrentImageData();if(this.videoPivotsGK){o.hide(this.nextPager);o.hide(this.prevPager);}var ac=zb.video_element;q.find(ac,"._ox1").style.cssText='';var bc=null;if(this.pivotsCarouselElement)bc=r.scry(this.pivotsCarouselElement,"._32_l");if(bc)bc.map(function(ec){return u.capture(ec,'click',function(){var fc=ec.getAttribute('data-fbid'),gc=this.stream.getCursor(),hc=this.stream.calculateDistance(gc,fc);this.page(hc,false);}.bind(this));}.bind(this));o.addClass(ac,'videoStageContainer');q.appendContent(this.videoStage,ac);q.appendContent(this.videoStage,this.pivotsCarouselElement);if(window[yb]&&!ob(yb))window[yb].write(wb);var cc='video_warning_'+wb,dc=ob(wb);if(!this.videoWarnings)this.videoWarnings=[];if(dc&&this.videoWarnings[cc])q.setContent(dc,this.videoWarnings[cc]);this.$PhotoSnowliftv=zb.controller;this.$PhotoSnowliftv.reset();if(this.$PhotoSnowliftH)this.$PhotoSnowliftv.play(gb.USER);if(this.$PhotoSnowliftI)this.$PhotoSnowliftv.addListener('finishPlayback',function(){var ec=zb.info.fbid.toString();if(ec===this.stream.getCursor())this.page(1,false);}.bind(this));setTimeout(this.adjustStageSizeForVideo.bind(this,wb),0);}else{window[yb]&&window[yb].addVariable('video_autoplay',0);this.videoLoadTimer&&clearTimeout(this.videoLoadTimer);o.removeClass(this.stageWrapper,'showVideo');}};vb.prototype.checkVideoStatus=function(wb){"use strict";if(this.videoLoadTimer)clearTimeout(this.videoLoadTimer);var xb=this.getVideoOnStage();if(!xb){return;}else{if(xb!==wb)return;this.adjustStageSizeForVideo(wb);}};vb.prototype.getVideoSize=function(wb){"use strict";return new fb(wb.getAttribute('data-video-width'),+wb.getAttribute('data-video-height')+this.getVideoComponentsHeight(wb));};vb.prototype.getVideoElement=function(wb){"use strict";return q.scry(this.videoStage,"._ox1")[0];};vb.prototype.getVideoComponentsHeight=function(wb){"use strict";var xb=0,yb=ha.byClass(wb,"_1c_u");if(!yb)return 0;var zb=q.scry(yb,"._2i84");if(zb.length){var ac=zb[0].getBoundingClientRect();xb=ac.bottom-ac.top;}return xb;};vb.prototype.adjustStageSizeForVideo=function(wb){"use strict";var xb=this.getVideoElement(wb);if(!xb){this.videoLoadTimer=setTimeout(this.checkVideoStatus.bind(this,wb),200);}else this.adjustStageSize(this.getVideoSize(xb));};vb.prototype.handleServerError=function(wb,xb){"use strict";q.setContent(this.errorBox,wb);this.storeFromData(xb);};vb.prototype.fixButtonText=function(wb){"use strict";if(!this.buttonTruncateGk)return;var xb=q.scry(wb,".photosTruncatingUIButton"),yb=parseInt(ya.get(wb,'width'),10);if(yb>k){var zb={tagPhoto:"\u5199\u771f\u306b\u30bf\u30b0\u4ed8\u3051",doneTagPhoto:"\u30bf\u30b0\u4ed8\u3051\u5b8c\u4e86",addLocation:"\u4f4d\u7f6e\u60c5\u5831\u3092\u8ffd\u52a0",editPhoto:"\u7de8\u96c6"};for(var ac=0;ac<xb.length;ac++){var bc=xb[ac];o.addClass(bc,"_2n0k");ab.set(bc,zb[bc.getAttribute('data-buttonname')],'below','center');}}};vb.prototype.swapData=function(){"use strict";var wb,xb=this.stream.getCurrentHtml();if(xb){this.setLoadingState(vb.STATE_HTML,false);for(var yb in xb){wb=ob(yb);wb&&q.setContent(wb,xb[yb]);}var zb=ob('photosTruncatingUIButtonGroup');zb&&this.fixButtonText(zb);l.inform('PhotoSnowlift.DATA_CHANGE',jb(this.stream.getCurrentImageData().info,{movement:this.movementDelta}),l.BEHAVIOR_STATE);this.movementDelta=0;if(this.stream.getCurrentExtraData())l.inform('PhotoSnowlift.EXTRA_DATA_CHANGE',this.stream.getCurrentExtraData(),l.BEHAVIOR_STATE);}this.adjustScroller();this.scrollableArea.showScrollbar(false);this.adjustForNewData();this.logImpressionDetailsForPhoto();};vb.prototype.updateTotalCount=function(wb,xb,yb){"use strict";var zb=this.stream.getCurrentHtml();if(zb){var ac=hb('fbPhotoSnowliftPositionAndCount');q.replace(ac,yb);ac=yb;o.show(ac);var bc='fbPhotoSnowliftPositionAndCount';zb[bc]=kb(ac.childNodes);}this.stream.setTotalCount(wb);this.stream.setFirstCursorIndex(xb);};vb.prototype.addPhotoFbids=function(wb,xb,yb,zb){"use strict";if(zb&&this.sessionID&&zb!=this.sessionID)return;var ac=this.stream.getCursor()===null;this.stream.attachToFbidsList(wb,xb,yb);if(yb&&ac)this.page(0,true);if(this.pivots&&yb)this.pivots.setCycleCount(this.stream.calculateDistance(this.stream.getCursor(),this.stream.firstCursor));if(!this.pagersShown&&this.stream.canPage())this.setStagePagersState('ready');if(!this.slideshowAvailable&&this.stream.canPage()){this.slideshowAvailable=true;o.addClass(this.root,'slideshowAvailable');}this.setLeftAndRightPagersState();};vb.prototype.attachTagger=function(wb){"use strict";q.appendContent(this.stageActions,wb);};vb.prototype.storeFromData=function(wb){"use strict";if(!this.isOpen)return;if(wb.pivots)this.pivotsCarouselElement=wb.pivots;this.videoPivotsGK=wb.pivotsgk;if(wb.ssid&&this.sessionID&&this.sessionID!=wb.ssid)return;var xb=this.stream.storeToCache(wb);if('error' in xb){this.checkState(vb.STATE_ERROR);return;}if('init' in wb){this.$PhotoSnowlifto=wb.init.album_fbid;this.$PhotoSnowliftz=wb.init.is_album;this.$PhotoSnowliftA=wb.init.album_owner_name;this.$PhotoSnowliftH=wb.init.autoplay_videos;this.$PhotoSnowliftI=wb.init.autoplay_next_video;}if('init' in xb){this.initDataFetched(xb.init);if(this.openExplicitly){this.replaceUrl=true;qb(this.stream.getCurrentImageData().info.permalink);}if(this.stream.canPage())this.setStagePagersState('ready');this.setLeftAndRightPagersState();this.ua&&this.ua.add_event('ufi');}if('image' in xb)this.checkState(vb.STATE_IMAGE_DATA);if('data' in xb)this.checkState(vb.STATE_HTML);};vb.prototype.setLeftAndRightPagersState=function(){"use strict";if(this.stream.isNonCircularPhotoSet()){o.conditionClass(this.root,'disableLeft',!this.stream.nonCircularPhotoSetCanPage(-1));o.conditionClass(this.root,'disableRight',!this.stream.nonCircularPhotoSetCanPage(1));}if(this.snowflake){o.conditionClass(this.root,'disableLeft',this.stream.getCursor()==this.firstInSet);var wb=this.stream.getCursorAt(this.stream.calculatePositionForMovement(1));o.conditionClass(this.root,'disableRight',wb==this.firstInSet);}};vb.prototype.setStagePagersState=function(wb){"use strict";switch(wb){case 'ready':o.addClass(this.root,'pagingReady');this.pagersShown=true;this.ua&&this.ua.add_event('arrows');return;case 'active':o.addClass(this.root,'pagingActivated');return;case 'inactive':o.removeClass(this.root,'pagingActivated');return;case 'disabled':case 'reset':o.removeClass(this.root,'pagingReady');return;}};vb.prototype.deletePhoto=function(wb){"use strict";this.closeRefresh();};vb.prototype.closeRefresh=function(){"use strict";this.refreshOnClose=true;this.spotlight.hide();};vb.prototype.onHiliteTag=function(wb,xb){"use strict";if(xb.version!=ka.VIEWER_SNOWLIFT)return;var yb=xb.tag;if(yb)this.switchHilitedTags(yb,true);};vb.prototype.onUpdateTagBox=function(wb,xb){"use strict";if(xb.version==ka.VIEWER_SNOWLIFT)this.updateTagBox(xb.id,xb.approve);};vb.prototype.$PhotoSnowlift3=function(wb){"use strict";if(this.$PhotoSnowlift6){this.$PhotoSnowlift7&&this.$PhotoSnowlift7.log(wb);return true;}return false;};vb.prototype.$PhotoSnowlifth=function(){"use strict";this.$PhotoSnowlifty=false;};vb.prototype.$PhotoSnowlifti=function(event){"use strict";if(this.$PhotoSnowlifty)event.kill();};vb.prototype.isReturningToStart=function(){"use strict";return !!this.returningToStart;};vb.prototype.$PhotoSnowliftp=function(){"use strict";if(this.$PhotoSnowliftv)this.$PhotoSnowliftv.logStopForUnload();};vb.getInstance=function(){"use strict";if(!vb.$PhotoSnowliftJ)vb.$PhotoSnowliftJ=new vb();return vb.$PhotoSnowliftJ;};vb.initWithSpotlight=function(wb,xb){"use strict";vb.getInstance().init(wb,xb);};vb.addPhotoFbids=function(wb,xb,yb,zb){"use strict";vb.getInstance().addPhotoFbids(wb,xb,yb,zb);};vb.setReachedLeftEnd=function(){"use strict";vb.getInstance().setReachedLeftEnd();};vb.setReachedRightEnd=function(){"use strict";vb.getInstance().setReachedRightEnd();};vb.attachFollowFlyout=function(wb){"use strict";q.insertAfter(hb('fbPhotoSnowliftSubscribe'),wb);};vb.attachSubscribeFlyout=function(wb){"use strict";q.insertAfter(hb('fbPhotoSnowliftSubscribe'),wb);};vb.attachTagger=function(wb){"use strict";vb.getInstance().attachTagger(wb);};vb.preload=function(wb,xb){"use strict";vb.getInstance().preload(wb,xb);};vb.bootstrap=function(wb,xb){"use strict";var yb=wb&&db(wb).getQueryData();if(yb&&yb.hasOwnProperty('share_id')){n.loadModules(["SpotlightShareViewer"],function(zb){zb.bootstrap(wb,xb);});return;}vb.getInstance().bootstrap(wb,xb);};vb.closeRefresh=function(){"use strict";vb.getInstance().closeRefresh();};vb.deletePhoto=function(wb){"use strict";vb.getInstance().deletePhoto(wb);};vb.getImage=function(){"use strict";return vb.getInstance().getImage();};vb.getImageId=function(){"use strict";return vb.getInstance().getImageId();};vb.getLoadQuery=function(){"use strict";return vb.getInstance().getLoadQuery();};vb.getRHCBody=function(){"use strict";return vb.getInstance().getRHCBody();};vb.getRHCFooter=function(){"use strict";return vb.getInstance().getRHCFooter();};vb.getRHCHeader=function(){"use strict";return vb.getInstance().getRHCHeader();};vb.getRoot=function(){"use strict";return vb.getInstance().getRoot();};vb.likePhotoSkipConfirmation=function(wb){"use strict";vb.getInstance().likePhotoSkipConfirmation(wb);};vb.saveTagsFromPayload=function(wb){"use strict";vb.getInstance().saveTagsFromPayload(wb);};vb.saveTagsFromPayloadDelayed=function(wb){"use strict";setTimeout(vb.saveTagsFromPayload.bind(null,wb),2000);};vb.handleServerError=function(wb,xb){"use strict";vb.getInstance().handleServerError(wb,xb);};vb.setVideoWarning=function(wb,xb){"use strict";var yb=vb.getInstance(),zb='video_warning_'+wb;if(!yb.videoWarnings)yb.videoWarnings=[];yb.videoWarnings[zb]=xb;};vb.storeFromData=function(wb){"use strict";vb.getInstance().storeFromData(wb);};vb.swapData=function(){"use strict";vb.getInstance().swapData();};vb.updateTotalCount=function(wb,xb,yb){"use strict";vb.getInstance().updateTotalCount(wb,xb,yb);};vb.setVideoRotateURI=function(wb){"use strict";vb.getInstance().videoRotateURI=wb;};jb(vb,{STATE_ERROR:'error',STATE_HTML:'html',STATE_IMAGE_PIXELS:'image_pixels',STATE_IMAGE_DATA:'image',LOADING_TIMEOUT:2000,PAGER_FADE:3000,FULL_SCREEN_PADDING:10,STAGE_NORMAL_MAX:{x:960,y:960},STAGE_MIN:{x:520,y:520},SIDEBAR_SIZE_MAX:360,MIN_PANORAMA_Y:240,ZOOM_BUTTON_HEIGHT:52,ZOOM_BUTTON_BOT_PAD:60,ZOOM_BUTTON_TOP_PAD:16,MAX_SLIDER_HEIGHT:.075,MAX_SLIDER_WIDTH:.75,MIN_PANO_TO_STAGE_RATIO:1.2,STAGE_CHROME:{x:82,y:42},VIDEO_BOTTOM_BAR_SPACE:40,GOPREV_AREA:120,TIMELINE_STRETCH_WIDTH:843,TIMELINE_STRETCH_MIN:480,MIN_TAG_DISTANCE:83,PADDING_MIN:40,MIN_UFI_HEIGHT:250,COLLECTIONS_UNTAGGED_PHOTOS:3,PHOTOS_OF_YOU_SUGGESTIONS:28,FRIENDS_IN_PHOTOS_SUGGESTIONS:31,MIN_ADS_VISIBLE:1,PINNED_UFI_ADJUSTMENT:11,ADD_COMMENT_HEIGHT:54,SLIDESHOW_TIME:3000,_instance:null,touch:nb,touchMarkup:nb});});e.exports={};},null);