/*!CK:1176750850!*//*1421709350,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["DgVzN"]); }

__d("ImageUtils",["UserAgent_DEPRECATED"],function(a,b,c,d,e,f,g){var h={hasLoaded:function(i){if(i.naturalWidth!==(void 0)){return i.complete&&i.width!==0;}else if(i.height==20&&i.width==20&&i.complete){return false;}else if(i.complete===(void 0)&&g.webkit()<500){var j=new Image();j.src=i.src;return j.complete;}return i.complete;}};e.exports=h;},null);
__d("PhotoEverstoreLogger",["Event","AsyncRequest","copyProperties","ImageUtils"],function(a,b,c,d,e,f,g,h,i,j){var k={BATCH_WINDOW_MS:500,storedLog:[]};function l(){}i(l,{_log:function(n){k.storedLog.push(n);if(k.storedLog.length==1)setTimeout(m,k.BATCH_WINDOW_MS);},logImmediately:function(n){l._log(n);},registerForLogging:function(n){var o=document.getElementById(n);if(o!=null)if(j.hasLoaded(o)){l._log(o.src);}else g.listen(o,'load',function(event){l._log(o.src);});}});function m(){var n=k.storedLog;k.storedLog=[];var o=JSON.stringify(n);new h().setURI('/ajax/photos/logging/everstore_logging.php').setData({loggedUrls:o}).setMethod('POST').setOption('suppressErrorHandlerWarning',true).setOption('suppressErrorAlerts',true).send();}e.exports=l;},null);
__d("PhotosConst",[],function(a,b,c,d,e,f){var g={VIEWER_PERMALINK:0,VIEWER_SNOWLIFT:6,VIEWER_VAULTBOX:8,VIEWER_SNOWFLAKE:14,VIEWER_COMPOSER:16,VIEWER_PERMALINK_STRING:'permalink',VIEWER_SNOWLIFT_STRING:'snowlift',VIEWER_VAULTBOX_STRING:'vaultbox',BULK_EDITOR:3,BULK_EDITOR_REACT:15,FLASH_UPLOADER:4,HTML5_UPLOADER:10,SIZE_NORMAL:'n',PIC_NORMAL_FBX_SIZE:180};e.exports=g;},null);
__d("PhotoViewerImage",["PhotoEverstoreLogger","URI","Vector"],function(a,b,c,d,e,f,g,h,i){function j(k){"use strict";this._hiResDimensions=k.hiResDimensions&&i.deserialize(k.hiResDimensions);this._normalDimensions=k.normalDimensions&&i.deserialize(k.normalDimensions);this._info=k.info;this._video=k.video;this._shouldLog=k.everstoreLogThis;this._hiResSrc=k.hiResSrc;this._normalSrc=k.normalSrc;this._thumbSrc=k.thumbSrc;this._isInverted=false;this._data=k;}j.prototype.getURIString=function(){"use strict";return h(this._info.permalink).getUnqualifiedURI().toString();};j.prototype.hasHiResDimensions=function(){"use strict";return !!this._hiResDimensions;};j.prototype.getHiResDimensions=function(){"use strict";return this._hiResDimensions;};j.prototype.getNormalDimensions=function(){"use strict";return this._normalDimensions;};j.prototype.getHiResSrc=function(){"use strict";return this._hiResSrc;};j.prototype.getNormalSrc=function(){"use strict";return this._normalSrc;};j.prototype.getThumbSrc=function(){"use strict";return this._thumbSrc;};j.prototype.getInfo=function(){"use strict";return this._info;};j.prototype.getPermalink=function(){"use strict";return this._info.permalink;};j.prototype.getHighestResSrc=function(){"use strict";return this._hiResSrc||this._normalSrc;};j.prototype.preload=function(k){"use strict";var l;if(this.getHighestResSrc())if(k&&!this._resource){this._resource=new Image();this._resource.src=this.getHighestResSrc();l=this._resource.src;if(this._shouldLog)g.logImmediately(this._resource.src);}else if(!k&&!this._small){this._small=new Image();this._small.src=this._normalSrc||this._hiResSrc;l=this._small.src;if(this._shouldLog)g.logImmediately(this._small.src);}return l;};j.prototype.setNormalDimensions=function(k,l){"use strict";this._normalDimensions=new i(k,l);};j.prototype.setHiResDimensions=function(k,l){"use strict";this._hiResDimensions=new i(k,l);};j.prototype.invertDimensions=function(){"use strict";if(this.hasHiResDimensions())this._hiResDimensions=new i(this._hiResDimensions.y,this._hiResDimensions.x);this._normalDimensions=new i(this._normalDimensions.y,this._normalDimensions.x);this._isInverted=!this._isInverted;};j.prototype.copy=function(){"use strict";return new j(this._data);};e.exports=j;},null);
__d("PhotoStreamCache",["DOM","HTML","PhotoEverstoreLogger","PhotosConst","PhotoViewerImage","Rect","UIPagelet","URI","Vector","copyProperties","createArrayFromMixed","ge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){function s(){"use strict";}s.prototype.init=function(t,u,v,w,x){"use strict";this.version=t;this.pageletName=u;this.pageletRootID=v;this.tagSuggestionMode=x;this.bufferSize=s.BUFFER_SIZE;this.fullBucketSize=s.FULL_BUCKET_SIZE;this.initError=false;this.isActive=true;this.usesOpaqueCursor=false;this.usesNonCircularPhotoSet=false;this.reachedLeftEnd=false;this.reachedRightEnd=false;this.leftLock=false;this.rightLock=false;this.useAjaxPipe=true;this.logger=w;this.viewAsUser=null;this.reset();};s.prototype.setViewAs=function(t){"use strict";this.viewAsUser=t;};s.prototype.isInViewAsMode=function(){"use strict";return !!this.viewAsUser;};s.prototype.getViewAsUserId=function(){"use strict";return this.viewAsUser;};s.prototype.getUsesOpaqueCursor=function(){"use strict";return this.usesOpaqueCursor;};s.prototype.isNonCircularPhotoSet=function(){"use strict";return this.usesNonCircularPhotoSet;};s.prototype.setReachedLeftEnd=function(){"use strict";this.reachedLeftEnd=true;};s.prototype.setReachedRightEnd=function(){"use strict";this.reachedRightEnd=true;};s.prototype.hasReachedLeftEnd=function(){"use strict";return this.reachedLeftEnd;};s.prototype.hasReachedRightEnd=function(){"use strict";return this.reachedRightEnd;};s.prototype.nonCircularPhotoSetCanPage=function(t){"use strict";if(!this.isNonCircularPhotoSet())return true;if(t<0)return this.getCursorPos()||!this.hasReachedLeftEnd();if(t>0)return (this.getLength()-1!=this.getCursorPos())||!this.hasReachedRightEnd();return true;};s.prototype.setUseAjaxPipe=function(t){"use strict";this.useAjaxPipe=t;};s.prototype.reset=function(){"use strict";this.cache={image:{},extra:{},html:{}};this.fbidList=[];this.loaded=false;this.allLoaded=false;this.permalinkMap={};this.position=0;this.totalCount=null;this.firstCursor=null;this.firstCursorIndex=null;this.firstOpaqueCursor=null;};s.prototype.waitForInitData=function(){"use strict";this.fbidList.push(s.INIT_PLACEHOLDER);};s.prototype.destroy=function(){"use strict";this.reset();this.isActive=false;};s.prototype.isLoaded=function(){"use strict";return this.loaded;};s.prototype.canPage=function(){"use strict";if(!this.isLoaded())return false;if(this.totalCount!==null)return this.totalCount>1;if(this.usesNonCircularPhotoSet)return true;return this.getLength()>1;};s.prototype.errorInCurrent=function(){"use strict";if(this.initError){return true;}else if(!this.isLoaded())return false;return this.checkErrorAt(this.getCursor());};s.prototype.getLength=function(){"use strict";return this.fbidList.length;};s.prototype.getPhotoSet=function(){"use strict";return this.photoSetQuery.set;};s.prototype.getPhotoSetQuery=function(){"use strict";return this.photoSetQuery;};s.prototype.getCurrentImageData=function(){"use strict";return this.getImageData(this.getCursor());};s.prototype.addViewAsToURI=function(t){"use strict";var u=n(t);if(this.isInViewAsMode())u.addQueryData({viewas:this.getViewAsUserId()});return u;};s.prototype.getOpaqueCursor=function(t){"use strict";if(this.getImageData(t)){if(this.version===j.VIEWER_VAULTBOX)return this.getImageData(t).getInfo().opaquecursor;return this.getImageData(t).info.opaquecursor;}if(t==this.firstCursor)return this.firstOpaqueCursor;return null;};s.prototype.getImageData=function(t){"use strict";var u=this.getCacheContent(t,s.IMAGE_DATA);if(u)u.info.permalink=this.addViewAsToURI(u.info.permalink);return u;};s.prototype.getCurrentHtml=function(){"use strict";return this.getCacheContent(this.getCursor(),s.HTML);};s.prototype.getCurrentExtraData=function(){"use strict";return this.getCacheContent(this.getCursor(),s.EXTRA);};s.prototype.getCacheContent=function(t,u){"use strict";if(!t||t===s.ERROR_ID||t===s.INIT_PLACEHOLDER)return null;return this.cache[u][t];};s.prototype.getCursorPos=function(){"use strict";return this.position;};s.prototype.getCursor=function(){"use strict";if(this.position>=0&&this.position<this.getLength())return this.fbidList[this.position];return null;};s.prototype.getCursorAt=function(t){"use strict";return this.fbidList[t];};s.prototype.getCursorForURI=function(t){"use strict";return this.permalinkMap[t];};s.prototype.calculatePositionForMovement=function(t){"use strict";var u=this.position+t;if(this.allLoaded){var v=this.getLength();u=(v+u%v)%v;}return u;};s.prototype.isValidMovement=function(t){"use strict";if(!this.isLoaded()||!this.canPage())return false;var u=this.calculatePositionForMovement(t);return this.getCursor()>0||(u>=0&&u<this.getLength());};s.prototype.moveCursor=function(t){"use strict";if(!this.isValidMovement(t))return;this.position=this.calculatePositionForMovement(t);if(t!==0)this.loadMoreIfNeccessary(t>0);};s.prototype.checkErrorAt=function(t){"use strict";if(!this.isLoaded())return false;if(t===s.ERROR_ID)return true;return false;};s.prototype.getRelativeMovement=function(t){"use strict";for(var u=0;u<this.getLength();u++)if(this.fbidList[u]==t)return u-this.position;return null;};s.prototype.preloadImages=function(t){"use strict";var u,v,w=this.getLength(),x=this.cache.image,y=s.BUFFER_SIZE;if(w>y*2){u=(this.position+w-y%w)%w;v=(this.position+y)%w;}else{u=0;v=w-1;}while(u!=v){var z,aa=this.fbidList[u],ba=t&&t(x[aa]);if(this.version===j.VIEWER_VAULTBOX){z=x[aa]&&x[aa].preload(ba);}else if(x[aa]&&x[aa].url)if(ba&&!x[aa].resource){x[aa].resource=new Image();x[aa].resource.src=x[aa].url;z=x[aa].url;if(x[aa].everstoreLogThis===true)i.logImmediately(x[aa].resource.src);}else if(!ba&&!x[aa].small){x[aa].small=new Image();x[aa].small.src=x[aa].smallurl||x[aa].url;z=x[aa].small.src;if(x[aa].everstoreLogThis===true)i.logImmediately(x[aa].small.src);}if(this.logger&&z)this.logger.log(z);u=(u+1)%w;}};s.prototype.loadMoreIfNeccessary=function(t){"use strict";if(this.allLoaded||(t&&this.rightLock)||(!t&&this.leftLock))return;var u=t?1:-1,v=this.position+this.bufferSize*u;if(v<0&&!this.checkErrorAt(this.getEndCursor(false))){this.leftLock=true;this.fetch(this.fullBucketSize,false);}else if(v>this.getLength()&&!this.checkErrorAt(this.getEndCursor(true))){this.rightLock=true;this.fetch(this.fullBucketSize,true);}};s.prototype.getEndCursor=function(t){"use strict";return t?this.fbidList[this.getLength()-1]:this.fbidList[0];};s.prototype.calculateRelativeIndex=function(t,u,v){"use strict";if(!this.totalCount)return null;var w=this.fbidList.indexOf(u),x=this.fbidList.indexOf(v);if(w===-1||x===-1)return null;var y=x-w;return (t+y+this.totalCount)%this.totalCount;};s.prototype.calculateDistance=function(t,u){"use strict";var v=this.fbidList.indexOf(t),w=this.fbidList.indexOf(u);if(v===-1||w===-1)return null;return (w-v+this.getLength())%this.getLength();};s.prototype.fetch=function(t,u){"use strict";var v=this.getEndCursor(u),w=p({cursor:v,version:this.version,end:this.getEndCursor(!u),fetchSize:u?t:-1*t,relevant_count:this.relevantCount,opaqueCursor:this.getOpaqueCursor(v),tagSuggestionMode:this.tagSuggestionMode},this.photoSetQuery);if(this.isInViewAsMode())w.viewas=this.getViewAsUserId();if(this.totalCount&&this.firstCursorIndex!==null){w.total=this.totalCount;w.cursorIndex=this.calculateRelativeIndex(this.firstCursorIndex,this.firstCursor,v);}var x=r(this.pageletRootID);if(!x){x=g.create('div',{id:this.pageletRootID});g.appendContent(document.body,x);}m.loadFromEndpoint(this.pageletName,x,w,{usePipe:this.useAjaxPipe,automatic:true,jsNonblock:true,crossPage:true});if(!this.useAjaxPipe)this.setUseAjaxPipe(true);};s.prototype.storeToCache=function(t){"use strict";var u={};if(!this.isActive)return u;if('error' in t){this.processErrorResult(t.error);u.error=true;return u;}if('init' in t){this.processInitResult(t.init);u.init={logids:t.init.logids,fbid:t.init.fbid,loggedin:t.init.loggedin,fromad:t.init.fromad};}if('image' in t){this.processImageResult(t.image);u.image=true;}if('data' in t){this.processDataResult(t.data);u.data=true;}return u;};s.prototype.processInitResult=function(t){"use strict";if(this.loaded)return;this.usesOpaqueCursor=t.usesopaquecursor;this.usesNonCircularPhotoSet=t.isnoncircularphotoset;this.loaded=true;this.photoSetQuery=t.query;if(t.bufferSize)this.bufferSize=t.bufferSize;if(t.fullBucketSize)this.fullBucketSize=t.fullBucketSize;if(this.fbidList.length===0){this.fbidList.push(t.fbid);this.rightLock=true;}else{var u=this.fbidList.indexOf(s.INIT_PLACEHOLDER);if(u!=-1)this.fbidList[u]=t.fbid;}this.firstCursor=t.fbid;this.firstOpaqueCursor=t.opaquecursor;if('initIndex' in t&&'totalCount' in t){this.firstCursorIndex=t.initIndex;this.totalCount=t.totalCount;}if(this.version==j.VIEWER_PERMALINK)this.fetch(s.INIT_BUCKET_SIZE,true);};s.prototype.processImageResult=function(t){"use strict";for(var u in t){if(u===this.firstCursor&&t[u].everstoreLogThis)i.logImmediately(t[u].url);if(this.version===j.VIEWER_VAULTBOX){var v=t[u];this.cache.image[u]=new k(v);this.permalinkMap[this.cache.image[u].getURIString()]=u;}else{this.cache.image[u]=t[u];if(t[u].dimensions)this.cache.image[u].dimensions=o.deserialize(t[u].dimensions);if(t[u].originalDimensions)this.cache.image[u].originalDimensions=o.deserialize(t[u].originalDimensions);if(t[u].smalldims)this.cache.image[u].smalldims=o.deserialize(t[u].smalldims);this.permalinkMap[n(t[u].info.permalink).getUnqualifiedURI().toString()]=u;}}};s.prototype.attachToFbidsList=function(t,u,v){"use strict";if(this.allLoaded)return;if(u===-1){for(var w=t.length-1;w>=0;w--){this.fbidList.unshift(t[w]);this.position++;}this.leftLock=false;}else{for(var x=0;x<t.length;x++)this.fbidList.push(t[x]);this.rightLock=false;}if(v)this.setAllLoaded();};s.prototype.setAllLoaded=function(){"use strict";this.allLoaded=true;if(this.getCursor()===null)this.position=this.calculatePositionForMovement(0);};s.prototype.processDataResult=function(t){"use strict";for(var u in t){if(!this.cache.html[u])this.cache.html[u]={};for(var v in t[u].html){var w=t[u].html[v];if(typeof w==='string')w=h(w).getRootNode();this.cache.html[u][v]=q(w.childNodes);}if(!('extra' in t[u])){this.cache.extra[u]=null;continue;}this.cache.extra[u]={tagRects:{}};if(!Array.isArray(t[u].extra.tagRects))for(var x in t[u].extra.tagRects)if(t[u].extra.tagRects[x])this.cache.extra[u].tagRects[x]=l.deserialize(t[u].extra.tagRects[x]);Object.keys(t[u].extra).forEach(function(y){if(y=='tagRects')return;this.cache.extra[u][y]=t[u].extra[y];}.bind(this));}};s.prototype.processErrorResult=function(t){"use strict";if(!this.isLoaded()){this.initError=true;return;}var u=t.side,v=[s.ERROR_ID];this.attachToFbidsList(v,u);};s.prototype.setTotalCount=function(t){"use strict";this.totalCount=t;};s.prototype.setFirstCursorIndex=function(t){"use strict";this.firstCursorIndex=t;};p(s,{ERROR:'error',HTML:'html',IMAGE_DATA:'image',EXTRA:'extra',BUFFER_SIZE:3,INIT_BUCKET_SIZE:4,FULL_BUCKET_SIZE:12,ERROR_ID:-1,INIT_PLACEHOLDER:1});e.exports=s;},null);
__d("XPhotosetSearchPivotControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){e.exports=b("XControllerURIBuilder").create("\/search-pivot\/photoset\/",{fbid:{type:"Int",required:true},tags:{type:"IntToIntMap"}});},null);
__d("PhotosetSearchPivotData",["AsyncRequest","PhotoStreamCache","Promise","XPhotosetSearchPivotControllerURIBuilder"],function(a,b,c,d,e,f,g,h,i,j){var k=/^(perm:)?tag:(\d+)/,l={},m={fetch:function(n,o){if(!(n in l)){var p=(new j()).setInt('fbid',n);if(o){var q={};o.fbidList.forEach(function(r){var s=o.getCacheContent(r,h.EXTRA);if(s)Object.keys(s.tagRects).forEach(function(t){if(k.test(t)){var u=RegExp.$2;if(u in q){q[u]++;}else q[u]=1;}});});p.setIntToIntMap('tags',q);}l[n]=new i(function(r,s){(new g()).setURI(p.getURI()).setHandler(function(t){r(t.getPayload());}).setErrorHandler(s).setAllowCrossPageTransition(true).send();});}return l[n]["catch"](function(r){delete l[n];throw r;});}};e.exports=m;},null);
__d("PhotoSessionLog",["AsyncRequest","Run","Vector","copyProperties"],function(a,b,c,d,e,f,g,h,i,j){function k(){}j(k,{UNKNOWN:0,ESC:1,X:2,OUTSIDE:3,UNLOAD:4,NAVIGATE:5,AGGREGATE:6,LEAVE:7,PERMALINK:0,SNOWLIFT:6,SNOWDOWN:13,AGGREGATION_COUNT:20,set:null,time:null,views:0,fbidList:[],details:{},width:0,height:0,first:false,last:false,logIds:false,version:null,source:null,buttonLikes:0,pagingAction:'',cycle:false,endOfRelevant:false,relevantCount:0,initLogging:function(l){this.set=null;this.time=new Date();this.views=0;this.hiResLoads=0;this.fullScreenViews={};this.first=true;this.last=false;this.logIds=false;this.version=l;this.buttonLikes=0;this.pagingAction='';this.cycle=false;this.endOfRelevant=false;this.relevantCount=0;this.panoramaClicks=0;this.panoramaImpressions=0;if(l===k.SNOWLIFT){var m=i.getViewportDimensions();this.width=m.x;this.height=m.y;}},setLogFbids:function(l){this.logIds=l;},setPhotoSet:function(l){this.set=l;},addButtonLike:function(){this.buttonLikes++;},setPagingAction:function(l){this.pagingAction=l;},setCycle:function(l){this.cycle=l;},setEndOfRelevant:function(l){this.endOfRelevant=l;},setRelevantCount:function(l){this.relevantCount=l;},setEndMetrics:function(l){this.endMetrics=l;},setSource:function(l){this.source=l;},addPanoramaClick:function(){this.panoramaClicks++;},addPanoramaImpression:function(){this.panoramaImpressions++;},addPhotoView:function(l,m,n){if(this.logIds&&this.views>=this.AGGREGATION_COUNT)this.logPhotoViews(this.AGGREGATE);this.views++;if(l)this.fbidList.push([l.fbid,l.owner,Date.now()]);if(m)this.hiResLoads++;if(n)this.fullScreenViews[l.fbid]=true;},logEnterFullScreen:function(l){this.fullScreenViews[l]=true;},addDetailData:function(l,m){if(!this.details[l])this.details[l]={t:m.num_tags,l:m.has_location,c:m.has_caption,cm:m.comment_count,lk:m.like_count,w:m.width,h:m.height,ad:'{}',p:this.pagingAction};},updateAdData:function(l,m){if(this.details[l])this.details[l].ad=JSON.stringify(m);},logPhotoViews:function(l){if(!this.views)return;if(l!=this.AGGREGATE)this.last=true;var m={set:this.set,time:new Date()-this.time,fbids:this.logIds?this.fbidList:[],details:this.logIds?this.details:{},first:this.first,last:this.last,close:l?l:this.UNKNOWN,button_likes:this.buttonLikes,version:this.version,endmetric:this.endMetrics,cycle:this.cycle,end_relev:this.endOfRelevant,relev_count:this.relevantCount,source:this.source,panorama_clicks:this.panoramaClicks,panorama_impressions:this.panoramaImpressions};if(this.version===k.SNOWLIFT){var n=i.getViewportDimensions();m.width=n.x||this.width;m.height=n.y||this.height;if(this.hiResLoads>0)m.hires_loads=this.hiResLoads;if(this.last){var o=Object.keys(this.fullScreenViews).length;if(o>0)m.fullscreen=o;}}new g().setURI('/ajax/photos/logging/session_logging.php').setAllowCrossPageTransition(true).setOption('asynchronous',(l!=k.UNLOAD)).setOption('suppressErrorHandlerWarning',true).setData(m).send();this.views=0;this.hiResLoads=0;this.fbidList=[];this.details={};this.first=false;this.buttonLikes=0;if(this.last){this.set=null;this.logIds=false;this.fullScreenViews={};}}});h.onUnload(function(){k.logPhotoViews(k.UNLOAD);});h.onLeave(function(){k.logPhotoViews(k.LEAVE);});e.exports=k;},null);
__d("PhotosUtils",["copyProperties","Vector"],function(a,b,c,d,e,f,g,h){function i(){}g(i,{getNearestBox:function(j,k){var l=Infinity,m=null;for(var n in j){var o=j[n];if(o.contains(k)){var p=k.distanceTo(o.getCenter());if(p<l){l=p;m=n;}}}return m;},absoluteToNormalizedPosition:function(j,k){var l=h.getElementPosition(j),m=h.getElementDimensions(j),n=k.sub(l).mul(100/m.x,100/m.y);n.domain='pure';return n;},normalizedToAbsolutePosition:function(j,k){var l=h.getElementPosition(j),m=h.getElementDimensions(j),n=k.mul(m.x/100,m.y/100).add(l);n.domain='document';return n;},isFacebox:function(j){return j.match(/^face:/);},isTag:function(j){return j.match(/^tag:/);}});e.exports=i;},null);
__d("PhotoPermalinkURI",[],function(a,b,c,d,e,f){var g={isValid:function(h){return g.parse(h)!==null;},parse:function(h){if(this.isValidLegacy(h)){var i=h.getQueryData();if(i.fbid)return {photo_id:i.fbid,set_token:i.set};if(i.id&&i.pid)return {photo_id:i.id+':'+i.pid,set_token:i.set};return null;}var j=h.getPath();if(j[j.length-1]==='/')j=j.substring(0,j.length-1);var k=j.split('/');if(k.length>=3&&k[2]==='photos')if(k.length===4&&/^\d+$/.exec(k[3])!==null){return {photo_id:k[3],set_token:null};}else if(k.length===5&&/^\d+$/.exec(k[4])!==null)return {photo_id:k[4],set_token:k[3]};return null;},isValidLegacy:function(h){var i=h.getPath();if(i[i.length-1]==='/')i=i.substring(0,i.length-1);if(i==='/photo.php'||i==='/force_photo/photo.php'||i==='/photo'||i==='/force_photo/photo/index.php'||i==='/photo/index.php'||i==='/force_photo/photo')return true;return false;}};e.exports=g;},null);
__d("PhotoTagSearchPivotLogger",["Banzai"],function(a,b,c,d,e,f,g){var h={};g.subscribe(g.SHUTDOWN,function(){Object.keys(h).forEach(function(l){var m=h[l];Object.keys(m).forEach(function(n){g.post('photo_tag_search_pivot',{source:l,action:n,count:m[n]});});});});var i=/^(perm:)?tag:/,j,k={logImpression:function(l,m){var n=l in h?h[l]:(h[l]={});n[m]=m in n?n[m]+1:1;},logImageImpression:function(l,m,n){if(j!==m){if(n.some(function(o){return i.test(o);}))this.logImpression(l,'image_impression');j=m;}},logPivotImpression:function(l,m){if(i.test(m))this.logImpression(l,'pivot_impression');},logShowMorePhotos:function(){this.logImpression('photoset','show_more_photos');},logHideMorePhotos:function(){this.logImpression('photoset','hide_more_photos');},logSuggestMorePhotos:function(){this.logImpression('photoset','suggest_more_photos');},logMorePhotosNavigation:function(l){g.post('photo_tag_search_pivot',{source:'photoset',action:'more_photos_search',query:l,count:1});}};e.exports=k;},null);
__d("PhotosetSearchPivot.react",["LeftRight.react","PhotoTagSearchPivotLogger","PhotosetSearchPivotData","React","XUISpinner.react","XUIText.react","cx","fbt","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=j.createClass({displayName:"PhotosetSearchPivotItem",propTypes:{normalized:j.PropTypes.string,title:j.PropTypes.object,uri:j.PropTypes.string,images:j.PropTypes.array},onClick:function(){h.logMorePhotosNavigation(this.props.normalized);},render:function(){return (j.createElement("div",{className:"_25r"},j.createElement("a",{onClick:this.onClick,href:this.props.uri,className:"_25t _3-8t"},j.createElement("div",{className:"_25u"},j.createElement("div",{className:"_25v _25w",style:{backgroundImage:'url('+this.props.images[0].uri+')'}}),j.createElement("div",{className:"_25x"},j.createElement("div",{className:"_25y"},j.createElement("div",{className:"_25z"}),j.createElement("div",{className:"_26r"},j.createElement("div",{className:"_273 _25w",style:{backgroundImage:'url('+this.props.images[1].uri+')'}}))),j.createElement("div",{className:"_274"},j.createElement("div",{className:"_25z"}),j.createElement("div",{className:"_26r"},j.createElement("div",{className:"_273 _25w",style:{backgroundImage:'url('+this.props.images[2].uri+')'}}))))),j.createElement(l,{display:"block",className:"_27f _2pi4",dangerouslySetInnerHTML:{__html:this.props.title.__html}}))));}}),q=j.createClass({displayName:"PhotosetSearchPivot",propTypes:{fbid:j.PropTypes.string,endofalbum:j.PropTypes.bool,withBackground:j.PropTypes.bool,linesAroundHeader:j.PropTypes.bool,onclose:j.PropTypes.func},fetchPivots:function(r){i.fetch(r).then(function(s){setTimeout(this.onFetchSuccess.bind(this,r,s.pivots),0);}.bind(this),function(s){setTimeout(this.onFetchError.bind(this,r),0);}.bind(this));},onFetchSuccess:function(r,s){if(!this.isMounted()||this.props.fbid!==r)return;s=s||[];var t='show';if(s.length===0)t='hide';this.setState({pivots:s,action:t});},onFetchError:function(r){if(!this.isMounted()||this.props.fbid!==r)return;this.setState({pivots:[],action:'hide'});},getInitialState:function(){this.fetchPivots(this.props.fbid);return {pivots:[],action:'loading'};},componentWillReceiveProps:function(r){if(r.fbid){this.setState({action:'loading'});this.fetchPivots(r.fbid);}else this.setState({action:'hide',pivots:[]});},onExitClicked:function(){this.props.onclose();},render:function(){if(this.state.action==='loading')return (j.createElement("div",{className:o(this.props.className,"_27h _2ph_")},j.createElement(k,{size:"large"})));if(this.state.action==='hide')return j.createElement("span",null);var r=this.state.pivots.map(function(v){return j.createElement(p,{normalized:v.normalized,title:v.title,uri:v.uri,images:v.images});}),s=this.props.endofalbum?j.createElement("span",{className:"_2pij"},"\u30a2\u30eb\u30d0\u30e0\u306f\u4ee5\u4e0a\u3067\u3059"):null,t=(("_27m")+(' '+"_2pi3")+(' '+"_2pib")+(this.props.linesAroundHeader?' '+"_3-te":'')),u=j.createElement("span",null,s,j.createElement("span",{className:"_4ptz"},"\u305d\u306e\u4ed6\u306e\u304a\u3059\u3059\u3081\u306e\u5199\u771f"));if(this.props.onclose){u=j.createElement(g,{className:t},u,j.createElement("a",{href:"#",onClick:this.onExitClicked,className:"_27n"}));}else u=j.createElement("div",{className:t},u);return (j.createElement("div",{className:o(this.props.className,((this.state.action==='hide'?"_27j":'')+(this.state.action==='show'?' '+"_27k":'')))},j.createElement("div",{className:(("_27l")+(this.props.withBackground?' '+"_3-tf":''))},u,j.createElement("div",{className:"_27o _2pi8 clearfix"},r))));}});e.exports=q;},null);
__d("PhotosetPivotSlide.react",["Image.react","Link.react","PhotosetSearchPivot.react","React","XUIText.react","cx","fbt","xuiglyph"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=j.createClass({displayName:"PhotosetPivotSlide",propTypes:{fbid:j.PropTypes.string,isAlbum:j.PropTypes.bool,albumOwnerName:j.PropTypes.string,visible:j.PropTypes.bool,onReturn:j.PropTypes.func},render:function(){return (j.createElement("div",{className:(("_1_ap")+(this.props.visible?' '+"_1_aq":''))},j.createElement("div",{className:"_1_ar"},j.createElement(k,{display:"block"},this._getEndOfAlbumTitle()),j.createElement(h,{className:"_1_as",onClick:this.props.onReturn},j.createElement(g,{className:"_1_at",src:n({name:'arrow-right',shade:'white',size:'small'})}),"Return to Beginning")),j.createElement(i,{className:"_1_au",fbid:this.props.visible?this.props.fbid:null,linesAroundHeader:true})));},_getEndOfAlbumTitle:function(){if(this.props.albumOwnerName){if(this.props.isAlbum){return (m._("End of {user_name}'s album",[m.param("user_name",j.createElement(k,{weight:"bold"},this.props.albumOwnerName))]));}else return (m._("End of {user_name}'s photos",[m.param("user_name",j.createElement(k,{weight:"bold"},this.props.albumOwnerName))]));}else if(this.props.isAlbum){return ("\u30a2\u30eb\u30d0\u30e0\u306f\u4ee5\u4e0a\u3067\u3059");}else return ("End of photos");}});e.exports=o;},null);
__d("PhotoSnowliftAds",["Arbiter","Event","copyProperties","CSS","csx","DataStore","DOM","PhotoSessionLog","UIPagelet","URI","Vector","extendArray"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s={REFRESH_RATE:30000,UNITS_REGISTER_DELAY:1000,root:null,availableDimensions:null,loadQuery:null,lastLoadTime:0,minAds:100,units:null,isLogAdData:null,displayedCallback:null,position:null,adsStatus:'null',adsEvents:{},resetEvents:function(){this.adsStatus='reset';this.adsEvents={};},addEvent:function(t,u){if(u)this.adsStatus=t;var v=Date.now();this.adsEvents[t+'_'+v]=v;},init:function(t,u,v,w){this.reset();this.root=t;this.snowlift=u;this.minAds=v.min_ads;this.displayedCallback=w;this.addEvent('init',true);},reset:function(){this.lastLoadTime=0;this.position=0;this.units=[];this.resetEvents();this.addEvent('reset',true);},resize:function(t){this.availableDimensions=t;this.loadQuery=this.snowlift.getLoadQuery();this.processResize();},calculateUnitSizes:function(t,u,v){var w={};t.forEach(function(x){var y=x.root.firstChild.offsetHeight;x.units.forEach(function(aa){if(!j.hasClass(aa,'hidden')&&!this.getIsHoldout(aa)&&!this.getIsShadow(aa)){var ba=this.getHeight(aa.firstChild,u);y-=ba;}}.bind(this));var z={height:y,visible:false};x.units.forEach(function(aa){var ba=this.getIsAds(aa),ca=this.getHeight(aa.firstChild,u),da=this.getUnitId(aa),ea=this.getIsHoldout(aa);if(ea&&v)return;w[da]={height:ca,visible:false,priority:0,is_ads:ba,is_holdout:ea,section_ref:z};}.bind(this));}.bind(this));return w;},calculateVisibleUnits:function(t,u,v){var w=0,x=this.getUnitPriority(u);x.forEach(function(y){if(u.hasOwnProperty(y)){var z=u[y],aa=z.height;if(!z.section_ref.visible)aa+=z.section_ref.height;z.height_below=v-aa;z.visible=z.height_below>=0&&aa>0;if(z.visible){z.section_ref.visible=true;v-=aa;w++;}}}.bind(this));return u;},displayUnits:function(t,u){t.forEach(function(v){var w=false,x=true;v.units.forEach(function(y){var z=this.getUnitId(y),aa=u[z];if(!aa)return;var ba=aa.visible,ca=aa.height_below,da=aa.is_ads;j.conditionClass(y,'hidden',!ba);if(da&&ba&&x){var ea=m.find(y,'div.ego_unit');j.addClass(ea,'ego_unit_no_top_border');x=false;}w=w||ba;this.calcUnitStats(this.units[da][z],ba,ca);}.bind(this));j.conditionClass(v.root,'hidden',!w);}.bind(this));g.inform('PhotoSnowliftAds/displayUnits');},getUnitsDisplayed:function(t,u){var v=0;t.forEach(function(w){w.units.forEach(function(x){var y=this.getUnitId(x),z=u[y];if(!z||!z.visible)return;v++;}.bind(this));}.bind(this));return v;},getHeightsRequired:function(t,u){var v=0,w=[];t.forEach(function(x){var y=false;x.units.forEach(function(z){var aa=this.getUnitId(z),ba=u[aa];if(!ba)return;v+=ba.height;if(!y){v+=ba.section_ref.height;y=true;}w.push(v);}.bind(this));}.bind(this));return w;},getUnitPriority:function(t){var u=[],v=0,w=0;for(var x in t){var y=t[x];u.push(x);var z=this.minAds+v+w;if(y.is_ads){if(w<this.minAds)z=w;w++;}else v++;y.priority=z;}u=u.sort(function(aa,ba){var ca=t[aa],da=t[ba];return ca.priority-da.priority;}.bind(this));return u;},updateUnitsStatus:function(){var t=this.availableDimensions.x,u=this.availableDimensions.y,v=this.calculateUnitSizes(this.sections,t);v=this.calculateVisibleUnits(this.sections,v,u);for(var w in v){if(!v.hasOwnProperty(w))continue;var x=v[w];if(!x.is_holdout||!x.visible)continue;var y=this.units[1][w];this.calcUnitStats(y,x.visible,x.height_below);}v=this.calculateUnitSizes(this.sections,t,true);v=this.calculateVisibleUnits(this.sections,v,u);this.displayUnits(this.sections,v);if(this.displayedCallback){var z=this.getUnitsDisplayed(this.sections,v),aa=this.getHeightsRequired(this.sections,v);this.displayedCallback(z,aa);}},calcUnitStats:function(t,u,v){var w=Date.now();if(t.visible)t.totalTime+=w-t.lastShowTime;if(t.trackingCode!==null&&t.totalTime>=this.UNITS_REGISTER_DELAY){var x=t.trackingCode;t.trackingCode=null;this.registerImpression(x,t.registerUrl);}t.visible=u;t.heightBelow=v;t.lastShowTime=w;},prepareResize:function(){var t=function(u){var v=m.create('div',{className:'inner'}),w=m.create('div',{className:'wrapper'},v);m.replace(u,w);m.setContent(v,u);return w;};this.sections=m.scry(this.root,'div.ego_section').map(function(u){return {root:t(u),units:m.scry(u,'div.ego_unit').map(t)};});},processResize:function(){if(this.isLoading||this.lastLoadTime===0||this.availableDimensions===null){this.setLogData();return;}this.updateUnitsStatus();this.setLogData();var t=this.nextRegisterTime();if(t!==Infinity)setTimeout(this.processResize.bind(this),t);},setIsLogAdData:function(t){this.isLogAdData=t;this.addEvent('setIsLogAdData',false);this.setLogData();},setLogData:function(){var t=this.snowlift.getImageId();if(this.isLogAdData&&t){var u=q.getElementDimensions(this.snowlift.getImage()),v=q.getElementDimensions(this.snowlift.getRHCHeader()),w=q.getElementDimensions(this.snowlift.getRHCBody()),x=q.getElementDimensions(this.snowlift.getRHCFooter()),y={query_set:this.snowlift.getLoadQuery().set,window_x:window.innerWidth,window_y:window.innerHeight,image_x:u.x,image_y:u.y,header_x:v.x,header_y:v.y,body_x:w.x,body_y:w.y,footer_x:x.x,footer_y:x.y,ads_below_space:this.getAdsBelowSpace(),time:Date.now(),adsStatus:this.adsStatus,adsEvents:this.adsEvents,refreshRate:this.refreshUnitsRate,position:this.position};n.updateAdData(t,y);}},getAdsBelowSpace:function(){var t=[],u=this.units[1];for(var v in u)if(u.hasOwnProperty(v)&&!this.getIsHoldout(this.getAdUnit(v)))t.push(u[v].heightBelow);return t;},getIsAds:function(t){var u=m.scry(t,"div._4u8");return u.length;},getUnitId:function(t){if(this.getIsAds(t)){return this.getAdId(t);}else return this.getEgoId(t);},getEgoId:function(t){var u=m.find(t,'div.ego_unit');return u.getAttribute('data-ego-fbid');},getAdData:function(t){var u=m.find(t,"div._4u8"),v=u.getAttribute('data-ad');return v&&JSON.parse(v)||{};},getAdId:function(t){return this.getAdData(t).adid;},getIsHoldout:function(t){return t&&this.getIsAds(t)&&this.getAdData(t).holdout;},getIsShadow:function(t){return t&&this.getIsAds(t)&&this.getAdData(t).shadow;},getAdUnit:function(t){if(!this.sections)return null;var u=[];this.sections.forEach(function(w){r(u,w.units);});for(var v=0;v<u.length;v++)if(this.getIsAds(u[v])&&this.getAdId(u[v])==t)return u[v];return null;},nextRegisterTime:function(){var t=Infinity,u=i(i({},this.units[0]),this.units[1]);for(var v in u)if(u.hasOwnProperty(v)){var w=u[v];if(w.trackingCode!==null&&w.visible)t=Math.min(t,this.UNITS_REGISTER_DELAY-w.totalTime);}return t;},getHeight:function(t,u){var v=l.get(t,'height');if(v&&v.x===u)return v.y;return this.cacheHeight(t,u);},cacheHeight:function(t,u){var v={x:u,y:t.offsetHeight};l.set(t,'height',v);return v.y;},loadAdsAndEgo:function(){this.resetEvents();this.addEvent('adsRequested',true);this.position++;var t=this.getCursorFBID(this.loadQuery);o.loadFromEndpoint('WebEgoPane',this.root,{pid:34,data:[this.loadQuery.set,t,false,this.snowlift.getOpaqueCursor(t)]},{crossPage:true,bundle:false});},getCursorFBID:function(t){if(t.v!==(void 0))return t.v;if(t.fbid!==(void 0))return t.fbid;return '0';},unitsLoaded:function(t,u){var v;if(u){v='/ai.php';this.addEvent('adsLoaded',true);}else{v='/ajax/ei.php';this.addEvent('egoLoaded',true);}var w={};for(var x in t)if(t.hasOwnProperty(x))w[x]={trackingCode:t[x],totalTime:0,lastShowTime:0,heightBelow:-10000,visible:false,registerUrl:v};this.units[u]=w;if(u)this.waitForImages(this.imagesLoaded.bind(this));},imagesLoaded:function(){this.prepareResize();this.addEvent('imagesLoaded',true);this.lastLoadTime=Date.now();this.isLoading=false;this.processResize();j.removeClass(this.root,'loading');},loadAdsFromUserActivity:function(){var t=Date.now()-this.lastLoadTime;if(!this.isLoading&&t>s.REFRESH_RATE){j.addClass(this.root,'loading');this.isLoading=true;this.loadAdsAndEgo();}},registerImpression:function(t,u){var v=m.create('iframe',{src:p(u).addQueryData({aed:t}),width:0,height:0,frameborder:0,scrolling:'no',className:'fbEmuTracking'});v.setAttribute('aria-hidden','true');m.appendContent(this.root,v);},waitForImages:function(t){var u=m.scry(this.root,'img.img'),v=u.length,w=v;if(w===0)t();var x=function(){w--;if(w===0)setTimeout(t,0);};for(var y=0;y<v;y++){var z=u[y];if(z.complete){x();}else h.listen(z,{load:x,error:x,abort:x});}}};e.exports=s;},null);
__d("PhotoViewer",["Bootloader","CSS","DOM","copyProperties","emptyFunction"],function(a,b,c,d,e,f,g,h,i,j,k){function l(){"use strict";this.image=null;this.root=null;this.stream=null;}l.prototype.getEventString=function(m){"use strict";var n=this.getEventPrefix();if(n)return n+'.'+m;return null;};l.prototype.getImage=function(){"use strict";return this.image;};l.prototype.getPosition=function(){"use strict";return this.stream?this.stream.getCursor():null;};l.prototype.getRoot=function(){"use strict";return this.root;};l.prototype.hiliteAllBoxes=function(){"use strict";i.scry(this.stageWrapper,'div.tagsWrapper div.faceBox').forEach(function(m){h.addClass(m,'otherActive');});};l.bootstrap=function(m,n){"use strict";g.loadModules(["PhotoSnowlift"],function(o){o.bootstrap(m,n);});};j(l.prototype,{getEventPrefix:k.thatReturnsNull,getSourceString:k.thatReturnsNull,getVersionConst:k.thatReturnsNull,getViewerSource:k.thatReturnsNull,getViewerSet:k.thatReturnsNull});e.exports=l;},null);
__d("SnowliftVideoPivotsCarouselController",[],function(a,b,c,d,e,f){var g={setPivotsCarousel:function(h,i){this._pivotsCarousel=h;this.adjustCarousel(i);},adjustCarousel:function(h){if(this._pivotsCarousel)this._pivotsCarousel.pageTo(h);},adjustCarouselOnAutoPlay:function(){if(this._pivotsCarousel)this._pivotsCarousel.page();}};e.exports=g;},null);
__d("PhotoSnowlift",["Arbiter","AsyncRequest","Bootloader","CSS","Dialog","DOM","DOMQuery","DOMControl","Event","fbt","FullScreen","ImageUtils","Input","Keys","Layer","LayerHideOnEscape","LikeConfirmer","LinkController","LitestandStoryInsertionStatus","tickerPhoteSnowLiftOpenStatus","Locale","PageTransitions","Parent","PhotoLogger","PhotoPermalinkURI","PhotosConst","PhotoSessionLog","PhotosetPivotSlide.react","PhotosetSearchPivot.react","PhotosetSearchPivotData","PhotoSnowliftAds","PhotoStreamCache","PhotosUtils","PhotoTagSearchPivotLogger","PhotoViewer","React","Rect","ScriptPath","ScrollableArea","SnowliftVideoPivotsCarouselController","Style","Toggler","Tooltip","UFIFeedbackTargets","UIPagelet","URI","UserAgent_DEPRECATED","Vector","VideoPlayerReason","$","computeRelativeURI","copyProperties","createArrayFromMixed","csx","cx","emptyFunction","ge","getActiveElement","goURI","invariant","userAction"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob){var pb=74,qb=75,rb=70,sb=76,tb=315;for(var ub in oa)if(oa.hasOwnProperty(ub))wb[ub]=oa[ub];var vb=oa===null?null:oa.prototype;wb.prototype=Object.create(vb);wb.prototype.constructor=wb;wb.__superConstructor__=oa;function wb(){"use strict";oa.call(this);this._seenTags={};this._navCount=0;this._isZoomOn=false;this.clearAlbumBoundaries();}wb.prototype.preload=function(xb,yb){"use strict";i.loadModules(["PhotoTagger","Live","PhotoTagApproval","PhotoTags","TagTokenizer","css:fb-photos-snowlift-fullscreen-css"],function(ac){this.PhotoTagger=ac;}.bind(this));var zb=this.getImageSrc(za(xb).getQueryData());if(zb)if(!this._log(zb))(new Image()).src=zb;};wb.prototype.bootstrap=function(xb,yb){"use strict";this.preload(xb,yb);if(this.closeDirty){setTimeout(this.bootstrap.bind(this,xb,yb),0);return;}ka.reset();this.resetUriStack=true;if(this.isOpen)if(this.openExplicitly){this.closeCleanup();this.resetUriStack=false;}else return;this._dataFt=null;var zb=ca.byAttribute(yb,'data-cursor');if(zb){try{var bc=JSON.parse(zb.getAttribute('data-ft'));this._dataFt={qid:bc.qid,mf_story_key:bc.mf_story_key};}catch(ac){}}else try{zb=ca.byAttribute(yb,'data-ad');var cc=JSON.parse(zb.getAttribute('data-ad'));this._dataFt={ad_id:cc.adid};}catch(ac){}this.ua=ob('snowlift',yb).uai('open');ra.openOverlayView('snowlift');this.returningToStart=false;this.loading&&j.removeClass(this.loading,'loading');if(yb){j.addClass((this.loading=yb),'loading');var dc=ca.byClass(yb,'uiStreamStory')||ca.byClass(yb,"_5jmm");if(dc){this.storyID=dc.id;}else{var ec=ca.byClass(yb,"_5b9c");if(ec)this.storyID=ec.getAttribute('data-ownerid');}this._updateContainerOwnerID();this.getThumbAndSize(yb);}else this.loading=null;g.inform('PhotoSnowlift.GO',xb,g.BEHAVIOR_STATE);this.loadFrameIfUninitialized();};wb.prototype._updateContainerOwnerID=function(){"use strict";if(this.container)if(this.storyID){this.container.setAttribute('data-ownerid',this.storyID);}else this.container.removeAttribute('data-ownerid');};wb.prototype.setupFromSnowflake=function(xb,yb){"use strict";this.extraClasses=xb;this.snowflake=true;this.firstInSet=yb;if(this.root){j.addClass(this.root,"snowflake");this.extraClasses.forEach(function(zb){j.addClass(this.root,zb);},this);}};wb.prototype.getCurrentImageServerSizeDimensions=function(){"use strict";var xb=this.stream.getCurrentImageData();return xb.originalDimensions||xb.dimensions;};wb.prototype.getEventPrefix=function(){"use strict";return 'PhotoSnowlift';};wb.prototype.getRoot=function(){"use strict";return this.root;};wb.prototype.getSourceString=function(){"use strict";return 'snowlift';};wb.prototype.getViewerSource=function(){"use strict";return this.source;};wb.prototype.getViewerSet=function(){"use strict";return this.stream.getPhotoSet();};wb.prototype.getVersionConst=function(){"use strict";return fa.VIEWER_SNOWLIFT;};wb.prototype.getImage=function(){"use strict";return this.image;};wb.prototype.getImageId=function(){"use strict";return this.stream.getCursor();};wb.prototype.getRHCHeader=function(){"use strict";return this.rhcHeader;};wb.prototype.getRHCBody=function(){"use strict";return this.ufiForm;};wb.prototype.getRHCFooter=function(){"use strict";return this.rhcFooter;};wb.prototype.getLoadQuery=function(){"use strict";return this.loadQuery;};wb.prototype.getCurrentPhotoInfo=function(){"use strict";var xb=this.stream.getCurrentImageData();if(xb)return xb.info;return null;};wb.prototype.getOwnerId=function(){"use strict";var xb=this.stream.getCurrentImageData();if(xb)return xb.info.owner;return null;};wb.prototype.getThumbAndSize=function(xb){"use strict";this.currentImageSize=null;this.thumbSrc=null;var yb=za(xb.getAttribute('ajaxify')).getQueryData();if(!yb.size)return;var zb=bb.deserialize(yb.size);if(!zb.x||!zb.y)return;this.currentImageSize=zb;if(xb.getAttribute('data-cropped'))return;var ac=l.scry(xb,'img')[0],bc=l.scry(xb,'i')[0],cc=ca.byAttribute(xb,'data-size');this.shouldStretch=cc&&this.currentImageSize&&ac&&cc.getAttribute('data-size')==="2"&&this.currentImageSize.x>this.currentImageSize.y&&this.currentImageSize.x<=wb.TIMELINE_STRETCH_WIDTH&&ac.offsetWidth===wb.TIMELINE_STRETCH_WIDTH;var dc;if(ac){dc=ac.src;}else if(bc){dc=ua.get(bc,'backgroundImage').replace(/.*url\("?([^"]*)"?\).*/,'$1');}else return;this.thumbSrc=dc;};wb.prototype.loadFrameIfUninitialized=function(){"use strict";if(this.root)return;new h('/ajax/photos/snowlift/init.php').setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();};wb.prototype.init=function(xb,yb){"use strict";this.init=jb;this._shouldLog=yb.photos_client_loading;this._logger=null;if(this._shouldLog)this._logger=new da(fa.VIEWER_SNOWLIFT_STRING);this._showHover=yb.pivot_hover;this._showMorePhotos=yb.show_more_photos;this._extraSlidePivot=yb.extra_slide_pivot;ga.setEndMetrics(yb.pivot_end_metric);this.startingMousePos=null;this.haveLeftBufferRegion=false;this.showingTypeaheadSuggestions=false;this.fullscreen=q.isSupported();this.showOGVideos=yb.og_videos;this.resizeCommentsForAds=yb.resize_comments_for_ads;this.spotlight=xb;this.spotlight.subscribe('blur',function(){this.closingAction=ga.OUTSIDE;}.bind(this));this.spotlight.subscribe('hide',this.closeHandler.bind(this));this.spotlight.subscribe('key',this.keyHandler.bind(this));this.initializeNodes(this.spotlight.getRoot());ka.init(this.sideAdUnit,this,yb,this.adsDisplayedCallback.bind(this));this.inAdsDisplayedCallback=false;this.lastAdsHeight=0;if(!this.subscription){x.registerHandler(this.handleNavigateAway.bind(this));this.subscription=g.subscribe('PhotoSnowlift.GO',function(zb,ac){this.openExplicitly=true;this.loading&&j.removeClass(this.loading,'loading');this.open(ac);}.bind(this));}this.transitionHandlerRegistered=false;this.returningToStart=false;ba.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;g.subscribe('PhotoTagApproval.HILITE_TAG',this.onHiliteTag.bind(this));g.subscribe('PhotoTagApproval.UPDATE_TAG_BOX',this.onUpdateTagBox.bind(this));if(this.fullscreen)q.subscribe('changed',this.onFullScreenChange.bind(this));this.slideshowGk=yb.snowlift_slideshow;this.buttonTruncateGk=yb.snowlift_button_truncate;this._hasZoomCapability=this._hasZoomCapability&&yb.www_panorama_viewer;this.allowIrrelevantRequests=!!yb.snowlift_allow_irrelevant_requests;if(this.snowflake){j.addClass(this.root,"snowflake");this.extraClasses.forEach(function(zb){j.addClass(this.root,zb);},this);}};wb.prototype.onFullScreenChange=function(){"use strict";if(!this.isOpen)return;var xb=q.isFullScreen();j.conditionClass(document.body,'fbPhotoSnowliftFullScreenMode',xb);if(xb){if(!j.hasClass(this.root,'fbPhotoSnowliftEditMode'))this.collapseRHC();var yb=this.stream.getCurrentImageData();if(yb&&yb.url&&this.image.src!==yb.url&&this.shouldShowHiRes(yb))this.switchImage(yb.url);this.adjustForResize();if(!this._isZoomOn)this._conditionDisplayZoomInButton();}else{if(!this._isZoomOn)this.uncollapseRHC();if(ab.chrome()&&!j.hasClass(this.root,'fbPhotoSnowliftEditMode'))this.page(0,false);g.inform('reflow');}va.hide();};wb.prototype.initializeNodes=function(xb){"use strict";this.root=xb;this.container=l.find(xb,'div.fbPhotoSnowliftContainer');this._updateContainerOwnerID();this.snowliftPopup=l.find(this.container,'div.fbPhotoSnowliftPopup');this.rhc=l.find(this.snowliftPopup,'div.rhc');this.rhcHeader=l.find(this.rhc,'div.rhcHeader');this.rhcFooter=l.find(this.rhc,'div.rhcFooter');this.ufiForm=l.find(this.rhc,'form.fbPhotosSnowliftFeedbackForm');this.ufiInputContainer=l.find(this.rhc,'div.fbPhotosSnowboxFeedbackInput');this.scroller=l.find(this.ufiForm,'div.rhcScroller');this.scrollerBody=l.find(this.scroller,'div.uiScrollableAreaBody');this.stageWrapper=l.find(this.snowliftPopup,'div.stageWrapper');this.overlay=l.find(this.snowliftPopup,'div.snowliftOverlay');this.errorBox=l.find(this.stageWrapper,'div.stageError');this.image=l.find(this.stageWrapper,'img.spotlight');this.stage=l.find(this.stageWrapper,'div.stage');this.showZoomInButton=l.scry(this.stageWrapper,"._5qmg").pop();this.showZoomOutButton=l.scry(this.stageWrapper,"._5qmh").pop();this.zoomedImage=l.scry(this.stage,"._10zw").pop();this.outerImageSlider=l.scry(this.stage,"._10zx").pop();this.innerImageSlider=l.scry(this.stage,"._10zv").pop();this._hasZoomCapability=this.showZoomInButton&&this.showZoomOutButton&&this.zoomedImage&&this.outerImageSlider&&this.innerImageSlider;if(this._hasZoomCapability){j.hide(this.showZoomInButton);j.hide(this.showZoomOutButton);j.hide(this.zoomedImage);j.hide(this.outerImageSlider);}this.videoStage=l.find(this.stageWrapper,'div.videoStage');this.prevPager=l.find(this.snowliftPopup,'a.snowliftPager.prev');this.nextPager=l.find(this.snowliftPopup,'a.snowliftPager.next');this.stageActions=l.find(xb,'div.stageActions');this.buttonActions=l.find(this.stageActions,'div.fbPhotosPhotoButtons');this.placeInfo=l.find(this.rhc,'div.fbPhotosSnowliftPlaceInfo');this.sideAdUnit=l.find(xb,"._5ciw");j.conditionClass(this.root,'fullScreenAvailable',this.fullscreen);};wb.prototype.initializeScroller=function(){"use strict";this.initializeScroller=jb;j.addClass(this.scroller,"_467y");this.scrollableArea=sa.fromNative(this.scroller,{fade:true,persistent:true});var xb=function(event){var yb=o.$E(event).getTarget();if(l.contains(this.ufiInputContainer,yb)){var zb=n.getInstance(yb);if(zb){this.scrollableArea.scrollToBottom();var ac=zb.subscribe('resize',function(){var cc=this.scrollableArea.isScrolledToBottom();this.adjustScroller();cc&&this.scrollableArea.scrollToBottom();}.bind(this)),bc=o.listen(yb,'blur',function(){zb.unsubscribe(ac);bc.remove();});}}}.bind(this);g.subscribe('ufi/inputHeightChanged',function(yb,zb){if(l.contains(this.ufiInputContainer,zb.node))this.adjustScroller();}.bind(this));g.subscribe('ufi/addCommentFacepileRendered',function(){this.adjustScroller();}.bind(this));g.subscribe('ufi/changed',function(yb,zb){if(this.ufiForm===zb.form)this.adjustScrollerIfNecessary();}.bind(this));g.subscribe('ufi/comment',function(yb,zb){if(this.ufiForm===zb.form){this.adjustScrollerIfNecessary();if(zb.isranked){this.scrollableArea.scrollToTop();}else this.scrollableArea.scrollToBottom();}}.bind(this));o.listen(this.rhc,'click',function(event){var yb=event.getTarget();if(ca.byTag(yb,'a')||ca.byTag(yb,'button')||l.isNodeOfType(yb,'input'))this.adjustScrollerIfNecessary();}.bind(this));g.subscribe(['reflow','CommentUFI.Pager'],function(){if(this.isOpen)this.adjustScrollerIfNecessary();}.bind(this));o.listen(this.ufiForm,'focusin',xb);};wb.prototype.openHandler=function(xb){"use strict";if(this.isOpen||!ea.isValid(xb)||this.returningToStart||xb.getQueryData().closeTheater||xb.getQueryData().permPage){this.openHandlerRegistered=false;return false;}this.open(xb);this._uriStack.push(za(xb).getQualifiedURI().toString());ba.transitionComplete(true);return true;};wb.prototype.getImageSrc=function(xb){"use strict";if(xb.smallsrc){if(!xb.size)return xb.smallsrc;var yb=bb.deserialize(xb.size),zb=this.getStageSize(yb);zb=this._adjustStageSizeForPixelRatio(zb);if(zb.x<=wb.STAGE_NORMAL_MAX.x&&zb.y<=wb.STAGE_NORMAL_MAX.y)return xb.smallsrc;}return xb.src;};wb.prototype.open=function(xb){"use strict";var yb=za(xb),zb=yb.getQueryData(),ac=ea.parse(yb);if(ac!==null){zb.fbid=ac.photo_id;zb.set=ac.set_token;}var bc=this.getImageSrc(zb);if(bc){delete zb.src;delete zb.smallsrc;}if(this.resetUriStack)this._uriStack=[];if(!this.initialLoad){zb.firstLoad=true;this.initialLoad=true;y.registerBlocker(function(){return this.isOpen;}.bind(this));z.registerOpenChecker(function(){return this.isOpen;}.bind(this));}this.sessionID=Date.now();this.loadQuery=fb(zb,{ssid:this.sessionID});if(this._dataFt)this.loadQuery.data_ft=this._dataFt;this.isOpen=true;this.pagersShown=false;this.refreshOnClose=false;this.hilitedTag=null;this.loadingStates={image:false,html:false};this.replaceUrl=false;this.movementDelta=0;this.pivotsCarouselElement=null;this.shouldRenderVideoPivots=false;j.show(this.nextPager);j.show(this.prevPager);this.source=null;this.saveTagSubscription=g.subscribe('PhotoTagger.SAVE_TAG',this.onTagSaved.bind(this));this.taggedPhotoIds=[];this.stream=new la();this.stream.init(fa.VIEWER_SNOWLIFT,'PhotoViewerPagelet','pagelet_photo_viewer',this._shouldLog?this._logger:null,zb.tagSuggestionMode||'everyone');if(!!za.getMostRecentURI().getQueryData().viewas)this.stream.setViewAs(za.getMostRecentURI().getQueryData().viewas+'');this.fetchInitialData();this.setLoadingState(wb.STATE_HTML,true);this.rhcCollapsed=false;this._open(xb,bc);i.loadModules(["PhotosButtonTooltips"],function(cc){cc.init();});};wb.prototype._open=function(xb,yb){"use strict";this.createLoader(yb);this.spotlight.show();this.ua&&this.ua.add_event('frame');g.inform('layer_shown',{type:'PhotoSnowlift'});g.inform('PhotoSnowlift.OPEN');this.stageHandlers=[o.listen(window,'resize',this.adjustForResize.bind(this)),o.listen(this.stageWrapper,'click',this.buttonListener.bind(this)),o.listen(this.stageWrapper,'mouseleave',function(event){var bc=event.getTarget();if(!(ca.byClass(bc,'snowliftOverlay')||ca.byClass(bc,'fbPhotoSnowliftTagApproval')||ca.byClass(bc,'tagPointer')||ca.byClass(bc,'arrow')||ca.byClass(bc,'faceboxSuggestion')||ca.byClass(bc,'typeaheadWrapper')||ca.byClass(bc,'photoTagTypeahead')||ca.byClass(bc,'fbPhotoTagger')))this.unhiliteAllTags();this.hidePagers();}.bind(this)),o.listen(this.stageWrapper,'mousemove',this.hilitePager.bind(this)),o.listen(this.stageWrapper,'mousemove',this.hiliteTagsOnMouseMove.bind(this)),o.listen(this.overlay,'mouseenter',this.unhiliteAllTags.bind(this)),o.listen(this.container,'mousemove',this._enableMouseOver.bind(this)),o.listen(this.container,'mouseover',this._interceptMouseOver.bind(this)),o.listen(this.stageWrapper,'focusin',this.hilitePager.bind(this)),o.listen(this.rhc,'focusin',this.hidePagers.bind(this))];if(this._hasZoomCapability){this.stageHandlers.push(o.listen(this.stage,'mousedown',this._zoomedImageMouseDown.bind(this)));this.stageHandlers.push(o.listen(this.root,'mouseup',this._zoomedImageMouseUp.bind(this)));}this.stageHandlers.push(o.listen(this.container,'click',function(event){var bc=event.getTarget();if(ca.byClass(bc,'rotateRight')){this.rotate('right');}else if(ca.byClass(bc,'rotateLeft')){this.rotate('left');}else if(ca.byClass(bc,'closeTheater')){if(q.isFullScreen()){q.toggleFullScreen();return;}this.closingAction=ga.X;this.spotlight.hide();return false;}else if(ca.byClass(bc,"_32_l")){var cc=ca.byClass(bc,"_32_l"),dc=cc.getAttribute('data-fbid'),ec=this.stream.getCursor(),fc=this.stream.calculateDistance(ec,dc),gc=this.stream.fbidList.indexOf(dc);ta.adjustCarousel(gc);this.page(fc,false);}else if(this.fullscreen)if(ca.byClass(bc,'fbPhotoSnowliftFullScreen')){this.toggleFullScreen();}else if(ca.byClass(bc,'fbPhotoSnowliftCollapse'))this.toggleCollapse();}.bind(this)));var zb=kb('fbPhotoSnowliftFeedback');if(zb)this.stageHandlers.push(o.listen(zb,'click',function(event){var bc=event.getTarget();if(ca.byClass(bc,'like_link')||(ca.byClass(bc,'UFILikeLink')&&ca.byClass(bc,'UIActionLinks')))this.toggleLikeButton();var cc=ca.byClass(event.getTarget(),'uiUfiCollapsedComment');if(cc)j.addClass(cc,'uiUfiCollapsedCommentToggle');}.bind(this)));var ac=kb('fbPhotoSnowliftOnProfile');if(ac)this.stageHandlers.push(o.listen(ac,'click',function(event){if(ca.byClass(event.getTarget(),'fbPhotoRemoveFromProfileLink'))this.refreshOnClose=true;}.bind(this)));if(this.resetUriStack)this.startingURI=za.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI();if(!yb)this.setLoadingState(wb.STATE_IMAGE_DATA,true);if(!this.transitionHandlerRegistered){ba.registerHandler(this.transitionHandler.bind(this));this.transitionHandlerRegistered=true;}ga.initLogging(ga.SNOWLIFT);if(this.pivots)ga.setRelevantCount(this.pivots.relevantCount);};wb.prototype.toggleFullScreen=function(){"use strict";var xb=q.toggleFullScreen(document.documentElement);if(xb){var yb=this.stream.getCurrentImageData();if(yb&&yb.url&&this.image.src!==yb.url&&this.shouldShowHiRes(yb))if(!this._log(yb.url))(new Image()).src=yb.url;ga.logEnterFullScreen(this.stream.getCursor());}};wb.prototype.getStream=function(){"use strict";return this.stream;};wb.prototype.fetchInitialData=function(){"use strict";this.ua&&this.ua.add_event('init_data');this.stream.waitForInitData();ya.loadFromEndpoint('PhotoViewerInitPagelet',kb('pagelet_photo_viewer_init',this.root),this.loadQuery,{actorID:xa.getActorIDForFeedbackTargetIfExists(this.loadQuery.fbid),usePipe:true,jsNonblock:true,crossPage:true,allowIrrelevantRequests:this.allowIrrelevantRequests});};wb.prototype.toggleCollapse=function(){"use strict";if(this.rhcCollapsed){this.uncollapseRHC();}else this.collapseRHC();};wb.prototype.collapseRHC=function(){"use strict";this.rhcCollapsed=true;j.addClass(this.root,'collapseRHC');this.adjustForResize();};wb.prototype.uncollapseRHC=function(){"use strict";this.rhcCollapsed=false;j.removeClass(this.root,'collapseRHC');this.adjustForResize();};wb.prototype.closeHandler=function(){"use strict";if(!this.isOpen)return;this.closingAction=this.closingAction||ga.ESC;if(za.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI().toString()==this.startingURI.toString()){this.close();return;}this.returnToStartingURI(this.refreshOnClose);this.close();};wb.prototype.returnToStartingURI=function(xb,yb){"use strict";if(!xb)if(yb){this.squashNextTransition(mb.bind(null,yb));}else this.squashNextTransition();this.returningToStart=true;var zb=g.subscribe('page_transition',(function(){this.returningToStart=false;zb.unsubscribe();}).bind(this)),ac=xb||isNaN(ab.opera()),bc=this._uriStack.length;if(ac&&bc<window.history.length){window.history.go(-bc);}else{var cc=this.startingURI,dc=new za(cc).removeQueryData('closeTheater');if(cc.getQueryData().sk=='approve'&&cc.getPath()=='/profile.php'){dc.removeQueryData('highlight');dc.removeQueryData('notif_t');}mb(dc);}};wb.prototype.squashNextTransition=function(xb){"use strict";this.squashNext=true;ba.registerHandler(function yb(){if(this.squashNext){this.squashNext=false;if(xb)setTimeout(xb,0);ba.transitionComplete(true);return true;}return false;}.bind(this),7);};wb.prototype.handleNavigateAway=function(xb){"use strict";var yb=eb(ba._most_recent_uri.getQualifiedURI(),xb.getAttribute('href'));if(this.isOpen&&(yb instanceof za)&&yb.getUnqualifiedURI().toString()!=this.startingURI.toString()&&yb.getPath()!='/photo.php'){if(!this.closingAction)this.closingAction=ga.NAVIGATE;this.returnToStartingURI(false,yb);this.close();return false;}return true;};wb.prototype.postProcessTaggedPhotos=function(){"use strict";if(this.taggedPhotoIds&&this.taggedPhotoIds.length>0){var xb=null;if(this.source===wb.COLLECTIONS_UNTAGGED_PHOTOS){xb='/ajax/photos/photo/edit/skiptag/';}else if(this.source===wb.PHOTOS_OF_YOU_SUGGESTIONS||this.source===wb.FRIENDS_IN_PHOTOS_SUGGESTIONS)xb='/ajax/photos/photo/add_to_star_grid/';if(xb)new h().setURI(xb).setAllowCrossPageTransition(true).setData({media_id:this.taggedPhotoIds,source:this.source}).send();}};wb.prototype.onTagSaved=function(xb,yb){"use strict";if(this.taggedPhotoIds){if(this.source===wb.PHOTOS_OF_YOU_SUGGESTIONS&&!yb.self_tag)return;this.taggedPhotoIds.push(yb.photo_fbid);}};wb.prototype.clearAlbumBoundaries=function(){"use strict";this._albumBoundaries={start:0,end:0};};wb.prototype.close=function(){"use strict";if(!this.isOpen)return;this._albumFBID=null;this.hideMorePhotos();this.hidePivotSlide();this._pauseVideoIfNeeded();this.isOpen=false;this._navCount=0;this.clearAlbumBoundaries();if(this.fullscreen)q.disableFullScreen();ob('snowlift').uai('close');ra.closeOverlayView('snowlift');this.spotlight.hide();this.openExplicitly=false;this.postProcessTaggedPhotos();g.unsubscribe(this.saveTagSubscription);this.taggedPhotoIds=[];this.closeDirty=true;setTimeout(this.closeCleanup.bind(this),0);if(this.snowflake){j.removeClass(this.root,"snowflake");this.extraClasses.forEach(function(xb){j.removeClass(this.root,xb);},this);}this.extraClasses=[];this.snowflake=false;this.firstInSet=null;this.movementDelta=0;};wb.prototype.closeCleanup=function(){"use strict";this.closeDirty=false;j.removeClass(this.root,'dataLoading');ga.logPhotoViews(this.closingAction);this.destroy();j.hide(this.errorBox);j.hide(this.image);this.currentImageSize=null;this.thumbSrc=null;this.shouldStretch=false;this.resetUriStack=true;var xb=this.stream.getCursor();j.removeClass(this.stageWrapper,'showVideo');l.empty(this.videoStage);this.uncollapseRHC();this.currentMinSize=null;this.setStagePagersState('reset');this.recacheData();l.empty(this.sideAdUnit);this.stream.destroy();this.root.setAttribute('aria-busy','true');var yb=this.closingAction===ga.NAVIGATE;this.closingAction=null;if(!this.openHandlerRegistered){ba.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;}g.inform('layer_hidden',{type:'PhotoSnowlift'});g.inform('PhotoSnowlift.CLOSE',{is_navigating:yb,fbid:xb});this._setZoomOut();this._previousZoomScrollPercent=null;};wb.prototype.createLoader=function(xb){"use strict";if(this.currentImageSize===null){this.adjustStageSize(wb.STAGE_MIN);}else{var yb=this.getStageSize(this.currentImageSize);yb=new bb(Math.max(yb.x,wb.STAGE_MIN.x),Math.max(yb.y,wb.STAGE_MIN.y));var zb=this.getImageSizeInStage(this.currentImageSize,yb);if(this.thumbSrc===null){this.adjustStageSize(zb);}else this.useImage(l.create('img',{className:'spotlight',alt:'',src:this.thumbSrc,style:{width:zb.x+'px',height:zb.y+'px'}}),zb,false);}this.setLoadingState(this.STATE_IMAGE_PIXELS,true);if(xb)setTimeout((function(){var ac=new Image(),bc=function(){if(!this.isOpen)return;if(!this.stream||!this.stream.errorInCurrent()){this.switchImage(xb,this.currentImageSize);this.ua&&this.ua.add_event('image');this.setLoadingState(wb.STATE_IMAGE_DATA,false);}}.bind(this),cc=o.listen(ac,'load',bc),dc=function(){if(cc){cc.remove();cc=null;}};g.subscribeOnce('PhotoSnowlift.SWITCH_IMAGE',dc);g.subscribeOnce('PhotoSnowlift.CLOSE',dc);this._log(xb);ac.src=xb;}).bind(this),0);j.hide(this.stageActions);this.setStagePagersState('disabled');};wb.prototype.initDataFetched=function(xb){"use strict";ga.setPhotoSet(this.stream.getPhotoSet());ga.setLogFbids(xb.logids);this._albumBoundaries.start=this.stream.getCursor();var yb=this.stream.getCurrentImageData();ga.addPhotoView(yb.info,this.shouldShowHiRes(yb),this.fullscreen&&q.isFullScreen());var zb=this.stream.getCurrentExtraData();if(this._showHover&&zb)na.logImageImpression('snowlift',String(this.stream.getCursor()),Object.keys(zb.tagRects));if(zb&&zb.source!==(void 0)){this.source=parseInt(zb.source,10);ga.setSource(this.source);}if(!this.pageHandlers)this.pageHandlers=[o.listen(this.root,'click',this.pageListener.bind(this)),o.listen(this.root,'mouseleave',this.mouseLeaveListener.bind(this))];j.show(this.stageActions);this.root.setAttribute('aria-busy','false');this.isLoggedInViewer=xb.loggedin;this.disableAds=!this.isLoggedInViewer||xb.fromad||this.stream.isInViewAsMode();this.loadAds();if(this._isZoomAvailable(yb)){ga.addPanoramaImpression();this.switchIntoZoomedImage();}else if(this._hasZoomCapability)j.hide(this.showZoomInButton);};wb.prototype.adjustScrollerIfNecessary=function(){"use strict";clearTimeout(this.scrollerTimeout);this.scrollerTimeout=setTimeout(this.adjustScroller.bind(this),0);};wb.prototype.adjustScroller=function(xb){"use strict";clearTimeout(this.scrollerTimeout);this.initializeScroller();this.scrollableArea.resize();var yb=bb.getElementDimensions(this.rhc),zb=yb.y;zb-=bb.getElementDimensions(this.rhcHeader).y;zb-=bb.getElementDimensions(this.ufiInputContainer).y;if(this.placeInfo){var ac=bb.getElementDimensions(this.placeInfo);zb-=ac.y;ua.set(this.sideAdUnit,'bottom',ac.y+'px');}if(xb==null)xb=this.resizeCommentsForAds?this.lastAdsHeight:0;this.lastAdsHeight=xb;zb=Math.max(0,zb);var bc=bb.getElementDimensions(this.scrollerBody).y,cc=Math.max(wb.MIN_UFI_HEIGHT,zb-xb);if(bc>=cc){if(zb>cc){j.removeClass(this.rhc,'pinnedUfi');zb-=cc;}else{j.addClass(this.rhc,'pinnedUfi');zb=0;}ua.set(this.scroller,'height',cc+'px');}else{ua.set(this.scroller,'height','auto');j.removeClass(this.rhc,'pinnedUfi');zb-=bc;}var dc=bb.getElementDimensions(this.ufiInputContainer).y;ua.set(this.ufiForm,'padding-bottom',dc+'px');ka.resize(new bb(yb.x,zb));this.scrollableArea.adjustGripper();};wb.prototype.adjustForResize=function(){"use strict";this.currentMinSize=null;this.adjustStageSize();this.adjustForNewData();if(this._hasZoomCapability){if(!this._isZoomOn)this._conditionDisplayZoomInButton();this._scrollZoomedImageToPercent(this._previousZoomScrollPercent);}};wb.prototype.shouldShowHiRes=function(xb){"use strict";if(!xb||!xb.smallurl)return false;var yb=this.getStageSize(xb.dimensions);yb=this._adjustStageSizeForPixelRatio(yb);var zb=this.getImageSizeInStage(xb.dimensions,yb);return (zb.x>wb.STAGE_NORMAL_MAX.x||zb.y>wb.STAGE_NORMAL_MAX.y);};wb.prototype._adjustStageSizeForPixelRatio=function(xb){"use strict";if(window.devicePixelRatio&&window.devicePixelRatio>1)xb=new bb(xb.x*window.devicePixelRatio,xb.y*window.devicePixelRatio);return xb;};wb.prototype.getImageURL=function(xb){"use strict";if(xb.video){return null;}else if(xb.smallurl&&!this.shouldShowHiRes(xb))return xb.smallurl;return xb.url;};wb.prototype.getImageOrVideoDimensions=function(xb){"use strict";if(xb.video){var yb=this.getVideoElement(xb.video);if(yb)return this.getVideoSize(yb);}return this.getImageDimensions(xb);};wb.prototype.getImageDimensions=function(xb){"use strict";if(this._isZoomOn)return xb.originalDimensions;if(xb.smalldims&&(!this.shouldShowHiRes(xb)||this.image.src===xb.smallurl))return xb.smalldims;return xb.dimensions;};wb.prototype.getStageSize=function(xb,yb){"use strict";var zb=bb.getViewportDimensions(),ac=new bb(xb.x,xb.y+this.getExtraVerticalSpace());if(yb)ac=new bb(Math.max(xb.x,yb.x),Math.max(xb.y,yb.y));var bc,cc;if(this.fullscreen&&q.isFullScreen()){return new bb((this.rhcCollapsed?screen.width:screen.width-wb.SIDEBAR_SIZE_MAX),screen.height-wb.FULL_SCREEN_PADDING*2);}else{bc=Math.min(ac.x,(zb.x-wb.SIDEBAR_SIZE_MAX-wb.STAGE_CHROME.x));cc=Math.min(ac.y,zb.y-wb.STAGE_CHROME.y);}if(bc===0&&cc===0)return new bb(0,0);var dc=bc/cc,ec=ac.x/ac.y;if(dc<ec)return new bb(bc,Math.round(bc/ec));return new bb(Math.round(cc*ec),cc);};wb.prototype.getExtraVerticalSpace=function(){"use strict";if(this.getVideoOnStage())return wb.VIDEO_BOTTOM_BAR_SPACE*2;return 0;};wb.prototype.getComponentsHeight=function(){"use strict";var xb=this.getVideoOnStage();if(xb)return this.getVideoComponentsHeight(kb(xb));return 0;};wb.prototype.getImageSizeInStage=function(xb,yb){"use strict";var zb=xb.x,ac=xb.y,bc=this.getComponentsHeight(),cc=this.getExtraVerticalSpace();ac-=bc;yb=new bb(yb.x,yb.y-bc-cc);if(zb>=yb.x||ac>=yb.y){var dc=yb.x/yb.y,ec=zb/ac;if(dc<ec){zb=yb.x;ac=Math.round(zb/ec);}else if(dc>ec){ac=yb.y;zb=Math.round(ac*ec);}else{zb=yb.x;ac=yb.y;}}return new bb(zb,ac+bc);};wb.prototype.getStageSizeForZoomedImage=function(xb,yb){"use strict";if(this.fullscreen&&q.isFullScreen()){var zb=this.rhcCollapsed?screen.width:screen.width-wb.SIDEBAR_SIZE_MAX,ac=screen.height-wb.FULL_SCREEN_PADDING*2;return new bb(zb,ac);}var bc=bb.getViewportDimensions();if(yb===null)yb=new bb(0,0);var cc=new bb(Math.max(xb.x,wb.STAGE_MIN.x,yb.x),Math.max(xb.y,wb.STAGE_MIN.y,yb.y)),dc=bc.x-wb.STAGE_CHROME.x;if(!this.rhcCollapsed)dc-=wb.SIDEBAR_SIZE_MAX;zb=Math.min(cc.x,dc);ac=Math.min(cc.y,bc.y-wb.STAGE_CHROME.y);return new bb(zb,ac);};wb.prototype.adjustStageSize=function(xb){"use strict";var yb=this.currentImageSize;if(xb){yb=xb;}else{var zb=this.stream&&this.stream.getCurrentImageData();if(zb)yb=this.getImageOrVideoDimensions(zb);}if(!yb)return;this.currentImageSize=yb;var ac=this.getExtraVerticalSpace();if(this.shouldStretch&&!this.getVideoOnStage()&&yb.x>yb.y&&yb.x<=wb.TIMELINE_STRETCH_WIDTH&&yb.x>=wb.TIMELINE_STRETCH_MIN){yb.y=Math.round(yb.y*wb.TIMELINE_STRETCH_WIDTH/yb.x);yb.x=wb.TIMELINE_STRETCH_WIDTH;}var bc;if(this._isZoomOn){bc=this.getStageSizeForZoomedImage(yb,this.currentMinSize);}else bc=this.getStageSize(yb,this.currentMinSize);if(!this.currentMinSize)this.currentMinSize=new bb(0,0);this.currentMinSize=new bb(Math.max(bc.x,wb.STAGE_MIN.x,this.currentMinSize.x),Math.max(bc.y,wb.STAGE_MIN.y,this.currentMinSize.y));var cc=this.getImageSizeInStage(yb,this.currentMinSize),dc=this.currentMinSize.x-cc.x,ec=this.currentMinSize.y-cc.y;if(dc>0&&dc<wb.PADDING_MIN){this.currentMinSize.x-=dc;}else if(ec>0&&ec<wb.PADDING_MIN)this.currentMinSize.y-=ec;var fc=this.currentMinSize.x+wb.SIDEBAR_SIZE_MAX;if(this.rhcCollapsed)fc=this.currentMinSize.x;var gc=this.getVideoOnStage()&&this.pivotsCarouselElement,hc=0,ic=this.currentMinSize.y;if(gc){var jc=this.pivotsCarouselElement.clientHeight;hc=Math.ceil(jc/100)*100;ic=ic+hc;}this.snowliftPopup.style.cssText='width:'+fc+'px;'+'height:'+ic+'px;';var kc=this.currentMinSize.y-ac,lc=kc+hc;if(ab.firefox()){var mc=ua.get(this.stageWrapper,'font-size');kc=(kc/parseFloat(mc))+'em';lc=(lc/parseFloat(mc))+'em';}else{kc=kc+'px';lc=lc+'px';}this.stageWrapper.style.cssText='width:'+this.currentMinSize.x+'px;'+'line-height:'+kc+';';if(this.getVideoOnStage())this.videoStage.style.cssText='width:'+this.currentMinSize.x+'px;'+'height:'+lc+';';if(this._isZoomOn){var nc=this.currentMinSize.y-ac;if(yb.y>nc){var oc=(yb.x/yb.y)*nc;ua.apply(this.zoomedImage,{width:oc+"px",height:nc+"px"});}else ua.apply(this.zoomedImage,{width:yb.x+"px",height:yb.y+"px"});}else{cc.y-=this.getComponentsHeight();this.setMediaElementSize(cc);}if(gc)this.setPivotCarouselElementWidth(mc);var pc=this.getTagger();if(pc)pc.repositionTagger();this.adjustScrollerIfNecessary();};wb.prototype.setMediaElementSize=function(xb){"use strict";var yb=this.image;if(this.getVideoOnStage())yb=l.scry(this.videoStage,"._53j5")[0]||yb;yb.style.cssText='width:'+xb.x+'px;'+'height:'+xb.y+'px;';};wb.prototype.setPivotCarouselElementWidth=function(xb){"use strict";var yb=this.videoStage.clientWidth;if(ab.firefox()){yb=(yb/parseFloat(xb))+'em';}else yb=yb+'px';this.pivotsCarouselElement.style.width=yb;};wb.prototype.adjustForNewData=function(){"use strict";if(!this.image)return;var xb=l.scry(this.stage,'div.tagsWrapper')[0],yb=bb.getElementDimensions(this.image);if(xb){ua.set(xb,'width',yb.x+'px');ua.set(xb,'height',yb.y+'px');}};wb.prototype.adsDisplayedCallback=function(xb,yb){"use strict";var zb=this.resizeCommentsForAds&&!this.inAdsDisplayedCallback&&!this.disableAds&&xb<wb.MIN_ADS_VISIBLE&&yb.length>=wb.MIN_ADS_VISIBLE;if(zb){this.inAdsDisplayedCallback=true;var ac=yb[wb.MIN_ADS_VISIBLE-1];this.adjustScroller(ac);this.inAdsDisplayedCallback=false;}};wb.prototype.setLoadingState=function(xb,yb){"use strict";switch(xb){case wb.STATE_IMAGE_PIXELS:j.conditionClass(this.root,'imagePixelsLoading',yb);break;case wb.STATE_IMAGE_DATA:this.loadingStates[xb]=yb;j.conditionClass(this.root,'imageLoading',yb);break;case wb.STATE_HTML:this.loadingStates[xb]=yb;j.conditionClass(this.root,'dataLoading',yb);this.rhc.setAttribute('aria-busy',yb?'true':'false');break;}};wb.prototype.destroy=function(){"use strict";this.stageHandlers.forEach(function(xb){xb.remove();});if(this.pageHandlers){this.pageHandlers.forEach(function(xb){xb.remove();});this.pageHandlers=null;}this._slideshowToken&&clearInterval(this._slideshowToken);this._slideshowToken=null;this._videoPlayerStateManager=null;};wb.prototype.checkState=function(xb){"use strict";if(xb!=wb.STATE_ERROR&&!this.loadingStates[xb])return;switch(xb){case wb.STATE_IMAGE_DATA:var yb=this.stream.getCurrentImageData();if(yb){var zb=this.getImageURL(yb);if(zb){if(!this._isZoomOn&&this._isZoomAvailable())this._setZoomIn();this.switchImage(zb,null,true);}else if(yb.video)this.switchVideo(yb.video,true);this.setLoadingState(xb,false);}break;case wb.STATE_HTML:if(this.stream.getCurrentHtml()){this.swapData();this.setLoadingState(xb,false);}break;default:if(this.stream.errorInCurrent()){j.hide(this.image);j.show(this.errorBox);}break;}};wb.prototype.buttonListener=function(event){"use strict";var xb=event.getTarget(),yb=Date.now();if(ca.byClass(xb,"_5qmg")){ga.addPanoramaClick();this.switchIntoZoomedImage();return;}if(ca.byClass(xb,"_5qmh")){this._setZoomOut();this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));return false;}if(ca.byClass(xb,'fbPhotoTagApprovalBox'))return;if(yb-this.lastPage<350)return;if(ca.byClass(xb,'fbPhotosPhotoLike')){this.likePhoto();}else if(ca.byClass(xb,'tagApproveIgnore')){this.updateTagBox(event,xb);}else if(ca.byClass(xb,"_5ge9")){this.hideMorePhotos();this.toggleSlideshow();return false;}else if(ca.byClass(xb,"_5ymu")){if(!this._showingMorePhotos){na.logShowMorePhotos();var zb=this.stream.getCursor();if(zb)this.showMorePhotos(String(zb));if(this._hasZoomCapability)j.hide(this.showZoomInButton);}else{na.logHideMorePhotos();this._conditionDisplayZoomInButton();this.hideMorePhotos();}return;}else if(ca.byClass(xb,"_27n"))this._conditionDisplayZoomInButton();this.hideMorePhotos();};wb.prototype.toggleSlideshow=function(){"use strict";if(!this.slideshowGk)return;if(this._slideshowToken){this.stopSlideshow();}else this.startSlideshow();};wb.prototype.startSlideshow=function(){"use strict";this._slideshowToken=window.setInterval(this.page.bind(this,1,ab.chrome()&&q.isFullScreen()),wb.SLIDESHOW_TIME);j.addClass(this.root,'slideshowStarted');j.removeClass(this.root,'slideshowAvailable');};wb.prototype.stopSlideshow=function(){"use strict";this._slideshowToken&&clearInterval(this._slideshowToken);this._slideshowToken=null;j.addClass(this.root,'slideshowAvailable');j.removeClass(this.root,'slideshowStarted');};wb.prototype.likePhoto=function(){"use strict";ga.addButtonLike();var xb=db('fbPhotoSnowliftFeedback'),yb=l.scry(xb,'button.like_link')[0];if(!yb)yb=l.scry(xb,'a.UFILikeLink')[0];var zb=yb.getAttribute('href');if(q.isFullScreen())if(ab.chrome())yb.setAttribute('href','javascript:;');yb.click();yb.setAttribute('href',zb);};wb.prototype.toggleLikeButton=function(){"use strict";var xb=l.scry(this.buttonActions,'a.fbPhotosPhotoLike')[0];if(xb){var yb=l.find(this.root,'.likeCount'),zb=l.find(yb,'.likeCountNum');if(yb)if(j.hasClass(xb,'viewerLikesThis')){l.setContent(zb,parseInt(zb.textContent,10)-1);}else l.setContent(zb,parseInt(zb.textContent,10)+1);j.toggleClass(xb,'viewerLikesThis');j.removeClass(xb,'viewerAlreadyLikedThis');}};wb.prototype.likePhotoWithKey=function(){"use strict";return w.like(this.likePhoto.bind(this),lb());};wb.prototype.updateTagBox=function(xb,yb){"use strict";this.unhiliteAllTags();var zb=kb(xb);if(!zb)return;j.addClass(zb,'tagBox');j.addClass(zb,'tagBoxPendingResponse');j.removeClass(zb,'tagBoxPending');j.hide(l.find(zb,'span.tagForm'));if(yb){j.show(l.find(zb,'span.tagApproved'));}else j.show(l.find(zb,'span.tagIgnored'));};wb.prototype.rotate=function(xb){"use strict";var yb=this.stream.getCursor();if(this.getVideoOnStage()){var zb=(xb=='left')?270:90;nb(!!this.videoRotateURI);i.loadModules(["VideoRotate"],function(bc){new bc(yb,this.videoRotateURI).motionRotate(zb);}.bind(this));return;}var ac=fb({fbid:yb,opaquecursor:this.stream.getOpaqueCursor(yb),cs_ver:fa.VIEWER_SNOWLIFT},this.stream.getPhotoSetQuery());ac[xb]=1;this.setLoadingState(wb.STATE_IMAGE_DATA,true);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);j.hide(this.image);new h('/ajax/photos/photo/rotate/').setAllowCrossPageTransition(true).setData(ac).setErrorHandler(this.rotationError.bind(this,yb)).setFinallyHandler(this.rotationComplete.bind(this,yb)).setMethod('POST').setReadOnly(false).send();};wb.prototype.rotationComplete=function(xb,yb){"use strict";if(xb==this.stream.getCursor()){this.setLoadingState(wb.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));this.swapData();}};wb.prototype.rotationError=function(xb,yb){"use strict";if(xb==this.stream.getCursor()){this.setLoadingState(wb.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));i.loadModules(["AsyncResponse"],function(zb){zb.defaultErrorHandler(yb);});}};wb.prototype.saveTagsFromPayload=function(xb){"use strict";this.storeFromData(xb);if('data' in xb&&this.stream.getCursor() in xb.data)this.swapData();};wb.prototype.saveEdit=function(){"use strict";if(!j.hasClass(this.root,'fbPhotoSnowliftEditMode'))return;i.loadModules(["PhotoInlineEditor","Form"],function(xb,yb){var zb=xb.getInstance(this.getViewerConst());zb&&yb.bootstrap(zb.getForm().controller);}.bind(this));};wb.prototype.mouseLeaveListener=function(event){"use strict";this.unhiliteAllTags();this.reHilitePendingTag();};wb.prototype.hilitePager=function(event){"use strict";var xb=bb.getEventPosition(event),yb=bb.getElementPosition(this.stage);if(aa.isRTL()){var zb=bb.getElementDimensions(this.stage);this.stagePagerPrev=zb.x-(xb.x-yb.x)<wb.GOPREV_AREA;}else this.stagePagerPrev=xb.x-yb.x<wb.GOPREV_AREA;j.conditionClass(this.prevPager,'hilightPager',this.stagePagerPrev);j.conditionClass(this.nextPager,'hilightPager',!this.stagePagerPrev);var ac,bc=event.getTarget();if(!ca.byClass(bc,'snowliftOverlay')&&!ca.byClass(bc,'bottomBarActions')&&!ca.byClass(bc,'snowliftPager'))ac=wb.PAGER_FADE;this.showPagers(ac);};wb.prototype.showPagers=function(xb){"use strict";clearTimeout(this.fadePagerTimer);this.setStagePagersState('active');if(typeof xb!=='undefined')this.fadePagerTimer=setTimeout(this.hidePagers.bind(this),xb);};wb.prototype.hidePagers=function(){"use strict";var xb=l.scry(this.getRoot(),'.fbPhotosPhotoActionsMenu')[0];if(xb)return;clearTimeout(this.fadePagerTimer);this.setStagePagersState('inactive');};wb.prototype.getTagger=function(){"use strict";return (this.PhotoTagger&&this.PhotoTagger.getInstance(fa.VIEWER_SNOWLIFT));};wb.prototype.unhiliteAllTags=function(){"use strict";clearTimeout(this.unhiliteTimer);l.scry(this.stage,'div.tagsWrapper div.hover').forEach(function(yb){j.removeClass(yb,'hover');});l.scry(this.stage,'div.tagsWrapper div.otherActive').forEach(function(yb){j.removeClass(yb,'otherActive');});this.hilitedTag=null;this.showingTypeaheadSuggestions=false;if(!j.hasClass(this.root,'taggingMode')){var xb=this.getTagger();if(xb){xb.hideTagger();xb.setCurrentFacebox(null);}}};wb.prototype.switchHilitedTags=function(xb,yb){"use strict";if(this.switchTimer!==null){clearTimeout(this.switchTimer);this.switchTimer=null;}this.unhiliteAllTags();this.hiliteAllBoxes();var zb=kb(xb);if(zb){this.hilitedTag=xb;if(!j.hasClass(this.root,'taggingMode')&&ma.isFacebox(this.hilitedTag)){var ac=this.getTagger();if(ac){j.addClass(zb,'hover');var bc=ac.getFacebox(xb);ac.setCurrentFacebox(bc);if(bc)ac.addTagFromFacebox(bc);}}else j.addClass(zb,'hover');if(j.hasClass(zb,'tagBoxPending')&&!j.hasClass(zb,'showPendingTagName')&&yb===true){l.scry(this.stage,'div.tagsWrapper div.showPendingTagName').forEach(function(cc){j.removeClass(cc,'showPendingTagName');});j.addClass(zb,'showPendingTagName');}}};wb.prototype.reHilitePendingTag=function(){"use strict";var xb=kb(this.hilitedTag);if(xb&&j.hasClass(xb,'showPendingTagName'))return;var yb=l.scry(this.stage,'div.tagsWrapper div.showPendingTagName')[0];if(yb)this.switchHilitedTags(yb.id);};wb.prototype.hiliteTagsOnMouseMove=function(event){"use strict";if(!this.stream.getCurrentExtraData()||this.getVideoOnStage())return;if(this.switchTimer!==null)return;var xb=event.getTarget();if(ca.byClass(xb,'snowliftOverlay')||ca.byClass(xb,'fbPhotoSnowliftTagApproval')||ca.byClass(xb,'tagPointer')||ca.byClass(xb,'arrow')||ca.byClass(xb,'faceboxSuggestion')||ca.byClass(xb,'typeaheadWrapper')||ca.byClass(xb,'photoTagTypeahead'))return;var yb=ca.byClass(xb,'tagBoxPending'),zb=false;if(this.hilitedTag){var ac=kb(this.hilitedTag);zb=ac&&j.hasClass(ac,'tagBoxPending');}var bc=((!this.hilitedTag&&yb)||(!zb&&yb));if(bc){this.switchHilitedTags(yb.id);return;}if(yb&&(yb.id==this.hilitedTag))return;var cc=250,dc=15,ec=bb.getEventPosition(event);if(!this.startingMousePos)this.startingMousePos=ec;var fc=ma.absoluteToNormalizedPosition(this.image,ec);if(!this.haveLeftBufferRegion&&this.startingMousePos.distanceTo(ec)<dc){return;}else this.haveLeftBufferRegion=true;if(this.currentTagHasPrecedence(fc))return;var gc=ma.getNearestBox(this.stream.getCurrentExtraData().tagRects,fc);if(!gc){if(!zb){this.unhiliteAllTags();this.reHilitePendingTag();}return;}var hc=null;if(zb){var ic={};ic[this.hilitedTag]=this.stream.getCurrentExtraData().tagRects[this.hilitedTag];hc=ma.getNearestBox(ic,fc);}if(hc!==null&&zb)return;if(this.hilitedTag!=gc)if(zb){this.switchTimer=setTimeout(this.switchHilitedTags.bind(this,gc),cc);}else{if(this._showHover&&!this._seenTags[gc]){this._seenTags[gc]=true;na.logPivotImpression('snowlift',gc);}this.switchHilitedTags(gc);}};wb.prototype.currentTagHasPrecedence=function(xb){"use strict";if(!this.hilitedTag)return false;if(this.stream.getCurrentExtraData().tagRects[this.hilitedTag]===(void 0)){this.hilitedTag=null;return false;}var yb=this.stream.getCurrentExtraData().tagRects[this.hilitedTag],zb=new qa(yb.t+(yb.h()/2),yb.r,yb.b+(ma.isFacebox(this.hilitedTag)?10:0),yb.l,yb.domain);return zb.contains(xb);};wb.prototype.getVideoOnStage=function(){"use strict";var xb=this.stream&&this.stream.getCurrentImageData();return xb&&xb.video;};wb.prototype.shouldPageOnAction=function(xb,yb){"use strict";if(!this.isOpen||w.isShowingConfirmation())return false;var zb=l.isNode(yb)&&(ca.byClass(yb,'snowliftPager')||ca.byClass(yb,'stagePagers')||ca.byClass(yb,'pivotPageColumn')),ac=l.isNode(yb)&&ca.byClass(yb,'stage'),bc=j.hasClass(yb,'faceBox'),cc=(!j.hasClass(this.root,'taggingMode')&&bc&&!zb);if(cc){if(!this.showingTypeaheadSuggestions){this.getTagger().updateWithSuggestions();setTimeout((function(){l.find(this.getTagger().tagger,'input.textInput').focus();}).bind(this),0);}this.showingTypeaheadSuggestions=!this.showingTypeaheadSuggestions;return false;}var dc=((ac&&j.hasClass(this.root,'taggingMode'))||ca.byClass(yb,'tagBoxPending')||ca.byClass(yb,'tagBoxPendingResponse')||ca.byClass(yb,'fbPhotoTagApprovalBox')||ca.byClass(yb,'tag'));if(dc)return false;if(ac&&this._isZoomOn)ac=false;return xb==t.LEFT||xb==t.RIGHT||xb==pb||xb==qb||zb||cc||ac;};wb.prototype.keyHandler=function(xb,event){"use strict";if(event.getModifiers().any||u.getTopmostLayer()!==this.spotlight)return true;switch(o.getKeyCode(event)){case t.LEFT:case t.RIGHT:case pb:case qb:this.pageListener(event);return false;case rb:return this.toggleFullScreen();case sb:return this.likePhotoWithKey();case t.SPACE:this.toggleSlideshow();this.showPagers(wb.PAGER_FADE);return false;case t.ESC:if(this._isZoomOn){this._setZoomOut();this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));return false;}break;}};wb.prototype.shouldHandlePendingTag=function(event){"use strict";var xb=this.getTagger();if(!xb||!xb.tags.length)return false;var yb=ma.absoluteToNormalizedPosition(this.getImage(),bb.getEventPosition(event)),zb=xb.findNearestTag(yb);if(!zb||!j.hasClass(zb.node,'tagBoxPending'))return false;g.inform('PhotoTagApproval.PENDING_TAG_PHOTO_CLICK',{id:zb.id,version:this.getVersionConst()});return true;};wb.prototype.pageListener=function(event){"use strict";var xb=o.getKeyCode(event),yb=event.getTarget();if(this._slideshowToken){this.stopSlideshow();return;}if(!this.shouldPageOnAction(xb,yb))return;if(this.shouldHandlePendingTag(event))return;var zb=0;if(xb==t.RIGHT||xb==qb){zb=1;ga.setPagingAction('key_right');this._disableMouseOver=true;}else if(xb==t.LEFT||xb==pb){zb=-1;ga.setPagingAction('key_left');this._disableMouseOver=true;}else if(ca.byClass(yb,'next')){zb=1;ga.setPagingAction('click_next');}else if(ca.byClass(yb,'prev')){zb=-1;ga.setPagingAction('click_prev');}else if(!this.stagePagerPrev){zb=1;ga.setPagingAction('click_stage');}else{zb=-1;ga.setPagingAction('click_stage_back');}var ac=l.scry(this.ufiForm,'input.mentionsHidden'),bc=false;for(var cc=0;cc<ac.length;cc++)if(!s.isEmpty(ac[cc])){bc=true;break;}if(bc||j.hasClass(this.root,'fbPhotoSnowliftEditMode')){this.warnLeavePage(this.page.bind(this,zb));}else{this.page(zb,ab.chrome()&&q.isFullScreen());this._previousZoomScrollPercent=null;ob('snowlift',yb,event).uai(ga.pagingAction);}};wb.prototype.warnLeavePage=function(xb){"use strict";new k().setTitle("\u3053\u306e\u30da\u30fc\u30b8\u304b\u3089\u79fb\u52d5\u3057\u307e\u3059\u304b\uff1f").setBody("\u30da\u30fc\u30b8\u304b\u3089\u79fb\u52d5\u3059\u308b\u3068\u3001\u4fdd\u5b58\u3055\u308c\u3066\u3044\u306a\u3044\u5909\u66f4\u306f\u5931\u308f\u308c\u307e\u3059\u3002").setButtons([{name:'leave_page',label:"\u79fb\u52d5\u3059\u308b",handler:xb},{name:'continue_editing',label:"\u3053\u306e\u30da\u30fc\u30b8\u304b\u3089\u79fb\u52d5\u3057\u306a\u3044",className:'inputaux'}]).setModal(true).show();};wb.prototype.getUsesOpaqueCursor=function(){"use strict";return this.stream.getUsesOpaqueCursor();};wb.prototype.getOpaqueCursor=function(xb){"use strict";return this.stream.getOpaqueCursor(xb);};wb.prototype.setReachedLeftEnd=function(){"use strict";this.stream.setReachedLeftEnd();};wb.prototype.setReachedRightEnd=function(){"use strict";this.stream.setReachedRightEnd();};wb.prototype.page=function(xb,yb){"use strict";if(!this.stream.isValidMovement(xb)||!this.stream.nonCircularPhotoSetCanPage(xb)){this.showPagers(wb.PAGER_FADE);return;}var zb=this.stream.getCursorAt(this.stream.calculatePositionForMovement(xb));if(this.snowflake&&((this.stream.getCursor()==this.firstInSet&&xb<0)||(this.firstInSet==zb&&xb>0))){this.showPagers(wb.PAGER_FADE);return;}this.lastPage=Date.now();this.unhiliteAllTags();this.startingMousePos=null;this.haveLeftBufferRegion=false;this._seenTags={};this._navCount+=xb;var ac=this.stream.allLoaded?Math.abs(this._navCount)-this.stream.getLength():null;if(this._extraSlidePivot&&this._albumFBID){if(!this._albumBoundaries.end&&ac===0){this._albumBoundaries.end=this.stream.getCursor();}else if(ac===-1)ja.fetch(this._albumFBID,this.stream);if(!this.onExtraSlide){if(this.stream.getCursor()===this._albumBoundaries.end&&zb===this._albumBoundaries.start){this.showPivotSlide(this._albumFBID,yb);return;}else if(this.stream.getCursor()===this._albumBoundaries.start&&zb===this._albumBoundaries.end)this.showPivotSlide(this._albumFBID,yb);}else{this.hidePivotSlide();if(zb!==this._albumBoundaries.start)return;}}var bc=this.getVideoOnStage();if(bc)this.switchVideo(bc,false);if(this.pivots&&this.pivots.page(xb))return;g.inform('PhotoSnowlift.PAGE');va.hide();this.recacheData();this.stream.moveCursor(xb);j.hide(this.image);if(xb!==0){this.storyID=null;this._updateContainerOwnerID();}if(xb!==0&&this._isZoomOn)this._setZoomOut();if(this.stream.errorInCurrent()){this.setLoadingState(wb.STATE_HTML,true);j.show(this.errorBox);return;}this.movementDelta+=xb;var cc=this.stream.getCurrentImageData();if(cc){var dc=this.getImageURL(cc);if(dc){if(!this._isZoomOn&&this._isZoomAvailable())this._setZoomIn();this.switchImage(dc,null,true);}else if(cc.video)this.switchVideo(cc.video,true);if(!yb){this.replaceUrl=true;mb(cc.info.permalink);}this.setLoadingState(wb.STATE_IMAGE_DATA,false);}else{this.setLoadingState(wb.STATE_IMAGE_PIXELS,true);this.setLoadingState(wb.STATE_IMAGE_DATA,true);}if(this.stream.getCurrentHtml()){this.swapData();}else this.setLoadingState(wb.STATE_HTML,true);this.disableAds=!this.isLoggedInViewer||this.stream.isInViewAsMode();this.loadAds();this.setLeftAndRightPagersState();if(this._slideshowToken){j.addClass(this.root,'slideshowStarted');}else if(this.slideshowAvailable)j.addClass(this.root,'slideshowAvailable');if(!this._extraSlidePivot&&this._showMorePhotos&&this._albumFBID)if(ac===-1){ja.fetch(this._albumFBID,this.stream);}else if(ac===0){na.logSuggestMorePhotos();this.showMorePhotos(this._albumFBID,true);this.showPagers();this._navCount=0;}else{this.hideMorePhotos();this.hidePagers();}};wb.prototype.showMorePhotos=function(xb,yb){"use strict";if(this._showingMorePhotos)return;this._showingMorePhotos=true;if(!this.searchPivot)this.searchPivot=this.overlay.appendChild(document.createElement('div'));j.addClass(this.stageWrapper,"_5ymv");this.searchPivotComponent=pa.render(pa.createElement(ia,{className:"_27g",fbid:xb,onclose:this.hideMorePhotos.bind(this),endofalbum:yb||false,withBackground:true}),this.searchPivot);};wb.prototype.hideMorePhotos=function(){"use strict";if(this.searchPivotComponent&&this._showingMorePhotos){this._showingMorePhotos=false;j.removeClass(this.stageWrapper,"_5ymv");this.searchPivotComponent.setProps({fbid:null});}};wb.prototype.showPivotSlide=function(xb,yb){"use strict";if(this.onExtraSlide)return;this.onExtraSlide=true;j.addClass(this.stageWrapper,"_3tvf");if(!this.pivotSlide){this.pivotSlide=l.create('div');l.insertBefore(this.stageActions,this.pivotSlide);}this.pivotSlideComponent=pa.render(pa.createElement(ha,{fbid:xb,isAlbum:this._isAlbum,albumOwnerName:this._albumOwnerName,visible:true,onReturn:this.returnToBeginning.bind(this,yb)}),this.pivotSlide);};wb.prototype.hidePivotSlide=function(){"use strict";if(this.pivotSlideComponent&&this.onExtraSlide){this.pivotSlideComponent.setProps({visible:false});j.removeClass(this.stageWrapper,"_3tvf");}this.onExtraSlide=false;};wb.prototype.returnToBeginning=function(xb){"use strict";var yb=this.stream.getRelativeMovement(this._albumBoundaries.start);this.page(yb,xb);};wb.prototype.logImpressionDetailsForPhoto=function(){"use strict";var xb=[].concat(l.scry(db('fbPhotoSnowliftTagList'),'input.photoImpressionDetails'),l.scry(db('fbPhotoSnowliftFeedback'),'input.photoImpressionDetails'));if(xb.length===0)return;var yb={};for(var zb=0;zb<xb.length;zb++)yb[xb[zb].name]=xb[zb].value;if(this.getVideoOnStage()){yb.width=0;yb.height=0;}else{var ac=this.getImageDimensions(this.stream.getCurrentImageData());yb.width=ac.x;yb.height=ac.y;}ga.addDetailData(this.stream.getCursor(),yb);ka.setIsLogAdData(true);};wb.prototype.loadAds=function(){"use strict";if(this.disableAds)return;ka.loadAdsFromUserActivity();};wb.prototype.transitionHandler=function(xb){"use strict";if(xb.getQueryData().closeTheater||xb.getQueryData().permPage||this.returningToStart){if(this.isOpen)this.close();this.transitionHandlerRegistered=false;return false;}if(this.replaceUrl){this.replaceUrl=false;this._uriStack.push(xb.getQualifiedURI().toString());ba.transitionComplete(true);return true;}var yb=this._uriStack.length;if(yb>=2&&this._uriStack[yb-2]==xb.getQualifiedURI().toString())this._uriStack.pop();var zb=this.stream.getCursorForURI(xb.getUnqualifiedURI().toString());if(zb){var ac=this.stream.getRelativeMovement(zb);this.page(ac,true);ba.transitionComplete(false);return true;}if(this.isOpen){ba.transitionComplete(true);this.close();return true;}this.transitionHandlerRegistered=false;return false;};wb.prototype.recacheData=function(){"use strict";if(!this.loadingStates.html){var xb=this.stream.getCurrentHtml();for(var yb in xb){xb[yb]=gb(db(yb).childNodes);l.empty(db(yb));}}};wb.prototype.reloadIfTimeout=function(){"use strict";if(!r.hasLoaded(this.image)){var xb=this.makeNewImage(this.image.src,true);o.listen(xb,'load',this.useImage.bind(this,xb,null,true));this._log(xb.src);}};wb.prototype.useImage=function(xb,yb,zb){"use strict";if(zb&&r.hasLoaded(this.image))return;l.replace(this.image,xb);this.image=xb;this.adjustStageSize(yb);};wb.prototype.makeNewImage=function(xb,yb){"use strict";if(this.imageLoadingTimer){clearTimeout(this.imageLoadingTimer);this.imageLoadingTimer=null;}else if(!yb)this.imageRefreshTimer=setTimeout(this.reloadIfTimeout.bind(this),wb.LOADING_TIMEOUT);var zb=l.create('img',{className:'spotlight',alt:''});zb.setAttribute('aria-describedby','fbPhotosSnowliftCaption');zb.setAttribute('aria-busy','true');var ac=function(){clearTimeout(this.imageRefreshTimer);this.image.setAttribute('aria-busy','false');this.setLoadingState(this.STATE_IMAGE_PIXELS,false);setTimeout((function(){if(this.isOpen){this.adjustStageSize();this.adjustForNewData();}}).bind(this),0);}.bind(this);o.listen(zb,'load',ac);this._log(xb);zb.src=xb;return zb;};wb.prototype.switchImage=function(xb,yb,zb){"use strict";j.hide(this.image);j.hide(this.errorBox);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);var ac=this.stream&&this.stream.getCurrentImageData();if(ac){ga.addPhotoView(ac.info,this.shouldShowHiRes(ac),this.fullscreen&&q.isFullScreen());if(this._showHover){var bc=this.stream.getCurrentExtraData();if(bc)na.logImageImpression('snowlift',String(this.stream.getCursor()),Object.keys(bc.tagRects));}}this.useImage(this.makeNewImage(xb,false),yb,false);if(zb)this.stream.preloadImages(this.shouldShowHiRes.bind(this));if(!this._isZoomOn&&this._isZoomAvailable(ac)){ga.addPanoramaImpression();var cc=new bb(this.stage.clientWidth,this.stage.clientHeight);this._displayZoomInButton(cc);}else if(this._hasZoomCapability)j.hide(this.showZoomInButton);if(this._isZoomOn){this.switchIntoZoomedImage();this.showPagers(wb.PAGER_FADE);}g.inform('PhotoSnowlift.SWITCH_IMAGE');};wb.prototype._conditionDisplayZoomInButton=function(){"use strict";if(!this._hasZoomCapability)return;if(this._isZoomAvailable()){var xb=new bb(this.stage.clientWidth,this.stage.clientHeight);this._displayZoomInButton(xb);}else j.hide(this.showZoomInButton);};wb.prototype._displayZoomInButton=function(xb){"use strict";var yb=parseInt(this.image.style.height,10),zb=(xb.y-yb)/2;if(zb>=wb.ZOOM_BUTTON_TOP_PAD+wb.ZOOM_BUTTON_BOT_PAD+wb.ZOOM_BUTTON_HEIGHT){var ac=zb-wb.ZOOM_BUTTON_HEIGHT-wb.ZOOM_BUTTON_TOP_PAD;ua.set(this.showZoomInButton,'bottom',ac+'px');}else ua.set(this.showZoomInButton,'bottom','60px');j.show(this.showZoomInButton);};wb.prototype._isZoomAvailable=function(xb){"use strict";if(typeof xb==="undefined")xb=this.stream&&this.stream.getCurrentImageData();if(!this._hasZoomCapability||!xb||!xb.originalDimensions)return false;var yb=new bb(this.stage.clientWidth,this.stage.clientHeight),zb=xb.originalDimensions,ac=zb.x/zb.y,bc=Math.min(yb.y*ac,zb.x);if(!isNaN(ac)&&ac>2&&zb.y>wb.MIN_PANORAMA_Y&&yb.x*wb.MIN_PANO_TO_STAGE_RATIO<bc){return true;}else return false;};wb.prototype._setZoomIn=function(){"use strict";this._isZoomOn=true;j.hide(this.showZoomInButton);j.hide(this.stageActions);j.show(this.showZoomOutButton);ua.set(this.stage,'overflow','hidden');this.spotlight.disableBehavior(v);this.collapseRHC();};wb.prototype._setZoomOut=function(){"use strict";if(!this._hasZoomCapability)return;this._isZoomOn=false;this.spotlight.enableBehavior(v);ua.set(this.stage,'overflow','visible');j.hide(this.showZoomInButton);j.hide(this.showZoomOutButton);j.hide(this.zoomedImage);j.hide(this.outerImageSlider);j.show(this.stageActions);this.uncollapseRHC();};wb.prototype.switchIntoZoomedImage=function(xb){"use strict";this._setZoomIn();j.hide(this.zoomedImage);j.hide(this.outerImageSlider);var yb=this.stream.getCurrentImageData(),zb=yb.originalDimensions;this.zoomedImage.src=yb.url;this.adjustStageSize(zb);this._initializeZoomedImagePositions(new bb(parseInt(ua.get(this.zoomedImage,'width'),10),parseInt(ua.get(this.zoomedImage,'height'),10)));j.hide(this.image);};wb.prototype._adjustInnerImageSlider=function(xb){"use strict";var yb=this.stage.clientWidth,zb=Math.min(100,(yb/xb.x)*100);ua.set(this.innerImageSlider,'width',zb+'%');return zb;};wb.prototype._getSliderSizeForZoomedImage=function(xb){"use strict";var yb=wb.MAX_SLIDER_HEIGHT*this.stage.clientHeight/xb.y,zb=wb.MAX_SLIDER_WIDTH*this.stage.clientWidth/xb.x,ac=Math.min(yb,zb);return new bb(100*xb.x*ac/this.stage.clientWidth,100*xb.y*ac/this.stage.clientHeight);};wb.prototype._initializeZoomedImagePositions=function(xb){"use strict";this._scrollZoomedImageToPercent(this._previousZoomScrollPercent);var yb=this._getSliderSizeForZoomedImage(xb);ua.set(this.outerImageSlider,'width',yb.x+'%');ua.set(this.outerImageSlider,'height',yb.y+'%');ua.set(this.outerImageSlider,'left',(50-yb.x/2)+'%');ua.set(this.showZoomOutButton,'bottom',yb.y*this.stage.clientHeight/100+parseInt(ua.get(this.outerImageSlider,'bottom'),10)+20+'px');j.show(this.zoomedImage);j.show(this.outerImageSlider);};wb.prototype._zoomedImageMouseDown=function(event){"use strict";if(!this._isZoomOn)return;j.addClass(this.stage,'showSlider');if(this._zoomedImageMouseMoveHandle)this._zoomedImageMouseMoveHandle.remove();var xb=false,yb=event.getTarget();if(ca.byClass(yb,"_10zv")){this.startSliderMargins=new bb(parseFloat(ua.get(this.innerImageSlider,'marginLeft')),parseFloat(ua.get(this.innerImageSlider,'marginTop')));this.startImageMargins=null;this.mouseDownStartPosition=new bb(event.clientX,event.clientY);}else if(ca.byClass(yb,"_10zx")){this.startSliderMargins=new bb(parseInt(ua.get(this.innerImageSlider,'marginLeft'),10),parseInt(ua.get(this.innerImageSlider,'marginTop'),10));this.startImageMargins=null;var zb=parseInt(ua.get(this.innerImageSlider,'width'),10);this.mouseDownStartPosition=new bb(this.innerImageSlider.getBoundingClientRect().left+zb/2,event.clientY);xb=true;}else if(ca.byClass(yb,"_10zw")){this.startImageMargins=new bb(parseInt(ua.get(this.zoomedImage,'marginLeft'),10),parseInt(ua.get(this.zoomedImage,'marginTop'),10));this.startSliderMargins=null;this.mouseDownStartPosition=new bb(event.clientX,event.clientY);}this._zoomedImageMouseMoveHandle=o.listen(this.stage,'mousemove',this._zoomedImagePan.bind(this));if(xb){this._zoomedImagePan(event);}else event.kill();};wb.prototype._zoomedImageMouseUp=function(event){"use strict";if(this._zoomedImageMouseMoveHandle){j.removeClass(this.stage,'showSlider');this._zoomedImageMouseMoveHandle.remove();this._zoomedImageMouseMoveHandle=null;var xb=parseFloat(ua.get(this.zoomedImage,'marginLeft')),yb=-this.zoomedImage.width+this.stage.clientWidth;this._previousZoomScrollPercent=xb/yb;}};wb.prototype._zoomedImagePan=function(event){"use strict";var xb;if(this.startSliderMargins){xb=event.clientX-this.mouseDownStartPosition.x;var yb=parseFloat(ua.get(this.outerImageSlider,'width')),zb=parseFloat(ua.get(this.innerImageSlider,'width')),ac=Math.max(0,Math.min(yb-zb,this.startSliderMargins.x+xb))/yb;ua.set(this.innerImageSlider,'marginLeft',100*ac+"%");ua.set(this.zoomedImage,'marginLeft',-1*ac*this.zoomedImage.width+'px');event.kill();}else if(this.startImageMargins){xb=1.75*(this.mouseDownStartPosition.x-event.clientX);var bc=Math.min(0,Math.max(this.startImageMargins.x-xb,-this.zoomedImage.width+this.stage.clientWidth));ua.set(this.zoomedImage,'marginLeft',bc+'px');ua.set(this.innerImageSlider,'marginLeft',(-bc/this.zoomedImage.width*100)+"%");event.kill();}};wb.prototype._scrollZoomedImageToPercent=function(xb){"use strict";if(xb===(void 0)||xb===null)xb=.5;var yb=new bb(parseInt(ua.get(this.zoomedImage,'width'),10),parseInt(ua.get(this.zoomedImage,'height'),10));ua.set(this.innerImageSlider,'marginLeft',((100-this._adjustInnerImageSlider(yb))*xb)+'%');ua.set(this.zoomedImage,'marginLeft',((this.stage.clientWidth-yb.x)*xb)+'px');};wb.prototype.switchVideo=function(xb,yb){"use strict";this._pauseVideoIfNeeded();var zb='swf_'+xb;l.empty(this.videoStage);if(yb){j.addClass(this.stageWrapper,'showVideo');var ac=this.stream.getCurrentImageData();if(this.shouldRenderVideoPivots){j.hide(this.nextPager);j.hide(this.prevPager);}var bc=ac.video_element;l.find(bc,"._ox1").style.cssText='';var cc=null;if(this.pivotsCarouselElement)cc=m.scry(this.pivotsCarouselElement,"._32_l");if(cc)cc.forEach(function(fc){var gc=fc.getAttribute('data-fbid'),hc=this.stream.getCursor(),ic=l.find(fc,"._1pqn");if(gc===hc){j.show(ic);}else j.hide(ic);}.bind(this));j.addClass(bc,'videoStageContainer');l.appendContent(this.videoStage,bc);l.appendContent(this.videoStage,this.pivotsCarouselElement);if(window[zb]&&!kb(zb))window[zb].write(xb);var dc='video_warning_'+xb,ec=kb(xb);if(!this.videoWarnings)this.videoWarnings=[];if(ec&&this.videoWarnings[dc])l.setContent(ec,this.videoWarnings[dc]);this._videoPlayerStateManager=ac.controller;this._videoPlayerStateManager.reset();if(this._autoplayVideos)this._videoPlayerStateManager.play(cb.USER);if(this._autoplayNextVideo)this._videoPlayerStateManager.addListener('finishPlayback',function(){var fc=ac.info.fbid.toString();if(fc===this.stream.getCursor()&&fc!==this.stream.fbidList[this.stream.fbidList.length-1]){ta.adjustCarouselOnAutoPlay();this.page(1,false);}}.bind(this));setTimeout(this.adjustStageSizeForVideo.bind(this,xb),0);}else{window[zb]&&window[zb].addVariable('video_autoplay',0);this.videoLoadTimer&&clearTimeout(this.videoLoadTimer);j.removeClass(this.stageWrapper,'showVideo');}};wb.prototype.checkVideoStatus=function(xb){"use strict";if(this.videoLoadTimer)clearTimeout(this.videoLoadTimer);var yb=this.getVideoOnStage();if(!yb){return;}else{if(yb!==xb)return;this.adjustStageSizeForVideo(xb);}};wb.prototype.getVideoSize=function(xb){"use strict";return new bb(xb.getAttribute('data-video-width'),+xb.getAttribute('data-video-height')+this.getVideoComponentsHeight(xb));};wb.prototype.getVideoElement=function(xb){"use strict";return l.scry(this.videoStage,"._ox1")[0];};wb.prototype.getVideoComponentsHeight=function(xb){"use strict";var yb=0,zb=ca.byClass(xb,"_1c_u");if(!zb)return 0;var ac=l.scry(zb,"._2i84");if(ac.length){var bc=ac[0].getBoundingClientRect();yb=bc.bottom-bc.top;}return yb;};wb.prototype.adjustStageSizeForVideo=function(xb){"use strict";var yb=this.getVideoElement(xb);if(!yb){this.videoLoadTimer=setTimeout(this.checkVideoStatus.bind(this,xb),200);}else this.adjustStageSize(this.getVideoSize(yb));};wb.prototype.handleServerError=function(xb,yb){"use strict";l.setContent(this.errorBox,xb);this.storeFromData(yb);};wb.prototype.fixButtonText=function(xb){"use strict";if(!this.buttonTruncateGk)return;var yb=l.scry(xb,".photosTruncatingUIButton"),zb=parseInt(ua.get(xb,'width'),10);if(zb>tb){var ac={tagPhoto:"\u5199\u771f\u306b\u30bf\u30b0\u4ed8\u3051",doneTagPhoto:"\u30bf\u30b0\u4ed8\u3051\u5b8c\u4e86",addLocation:"\u4f4d\u7f6e\u60c5\u5831\u3092\u8ffd\u52a0",editPhoto:"\u7de8\u96c6"};for(var bc=0;bc<yb.length;bc++){var cc=yb[bc];j.addClass(cc,"_2n0k");wa.set(cc,ac[cc.getAttribute('data-buttonname')],'below','center');}}};wb.prototype.swapData=function(){"use strict";var xb,yb=this.stream.getCurrentHtml();if(yb){this.setLoadingState(wb.STATE_HTML,false);for(var zb in yb){xb=kb(zb);xb&&l.setContent(xb,yb[zb]);}var ac=kb('photosTruncatingUIButtonGroup');ac&&this.fixButtonText(ac);g.inform('PhotoSnowlift.DATA_CHANGE',fb(this.stream.getCurrentImageData().info,{movement:this.movementDelta}),g.BEHAVIOR_STATE);this.movementDelta=0;if(this.stream.getCurrentExtraData())g.inform('PhotoSnowlift.EXTRA_DATA_CHANGE',this.stream.getCurrentExtraData(),g.BEHAVIOR_STATE);}this.adjustScroller();this.scrollableArea.showScrollbar(false);this.adjustForNewData();this.logImpressionDetailsForPhoto();};wb.prototype.updateTotalCount=function(xb,yb,zb){"use strict";var ac=this.stream.getCurrentHtml();if(ac){var bc=db('fbPhotoSnowliftPositionAndCount');l.replace(bc,zb);bc=zb;j.show(bc);var cc='fbPhotoSnowliftPositionAndCount';ac[cc]=gb(bc.childNodes);}this.stream.setTotalCount(xb);this.stream.setFirstCursorIndex(yb);};wb.prototype.addPhotoFbids=function(xb,yb,zb,ac){"use strict";if(ac&&this.sessionID&&ac!=this.sessionID)return;var bc=this.stream.getCursor()===null;if(this.shouldRenderVideoPivots&&!this._videoSameAsSource)this.stream.fbidList=[];this.stream.attachToFbidsList(xb,yb,zb);if(zb&&bc)this.page(0,true);if(this.pivots&&zb)this.pivots.setCycleCount(this.stream.calculateDistance(this.stream.getCursor(),this.stream.firstCursor));if(!this.pagersShown&&this.stream.canPage())this.setStagePagersState('ready');if(!this.slideshowAvailable&&this.stream.canPage()){this.slideshowAvailable=true;j.addClass(this.root,'slideshowAvailable');}this.setLeftAndRightPagersState();if(this.shouldRenderVideoPivots&&!this._videoSameAsSource){var cc=this.stream.getCursor(),dc=this.stream.calculateDistance(cc,this._mediaFBID);this.stream.moveCursor(dc);}};wb.prototype.attachTagger=function(xb){"use strict";l.appendContent(this.stageActions,xb);};wb.prototype.storeFromData=function(xb){"use strict";if(!this.isOpen)return;if(xb.pivots)this.pivotsCarouselElement=xb.pivots;this.shouldRenderVideoPivots=xb.should_render_pivots;if(xb.ssid&&this.sessionID&&this.sessionID!=xb.ssid)return;var yb=this.stream.storeToCache(xb);if('error' in yb){this.checkState(wb.STATE_ERROR);return;}if('init' in xb){if(this.shouldRenderVideoPivots)this._videoSameAsSource=xb.init.videoSameAsSource;this._mediaFBID=xb.init.fbid;this._albumFBID=xb.init.album_fbid;this._isAlbum=xb.init.is_album;this._albumOwnerName=xb.init.album_owner_name;this._autoplayVideos=xb.init.autoplay_videos;this._autoplayNextVideo=xb.init.autoplay_next_video;}if('init' in yb){this.initDataFetched(yb.init);if(this.openExplicitly){this.replaceUrl=true;mb(this.stream.getCurrentImageData().info.permalink);}if(this.stream.canPage())this.setStagePagersState('ready');this.setLeftAndRightPagersState();this.ua&&this.ua.add_event('ufi');}if('image' in yb)this.checkState(wb.STATE_IMAGE_DATA);if('data' in yb)this.checkState(wb.STATE_HTML);};wb.prototype.setLeftAndRightPagersState=function(){"use strict";if(this.stream.isNonCircularPhotoSet()){j.conditionClass(this.root,'disableLeft',!this.stream.nonCircularPhotoSetCanPage(-1));j.conditionClass(this.root,'disableRight',!this.stream.nonCircularPhotoSetCanPage(1));}if(this.snowflake){j.conditionClass(this.root,'disableLeft',this.stream.getCursor()==this.firstInSet);var xb=this.stream.getCursorAt(this.stream.calculatePositionForMovement(1));j.conditionClass(this.root,'disableRight',xb==this.firstInSet);}};wb.prototype.setStagePagersState=function(xb){"use strict";switch(xb){case 'ready':j.addClass(this.root,'pagingReady');this.pagersShown=true;this.ua&&this.ua.add_event('arrows');return;case 'active':j.addClass(this.root,'pagingActivated');return;case 'inactive':j.removeClass(this.root,'pagingActivated');return;case 'disabled':case 'reset':j.removeClass(this.root,'pagingReady');return;}};wb.prototype.deletePhoto=function(xb){"use strict";this.closeRefresh();};wb.prototype.closeRefresh=function(){"use strict";this.refreshOnClose=true;this.spotlight.hide();};wb.prototype.onHiliteTag=function(xb,yb){"use strict";if(yb.version!=fa.VIEWER_SNOWLIFT)return;var zb=yb.tag;if(zb)this.switchHilitedTags(zb,true);};wb.prototype.onUpdateTagBox=function(xb,yb){"use strict";if(yb.version==fa.VIEWER_SNOWLIFT)this.updateTagBox(yb.id,yb.approve);};wb.prototype._log=function(xb){"use strict";if(this._shouldLog){this._logger&&this._logger.log(xb);return true;}return false;};wb.prototype._enableMouseOver=function(){"use strict";this._disableMouseOver=false;};wb.prototype._interceptMouseOver=function(event){"use strict";if(this._disableMouseOver)event.kill();};wb.prototype.isReturningToStart=function(){"use strict";return !!this.returningToStart;};wb.prototype._pauseVideoIfNeeded=function(){"use strict";if(this._videoPlayerStateManager)this._videoPlayerStateManager.logStopForUnload();};wb.getInstance=function(){"use strict";if(!wb._instance)wb._instance=new wb();return wb._instance;};wb.initWithSpotlight=function(xb,yb){"use strict";wb.getInstance().init(xb,yb);};wb.addPhotoFbids=function(xb,yb,zb,ac){"use strict";wb.getInstance().addPhotoFbids(xb,yb,zb,ac);};wb.setReachedLeftEnd=function(){"use strict";wb.getInstance().setReachedLeftEnd();};wb.setReachedRightEnd=function(){"use strict";wb.getInstance().setReachedRightEnd();};wb.attachFollowFlyout=function(xb){"use strict";l.insertAfter(db('fbPhotoSnowliftSubscribe'),xb);};wb.attachSubscribeFlyout=function(xb){"use strict";l.insertAfter(db('fbPhotoSnowliftSubscribe'),xb);};wb.attachTagger=function(xb){"use strict";wb.getInstance().attachTagger(xb);};wb.preload=function(xb,yb){"use strict";wb.getInstance().preload(xb,yb);};wb.bootstrap=function(xb,yb){"use strict";var zb=xb&&za(xb).getQueryData();if(zb&&zb.hasOwnProperty('share_id')){i.loadModules(["SpotlightShareViewer"],function(ac){ac.bootstrap(xb,yb);});return;}wb.getInstance().bootstrap(xb,yb);};wb.closeRefresh=function(){"use strict";wb.getInstance().closeRefresh();};wb.deletePhoto=function(xb){"use strict";wb.getInstance().deletePhoto(xb);};wb.getImage=function(){"use strict";return wb.getInstance().getImage();};wb.getImageId=function(){"use strict";return wb.getInstance().getImageId();};wb.getLoadQuery=function(){"use strict";return wb.getInstance().getLoadQuery();};wb.getRHCBody=function(){"use strict";return wb.getInstance().getRHCBody();};wb.getRHCFooter=function(){"use strict";return wb.getInstance().getRHCFooter();};wb.getRHCHeader=function(){"use strict";return wb.getInstance().getRHCHeader();};wb.getRoot=function(){"use strict";return wb.getInstance().getRoot();};wb.likePhotoSkipConfirmation=function(xb){"use strict";wb.getInstance().likePhotoSkipConfirmation(xb);};wb.saveTagsFromPayload=function(xb){"use strict";wb.getInstance().saveTagsFromPayload(xb);};wb.saveTagsFromPayloadDelayed=function(xb){"use strict";setTimeout(wb.saveTagsFromPayload.bind(null,xb),2000);};wb.handleServerError=function(xb,yb){"use strict";wb.getInstance().handleServerError(xb,yb);};wb.setVideoWarning=function(xb,yb){"use strict";var zb=wb.getInstance(),ac='video_warning_'+xb;if(!zb.videoWarnings)zb.videoWarnings=[];zb.videoWarnings[ac]=yb;};wb.storeFromData=function(xb){"use strict";wb.getInstance().storeFromData(xb);};wb.swapData=function(){"use strict";wb.getInstance().swapData();};wb.updateTotalCount=function(xb,yb,zb){"use strict";wb.getInstance().updateTotalCount(xb,yb,zb);};wb.setVideoRotateURI=function(xb){"use strict";wb.getInstance().videoRotateURI=xb;};fb(wb,{STATE_ERROR:'error',STATE_HTML:'html',STATE_IMAGE_PIXELS:'image_pixels',STATE_IMAGE_DATA:'image',LOADING_TIMEOUT:2000,PAGER_FADE:3000,FULL_SCREEN_PADDING:10,STAGE_NORMAL_MAX:{x:960,y:960},STAGE_MIN:{x:520,y:520},SIDEBAR_SIZE_MAX:360,MIN_PANORAMA_Y:240,ZOOM_BUTTON_HEIGHT:52,ZOOM_BUTTON_BOT_PAD:60,ZOOM_BUTTON_TOP_PAD:16,MAX_SLIDER_HEIGHT:.075,MAX_SLIDER_WIDTH:.75,MIN_PANO_TO_STAGE_RATIO:1.2,STAGE_CHROME:{x:82,y:42},VIDEO_BOTTOM_BAR_SPACE:40,GOPREV_AREA:120,TIMELINE_STRETCH_WIDTH:843,TIMELINE_STRETCH_MIN:480,MIN_TAG_DISTANCE:83,PADDING_MIN:40,MIN_UFI_HEIGHT:250,COLLECTIONS_UNTAGGED_PHOTOS:3,PHOTOS_OF_YOU_SUGGESTIONS:28,FRIENDS_IN_PHOTOS_SUGGESTIONS:31,MIN_ADS_VISIBLE:1,PINNED_UFI_ADJUSTMENT:11,ADD_COMMENT_HEIGHT:54,SLIDESHOW_TIME:3000,_instance:null,touch:jb,touchMarkup:jb});fb(wb.prototype,{switchTimer:null,imageRefreshTimer:null,imageLoadingTimer:null,lastPage:0,currentMinSize:null,currentImageSize:null,resetUriStack:true,thumbSrc:null,shouldStretch:false,stageMax:wb.STAGE_NORMAL_MAX,stageChrome:wb.STAGE_CHROME,stagePagerPrev:null,ua:null,PhotoTagger:null});e.exports=wb;},null);